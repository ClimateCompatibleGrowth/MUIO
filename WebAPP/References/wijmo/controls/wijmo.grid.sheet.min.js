/*!
    *
    * Wijmo Library 5.20213.824
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

var wijmo,__extends=this&&this.__extends||function(){var extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}}();!function(e){!function(t){!function(t){t.softInput=function softInput(){return e._getModule("wijmo.input")};t.softXlsx=function softXlsx(){return e._getModule("wijmo.xlsx")}}(t.sheet||(t.sheet={}))}(e.grid||(e.grid={}))}(wijmo||(wijmo={}));!function(e){!function(e){!function(e){"use strict";e._ErrorMessages={InvalidCellRef:"Invalid cell reference.",InvalidSheetRef:"Invalid sheet reference.",InvalidTableRef:"Invalid table reference.",InvalidTableColRef:"Invalid table column reference.",InvalidParameters:"Invalid parameters.",BadExpression:"Bad expression.",CircRef:"Circular reference.",InvalidParameter:function(e){return'Invalid parameter: "'+e+'".'},ParameterIsOutOfRange:function(e){return'Parameter is out of range: "'+e+'".'},RowIsOutOfTableRange:function(e){return"The row is out of the table ("+e+") range."},UnkFuncName:function(e){return'The function "'+e+'" has not supported in FlexSheet yet.'},DefNameInvalidSheet:function(e){return'The defined name item works in "'+e+'". It does not work in current sheet.'},InvalidTable:function(e){return"The Table("+e+") is not located in any sheet."},InvalidExpression:function(e){return"Invalid Expression: "+e},Atan2ArgsLessThanZero:"The x number and y number can't both be zero for the atan2 function.",RateCriteriaFails:"It is not able to calculate the rate with current parameters.",RangesMustBeTheSame:"The row span and column span of each cell range has to be same with each other.",TooFewParameters:"Too few parameters.",TooManyParameters:"Too many parameters.",ExpressionExpected:"Expression expected.",UnbalancedParenthesis:"Unbalanced parenthesis.",UnbalancedSquareBrackets:"Unbalanced square brackets.",TableReferencesExpected:"Table references expected.",IdentifierExpected:"Identifier expected.",CantFindFinalQuote:"Can't find final quote.",IllegalCrossSheetReference:"Illegal cross sheet reference.",CantFindFinalDateDelimiter:'Can\'t find final date delimiter ("#").',CellRefMustBeInSameSheet:"The cell reference must be in the same sheet.",SyntaxError:"Syntax error."};var t;!function(e){e.Div="#DIV/0!";e.Name="#NAME?";e.Ref="#REF!";e.Num="#NUM!";e.Val="#VALUE!";e.Null="#NULL!";e.NA="#N/A"}(t||(t={}));var o=function(){function FormulaError(e,t){this._error=e;this._data=t}Object.defineProperty(FormulaError.prototype,"error",{get:function(){return this._error},enumerable:!0,configurable:!0});Object.defineProperty(FormulaError.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0});FormulaError.prototype.toString=function(){return this._error||(this._data||"").toString()};return FormulaError}();e.FormulaError=o;var n=function(e){__extends(DivideByZeroError,e);function DivideByZeroError(o){return e.call(this,t.Div,o)||this}return DivideByZeroError}(o);e.DivideByZeroError=n;var i=function(e){__extends(NameError,e);function NameError(o){return e.call(this,t.Name,o)||this}return NameError}(o);e.NameError=i;var l=function(e){__extends(ReferenceError,e);function ReferenceError(o){return e.call(this,t.Ref,o)||this}return ReferenceError}(o);e.ReferenceError=l;var r=function(e){__extends(NumericError,e);function NumericError(o){return e.call(this,t.Num,o)||this}return NumericError}(o);e.NumericError=r;var s=function(e){__extends(ValueError,e);function ValueError(o){return e.call(this,t.Val,o)||this}return ValueError}(o);e.ValueError=s;var a=function(e){__extends(NotAvailableError,e);function NotAvailableError(o){return e.call(this,t.NA,o)||this}return NotAvailableError}(o);e.NotAvailableError=a;var h=function(e){__extends(NullError,e);function NullError(o){return e.call(this,t.Null,o)||this}return NullError}(o);e.NullError=h;var u=function(e){__extends(UnknownError,e);function UnknownError(t){return e.call(this,"",t)||this}return UnknownError}(o);e.UnknownError=u;var d=function(e){__extends(SyntaxError,e);function SyntaxError(t){return e.call(this,"#SYNTAX",t)||this}return SyntaxError}(o);e.SyntaxError=d;var c=function(){function _FormulaErrorHelper(){}_FormulaErrorHelper.asError=function(e){return e instanceof o?e:"string"==typeof e?this.fromString(e):null};_FormulaErrorHelper.fromString=function(e){e=e.toUpperCase();if(this._errTypeMap[e])switch(e){case t.Div:return new n;case t.Name:return new i;case t.NA:return new a;case t.Null:return new h;case t.Num:return new r;case t.Ref:return new l;case t.Val:return new s}return null};_FormulaErrorHelper._errTypeMap=function(){var e={};Object.keys(t).forEach((function(o){return e[t[o]]=1}));return e}();return _FormulaErrorHelper}();e._FormulaErrorHelper=c}(e.sheet||(e.sheet={}))}(e.grid||(e.grid={}))}(wijmo||(wijmo={}));!function(e){!function(t){!function(t){"use strict";var o=function(){function Table(e,t,o,n,i){this._showHeaderRow=!0;this._showTotalRow=!1;this._showBandedColumns=!1;this._showBandedRows=!0;this._alterFirstColumn=!1;this._alterLastColumn=!1;this._orgHeaderCellsContent=[];if(!t.isValid)throw"The range of this table is invalid.";this._name=e;this._range=t.clone();this._style=o;null!=n&&n.length>0&&this._pushTableColumns(n);if(null!=i){null!=i.showHeaderRow&&(this._showHeaderRow=i.showHeaderRow);null!=i.showTotalRow&&(this._showTotalRow=i.showTotalRow);null!=i.showBandedColumns&&(this._showBandedColumns=i.showBandedColumns);null!=i.showBandedRows&&(this._showBandedRows=i.showBandedRows);null!=i.alterFirstColumn&&(this._alterFirstColumn=i.alterFirstColumn);null!=i.alterLastColumn&&(this._alterLastColumn=i.alterLastColumn)}}Object.defineProperty(Table.prototype,"name",{get:function(){return this._name},set:function(e){if(null==e||""===e)throw"The name of the Table should not be empty.";if(this._name.toLowerCase()!==e.toLowerCase()){var o=this._name;this._name=e;if(this._owner){var n=void 0;!this._owner._isUndoing&&this._owner.undoStack.stackSize>0&&(n=new t._TableSettingAction(this._owner,this));this._owner._updateFormulasWithNameUpdating(o,e,!0);if(n){n.saveNewState();this._owner.undoStack._addAction(n);n=null}}}},enumerable:!0,configurable:!0});Object.defineProperty(Table.prototype,"sheet",{get:function(){return this._sheet},enumerable:!0,configurable:!0});Object.defineProperty(Table.prototype,"style",{get:function(){return this._style},set:function(e){if(e.name!==this._style.name){var o=void 0;this._owner&&!this._owner._isUndoing&&this._owner.undoStack.stackSize>0&&(o=new t._TableSettingAction(this._owner,this));this._style=e;if(this._owner){if(o){o.saveNewState();this._owner.undoStack._addAction(o);o=null}this._owner.refresh()}}},enumerable:!0,configurable:!0});Object.defineProperty(Table.prototype,"showHeaderRow",{get:function(){return this._showHeaderRow},set:function(e){if(e!==this._showHeaderRow){var o=void 0,n=this._showHeaderRow;this._owner&&!this._owner._isUndoing&&this._owner.undoStack.stackSize>0&&(o=new t._TableSettingAction(this._owner,this));this._showHeaderRow=e;if(this._owner)try{this._owner.beginUpdate();this._adjustTableRangeWithHeaderRow();if(o){o.saveNewState();this._owner.undoStack._addAction(o)}}catch(e){this._showHeaderRow=n;throw e}finally{o=null;this._owner.endUpdate()}}},enumerable:!0,configurable:!0});Object.defineProperty(Table.prototype,"showTotalRow",{get:function(){return this._showTotalRow},set:function(e){if(e!==this._showTotalRow){var o=void 0,n=this._showTotalRow;this._owner&&!this._owner._isUndoing&&this._owner.undoStack.stackSize>0&&(o=new t._TableSettingAction(this._owner,this));this._showTotalRow=e;if(this._owner)try{this._owner.beginUpdate();this._adjustTableRangeWithTotalRow();if(o){o.saveNewState();this._owner.undoStack._addAction(o)}}catch(e){this._showTotalRow=n;throw e}finally{o=null;this._owner.endUpdate()}}},enumerable:!0,configurable:!0});Object.defineProperty(Table.prototype,"showBandedColumns",{get:function(){return this._showBandedColumns},set:function(e){if(e!==this._showBandedColumns){var o=void 0;this._owner&&!this._owner._isUndoing&&this._owner.undoStack.stackSize>0&&(o=new t._TableSettingAction(this._owner,this));this._showBandedColumns=e;if(this._owner){if(o){o.saveNewState();this._owner.undoStack._addAction(o);o=null}this._owner.refresh()}}},enumerable:!0,configurable:!0});Object.defineProperty(Table.prototype,"showBandedRows",{get:function(){return this._showBandedRows},set:function(e){if(e!==this._showBandedRows){var o=void 0;this._owner&&!this._owner._isUndoing&&this._owner.undoStack.stackSize>0&&(o=new t._TableSettingAction(this._owner,this));this._showBandedRows=e;if(this._owner){if(o){o.saveNewState();this._owner.undoStack._addAction(o);o=null}this._owner.refresh()}}},enumerable:!0,configurable:!0});Object.defineProperty(Table.prototype,"alterFirstColumn",{get:function(){return this._alterFirstColumn},set:function(e){if(e!==this._alterFirstColumn){var o=void 0;this._owner&&!this._owner._isUndoing&&this._owner.undoStack.stackSize>0&&(o=new t._TableSettingAction(this._owner,this));this._alterFirstColumn=e;if(this._owner){if(o){o.saveNewState();this._owner.undoStack._addAction(o);o=null}this._owner.refresh()}}},enumerable:!0,configurable:!0});Object.defineProperty(Table.prototype,"alterLastColumn",{get:function(){return this._alterLastColumn},set:function(e){if(e!==this._alterLastColumn){var o=void 0;this._owner&&!this._owner._isUndoing&&this._owner.undoStack.stackSize>0&&(o=new t._TableSettingAction(this._owner,this));this._alterLastColumn=e;if(this._owner){if(o){o.saveNewState();this._owner.undoStack._addAction(o);o=null}this._owner.refresh()}}},enumerable:!0,configurable:!0});Table.prototype._isHeaderRow=function(e){return this._showHeaderRow&&e===this._range.topRow};Table.prototype._getTableRange=function(){return this._range};Table.prototype._getColumns=function(){return this._columns||[]};Table.prototype.getRange=function(e,t){void 0===e&&(e=i.All);var o;switch(e){case i.Data:o=this._getDataRange();break;case i.Header:o=this._getHeaderRange();break;case i.Footer:o=this._getFooterRange();break;default:o=this._range.clone()}if(null!=t&&o){var n=this._getColumnIndex(t);if(null==n)return null;o.col=o.col2=o.leftCol+n}return o};Table.prototype.getColumns=function(){return this._columns?this._columns.slice():[]};Table.prototype.insertRows=function(t,o,n){void 0===n&&(n=!0);var i=!1;null==o&&(o=1);if(!e.isInt(o)||o<1)return!1;if(0===t&&this._showHeaderRow||t===this._range.rowSpan-1&&this._showTotalRow||t<0||t>=this._range.rowSpan)return!1;if(this._owner){var l=this.getRange(),r=this._flex;this._owner.beginUpdate();if(n){var s=new e.grid.CellRange(l.bottomRow+1,l.col,l.bottomRow+1,l.col2);if(this._sheet._canShiftCells(s)){var a=this._sheet._needAddRowCountForInsertTableRows(o,l);if(r.collectionView){var h=r.itemsSource instanceof e.collections.CollectionView;r.collectionView.beginUpdate();for(var u=0;u<a;u++)h?r.itemsSource.sourceCollection.push({}):r.itemsSource.push({});r.collectionView.endUpdate(!0)}else for(u=0;u<a;u++)r.rows.push(new e.grid.Row);this._sheet._moveDownCells(o,s);i=!0}}else this._canInsertRowsWithoutShift(o)&&(i=!0);if(i){this._sheet._moveDownCellsWithinTable(t,o,l);this._updateTableRange(0,o,0,0)}this._owner.endUpdate()}else{this._updateTableRange(0,o,0,0);i=!0}return i};Table.prototype.deleteRows=function(t,o,n){void 0===n&&(n=!0);null==o&&(o=1);if(e.isInt(o)&&!(o<1)&&!(0===t&&this._showHeaderRow||t===this._range.rowSpan-1&&this._showTotalRow||t<0||t>=this._range.rowSpan||t+o>this._range.rowSpan-(this._showTotalRow?1:0)))if(this._owner){var i=!1,l=this.getRange(),r=void 0;this._owner.beginUpdate();if(n){r=new e.grid.CellRange(l.bottomRow+1,l.col,l.bottomRow+1,l.col2);this._sheet._canShiftCells(r)&&(i=!0)}else i=!0;if(i){this._sheet._moveUpCellsWithinTable(t,o,l);n&&this._sheet._moveUpCells(o,r);this._updateTableRange(0,-o,0,0)}this._owner.endUpdate()}else this._updateTableRange(0,-o,0,0)};Table.prototype._addColumn=function(e,t){if(e<=0||e>this._columns.length)throw"The column index is out of range.";t=this._getUniqueColumnName(e,t);var o=new n(t);o._attach(this);this._columns.splice(e,0,o);if(this.showHeaderRow&&this._owner&&this._sheet){var i=this.getRange();this._flex.setCellData(i.topRow,i.leftCol+e,t)}};Table.prototype._updateCell=function(e,t,o){if(null!=this._style){var n=e-this._range.topRow,i=t-this._range.leftCol,l=this._getTableCellAppliedStyles(n,i);this._applyStylesForCell(l,o)}};Table.prototype._updateTableRange=function(e,t,o,n){if(this._range.row<=this._range.row2){this._range.row+=e;this._range.row2+=t}else{this._range.row2+=e;this._range.row+=t}if(this._range.col<=this._range.col2){this._range.col+=o;this._range.col2+=n}else{this._range.col2+=o;this._range.col+=n}};Table.prototype._setTableRange=function(e,t){this._range=e;if(null!=t){this._columns.splice(0,this._columns.length);for(var o=0;o<t.length;o++)this._columns.push(t[o])}};Table.prototype._updateColumnName=function(e,t,o){void 0===o&&(o=!0);var n=this._columns[e];if(!n||!n.name||n.name!==t){t=this._getUniqueColumnName(null,t);n.name=t;if(this._showHeaderRow&&this._owner&&this._sheet&&o){this._flex.setCellData(this._range.topRow,this._range.leftCol+e,t)}}};Table.prototype._updateColumnTotalRowContent=function(e,t){null==t&&(t=this._columns.indexOf(e));if(!(t<0)){var o;if(e.totalRowFunction){var n=this._getSubtotalFunction(e.totalRowFunction.toLowerCase());o=null!=n?"=subtotal("+n+",["+e.name+"])":"="===e.totalRowFunction[0]?e.totalRowFunction:"="+e.totalRowFunction}else if(0===t){e.totalRowLabel||(e.totalRowLabel="Total");o=e.totalRowLabel}else o=e.totalRowLabel;if(this._owner&&this._sheet){this._flex.setCellData(this._range.bottomRow,this._range.leftCol+t,o,!1)}}};Table.prototype._attachSheet=function(e){if(!this._sheet||!this._owner){this._sheet=e;this._owner=e._owner;if(null!=this._owner){if(this._owner._containsMergedCells(this._range,e))throw"Table does not allow the merged cell within the table.";var t=this.getRange();null==this._style&&(this._style=this._owner.getBuiltInTableStyle("TableStyleMedium9"));null!=this._columns&&0!==this._columns.length||this._generateColumns(this._showHeaderRow);try{this._owner.beginUpdate();this._showHeaderRow&&1===t.rowSpan&&this._adjustTableRangeWithHeaderRow();this._showTotalRow&&this._updateTotalRow()}finally{this._attached=!0;this._owner.endUpdate()}}}};Table.prototype._detachSheet=function(){this._attached=!1;this._sheet=null;this._owner=null};Object.defineProperty(Table.prototype,"_flex",{get:function(){return this._sheet===this._owner.selectedSheet?this._owner:this._sheet.grid},enumerable:!0,configurable:!0});Table.prototype._pushTableColumns=function(e){this._columns=[];for(var t=0;t<e.length;t++){var o=e[t];o._attach(this);this._columns.push(o)}};Table.prototype._generateColumns=function(o){if(!this._range.isValid)throw"The range of the table is invalid.";this._columns=[];for(var i=0;i<this._range.columnSpan;i++){var l=null,r=this._sheet.grid.columns[this._range.leftCol+i],s=this._range.topRow*this._sheet.grid.columns.length+this._range.leftCol+i,a=void 0,h=void 0,u=this._flex;if(1===this._range.rowSpan)a=this._getUniqueColumnName(i+1);else{null==(a=l=this._sheet.grid.getCellData(this._range.topRow,this._range.leftCol+i,!1))&&(a="");t._isFormula(a)&&(a=this._owner.evaluate(a,"",this._sheet,!1));h=this._sheet._styledCells[s];var d=this._owner._formatEvaluatedResult(a,r,h?h.format:"");null!=a&&""==d||(a=d);a=this._getUniqueColumnName(i+1,a.toString())}if(o&&this._range.rowSpan>1){this._orgHeaderCellsContent[i]=this._sheet.grid.getCellData(this._range.topRow,this._range.leftCol+i,!1);isNaN(+a)||r.format||h&&h.format||(h?h.format="@":this._sheet._styledCells[s]={format:"@"});u.setCellData(this._range.topRow,this._range.leftCol+i,r.dataType===e.DataType.Boolean&&e.isBoolean(l)?l:a,!1)}var c=new n(a);c._attach(this);0===i?c._totalRowLabel="Total":i===this._range.columnSpan-1&&(c._totalRowFunction="Sum");this._columns.push(c)}};Table.prototype._getTableCellAppliedStyles=function(e,t){var o={},n=0,i=!1,l=!1;this._showHeaderRow&&(n=1);this._showHeaderRow&&0===e?i=!0:this._showTotalRow&&e===this._range.rowSpan-1&&(l=!0);this._extendStyle(o,this._style.wholeTableStyle,e,t,i,l);if(!i&&!l){if(this._showBandedColumns&&(null!=this._style.firstBandedColumnStyle||null!=this._style.secondBandedColumnStyle)){var r=void 0;t%((r=this._style.firstBandedColumnStyle?null==this._style.firstBandedColumnStyle.size?1:this._style.firstBandedColumnStyle.size:1)+(this._style.secondBandedColumnStyle?null==this._style.secondBandedColumnStyle.size?1:this._style.secondBandedColumnStyle.size:1))>=r?this._style.secondBandedColumnStyle&&this._extendStyle(o,this._style.secondBandedRowStyle,e,t,i,l):this._style.firstBandedColumnStyle&&this._extendStyle(o,this._style.firstBandedColumnStyle,e,t,i,l)}if(this._showBandedRows&&(null!=this._style.firstBandedRowStyle||null!=this._style.secondBandedRowStyle)){r=void 0;(e-n)%((r=this._style.firstBandedRowStyle?null==this._style.firstBandedRowStyle.size?1:this._style.firstBandedRowStyle.size:1)+(this._style.secondBandedRowStyle?null==this._style.secondBandedRowStyle.size?1:this._style.secondBandedRowStyle.size:1))>=r?this._style.secondBandedRowStyle&&this._extendStyle(o,this._style.secondBandedRowStyle,e,t,i,l):this._style.firstBandedRowStyle&&this._extendStyle(o,this._style.firstBandedRowStyle,e,t,i,l)}}this._alterLastColumn&&t===this._range.columnSpan-1&&this._style.lastColumnStyle&&this._extendStyle(o,this._style.lastColumnStyle,e,t,i,l);this._alterFirstColumn&&0===t&&this._style.firstColumnStyle&&this._extendStyle(o,this._style.firstColumnStyle,e,t,i,l);if(i){this._style.headerRowStyle&&this._extendStyle(o,this._style.headerRowStyle,e,t,i,l);t===this._range.columnSpan-1&&this._style.lastHeaderCellStyle&&this._extendStyle(o,this._style.lastHeaderCellStyle,e,t,i,l);0===t&&this._style.firstHeaderCellStyle&&this._extendStyle(o,this._style.firstHeaderCellStyle,e,t,i,l)}else if(l){this._style.totalRowStyle&&this._extendStyle(o,this._style.totalRowStyle,e,t,i,l);t===this._range.columnSpan-1&&this._style.lastTotalCellStyle&&this._extendStyle(o,this._style.lastTotalCellStyle,e,t,i,l);0===t&&this._style.firstTotalCellStyle&&this._extendStyle(o,this._style.firstTotalCellStyle,e,t,i,l)}return o};Table.prototype._applyStylesForCell=function(e,t){var o=t.style;for(var n in e){var i=e[n];i&&(o[n]=i)}};Table.prototype._extendStyle=function(e,t,o,n,i,l){for(var r in t){var s=t[r];null!==s&&(r.indexOf("borderTop")>-1?(0===o||l)&&(e[r]=s):r.indexOf("borderBottom")>-1?(o===this._range.rowSpan-1||i)&&(e[r]=s):r.indexOf("borderLeft")>-1?0===n&&(e[r]=s):r.indexOf("borderRight")>-1?n===this._range.columnSpan-1&&(e[r]=s):r.indexOf("borderHorizontal")>-1?o<this._range.rowSpan-1&&("borderHorizontalStyle"===r?e.borderBottomStyle=s:"borderHorizontalWidth"===r?e.borderBottomWidth=s:e.borderBottomColor=s):r.indexOf("borderVertical")>-1?n<this._range.columnSpan-1&&("borderVerticalStyle"===r?e.borderRightStyle=s:"borderVerticalWidth"===r?e.borderRightWidth=s:e.borderRightColor=s):e[r]=s)}};Table.prototype._getSubtotalFunction=function(e){switch(e){case"average":return"101";case"countnums":return"102";case"count":return"103";case"max":return"104";case"min":return"105";case"stddev":return"107";case"sum":return"109";case"var":return"110"}return null};Table.prototype._checkColumnNameExist=function(e){for(var t=this.getColumns(),o=0;o<t.length;o++){if(t[o].name.toLowerCase()===e.toLowerCase())return!0}return!1};Table.prototype._adjustTableRangeWithHeaderRow=function(){var t=this._flex;if(this._showHeaderRow){if(this._sheet._needMoveDownTable(this)){var o=this.getRange(),n=new e.grid.CellRange(o.bottomRow+1,o.col,o.bottomRow+1,o.col2);if(!this._sheet._canShiftCells(n))throw"The operation is not allowed.  The operation is attempting to shift the cells in a table or a merged cell on the current sheet.";if(1===this._sheet._needAddRowCountForInsertTableRows(1,o))if(t.collectionView){t.collectionView.beginUpdate();t.itemsSource instanceof e.collections.CollectionView?t.itemsSource.sourceCollection.push({}):t.itemsSource.push({});t.collectionView.endUpdate(!0)}else t.rows.push(new e.grid.Row);this._sheet._moveDownCells(1,n);this._sheet._moveDownTable(this)}this._range.row<=this._range.row2?this._range.row-=1:this._range.row2-=1;for(var i=0;i<this._columns.length;i++){var l=this._columns[i];this._orgHeaderCellsContent[i]=t.getCellData(this._range.topRow,this._range.leftCol+i,!1);t.setCellData(this._range.topRow,this._range.leftCol+i,l.name)}}else{for(i=this._range.leftCol;i<=this._range.rightCol;i++)t.setCellData(this._range.topRow,i,"");this._range.row<=this._range.row2?this._range.row+=1:this._range.row2+=1}};Table.prototype._adjustTableRangeWithTotalRow=function(){var t=this._sheet===this._owner.selectedSheet?this._owner:this._sheet.grid,o=this.getRange(),n=new e.grid.CellRange(o.bottomRow+1,o.col,o.bottomRow+1,o.col2);if(this._showTotalRow){if(this._sheet._canShiftCells(n)){if(1===this._sheet._needAddRowCountForInsertTableRows(1,o))if(t.collectionView){t.collectionView.beginUpdate();t.itemsSource instanceof e.collections.CollectionView?t.itemsSource.sourceCollection.push({}):t.itemsSource.push({});t.collectionView.endUpdate(!0)}else t.rows.push(new e.grid.Row);this._sheet._moveDownCells(1,n);this._owner._updateAffectedFormula(this._range.bottomRow+1,1,!0,!0,this.getRange())}else if(!this._beneathRowIsEmpty())throw"The operation is not allowed.  The operation is attempting to shift the cells in a table or a merged cell on the current sheet.";this._range.row<=this._range.row2?this._range.row2+=1:this._range.row+=1;this._updateTotalRow()}else{for(var i=this._range.leftCol;i<=this._range.rightCol;i++)t.setCellData(this._range.bottomRow,i,"");if(this._sheet._canShiftCells(n)){this._owner._updateAffectedFormula(this._range.bottomRow,1,!1,!0,this.getRange());this._sheet._moveUpCells(1,n)}this._range.row<=this._range.row2?this._range.row2-=1:this._range.row-=1}};Table.prototype._updateTotalRow=function(){if(this.showTotalRow)for(var e=0;e<this._columns.length;e++){var t=this._columns[e];this._updateColumnTotalRowContent(t,e)}};Table.prototype._getUniqueColumnName=function(e,t){null!=t&&""!==t||(t="Column"+e);if(this._checkColumnNameExist(t)){for(var o=1,n=t+o;this._checkColumnNameExist(n);)n=t+ ++o;t=n}return t};Table.prototype._moveColumns=function(e,t){if(this._columns){var o=this._columns[e];this._columns.splice(e,1);t<0&&(t=this._columns.length);this._columns.splice(t,0,o)}};Table.prototype._canInsertRowsWithoutShift=function(e){var t=this._flex;if(this._range.bottomRow+e>=t.rows.length)return!1;for(var o=1;o<=e;o++)for(var n=this._range.bottomRow+o,i=this._range.leftCol;i<=this._range.rightCol;i++){var l=t.getCellData(n,i,!1),r=this._sheet.getCellStyle(n,i);if(null!=l&&""!==l||null!=r)return!1}return!0};Table.prototype._beneathRowIsEmpty=function(){var e=this._range.bottomRow+1,t=this._flex;if(e>=t.rows.length)return!1;for(var o=this._range.leftCol;o<=this._range.rightCol;o++){var n=t.getCellData(this._range.bottomRow+1,o,!1);if(null!=n&&""!==n)return!1;if(null!=this._sheet.getCellStyle(this._range.bottomRow+1,o))return!1;if(this._sheet.findTable(e,o))return null;var i=e*t.columns.length+o;if(null!=this._sheet._mergedRanges[i])return!1}return!0};Table.prototype._getDataRange=function(){var t=this._range.topRow,o=this._range.bottomRow;this._showHeaderRow&&(t+=1);this._showTotalRow&&(o-=1);return new e.grid.CellRange(t,this._range.leftCol,o,this._range.rightCol)};Table.prototype._getHeaderRange=function(){return this._showHeaderRow?new e.grid.CellRange(this._range.topRow,this._range.leftCol,this._range.topRow,this._range.rightCol):null};Table.prototype._getFooterRange=function(){return this._showTotalRow?new e.grid.CellRange(this._range.bottomRow,this._range.leftCol,this._range.bottomRow,this._range.rightCol):null};Table.prototype._getColumnIndex=function(t){var o;if(e.isInt(t)&&t>=0&&t<this._columns.length)o=t;else{var i=void 0;t instanceof n?i=t.name.toLowerCase():e.isString(t)&&""!==t&&(i=t.toLowerCase());for(var l=this.getColumns(),r=0;r<l.length;r++)if(l[r].name.toLowerCase()===i){o=r;break}}return o};return Table}();t.Table=o;var n=function(){function TableColumn(e,t,o,n){void 0===n&&(n=!0);this._name=e;this._totalRowLabel=t;this._totalRowFunction=o;null!=n&&(this._showFilterButton=n)}Object.defineProperty(TableColumn.prototype,"table",{get:function(){return this._table},enumerable:!0,configurable:!0});Object.defineProperty(TableColumn.prototype,"name",{get:function(){return this._name},set:function(e){e!==this._name&&(this._name=e)},enumerable:!0,configurable:!0});Object.defineProperty(TableColumn.prototype,"totalRowLabel",{get:function(){return this._totalRowLabel},set:function(e){if(e!==this._totalRowLabel){this._totalRowLabel=e;this._updateTableTotalInfo()}},enumerable:!0,configurable:!0});Object.defineProperty(TableColumn.prototype,"totalRowFunction",{get:function(){return this._totalRowFunction},set:function(e){if(e!==this._totalRowFunction){this._totalRowFunction=e;this._updateTableTotalInfo()}},enumerable:!0,configurable:!0});Object.defineProperty(TableColumn.prototype,"showFilterButton",{get:function(){return this._showFilterButton},set:function(e){this._showFilterButton!==e&&(this._showFilterButton=e)},enumerable:!0,configurable:!0});TableColumn.prototype._attach=function(e){this._table=e};TableColumn.prototype._updateTableTotalInfo=function(){if(this._table&&this._table.showTotalRow){this._table._updateColumnTotalRowContent(this);this._table._owner&&this._table._owner.refresh()}};return TableColumn}();t.TableColumn=n;var i,l=function(){function TableStyle(e,t){void 0===t&&(t=!1);this._name=e;this._isBuiltIn=t}Object.defineProperty(TableStyle.prototype,"name",{get:function(){return this._name},set:function(e){e!==this._name&&(this._name=e)},enumerable:!0,configurable:!0});Object.defineProperty(TableStyle.prototype,"wholeTableStyle",{get:function(){return this._wholeTableStyle},set:function(e){this._wholeTableStyle=e},enumerable:!0,configurable:!0});Object.defineProperty(TableStyle.prototype,"firstBandedColumnStyle",{get:function(){return this._firstBandedColumnStyle},set:function(e){this._firstBandedColumnStyle=e},enumerable:!0,configurable:!0});Object.defineProperty(TableStyle.prototype,"secondBandedColumnStyle",{get:function(){return this._secondBandedColumnStyle},set:function(e){this._secondBandedColumnStyle=e},enumerable:!0,configurable:!0});Object.defineProperty(TableStyle.prototype,"firstBandedRowStyle",{get:function(){return this._firstBandedRowStyle},set:function(e){this._firstBandedRowStyle=e},enumerable:!0,configurable:!0});Object.defineProperty(TableStyle.prototype,"secondBandedRowStyle",{get:function(){return this._secondBandedRowStyle},set:function(e){this._secondBandedRowStyle=e},enumerable:!0,configurable:!0});Object.defineProperty(TableStyle.prototype,"firstColumnStyle",{get:function(){return this._firstColumnStyle},set:function(e){this._firstColumnStyle=e},enumerable:!0,configurable:!0});Object.defineProperty(TableStyle.prototype,"lastColumnStyle",{get:function(){return this._lastColumnStyle},set:function(e){this._lastColumnStyle=e},enumerable:!0,configurable:!0});Object.defineProperty(TableStyle.prototype,"headerRowStyle",{get:function(){return this._headerRowStyle},set:function(e){this._headerRowStyle=e},enumerable:!0,configurable:!0});Object.defineProperty(TableStyle.prototype,"totalRowStyle",{get:function(){return this._totalRowStyle},set:function(e){this._totalRowStyle=e},enumerable:!0,configurable:!0});Object.defineProperty(TableStyle.prototype,"firstHeaderCellStyle",{get:function(){return this._firstHeaderCellStyle},set:function(e){this._firstHeaderCellStyle=e},enumerable:!0,configurable:!0});Object.defineProperty(TableStyle.prototype,"lastHeaderCellStyle",{get:function(){return this._lastHeaderCellStyle},set:function(e){this._lastHeaderCellStyle=e},enumerable:!0,configurable:!0});Object.defineProperty(TableStyle.prototype,"firstTotalCellStyle",{get:function(){return this._firstTotalCellStyle},set:function(e){this._firstTotalCellStyle=e},enumerable:!0,configurable:!0});Object.defineProperty(TableStyle.prototype,"lastTotalCellStyle",{get:function(){return this._lastTotalCellStyle},set:function(e){this._lastTotalCellStyle=e},enumerable:!0,configurable:!0});Object.defineProperty(TableStyle.prototype,"isBuiltIn",{get:function(){return this._isBuiltIn},enumerable:!0,configurable:!0});return TableStyle}();t.TableStyle=l;!function(e){e[e.All=0]="All";e[e.Data=1]="Data";e[e.Header=2]="Header";e[e.Footer=3]="Footer"}(i=t.TableSection||(t.TableSection={}))}(t.sheet||(t.sheet={}))}(e.grid||(e.grid={}))}(wijmo||(wijmo={}));!function(e){!function(t){!function(t){"use strict";var o=function(){function _UndoAction(e){this._owner=e;this._sheetIndex=e.selectedSheetIndex}Object.defineProperty(_UndoAction.prototype,"sheetIndex",{get:function(){return this._sheetIndex},enumerable:!0,configurable:!0});_UndoAction.prototype.undo=function(){throw"This abstract method must be overridden."};_UndoAction.prototype.redo=function(){throw"This abstract method must be overridden."};_UndoAction.prototype.saveNewState=function(){throw"This abstract method must be overridden."};return _UndoAction}();t._UndoAction=o;var n=function(e){__extends(_EditAction,e);function _EditAction(t,o){var n=e.call(this,t)||this;n._isPaste=!1;n._selections=o?[o]:t.selectedSheet.selectionRanges.length>0?t.selectedSheet.selectionRanges.slice():[t.selection.clone()];n._mergeAction=new h(t);n._cellStyleAction=new a(t);n._saveValues(!0);return n}Object.defineProperty(_EditAction.prototype,"isPaste",{get:function(){return this._isPaste},enumerable:!0,configurable:!0});_EditAction.prototype.undo=function(){this._handleUndoRedo(!0)};_EditAction.prototype.redo=function(){this._handleUndoRedo(!1)};_EditAction.prototype.saveNewState=function(){if(!this._saveValues(!1))return!1;this._mergeAction.saveNewState();this._cellStyleAction.saveNewState();return this._checkActionState()};_EditAction.prototype.markIsPaste=function(){this._isPaste=!0};_EditAction.prototype.updateForPasting=function(e){var t=this._selections[this._selections.length-1],o=this._owner.getCellData(e.row,e.col,!!this._owner.columns[e.col].dataMap);if(!t){t=this._owner.selection;this._selections=[t]}o=null==o?"":o;this._oldValues["r"+e.row+"_c"+e.col]={row:e.row,col:e.col,value:o};t.row=Math.min(t.topRow,e.topRow);t.row2=Math.max(t.bottomRow,e.bottomRow);t.col=Math.min(t.leftCol,e.leftCol);t.col2=Math.max(t.rightCol,e.rightCol)};_EditAction.prototype._storeDeletedTables=function(e){null==this._deletedTables&&(this._deletedTables=[]);this._deletedTables.push(e)};_EditAction.prototype._checkActionState=function(){var e=this,t=!1;Object.keys(e._oldValues).forEach((function(o){var n,i;if(!t){n=e._oldValues[o];i=e._newValues[o];n&&i&&n.value!==i.value&&(t=!0)}}));return t||e._mergeAction._checkActionState()||e._cellStyleAction._checkActionState()};_EditAction.prototype._saveValues=function(e){for(var t={},o=0;o<this._selections.length;o++)for(var n=this._selections[o],i=n.topRow;i<=n.bottomRow;i++)if(!(i<0))for(var l=n.leftCol;l<=n.rightCol;l++){var r=this._owner.columns[l];if(!r)return!1;var s=this._owner.getCellData(i,l,!!r.dataMap);s=null==s?"":s;t["r"+i+"_c"+l]={row:i,col:l,value:s}}e?this._oldValues=t:this._newValues=t;return!0};_EditAction.prototype._handleUndoRedo=function(e){var t=this;t._owner._clearCalcEngine();t._owner.selectedSheet.selectionRanges.clear();t._owner.deferUpdate((function(){var o,n=e?t._oldValues:t._newValues;if(t._deletedTables&&t._deletedTables.length>0)for(var i=0;i<t._deletedTables.length;i++){var l=t._deletedTables[i];e?t._owner.selectedSheet.tables.push(l):t._owner.selectedSheet.tables.remove(l)}for(i=0;i<t._selections.length;i++){var r=t._selections[i];t._owner.selectedSheet.selectionRanges.push(r)}Object.keys(n).forEach((function(e){var o=n[e];t._owner.setCellData(o.row,o.col,o.value)}));t._affectedFormulas&&(o=e?t._affectedFormulas.oldFormulas:t._affectedFormulas.newFormulas);if(o&&o.length>0)for(i=0;i<o.length;i++){var s=o[i];t._owner.setCellData(s.point.x,s.point.y,s.formula)}if(e){t._mergeAction.undo();t._cellStyleAction.undo()}else{t._mergeAction.redo();t._cellStyleAction.redo()}t._owner.refresh(!1)}))};return _EditAction}(o);t._EditAction=n;var i=function(e){__extends(_ColumnResizeAction,e);function _ColumnResizeAction(t,o,n){var i=e.call(this,t)||this;i._panel=o;i._colIndex=n;i._oldColWidth=o.columns[n].width;return i}_ColumnResizeAction.prototype.undo=function(){this._handleUndoRedo(!0)};_ColumnResizeAction.prototype.redo=function(){this._handleUndoRedo(!1)};_ColumnResizeAction.prototype.saveNewState=function(){this._newColWidth=this._panel.columns[this._colIndex].width;return this._oldColWidth!==this._newColWidth};_ColumnResizeAction.prototype._handleUndoRedo=function(e){var t=this._panel.columns[this._colIndex];t&&(t.width=e?this._oldColWidth:this._newColWidth)};return _ColumnResizeAction}(o);t._ColumnResizeAction=i;var l=function(e){__extends(_RowResizeAction,e);function _RowResizeAction(t,o,n){var i=e.call(this,t)||this;i._panel=o;i._rowIndex=n;i._oldRowHeight=o.rows[n].height;return i}_RowResizeAction.prototype.undo=function(){this._handleUndoRedo(!0)};_RowResizeAction.prototype.redo=function(){this._handleUndoRedo(!1)};_RowResizeAction.prototype.saveNewState=function(){this._newRowHeight=this._panel.rows[this._rowIndex].height;return this._oldRowHeight!==this._newRowHeight};_RowResizeAction.prototype._handleUndoRedo=function(e){var t=this._panel.rows[this._rowIndex];t&&(t.height=e?this._oldRowHeight:this._newRowHeight)};return _RowResizeAction}(o);t._RowResizeAction=l;var r=function(e){__extends(_ColumnsChangedAction,e);function _ColumnsChangedAction(t,o,n,i){var l=e.call(this,t)||this;l._delSubActions=[];l._columnIndex=o;l._count=n;l._isAdding=i;l._saveValues(!0);return l}_ColumnsChangedAction.prototype.undo=function(){this._handleUndoRedo(!0)};_ColumnsChangedAction.prototype.redo=function(){this._handleUndoRedo(!1)};_ColumnsChangedAction.prototype.saveNewState=function(){this._saveValues(!1);return!0};_ColumnsChangedAction.prototype._saveValues=function(e){var t=[],o=[];if(null==this._isAdding)for(var n=0;n<this._owner.columns.length;n++)t.push(this._owner.columns[n]);else if(e&&!this._isAdding||!e&&this._isAdding)for(n=this._columnIndex;n<this._columnIndex+this._count&&n<this._owner.columns.length;n++)t.push(this._owner.columns[n]);if(this._owner.selectedSheet.tables&&this._owner.selectedSheet.tables.length>0)for(n=0;n<this._owner.selectedSheet.tables.length;n++){var i=this._owner.selectedSheet.tables[n];i&&i.sheet.name===this._owner.selectedSheet.name&&o.push({name:i.name,range:i.getRange(),columns:i.getColumns()})}var l={columns:t,sortList:this._owner.sortManager._cloneSortList(this._owner.sortManager._committedList),styledCells:this._owner.selectedSheet?this._owner._cloneObject(this._owner.selectedSheet._styledCells):null,mergedCells:this._owner.selectedSheet?this._owner.selectedSheet._cloneMergedCells():null,tableRanges:o,selection:this._owner.selection,filterDef:this._owner.selectedSheet._filterDefinition};e?this._oldValue=l:this._newValue=l};_ColumnsChangedAction.prototype._handleUndoRedo=function(e,t){var o=this;void 0===t&&(t=!0);var n=e?this._oldValue:this._newValue;if(this._owner.selectedSheet)if(this._delSubActions.length)this._owner.deferUpdate((function(){if(e)for(var t=o._delSubActions.length-1;t>=0;t--){o._delSubActions[t]._handleUndoRedo(e,!1)}else for(t=0;t<o._delSubActions.length;t++){o._delSubActions[t]._handleUndoRedo(e,!1)}}));else{try{t&&this._owner.beginUpdate();var i=void 0;this._owner._isUndoing=!0;this._owner._clearCalcEngine();this._owner.finishEditing();if(null==this._isAdding){this._owner.columns.clear();this._columnIndex=0}this._owner.selectedSheet._styledCells=null;this._owner.selectedSheet._mergedRanges.length=0;this._owner.columns.beginUpdate();if(n.columns&&n.columns.length>0)for(var l=0;l<n.columns.length;l++){if((r=n.columns[l])&&r.isVisible){this._owner.columns.insert(this._columnIndex+l,r);if(this._owner.itemsSource&&(i=this._owner.rows[this._owner._getDataRowsOffset()-1])){i._ubv||(i._ubv={});i._ubv[r._hash]=r.header}}}else for(l=this._columnIndex+this._count-1;l>=this._columnIndex;l--){var r;(r=this._owner.columns[l])&&r.isVisible&&this._owner.columns.removeAt(l)}this._owner.columns.endUpdate();this._owner.selectedSheet._styledCells=this._owner._cloneObject(n.styledCells);for(var s=0;s<n.mergedCells.length;s++)this._owner.selectedSheet._mergedRanges[s]=n.mergedCells[s];for(s=0;s<n.tableRanges.length;s++){var a=n.tableRanges[s];(d=this._owner._getTable(a.name))&&d._setTableRange(a.range,a.columns)}var h=void 0;this._affectedFormulas&&(h=e?this._affectedFormulas.oldFormulas:this._affectedFormulas.newFormulas);if(h&&h.length>0)for(s=0;s<h.length;s++){var u=h[s];null!=u.point?u.sheet.name===this._owner.selectedSheet.name?this._owner.setCellData(u.point.x,u.point.y,u.formula):u.sheet.grid.setCellData(u.point.x,u.point.y,u.formula):u.row._ubv[u.column._hash]=u.formula}if(this._deletedTables&&this._deletedTables.length>0)for(s=0;s<this._deletedTables.length;s++){var d=this._deletedTables[s];e?this._owner.selectedSheet.tables.push(d):this._owner.selectedSheet.tables.remove(d)}var c=void 0;this._affectedDefinedNameVals&&(c=e?this._affectedDefinedNameVals.oldDefinedNameVals:this._affectedDefinedNameVals.newDefinedNameVals);if(c&&c.length>0)for(s=0;s<c.length;s++){var _=c[s],g=this._owner._getDefinedNameIndexByName(_.name);g>-1&&(this._owner.definedNames[g].value=_.value)}this._owner.selectedSheet.grid.wj_sheetInfo.styledCells=this._owner.selectedSheet._styledCells;this._owner.selectedSheet.grid.wj_sheetInfo.mergedRanges=this._owner.selectedSheet._mergedRanges}finally{t&&this._owner.endUpdate()}this._owner._copyColumnsToSelectedSheet();this._owner.sortManager.sortDescriptions.sourceCollection=n.sortList.slice();this._owner.selectedSheet._filterDefinition=n.filterDef;this._owner.sortManager.commitSort(!1);this._owner.selection=n.selection;this._owner._isUndoing=!1}};return _ColumnsChangedAction}(o);t._ColumnsChangedAction=r;var s=function(t){__extends(_RowsChangedAction,t);function _RowsChangedAction(e,o,n,i){var l=t.call(this,e)||this;l._delSubActions=[];l._headerRowAtTop=e._headerRowAtTop();l._rowIndex=o;l._count=n;l._isAdding=i;l._saveValues(!0);return l}_RowsChangedAction.prototype.undo=function(){this._handleUndoRedo(!0)};_RowsChangedAction.prototype.redo=function(){this._handleUndoRedo(!1)};_RowsChangedAction.prototype.saveNewState=function(){this._saveValues(!1);return!0};_RowsChangedAction.prototype.addDeleteSubAction=function(e){this._delSubActions.push(e)};_RowsChangedAction.prototype._saveValues=function(t){var o,n,i=[],l=[],r=[];if(null==this._isAdding)if(this._owner.itemsSource){o=this._owner.itemsSource instanceof e.collections.CollectionView?this._owner.itemsSource.sourceCollection.slice():this._owner.itemsSource.slice();for(var s=0;s<this._owner.columns.length;s++)l.push(this._owner.columns[s])}else for(s=0;s<this._owner.rows.length;s++)i.push(this._owner.rows[s]);else{if(t&&!this._isAdding||!t&&this._isAdding)for(s=this._rowIndex;s<this._rowIndex+this._count&&s<this._owner.rows.length;s++){var a=this._owner.rows[s];a.isVisible||this._isAdding?i.push(a):i.push(null)}this._owner.collectionView&&this._owner.collectionView.sortDescriptions.length>0&&(n=this._owner.collectionView._view.slice())}if(this._owner.selectedSheet.tables&&this._owner.selectedSheet.tables.length>0)for(s=0;s<this._owner.selectedSheet.tables.length;s++){var h=this._owner.selectedSheet.tables[s];h&&h.sheet.name===this._owner.selectedSheet.name&&r.push({name:h.name,range:h.getRange(),setting:{showHeaderRow:h.showHeaderRow,showTotalRow:h.showTotalRow}})}var u={rows:i,columns:l,itemsSource:o,styledCells:this._owner.selectedSheet?this._owner._cloneObject(this._owner.selectedSheet._styledCells):null,mergedCells:this._owner.selectedSheet?this._owner.selectedSheet._cloneMergedCells():null,tableSettings:r,selection:this._owner.selection,dataView:n,scrollPosition:this._owner.scrollPosition};t?this._oldValue=u:this._newValue=u};_RowsChangedAction.prototype._handleUndoRedo=function(t,o){var n=this;void 0===o&&(o=!0);var i,l=this,r=!!l._owner.itemsSource,s=t?l._oldValue:l._newValue;if(l._owner.selectedSheet)if(this._delSubActions.length)l._owner.deferUpdate((function(){if(t)for(var e=n._delSubActions.length-1;e>=0;e--){n._delSubActions[e]._handleUndoRedo(t,!1)}else{for(e=0;e<n._delSubActions.length;e++){n._delSubActions[e]._handleUndoRedo(t,!1)}l._owner.selection=n._newValue.selection}}));else{try{o&&l._owner.beginUpdate();l._owner._isUndoing=!0;l._owner._clearCalcEngine();l._owner.finishEditing();if(null==l._isAdding){l._owner.itemsSource&&l._owner.columns.clear();l._owner.rows.clear();l._rowIndex=0}l._owner.selectedSheet._styledCells=null;l._owner.selectedSheet._mergedRanges.length=0;if(null==this._isAdding&&r){i=l._owner.autoGenerateColumns;l._owner.autoGenerateColumns=!1;l._owner.collectionView.beginUpdate();if(l._owner.itemsSource instanceof e.collections.CollectionView){var a=[0,l._owner.itemsSource.sourceCollection.length].concat(s.itemsSource);Array.prototype.splice.apply(l._owner.itemsSource.sourceCollection,a)}else l._owner.itemsSource=s.itemsSource.slice();l._owner.columns.beginUpdate();for(var h=0;h<s.columns.length;h++)l._owner.columns.push(s.columns[h]);l._owner.columns.endUpdate();l._owner.collectionView.endUpdate(!0);l._owner.autoGenerateColumns=i}else{l._owner.rows.beginUpdate();var u=void 0;if(r){i=l._owner.autoGenerateColumns;l._owner.autoGenerateColumns=!1;u=Math.max(l._rowIndex-l._owner._getDataRowsOffset(),0);l._owner.collectionView.beginUpdate()}var d=l._owner.collectionView,c=d instanceof e.collections.CollectionView?d:null;if(s.rows&&s.rows.length>0)for(h=0;h<s.rows.length;h++){if(w=s.rows[h])if(r&&w.dataItem){var _=null!=w.dataItem._itemIdx?w.dataItem._itemIdx:u+h;l._owner._updateItemIndexForInsertingRow(d.sourceCollection,_,1);d.sourceCollection.splice(_,0,w.dataItem);if(c&&c.trackChanges){var g=c.itemsRemoved.indexOf(w.dataItem)>=0;g&&c.itemsRemoved.remove(w.dataItem);!g&&c.itemsAdded.indexOf(w.dataItem)<=0&&c.itemsAdded.push(w.dataItem)}}else l._owner.rows.insert(l._rowIndex+h,w)}else{var f=l._rowIndex;l._isAdding||l._headerRowAtTop||!l._owner._headerRowAtTop()||f++;for(var p=f+l._count-1;p>=f;p--){var w;if(w=l._owner.rows[p])if(r&&w.dataItem){_=null!=w.dataItem._itemIdx?w.dataItem._itemIdx:p-l._owner._getDataRowsOffset();d.sourceCollection.splice(_,1);l._owner._updateItemIndexForRemovingRow(d.sourceCollection,_);if(c&&c.trackChanges){var m=c.itemsAdded.indexOf(w.dataItem)>=0;m&&c.itemsAdded.remove(w.dataItem);!m&&c.itemsRemoved.indexOf(w.dataItem)<0&&c.itemsRemoved.push(w.dataItem)}}else l._owner.rows.removeAt(p)}}if(r){l._owner._lastCount=l._owner.collectionView.itemCount;l._owner.collectionView.endUpdate(!0);if(s.dataView&&s.dataView.length>0){l._owner.collectionView._view=s.dataView;l._owner.collectionView._pgView=l._owner.collectionView._getPageView();if(!(l._owner.itemsSource instanceof e.collections.CollectionView)){l._owner.selectedSheet.grid.collectionView._view=s.dataView;l._owner.selectedSheet.grid.collectionView._pgView=l._owner.selectedSheet.grid.collectionView._getPageView()}l._owner._bindGrid(!1);l._owner.selectedSheet.grid._bindGrid(!1)}l._owner.autoGenerateColumns=i}l._owner.rows.endUpdate()}l._owner.selectedSheet._styledCells=l._owner._cloneObject(s.styledCells);for(h=0;h<s.mergedCells.length;h++)l._owner.selectedSheet._mergedRanges[h]=s.mergedCells[h];for(h=0;h<s.tableSettings.length;h++){var C=s.tableSettings[h];if(y=l._owner._getTable(C.name)){y._showHeaderRow=C.setting.showHeaderRow;y._showTotalRow=C.setting.showTotalRow;y._setTableRange(C.range)}}var S=void 0;l._affectedFormulas&&(S=t?l._affectedFormulas.oldFormulas:l._affectedFormulas.newFormulas);if(S&&S.length>0)for(h=0;h<S.length;h++){var b=S[h];null!=b.point?b.sheet.name===l._owner.selectedSheet.name?l._owner.setCellData(b.point.x,b.point.y,b.formula):b.sheet.grid.setCellData(b.point.x,b.point.y,b.formula):b.row._ubv[b.column._hash]=b.formula}if(l._deletedTables&&l._deletedTables.length>0)for(h=0;h<l._deletedTables.length;h++){var y=l._deletedTables[h];t?l._owner.selectedSheet.tables.push(y):l._owner.selectedSheet.tables.remove(y)}var v=void 0;l._affectedDefinedNameVals&&(v=t?l._affectedDefinedNameVals.oldDefinedNameVals:l._affectedDefinedNameVals.newDefinedNameVals);if(v&&v.length>0)for(h=0;h<v.length;h++){var R=v[h],x=l._owner._getDefinedNameIndexByName(R.name);x>-1&&(l._owner.definedNames[x].value=R.value)}l._owner.selectedSheet.grid.wj_sheetInfo.styledCells=l._owner.selectedSheet._styledCells;l._owner.selectedSheet.grid.wj_sheetInfo.mergedRanges=l._owner.selectedSheet._mergedRanges;l._owner.selection=s.selection;l._owner.scrollPosition=s.scrollPosition;l._owner._isUndoing=!1}finally{o&&l._owner.endUpdate()}l._owner._copyRowsToSelectedSheet()}};return _RowsChangedAction}(o);t._RowsChangedAction=s;var a=function(e){__extends(_CellStyleAction,e);function _CellStyleAction(t,o){var n=e.call(this,t)||this;n._oldStyledCells=o?t._cloneObject(o):t.selectedSheet?t._cloneObject(t.selectedSheet._styledCells):null;return n}_CellStyleAction.prototype.undo=function(){this._handleUndoRedo(!0)};_CellStyleAction.prototype.redo=function(){this._handleUndoRedo(!1)};_CellStyleAction.prototype.saveNewState=function(){this._newStyledCells=this._owner.selectedSheet?this._owner._cloneObject(this._owner.selectedSheet._styledCells):null;return!0};_CellStyleAction.prototype._checkActionState=function(){return null!=this._oldStyledCells&&null==this._newStyledCells||null==this._oldStyledCells&&null!=this._newStyledCells||null!=this._oldStyledCells&&null!=this._newStyledCells&&this._oldStyledCells.length!==this._newStyledCells.length};_CellStyleAction.prototype._handleUndoRedo=function(e){var t;if(this._owner.selectedSheet){t=e?this._oldStyledCells:this._newStyledCells;this._owner.selectedSheet._styledCells=this._owner._cloneObject(t);this._owner.selectedSheet.grid.wj_sheetInfo.styledCells=this._owner.selectedSheet._styledCells;this._owner.refresh(!1)}};return _CellStyleAction}(o);t._CellStyleAction=a;var h=function(e){__extends(_CellMergeAction,e);function _CellMergeAction(t){var o=e.call(this,t)||this;o._oldMergedCells=t.selectedSheet?t.selectedSheet._cloneMergedCells():null;return o}_CellMergeAction.prototype.undo=function(){this._handleUndoRedo(!0)};_CellMergeAction.prototype.redo=function(){this._handleUndoRedo(!1)};_CellMergeAction.prototype.saveNewState=function(){this._newMergedCells=this._owner.selectedSheet?this._owner.selectedSheet._cloneMergedCells():null;return!0};_CellMergeAction.prototype._handleUndoRedo=function(e){var t,o;if(this._owner.selectedSheet){t=e?this._oldMergedCells:this._newMergedCells;this._owner._clearCalcEngine();if(t){this._owner.selectedSheet._mergedRanges.length=0;for(o=0;o<t.length;o++)this._owner.selectedSheet._mergedRanges[o]=t[o]}this._owner.selectedSheet.grid.wj_sheetInfo.mergedRanges=this._owner.selectedSheet._mergedRanges;this._owner.refresh(!0)}};_CellMergeAction.prototype._checkActionState=function(){var e,t,o;if(null!=this._oldMergedCells&&null==this._newMergedCells||null==this._oldMergedCells&&null!=this._newMergedCells)return!0;if(null!=this._oldMergedCells&&null!=this._newMergedCells&&this._oldMergedCells.length!==this._newMergedCells.length)return!0;if(null!=this._oldMergedCells&&null!=this._newMergedCells&&this._oldMergedCells.length===this._newMergedCells.length)for(e=0;e<this._oldMergedCells.length;e++){o=this._oldMergedCells[e];t=this._oldMergedCells[e];if(!o.equals(t))return!0}return!1};return _CellMergeAction}(o);t._CellMergeAction=h;var u=function(t){__extends(_SortColumnAction,t);function _SortColumnAction(e){var o=t.call(this,e)||this;o._saveValues(!0);return o}_SortColumnAction.prototype.undo=function(){this._handleUndoRedo(!0)};_SortColumnAction.prototype.redo=function(){this._handleUndoRedo(!1)};_SortColumnAction.prototype.saveNewState=function(){this._saveValues(!1);return!0};_SortColumnAction.prototype._saveValues=function(e){for(var t,o,n,i=[],l=0;l<this._owner.columns.length;l++)i.push(this._owner.columns[l]);if(this._owner.itemsSource){var r=this._owner._getDataRowsOffset();o=[];for(var s=0;s<this._owner.rows.length-r;s++){var a=this._owner.rows[s+r],h=a.dataItem;if(h){o[null!=h._itemIdx?h._itemIdx:s]=a.visible}}e&&(n=this._owner.collectionView._view.slice())}else{t=[];for(s=0;s<this._owner.rows.length;s++)t.push(this._owner.rows[s])}var u={sortList:this._owner.sortManager._committedList.slice(),rows:t,columns:i,selection:this._owner.selection.clone(),formulas:this._owner._scanFormulas(),styledCells:this._owner.selectedSheet?this._owner._cloneObject(this._owner.selectedSheet._styledCells):null,rowsVisible:o,dataView:n};e?this._oldValue=u:this._newValue=u};_SortColumnAction.prototype._handleUndoRedo=function(t){var o=this,n=t?o._oldValue:o._newValue,i=!!o._owner.itemsSource,l=this._owner.itemsSource instanceof e.collections.CollectionView;if(o._owner.selectedSheet){o._owner._isUndoing=!0;o._owner.deferUpdate((function(){o._owner._clearCalcEngine();o._owner.sortManager.sortDescriptions.sourceCollection=n.sortList.slice();o._owner.sortManager.commitSort(!1);o._owner.selectedSheet._styledCells=o._owner._cloneObject(n.styledCells);if(i){if(n.dataView&&n.dataView.length>0){o._owner.collectionView._view=n.dataView;o._owner.collectionView._pgView=o._owner.collectionView._getPageView();if(!l){o._owner.selectedSheet.grid.collectionView._view=n.dataView;o._owner.selectedSheet.grid.collectionView._pgView=o._owner.selectedSheet.grid.collectionView._getPageView()}o._owner._bindGrid(!1);o._owner.selectedSheet.grid._bindGrid(!1)}}else{o._owner.rows.clear();o._owner.selectedSheet.grid.rows.clear();for(var e=0;e<n.rows.length;e++){var t=n.rows[e];o._owner.selectedSheet.grid.rows.push(t);o._owner.rows.push(t)}o._owner.columns.clear();for(e=0;e<n.columns.length;e++){var r=n.columns[e];o._owner.columns.push(r)}o._owner._resetFormulas(n.formulas)}o._owner._isUndoing=!1}))}};return _SortColumnAction}(o);t._SortColumnAction=u;var d=function(t){__extends(_MoveCellsAction,t);function _MoveCellsAction(e,o,n,i){var l=t.call(this,e)||this;if(!e.selectedSheet)return l;0===o.topRow&&o.bottomRow===e.rows.length-1?l._isDraggingColumns=!0:l._isDraggingColumns=!1;l._isCopyCells=i;l._dragRange=o;l._dropRange=n;l._saveValues(!0);return l}_MoveCellsAction.prototype.undo=function(){this._handleUndoRedo(!0)};_MoveCellsAction.prototype.redo=function(){this._handleUndoRedo(!1)};_MoveCellsAction.prototype.saveNewState=function(){if(!this._owner.selectedSheet)return!1;if(this._dropRange){this._saveValues(!1);return!0}return!1};_MoveCellsAction.prototype._saveValues=function(e){for(var t=[],o={},n=this._dropRange.topRow;n<=this._dropRange.bottomRow;n++)for(var i=this._dropRange.leftCol;i<=this._dropRange.rightCol;i++){this._isDraggingColumns&&(o[i]||(o[i]={dataType:this._owner.columns[i].dataType,align:this._owner.columns[i].align,format:this._owner.columns[i].format}));var l=n*this._owner.columns.length+i,r=this._owner.selectedSheet._styledCells[l]?this._owner._cloneObject(this._owner.selectedSheet._styledCells[l]):null,s=this._owner.getCellData(n,i,!1);t.push({rowIndex:n,columnIndex:i,cellContent:s,cellStyle:r})}if(e){this._oldDroppingCells=t;this._oldDroppingColumnSetting=o}else{this._newDroppingCells=t;this._newDroppingColumnSetting=o}if(this._isCopyCells){if(this._isDraggingColumns)if(e)for(n=this._dragRange.topRow;n<=this._dragRange.bottomRow;n++)for(i=this._dragRange.leftCol;i<=this._dragRange.rightCol;i++){if((c=this._owner.selectedSheet.findTable(n,i))&&c._isHeaderRow(n)){var a=c._getTableRange(),h=c._getColumns();this._draggingTableColumns||(this._draggingTableColumns=[]);this._draggingTableColumns.push({rowIndex:n,columnIndex:i,cellContent:h[i-a.leftCol].name})}}else if(this._draggingTableColumns&&this._draggingTableColumns.length>0&&this._draggingTableColumns&&this._draggingTableColumns.length>0)for(var u=0;u<this._draggingTableColumns.length;u++){var d=this._draggingTableColumns[u];if((c=this._owner.selectedSheet.findTable(d.rowIndex,d.columnIndex))&&c._isHeaderRow(d.rowIndex)){a=c._getTableRange(),h=c._getColumns();d.updatedCellContent=h[d.columnIndex-a.leftCol].name}}}else if(e){this._draggingCells=[];this._draggingColumnSetting={};for(n=this._dragRange.topRow;n<=this._dragRange.bottomRow;n++)for(i=this._dragRange.leftCol;i<=this._dragRange.rightCol;i++){this._isDraggingColumns&&(this._draggingColumnSetting[i]||(this._draggingColumnSetting[i]={dataType:this._owner.columns[i].dataType,align:this._owner.columns[i].align,format:this._owner.columns[i].format}));l=n*this._owner.columns.length+i,r=this._owner.selectedSheet._styledCells[l]?this._owner._cloneObject(this._owner.selectedSheet._styledCells[l]):null,s=this._owner.getCellData(n,i,!1);this._draggingCells.push({rowIndex:n,columnIndex:i,cellContent:s,cellStyle:r})}}else if(this._isDraggingColumns&&this._draggingCells&&this._draggingCells.length>0)for(u=0;u<this._draggingCells.length;u++){var c;d=this._draggingCells[u];if((c=this._owner.selectedSheet.findTable(d.rowIndex,d.columnIndex))&&c._isHeaderRow(d.rowIndex)){a=c._getTableRange(),h=c._getColumns();d.updatedCellContent=h[d.columnIndex-a.leftCol].name}}};_MoveCellsAction.prototype._handleUndoRedo=function(t){var o=this,n=t?o._oldDroppingCells:o._newDroppingCells,i=t?o._oldDroppingColumnSetting:o._newDroppingColumnSetting;if(o._owner.selectedSheet){o._owner._clearCalcEngine();o._owner.deferUpdate((function(){var l,r;o._affectedFormulas&&(l=t?o._affectedFormulas.oldFormulas:o._affectedFormulas.newFormulas);if(l&&l.length>0)for(var s=0;s<l.length;s++){var a=l[s];a.sheet.name===o._owner.selectedSheet.name?o._owner.setCellData(a.point.x,a.point.y,a.formula):a.sheet.grid.setCellData(a.point.x,a.point.y,a.formula)}o._affectedDefinedNameVals&&(r=t?o._affectedDefinedNameVals.oldDefinedNameVals:o._affectedDefinedNameVals.newDefinedNameVals);if(r&&r.length>0)for(s=0;s<r.length;s++){var h=r[s],u=o._owner._getDefinedNameIndexByName(h.name);u>-1&&(o._owner.definedNames[u].value=h.value)}for(s=0;s<n.length;s++){var d=n[s];o._owner.setCellData(d.rowIndex,d.columnIndex,d.cellContent);if((f=o._owner.selectedSheet.findTable(d.rowIndex,d.columnIndex))&&f._isHeaderRow(d.rowIndex)){var c=f._getTableRange();(g=f._getColumns())[d.columnIndex-c.leftCol].name=d.cellContent}var _=d.rowIndex*o._owner.columns.length+d.columnIndex;d.cellStyle?o._owner.selectedSheet._styledCells[_]=d.cellStyle:delete o._owner.selectedSheet._styledCells[_]}o._isDraggingColumns&&i&&Object.keys(i).forEach((function(t){o._owner.columns[+t].dataType=i[+t].dataType?i[+t].dataType:e.DataType.Object;o._owner.columns[+t].align=i[+t].align;o._owner.columns[+t].format=i[+t].format}));if(o._isCopyCells){if(o._draggingTableColumns&&o._draggingTableColumns.length>0)for(s=0;s<o._draggingTableColumns.length;s++){d=o._draggingTableColumns[s];if((f=o._owner.selectedSheet.findTable(d.rowIndex,d.columnIndex))&&f._isHeaderRow(d.rowIndex)){c=f._getTableRange();var g=f._getColumns();o._owner.setCellData(d.rowIndex,d.columnIndex,t?d.cellContent:d.updatedCellContent);g[d.columnIndex-c.leftCol].name=t?d.cellContent:d.updatedCellContent}}}else{for(s=0;s<o._draggingCells.length;s++){var f;d=o._draggingCells[s];if(f=o._owner.selectedSheet.findTable(d.rowIndex,d.columnIndex)){c=f._getTableRange(),g=f._getColumns();if(f._isHeaderRow(d.rowIndex)){o._owner.setCellData(d.rowIndex,d.columnIndex,t?d.cellContent:d.updatedCellContent);g[d.columnIndex-c.leftCol].name=t?d.cellContent:d.updatedCellContent}else o._owner.setCellData(d.rowIndex,d.columnIndex,t?d.cellContent:null)}else o._owner.setCellData(d.rowIndex,d.columnIndex,t?d.cellContent:null);_=d.rowIndex*o._owner.columns.length+d.columnIndex;t?d.cellStyle&&(o._owner.selectedSheet._styledCells[_]=d.cellStyle):o._owner.selectedSheet._styledCells[_]&&delete o._owner.selectedSheet._styledCells[_]}o._isDraggingColumns&&o._draggingColumnSetting&&Object.keys(o._draggingColumnSetting).forEach((function(n){o._owner.columns[+n].dataType=t&&o._draggingColumnSetting[+n].dataType?o._draggingColumnSetting[+n].dataType:e.DataType.Object;o._owner.columns[+n].align=t?o._draggingColumnSetting[+n].align:null;o._owner.columns[+n].format=t?o._draggingColumnSetting[+n].format:null}));if(t){if(o._isDraggingColumns)if(o._dragRange.leftCol<o._dropRange.leftCol)for(var p=o._dragRange.leftCol,w=o._dropRange.leftCol;w<=o._dropRange.rightCol;w++){o._owner._updateColumnFiler(w,p);p++}else for(p=o._dragRange.rightCol,w=o._dropRange.rightCol;w>=o._dropRange.leftCol;w--){o._owner._updateColumnFiler(w,p);p--}}else if(o._isDraggingColumns)if(o._dragRange.leftCol>o._dropRange.leftCol)for(p=o._dropRange.leftCol,w=o._dragRange.leftCol;w<=o._dragRange.rightCol;w++){o._owner._updateColumnFiler(w,p);p++}else for(p=o._dropRange.rightCol,w=o._dragRange.rightCol;w>=o._dragRange.leftCol;w--){o._owner._updateColumnFiler(w,p);p--}}}))}};return _MoveCellsAction}(o);t._MoveCellsAction=d;var c=function(t){__extends(_CutAction,t);function _CutAction(o){var n=t.call(this,o)||this;n._oldValues=[];n._mergeAction=new h(o);n._celltyleAction=new a(o);n._cutSheet=o._copiedSheet;n._selection=o.selection;n._cutSelection=o.selectionMode===e.grid.SelectionMode.ListBox?o._getSelectionForListBoxMode(n._cutSheet.grid):o._copiedRanges[0];n._saveCutValues(!0);return n}_CutAction.prototype.undo=function(){this._handleUndoRedo(!0)};_CutAction.prototype.redo=function(){this._handleUndoRedo(!1)};_CutAction.prototype.saveNewState=function(){this._cutSheet===this._owner.selectedSheet?this._owner:this._cutSheet.grid;this._saveCutValues(!1);this._newValues=[];for(var e=this._selection.topRow;e<=this._selection.bottomRow;e++)for(var t=this._selection.leftCol;t<=this._selection.rightCol;t++){if(!this._owner.columns[t])return!1;var o=this._owner.getCellData(e,t,!!this._owner.columns[t].dataMap);o=null==o?"":o;this._newValues.push({row:e,col:t,value:o})}this._mergeAction.saveNewState();this._celltyleAction.saveNewState();return!0};_CutAction.prototype.updateForPasting=function(e){var t=this._owner.getCellData(e.row,e.col,!!this._owner.columns[e.col].dataMap);t=null==t?"":t;this._oldValues.push({row:e.row,col:e.col,value:t});this._selection.row=Math.min(this._selection.topRow,e.topRow);this._selection.row2=Math.max(this._selection.bottomRow,e.bottomRow);this._selection.col=Math.min(this._selection.leftCol,e.leftCol);this._selection.col2=Math.max(this._selection.rightCol,e.rightCol)};_CutAction.prototype._saveCutValues=function(e){for(var t=this._cutSheet===this._owner.selectedSheet?this._owner:this._cutSheet.grid,o=[],n=this._cutSelection.topRow;n<=this._cutSelection.bottomRow;n++)if(null!=t.rows[n])for(var i=this._cutSelection.leftCol;i<=this._cutSelection.rightCol;i++){var l=t.getCellData(n,i,!!t.columns[i].dataMap);l=null==l?"":l;o.push({row:n,col:i,value:l})}e?this._oldCutValues=o:this._newCutValues=o};_CutAction.prototype._handleUndoRedo=function(e){var t=this,o=e?t._oldCutValues:t._newCutValues,n=e?t._oldValues:t._newValues;t._owner._clearCalcEngine();t._owner.selectedSheet.selectionRanges.clear();t._owner.deferUpdate((function(){var i,l,r=t._cutSheet===t._owner.selectedSheet?t._owner:t._cutSheet.grid;t._owner.selectedSheet.selectionRanges.push(t._selection);for(i=0;i<o.length;i++){l=o[i];r.setCellData(l.row,l.col,l.value)}for(i=0;i<n.length;i++){l=n[i];t._owner.setCellData(l.row,l.col,l.value)}if(e){t._mergeAction.undo();t._celltyleAction.undo()}else{t._mergeAction.redo();t._celltyleAction.redo()}t._owner.refresh(!1)}))};return _CutAction}(o);t._CutAction=c;var _=function(e){__extends(_TableSettingAction,e);function _TableSettingAction(t,o){var n=e.call(this,t)||this;n._table=o;n._saveValues(!0);return n}_TableSettingAction.prototype.undo=function(){this._handleUndoRedo(!0)};_TableSettingAction.prototype.redo=function(){this._handleUndoRedo(!1)};_TableSettingAction.prototype.saveNewState=function(){this._saveValues(!1);return!0};_TableSettingAction.prototype._saveValues=function(e){var t={name:this._table.name,style:this._table.style,showHeaderRow:this._table.showHeaderRow,showTotalRow:this._table.showTotalRow,showbandedRows:this._table.showBandedRows,showBandedColumns:this._table.showBandedColumns,alterFirstColumn:this._table.alterFirstColumn,alterLastColumn:this._table.alterLastColumn};e?this._oldTableSetting=t:this._newTableSetting=t};_TableSettingAction.prototype._handleUndoRedo=function(e){var t=e?this._oldTableSetting:this._newTableSetting;this._owner.beginUpdate();this._owner._isUndoing=!0;this._table.name=t.name;this._table.style=t.style;this._table.showHeaderRow=t.showHeaderRow;this._table.showTotalRow=t.showTotalRow;this._table.showBandedRows=t.showbandedRows;this._table.showBandedColumns=t.showBandedColumns;this._table.alterFirstColumn=t.alterFirstColumn;this._table.alterLastColumn=t.alterLastColumn;this._owner._isUndoing=!1;this._owner.endUpdate()};return _TableSettingAction}(o);t._TableSettingAction=_;var g=function(e){__extends(_TableAction,e);function _TableAction(t,o){var n=e.call(this,t)||this;n._addedTable=o;o.showHeaderRow&&(n._orgHeaderCellsContent=o._orgHeaderCellsContent.slice());return n}_TableAction.prototype.undo=function(){this._handleUndoRedo(!0)};_TableAction.prototype.redo=function(){this._handleUndoRedo(!1)};_TableAction.prototype._handleUndoRedo=function(e){e?this._owner.selectedSheet.tables.remove(this._addedTable):this._owner.selectedSheet.tables.push(this._addedTable);if(this._addedTable.showHeaderRow)for(var t=this._addedTable.getRange(),o=this._addedTable.getColumns(),n=0;n<t.columnSpan;n++)this._owner.setCellData(t.topRow,t.leftCol+n,e?this._orgHeaderCellsContent[n]:o[n].name);this._owner.refresh()};return _TableAction}(o);t._TableAction=g;var f=function(e){__extends(_FilteringAction,e);function _FilteringAction(t){var o=e.call(this,t)||this;o._oldFilterDefinition=t.filter.filterDefinition;o._oldRowsVisible=o._getRowsVisible();return o}_FilteringAction.prototype.undo=function(){this._handleUndoRedo(!0)};_FilteringAction.prototype.redo=function(){this._handleUndoRedo(!1)};_FilteringAction.prototype.saveNewState=function(){this._newFilterDefinition=this._owner.filter.filterDefinition;this._newRowsVisible=this._getRowsVisible();return!0};_FilteringAction.prototype._handleUndoRedo=function(e){var t=e?this._oldFilterDefinition:this._newFilterDefinition;if(this._owner.filter.filterDefinition!==t){this._owner._isUndoing=!0;this._owner.selectedSheet._filterDefinition=t;this._owner.selectedSheet._applyFilterSetting();this._owner._isUndoing=!1;this._owner.filter.apply()}else this._setRowVisible(e)};_FilteringAction.prototype._getRowsVisible=function(){for(var e,t=[],o=0;o<this._owner.rows.length;o++)(e=this._owner.rows[o])&&t.push(e.visible);return t};_FilteringAction.prototype._setRowVisible=function(e){for(var t,o=e?this._oldRowsVisible:this._newRowsVisible,n=0;n<o.length;n++)(t=this._owner.rows[n])&&(t.visible=o[n])};return _FilteringAction}(o);t._FilteringAction=f;var p=function(t){__extends(_FillAction,t);function _FillAction(e,o){var n=t.call(this,e)||this;n._fillSource=o.clone();n._oldCellSettings=e._orgCellSettings;return n}_FillAction.prototype.undo=function(){this._handleUndoRedo(!0)};_FillAction.prototype.redo=function(){this._handleUndoRedo(!1)};_FillAction.prototype.saveNewState=function(){this._fillRange=this._owner.selection.clone();this._newCellSettings=this._owner._getCellSettingsForFill(this._fillSource,this._fillRange);return!0};_FillAction.prototype._handleUndoRedo=function(t){var o,n,i,l,r,s,a=t?this._oldCellSettings:this._newCellSettings,h=t?this._fillSource:this._fillRange;this._owner.beginUpdate();s=this._fillRange.topRow<this._fillSource.topRow?new e.grid.CellRange(this._fillRange.topRow,this._fillRange.col,this._fillSource.topRow-1,this._fillRange.col2):this._fillRange.leftCol===this._fillSource.leftCol&&this._fillRange.rightCol===this._fillSource.rightCol?new e.grid.CellRange(this._fillSource.bottomRow+1,this._fillRange.col,this._fillRange.bottomRow,this._fillRange.col2):this._fillRange.leftCol<this._fillSource.leftCol?new e.grid.CellRange(this._fillRange.row,this._fillRange.leftCol,this._fillRange.row2,this._fillSource.leftCol-1):new e.grid.CellRange(this._fillRange.row,this._fillSource.rightCol+1,this._fillRange.row2,this._fillRange.rightCol);this._owner._resetMergedRange(s);if(a&&a.length>0)for(o=0;o<a.length;o++){i=(n=a[o]).row;l=n.col;r=i*this._owner.columns.length+l;this._owner.selectedSheet._styledCells[r]=n.style;this._owner.setCellData(i,l,n.value);n.mergedCell&&this._owner.mergeRange(n.mergedCell)}this._owner.selection=h;this._owner.endUpdate()};return _FillAction}(o);t._FillAction=p}(t.sheet||(t.sheet={}))}(e.grid||(e.grid={}))}(wijmo||(wijmo={}));!function(e){!function(t){!function(t){"use strict";var o=function(){function SortManager(t){this._owner=t;this._sortDescriptions=new e.collections.CollectionView;this._committedList=[new n(-1,!0)];this._sortDescriptions.newItemCreator=function(){return new n(-1,!0)}}Object.defineProperty(SortManager.prototype,"sortDescriptions",{get:function(){return this._sortDescriptions},set:function(e){this._sortDescriptions=e;this.commitSort()},enumerable:!0,configurable:!0});SortManager.prototype.addSortLevel=function(t,o){void 0===o&&(o=!0);var n=this._sortDescriptions.addNew();null!=t&&!isNaN(t)&&e.isInt(t)&&(n.columnIndex=t);n.ascending=o;this._sortDescriptions.commitNew()};SortManager.prototype.deleteSortLevel=function(e){var t;(t=null!=e?this._getSortItem(e):this._sortDescriptions.currentItem)&&this._sortDescriptions.remove(t)};SortManager.prototype.copySortLevel=function(){var e=this._sortDescriptions.currentItem;if(e){var t=this._sortDescriptions.addNew();t.columnIndex=parseInt(e.columnIndex);t.ascending=e.ascending;this._sortDescriptions.commitNew()}};SortManager.prototype.editSortLevel=function(e,t){null!=e&&(this._sortDescriptions.currentItem.columnIndex=e);null!=t&&(this._sortDescriptions.currentItem.ascending=t)};SortManager.prototype.moveSortLevel=function(e){var t=this._sortDescriptions.currentItem;if(t){var o=this._sortDescriptions.sourceCollection,n=o.indexOf(t),i=n+e;if(n>-1&&i>-1){o.splice(n,1);o.splice(i,0,t);this._sortDescriptions.refresh();this._sortDescriptions.moveCurrentTo(t)}}};SortManager.prototype.checkSortItemExists=function(e){for(var t=0,o=this._sortDescriptions.itemCount;t<o;t++)if(+this._sortDescriptions.items[t].columnIndex===e)return t;return-1};SortManager.prototype.commitSort=function(o){void 0===o&&(o=!0);var i,l,r,s,a,h,u,d,c,_,g,f,p,w,m,C=this._owner,S=this._owner.itemsSource instanceof e.collections.CollectionView,b={};if(this._owner.selectedSheet&&0!==this._owner.columns.length){var y=null==this._owner.selectedSheet.grid.collectionView;C._needCopyToSheet=!1;h=C.selectedSheet._unboundSortDesc;o&&C.undoStack.stackSize>0&&(u=new t._SortColumnAction(C));this._sortDescriptions.itemCount>0?this._committedList=this._cloneSortList(this._sortDescriptions.items):this._committedList=[new n(-1,!0)];if(C.collectionView){C._isSorting=!0;C.beginUpdate();(d=C.editableCollectionView)&&d.currentEditItem&&-1!==d.items.indexOf(d.currentEditItem)&&!this._isEmpty(d.currentEditItem)&&d.commitEdit();C.collectionView.beginUpdate();y||C.selectedSheet.grid.collectionView.beginUpdate();(r=C.collectionView.sortDescriptions).clear();c=C.selection.clone();_=C.scrollPosition;m=C._getDataRowsOffset();var v=[];if(!C._isUndoing&&C.filter&&C.filter._isActive())for(a=0;a<C.rows.length-m;a++)(w=(p=C.rows[a+m]).dataItem)&&(v[f=null!=w._itemIdx?w._itemIdx:a]=p.visible);S||(s=y?C.collectionView.sortDescriptions:C.selectedSheet.grid.collectionView.sortDescriptions).clear();C.collectionView.sourceCollection.map((function(e,t){null==e._itemIdx&&(e._itemIdx=t)}));C.selection=c;C.scrollPosition=_;if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){C.collectionView.useStableSort=!0;S||y||(C.selectedSheet.grid.collectionView.useStableSort=!0)}for(a=0;a<this._sortDescriptions.itemCount;a++)if((i=this._sortDescriptions.items[a]).columnIndex>-1&&i.columnIndex<C.columns.length){l=new e.collections.SortDescription(C.columns[i.columnIndex].binding,i.ascending);r.push(l);S||s.push(l)}C.selectedSheet.selectionRanges.clear();C.collectionView.endUpdate(!0);y||C.selectedSheet.grid.collectionView.endUpdate(!0);c=C.selection.clone();_=C.scrollPosition;g=C.collectionView._view.slice();for(a=0;a<g.length;a++){a!==(w=g[a])._itemIdx&&C._updateFormulaForReorderingRows(w._itemIdx+m,a+m);C._updateCellStyleForReorderingRows(w._itemIdx+m,a+m,b)}if(v.length)for(a=0;a<C.rows.length-m;a++)if(w=(p=C.rows[a+m]).dataItem){f=null!=w._itemIdx?w._itemIdx:a;p.visible=v[f]}g.map((function(e,t){e._itemIdx=t}));C.selectedSheet._styledCells=b;C.selection=c;C.scrollPosition=_;C.endUpdate();C._copyColumnsToSelectedSheet();C._isSorting=!1}else{h.clear();for(a=0;a<this._sortDescriptions.itemCount;a++)(i=this._sortDescriptions.items[a]).columnIndex>-1&&h.push(new t._UnboundSortDescription(C.columns[i.columnIndex],i.ascending));!C.filter||!C._isUndoing&&C.filter._isActive()||setTimeout((function(){C._checkCollectionOwner(C.columns,!1);C.filter.apply()}),10)}if(u){u.saveNewState();C.undoStack._addAction(u)}C._copiedRanges=null;C._needCopyToSheet=!0}};SortManager.prototype.cancelSort=function(){this._sortDescriptions.sourceCollection=this._committedList.slice()};SortManager.prototype.clearSort=function(){this._sortDescriptions.sourceCollection=[];this.commitSort()};SortManager.prototype._getSortItem=function(e){var t=this.checkSortItemExists(e);if(t>-1)return this._sortDescriptions.items[t]};SortManager.prototype._cloneSortList=function(e){for(var t=[],o=0;o<e.length;o++)t[o]=e[o].clone();return t};SortManager.prototype._updateSortSortDescription=function(e,t,o){void 0===o&&(o=!0);var n,i;for(n=this._sortDescriptions.items.length-1;n>=0;n--){i=this._sortDescriptions.items[n];o?i.columnIndex>e&&(i.columnIndex+=t):i.columnIndex>=e+t?i.columnIndex-=t:i.columnIndex>=e&&this._sortDescriptions.remove(i)}};SortManager.prototype._isEmpty=function(e){var t=Object.prototype.hasOwnProperty;if(null==e)return!0;if(e.length>0)return!1;if(0===e.length)return!0;for(var o in e)if(t.call(e,o))return!1;return!0};return SortManager}();t.SortManager=o;var n=function(){function ColumnSortDescription(e,t){this._columnIndex=e;this._ascending=t}Object.defineProperty(ColumnSortDescription.prototype,"columnIndex",{get:function(){return this._columnIndex},set:function(e){this._columnIndex=+e},enumerable:!0,configurable:!0});Object.defineProperty(ColumnSortDescription.prototype,"ascending",{get:function(){return this._ascending},set:function(e){this._ascending=e},enumerable:!0,configurable:!0});ColumnSortDescription.prototype.clone=function(){return new ColumnSortDescription(this._columnIndex,this._ascending)};return ColumnSortDescription}();t.ColumnSortDescription=n}(t.sheet||(t.sheet={}))}(e.grid||(e.grid={}))}(wijmo||(wijmo={}));!function(e){var t;(function(t){"use strict";e._addCultureInfo("FlexSheet",{insertRow:"Insert Row",deleteRow:"Delete Rows",insertCol:"Insert Column",deleteCol:"Delete Columns",convertTable:"Convert To Table",insertSheet:"Insert",deleteSheet:"Delete",renameSheet:"Rename",copyCells:"Copy Cells",fillSeries:"Fill Series",fillFormat:"Fill Formatting Only",fillWithoutFormat:"Fill Without Formatting"});var o=[{name:"abs",description:"Returns the absolute value of a number."},{name:"acos",description:"Returns the arccosine of a number."},{name:"address",description:"Obtains the address of a cell in a worksheet by given specified row and column numbers."},{name:"and",description:"Returns TRUE if all of its arguments are TRUE."},{name:"asin",description:"Returns the arcsine of a number."},{name:"atan",description:"Returns the arctangent of a number."},{name:"atan2",description:"Returns the arctangent from x- and y-coordinates."},{name:"average",description:"Returns the average of its arguments."},{name:"ceiling",description:"Rounds a number to the nearest integer or to the nearest multiple of significance."},{name:"char",description:"Returns the character specified by the code number."},{name:"choose",description:"Chooses a value from a list of values."},{name:"code",description:"Returns a numeric code for the first character in a text string."},{name:"column",description:"Returns the column number of a reference."},{name:"columns",description:"Returns the number of columns in a reference."},{name:"concatenate",description:"Joins several text items into one text item."},{name:"cos",description:"Returns the cosine of a number."},{name:"count",description:"Counts how many numbers are in the list of arguments."},{name:"counta",description:"Counts how many values are in the list of arguments."},{name:"countblank",description:"Counts the number of blank cells within a range."},{name:"countif",description:"Counts the number of cells within a range that meet the given criteria."},{name:"countifs",description:"Counts the number of cells within a range that meet multiple criteria."},{name:"date",description:"Returns the serial number of a particular date."},{name:"datedif",description:"Calculates the number of days, months, or years between two dates."},{name:"day",description:"Converts a serial number to a day of the month."},{name:"dcount",description:"Counts the cells that contain numbers in a database."},{name:"exp",description:"Returns e raised to the power of a given number."},{name:"exact",description:"Compares two text strings and returns TRUE if they are exactly the same, FALSE otherwise."},{name:"false",description:"Returns the logical value FALSE."},{name:"find",description:"Finds one text value within another (case-sensitive)."},{name:"floor",description:"Rounds a number down, toward zero."},{name:"hlookup",description:"Looks in the top row of an array and returns the value of the indicated cell."},{name:"hour",description:"Converts a serial number to an hour."},{name:"if",description:"Specifies a logical test to perform."},{name:"iferror",description:"Returns a value you specify if a formula evaluates to an error; otherwise, it returns the result of the formula."},{name:"index",description:"Uses an index to choose a value from a reference."},{name:"indirect",description:"Returns the reference specified by a text string. References are immediately evaluated to display their contents."},{name:"iserr",description:"Checks if value is an error (#VALUE!, #REF!, #DIV/0!, #NUM!, #NAME?, or #NULL!) excluding #N/A, and returns TRUE or FALSE."},{name:"iserror",description:"Checks if value is an error (#N/A, #VALUE!, #REF!, #DIV/0!, #NUM!, #NAME?, or #NULL!), and returns TRUE or FALSE."},{name:"left",description:"Returns the leftmost characters from a text value."},{name:"len",description:"Returns the number of characters in a text string."},{name:"ln",description:"Returns the natural logarithm of a number."},{name:"lower",description:"Converts text to lowercase."},{name:"max",description:"Returns the maximum value in a list of arguments."},{name:"mid",description:"Returns a specific number of characters from a text string starting at the position you specify."},{name:"min",description:"Returns the minimum value in a list of arguments."},{name:"mod",description:"Returns the remainder from division."},{name:"month",description:"Converts a serial number to a month."},{name:"not",description:"Reverses the logic of its argument."},{name:"now",description:"Returns the serial number of the current date and time."},{name:"or",description:"Returns TRUE if any argument is TRUE."},{name:"pi",description:"Returns the value of pi."},{name:"power",description:"Returns the result of a number raised to a power."},{name:"product",description:"Multiplies its arguments."},{name:"proper",description:"Capitalizes the first letter in each word of a text value."},{name:"rand",description:"Returns a random number between 0 and 1."},{name:"rank",description:"Returns the rank of a number in a list of numbers."},{name:"rate",description:"Returns the interest rate per period of an annuity."},{name:"replace",description:"Replaces characters within text."},{name:"rept",description:"Repeats text a given number of times."},{name:"right",description:"Returns the rightmost characters from a text value."},{name:"round",description:"Rounds a number to a specified number of digits."},{name:"rounddown",description:"Rounds a number down, toward zero."},{name:"roundup",description:"Rounds a number up, away from zero."},{name:"row",description:"Returns the row number of a reference."},{name:"rows",description:"Returns the number of rows in a reference."},{name:"search",description:"Finds one text value within another (not case-sensitive)."},{name:"sin",description:"Returns the sine of the given angle."},{name:"sqrt",description:"Returns a positive square root."},{name:"stdev",description:"Estimates standard deviation based on a sample."},{name:"stdevp",description:"Calculates standard deviation based on the entire population."},{name:"substitute",description:"Substitutes new text for old text in a text string."},{name:"subtotal",description:"Returns a subtotal in a list or database."},{name:"sum",description:"Adds its arguments."},{name:"sumif",description:"Adds the cells specified by a given criteria."},{name:"sumifs",description:"Adds the cells in a range that meet multiple criteria."},{name:"sumproduct",description:"Multiplies corresponding components in the given arrays, and returns the sum of those products."},{name:"tan",description:"Returns the tangent of a number."},{name:"text",description:"Formats a number and converts it to text."},{name:"time",description:"Returns the serial number of a particular time."},{name:"today",description:"Returns the serial number of today's date."},{name:"trim",description:"Removes spaces from text."},{name:"true",description:"Returns the logical value TRUE."},{name:"trunc",description:"Truncates a number to an integer."},{name:"upper",description:"Converts text to uppercase."},{name:"value",description:"Converts a text argument to a number."},{name:"var",description:"Estimates variance based on a sample."},{name:"varp",description:"Calculates variance based on the entire population."},{name:"vlookup",description:"Looks in the first column of an array and returns the value of the indicated cell."},{name:"year",description:"Converts a serial number to a year."}],n=function(n){__extends(FlexSheet,n);function FlexSheet(o,i){var l=n.call(this,o,i)||this;l._selectedSheetIndex=-1;l._columnHeaderClicked=!1;l._addingSheet=!1;l._mouseMoveHdl=l._mouseMove.bind(l);l._clickHdl=l._click.bind(l);l._touchStartHdl=l._touchStart.bind(l);l._touchEndHdl=l._touchEnd.bind(l);l._keydownHdl=l._keydown.bind(l);l._isContextMenuKeyDown=!1;l._isClicking=!1;l._definedNames=new e.collections.ObservableArray;l._builtInTableStylesCache=null;l._needCopyToSheet=!0;l._isSorting=!1;l._fillingData=!1;l._enableDragDrop=!0;l._enableFormulas=!0;l._headerRowRemoved=!1;l._clearCalcCacheOnRefresh=!0;l._copyingTo=!1;l._ignoreBindGrid=!1;l._loadingFromWorkbook=!1;l.selectedSheetChanged=new e.Event;l.draggingRowColumn=new e.Event;l.droppingRowColumn=new e.Event;l.beginDroppingRowColumn=new e.Event;l.endDroppingRowColumn=new e.Event;l.loaded=new e.Event;l.unknownFunction=new e.Event;l.sheetCleared=new e.Event;l.prepareChangingRow=new e.Event;l.prepareChangingColumn=new e.Event;l.rowChanged=new e.Event;l.columnChanged=new e.Event;l.autoFilling=new e.Event;l.autoFilled=new e.Event;l._updateScrollPos=!1;i&&null!=i.allowAutoFill||(l._allowAutoFill=!0);l._needCopyToSheet=!1;l._colorThemes=["FFFFFF","000000","EEECE1","1F497D","4F818D","C0504D","9BBB59","8064A2","4BACC6","F79646"];l._eCt.style.backgroundColor="white";e.addClass(l.hostElement,"wj-flexsheet");e.setCss(l.hostElement,{fontFamily:"Arial"});l._cf=new t._FlexSheetCellFactory;l._bndSortConverter=l._sheetSortConverter.bind(l);l._selHdl=new t._FlexSheetSelectionHandler(l);l.quickAutoSize=!1;l._init();l.showSort=!1;l.allowSorting=e.grid.AllowSorting.None;l.showGroups=!1;l.showMarquee=!0;l.showSelectedHeaders=e.grid.HeadersVisibility.All;l.allowResizing=e.grid.AllowResizing.Both;l.allowDragging=e.grid.AllowDragging.None;l.keyActionTab=e.grid.KeyAction.CycleOut;l._needCopyToSheet=!0;return l}FlexSheet.prototype._getProductInfo=function(){return"R20I,FlexSheet"};Object.defineProperty(FlexSheet.prototype,"sheets",{get:function(){this._sheets||(this._sheets=new t.SheetCollection);return this._sheets},enumerable:!0,configurable:!0});Object.defineProperty(FlexSheet.prototype,"selectedSheetIndex",{get:function(){return this._selectedSheetIndex},set:function(e){if(e!==this._selectedSheetIndex){this._showSheet(e);this._sheets.selectedIndex=e}},enumerable:!0,configurable:!0});Object.defineProperty(FlexSheet.prototype,"selectedSheet",{get:function(){return this._selectedSheetIndex>=0?this._sheets[this._selectedSheetIndex]:null},enumerable:!0,configurable:!0});Object.defineProperty(FlexSheet.prototype,"isFunctionListOpen",{get:function(){return this._functionListHost&&"none"!==this._functionListHost.style.display},enumerable:!0,configurable:!0});Object.defineProperty(FlexSheet.prototype,"isTabHolderVisible",{get:function(){return this._tabHolder.visible},set:function(e){if(e!==this._tabHolder.visible){this._updateDivContainerHeight(e);e?this._eFocus.removeAttribute("tabindex"):this._eFocus.tabIndex=this._orgTabIndex;this._tabHolder.visible=e;this.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(FlexSheet.prototype,"undoStack",{get:function(){return this._undoStack},enumerable:!0,configurable:!0});Object.defineProperty(FlexSheet.prototype,"sortManager",{get:function(){return this._sortManager},enumerable:!0,configurable:!0});Object.defineProperty(FlexSheet.prototype,"filter",{get:function(){return this._filter},enumerable:!0,configurable:!0});Object.defineProperty(FlexSheet.prototype,"showFilterIcons",{get:function(){return!!this._filter&&this._filter.showFilterIcons},set:function(e){this._filter&&this._filter.showFilterIcons!==e&&(this._filter.showFilterIcons=e)},enumerable:!0,configurable:!0});Object.defineProperty(FlexSheet.prototype,"definedNames",{get:function(){return this._definedNames},enumerable:!0,configurable:!0});Object.defineProperty(FlexSheet.prototype,"enableDragDrop",{get:function(){return this._enableDragDrop},set:function(e){this._enableDragDrop=e},enumerable:!0,configurable:!0});Object.defineProperty(FlexSheet.prototype,"enableFormulas",{get:function(){return this._enableFormulas},set:function(e){if(this._enableFormulas!==e){this._enableFormulas=e;this.refresh()}},enumerable:!0,configurable:!0});Object.defineProperty(FlexSheet.prototype,"allowAutoFill",{get:function(){return this._allowAutoFill},set:function(t){this._allowAutoFill=e.asBoolean(t)},enumerable:!0,configurable:!0});Object.defineProperty(FlexSheet.prototype,"_lastSelMovePos",{get:function(){return this._lsmPos},set:function(e){this._lsmPos=e?e.clone():null},enumerable:!0,configurable:!0});FlexSheet.prototype.onSelectedSheetChanged=function(e){this.selectedSheetChanged.raise(this,e)};FlexSheet.prototype.onDraggingRowColumn=function(e){this.draggingRowColumn.raise(this,e)};FlexSheet.prototype.onDroppingRowColumn=function(t){e._deprecated("droppingRowColumn","beginDroppingRowColumn and endDroppingRowColumn");this.droppingRowColumn.raise(this,new e.EventArgs)};FlexSheet.prototype.onBeginDroppingRowColumn=function(e){this.beginDroppingRowColumn.raise(this,e)};FlexSheet.prototype.onEndDroppingRowColumn=function(e){this.endDroppingRowColumn.raise(this,e)};FlexSheet.prototype.onLoaded=function(t){var o=this;if(this._toRefresh){clearTimeout(this._toRefresh);this._toRefresh=null}this._toRefresh=setTimeout((function(){o._setFlexSheetToDirty();o.invalidate()}),10);this.loaded.raise(this,new e.EventArgs)};FlexSheet.prototype.onUnknownFunction=function(e){this.unknownFunction.raise(this,e)};FlexSheet.prototype.onSheetCleared=function(e){this.sheetCleared.raise(this,e)};FlexSheet.prototype.onPrepareChangingRow=function(e){this.prepareChangingRow.raise(this,e)};FlexSheet.prototype.onPrepareChangingColumn=function(e){this.prepareChangingColumn.raise(this,e)};FlexSheet.prototype.onRowChanged=function(e){this.rowChanged.raise(this,e)};FlexSheet.prototype.onColumnChanged=function(e){this.columnChanged.raise(this,e)};FlexSheet.prototype.onAutoFilling=function(e){this.autoFilling.raise(this,e)};FlexSheet.prototype.onAutoFilled=function(e){this.autoFilled.raise(this,e)};FlexSheet.prototype.refresh=function(e){void 0===e&&(e=!0);this.hostElement&&!this.isUpdating&&this._updateDivContainerHeight(this.isTabHolderVisible);if(!this.preserveSelectedState&&this.selectedSheet){this.selectedSheet.selectionRanges.clear();this.selectedSheet.selectionRanges.push(this.selection)}if(e){this._clearCalcCacheOnRefresh&&this._clearCalcEngine();this._clearCalcCacheOnRefresh=!0}this._lastVisibleFrozenRow=-1;if(this.frozenRows>0)for(var t=this.frozenRows-1;t>=0;t--)if(this.rows[t]&&this.rows[t].isVisible){this._lastVisibleFrozenRow=t;break}this._lastVisibleFrozenColumn=-1;if(this.frozenColumns>0)for(t=this.frozenColumns-1;t>=0;t--)if(this.columns[t]&&this.columns[t].isVisible){this._lastVisibleFrozenColumn=t;break}if(this.selectedSheet){if(this.selectedSheet._freezeHiddenRows&&this.selectedSheet._freezeHiddenRows.length>0)for(t=0;t<this.selectedSheet._freezeHiddenRows.length;t++){var o=this.rows[t];o instanceof d||!this.selectedSheet._freezeHiddenRows[t]||(o.visible=!1)}if(this.selectedSheet._freezeHiddenCols&&this.selectedSheet._freezeHiddenCols.length>0)for(t=0;t<this.selectedSheet._freezeHiddenCols.length;t++)this.selectedSheet._freezeHiddenCols[t]&&(this.columns[t].visible=!1)}n.prototype.refresh.call(this,e);if(this.hostElement&&!this.isUpdating){this._tabHolder.adjustSize();this._tabHolder.isDisabled=this.isDisabled;this._tabHolder.sheetControl.isDisabled=this.isDisabled}};FlexSheet.prototype.setCellData=function(e,t,o,n,i){void 0===n&&(n=!1);void 0===i&&(i=!0);var l=_isFormula(o);this._clearCalcEngine();return this.cells.setCellData(e,t,o,n&&!l,i)||this._getHasValidation()};FlexSheet.prototype.containsFocus=function(){return this.isFunctionListOpen||n.prototype.containsFocus.call(this)};FlexSheet.prototype.addUnboundSheet=function(e,t,o,n,i){var l=this._addSheet(e,t,o,n,i);0===l.selectionRanges.length&&l.selectionRanges.push(this.selection);return l};FlexSheet.prototype.addBoundSheet=function(e,t,o,n){var i=this._addSheet(e,0,0,o,n);if(t){i.itemsSource=t;this.childItemsPath&&(i.grid.childItemsPath=this.childItemsPath)}0===i.selectionRanges.length&&i.selectionRanges.push(this.selection);return i};FlexSheet.prototype.applyCellsStyle=function(e,o,n){void 0===n&&(n=!1);var i,l,r,s,a,h=null!=o&&o.length>0,u=o||[this.selection];if(this.selectedSheet)if(e||!this._cloneStyle){if(u){if(o||n)n&&!this._cloneStyle&&(this._cloneStyle=this._cloneObject(this.selectedSheet._styledCells));else{this.undoStack.stackSize>0&&(a=new t._CellStyleAction(this,this._cloneStyle));this._cloneStyle=null}for(s=0;s<u.length;s++)for(i=(r=u[s]).topRow;i<=r.bottomRow;i++)for(l=r.leftCol;l<=r.rightCol;l++)this._applyStyleForCell(i,l,e,h);if(a){a.saveNewState();this._undoStack._addAction(a)}}o||this.refresh(!1)}else{this.selectedSheet._styledCells=this._cloneObject(this._cloneStyle);this._cloneStyle=null;this.refresh(!1)}};FlexSheet.prototype.freezeAtCursor=function(){var e,t,o=this;if(this.selectedSheet){this.selectedSheet._freezeHiddenRows=null;this.selectedSheet._freezeHiddenCols=null;if(this.selection&&0===this.frozenRows&&0===this.frozenColumns){if(this._ptScrl.y<0){this.selectedSheet._freezeHiddenRows=[];for(var n=0;n<this.selection.topRow-1;n++){var i=this.rows[n];if(!(i instanceof d)){if(!(i._pos+this._ptScrl.y<0&&i.visible))break;i.visible=!1;this.selectedSheet._freezeHiddenRows[n]=!0}}}if(this._ptScrl.x<0){this.selectedSheet._freezeHiddenCols=[];for(n=0;n<this.selection.leftCol-1;n++){var l=this.columns[n];if(!(l._pos+this._ptScrl.x<0&&l.visible))break;l.visible=!1;this.selectedSheet._freezeHiddenCols[n]=!0}}e=this.selection.leftCol>0?this.selection.leftCol:0;t=this.selection.topRow>0?this.selection.topRow:0}else{for(n=0;n<this.frozenRows-1&&n<this.rows.length;n++)this.rows[n].visible=!0;for(n=0;n<this.frozenColumns-1&&n<this.columns.length;n++)this.columns[n].visible=!0;this._filter.apply();e=0;t=0}this.frozenRows=this.selectedSheet.grid.frozenRows=t;this.frozenColumns=this.selectedSheet.grid.frozenColumns=e;setTimeout((function(){o._setFlexSheetToDirty();o.invalidate();o.scrollIntoView(o.selection.topRow,o.selection.leftCol)}),10)}};FlexSheet.prototype.showColumnFilter=function(){var e=this.selection.col>0?this.selection.col:0;this.columns.length>0&&this._filter.editColumnFilter(this.columns[e])};FlexSheet.prototype.clear=function(){this.beginUpdate();this.selection=new e.grid.CellRange;this.sheets.clear();this._selectedSheetIndex=-1;this.columns.clear();this.rows.clear();this.columnHeaders.columns.clear();this.rowHeaders.rows.clear();this._undoStack.clear();this._ptScrl=new e.Point;this._clearCalcEngine();this._definedNames.clear();this._builtInTableStylesCache=null;this._copiedRanges=null;this._copiedSheet=null;this._isCutting=!1;this._cutValue=null;this._reservedContent=null;this._lastVisibleFrozenRow=-1;this._lastVisibleFrozenColumn=-1;this.addUnboundSheet();this.endUpdate()};FlexSheet.prototype.getSelectionFormatState=function(){var e,t,o=this.rows.length,n=this.columns.length,i={isBold:!1,isItalic:!1,isUnderline:!1,textAlign:"left",isMergedCell:!1};if(0===o||0===n)return i;if(this.selection){if(this.selection.row>=o||this.selection.row2>=o||this.selection.col>=n||this.selection.col2>=n)return i;for(e=this.selection.topRow;e<=this.selection.bottomRow;e++)for(t=this.selection.leftCol;t<=this.selection.rightCol;t++)this._checkCellFormat(e,t,i)}return i};FlexSheet.prototype.insertRows=function(o,n){var i,l,r,a,h,u,c,_=this,g=e.isNumber(o)&&o>=0?o:this.selection&&this.selection.topRow>-1?this.selection.topRow:0,f=e.isNumber(n)?n:1,p=this.rows[g];if(this.selectedSheet){this.rows.length>0?g>=this.rows.length&&(g=this.rows.length-1):g=0;this._clearCalcEngine();this.finishEditing();0===g&&p&&p.constructor===d&&(g=1);this.onPrepareChangingRow(new s(g,f,!0,!1));this.undoStack.stackSize>0&&(i=new t._RowsChangedAction(this,g,f,!0));this._updateCellsForUpdatingRow(this.rows.length,g,f);if(!this.collectionView||0===this.collectionView.sortDescriptions.length){l=this._updateAffectedFormula(g,f,!0,!0);r=this._updateAffectedNamedRanges(g,f,!0,!0)}if(i){i._affectedFormulas=l;i._affectedDefinedNameVals=r}var w=null==this.selectedSheet.grid.collectionView,m=this.collectionView,C=m instanceof e.collections.CollectionView?m:null;if(m){this.selectedSheet._dataView=this.collectionView._view.slice();a=this.itemsSource instanceof e.collections.CollectionView;h=this.autoGenerateColumns;this.autoGenerateColumns=!1;this.collectionView.beginUpdate();if(!a){u=this.selectedSheet.grid.autoGenerateColumns;this.selectedSheet.grid.autoGenerateColumns=!1;w||this.selectedSheet.grid.collectionView.beginUpdate()}for(var S=0;S<f;S++){var b=C&&C.newItemCreator?C.newItemCreator():{};c=Math.max(g-this._getDataRowsOffset(),0);m.sourceCollection.splice(c,0,b);C&&C.trackChanges&&C.itemsAdded.push(b);if(!a){var y=this.selectedSheet.grid.itemsSource;y&&this.itemsSource!==y&&y.splice(c,0,b)}this.selectedSheet._dataView.splice(c,0,b)}this._updateItemIndexForInsertingRow(this.collectionView.sourceCollection,c,f);if(!a){w||this.selectedSheet.grid.collectionView.endUpdate(!0);this.selectedSheet.grid.autoGenerateColumns=u}var v=this.collectionView._idx;this.collectionView.endUpdate(!0);if(this.collectionView.sortDescriptions.length>0){this.collectionView._view=this.selectedSheet._dataView;this.collectionView._pgView=this.collectionView._getPageView();this.collectionView._idx=v;if(!a&&!w){this.selectedSheet.grid.collectionView._view=this.selectedSheet._dataView;this.selectedSheet.grid.collectionView._pgView=this.selectedSheet.grid.collectionView._getPageView();this.collectionView._idx=v}this._bindGrid(!1);this.selectedSheet.grid._bindGrid(!1)}setTimeout((function(){_._filter.apply()}));this.autoGenerateColumns=h}else{this.rows.beginUpdate();for(S=0;S<f;S++)this.rows.insert(g,new e.grid.Row);var R=this.selectedSheet._freezeHiddenRows;if(R&&R.length)for(S=g+f;S<this.rows.length;S++)R[S]||(this.rows[S].visible=!0);this.rows.endUpdate()}this._updateTablesForUpdatingRow(g,f);this.selection&&-1!==this.selection.row&&-1!==this.selection.col||(this.selection=new e.grid.CellRange(0,0));if(i){i.saveNewState();this._undoStack._addAction(i)}this.onRowChanged(new s(g,f,!0,!1));m&&this.refresh()}};FlexSheet.prototype.deleteRows=function(o,n){if(this.selectedSheet&&!(this.rows.length<1)){var i=o,l=e.isArray(o);if(!l)if(e.isNumber(o)){if((n=e.isNumber(n)?n:1)<1)return;i=[new e.grid.CellRange(o,-1,o+n-1,-1)]}else l=(i=this._selections()).length>1;var r=!!this.collectionView;if(r&&!this._headerRowRemoved)for(var a=0,h=this.rows.length;a<h;a++)if(this.rows[a]instanceof d){i=g.excludeRow(i,a);break}if((i=g.validateRowRanges(i,this.rows.length)).length){var u=0;i.forEach((function(e){e.col=e.col2=-1;u+=e.rowSpan}));this._clearCalcEngine();this.finishEditing();var c,_,f,p=this.selection.topRow,w=l?new s(i,!1,!1):new s(i[0].topRow,i[0].rowSpan,!1,!1);this.onPrepareChangingRow(w);this.undoStack.stackSize>0&&(f=new t._RowsChangedAction(this,null,null,!1));var m=u===this.rows.length,C=r&&this.itemsSource instanceof e.collections.CollectionView,S=null==this.selectedSheet.grid.collectionView,b=0;this.rows.beginUpdate();if(r){this.selectedSheet._dataView=this.collectionView._view.slice();c=this.autoGenerateColumns;this.autoGenerateColumns=!1;this.collectionView.beginUpdate();if(!C){_=this.selectedSheet.grid.autoGenerateColumns;this.selectedSheet.grid.autoGenerateColumns=!1;S||this.selectedSheet.grid.collectionView.beginUpdate()}}for(a=i.length-1;a>=0;a--){var y=i[a],v=void 0;if(f){(v=new t._RowsChangedAction(this,y.topRow,y.rowSpan,!1))._affectedFormulas=this._updateAffectedFormula(y.bottomRow,y.rowSpan,!1,!0);v._affectedDefinedNameVals=this._updateAffectedNamedRanges(y.bottomRow,y.rowSpan,!1,!0);v._deletedTables=this._updateTablesForUpdatingRow(y.topRow,y.rowSpan,!0);f.addDeleteSubAction(v)}this._updateCellsForUpdatingRow(this.rows.length,y.topRow,y.rowSpan,!0);for(var R=y.bottomRow;R>=y.topRow;R--){var x=this.rows[R];if(!x||(x.constructor!==d||m)&&x.isVisible){b++;if(x.dataItem&&this.editableCollectionView){var T=void 0;this.editableCollectionView.remove(x.dataItem);this.selectedSheet._dataView.splice(this.selectedSheet._dataView.indexOf(x.dataItem),1);C||(T=this.itemsSource.indexOf(x.dataItem));this._updateItemIndexForRemovingRow(this.collectionView.sourceCollection,T)}else this.rows.removeAt(R)}}v&&v.saveNewState()}if(r){if(!C){S||this.selectedSheet.grid.collectionView.endUpdate(b>0);this.selectedSheet.grid.autoGenerateColumns=_}this.collectionView.endUpdate(b>0);if(this.collectionView.sortDescriptions.length>0){this.collectionView._view=this.selectedSheet._dataView;this.collectionView._pgView=this.collectionView._getPageView();if(!C&&!S){this.selectedSheet.grid.collectionView._view=this.selectedSheet._dataView;this.selectedSheet.grid.collectionView._pgView=this.selectedSheet.grid.collectionView._getPageView()}this._bindGrid(!1);this.selectedSheet.grid._bindGrid(!1)}this.autoGenerateColumns=c}this.rows.endUpdate();this.selectedSheet.selectionRanges.clear();var E=this.rows.length;if(0===E){this.select(new e.grid.CellRange);"move"===this.hostElement.style.cursor&&(this.hostElement.style.cursor="default")}else if(this.selection.topRow>=E)this.select(new e.grid.CellRange(E-1,0,E-1,this.columns.length-1));else{var F=p-u+1;F=Math.max(F,i[0].topRow);this.selection.topRow>=0&&(F=Math.min(F,this.selection.topRow));this.select(new e.grid.CellRange(F,this.selection.col,F,this.selection.col2))}if(f){f.saveNewState();this._undoStack._addAction(f)}this.onRowChanged(w);r&&this.refresh()}}};FlexSheet.prototype.insertColumns=function(o,n){var i,l,r,a=e.isNumber(o)&&o>=0?o:this.selection&&this.selection.leftCol>-1?this.selection.leftCol:0,h=e.isNumber(n)?n:1;if(this.selectedSheet){this.columns.length>0?a>=this.columns.length&&(a=this.columns.length-1):a=0;this._clearCalcEngine();this.finishEditing();this.onPrepareChangingColumn(new s(a,h,!0,!0));this.undoStack.stackSize>0&&(i=new t._ColumnsChangedAction(this,a,h,!0));this._updateCellsForUpdatingColumn(this.columns.length,a,h);l=this._updateAffectedFormula(a,h,!0,!1);r=this._updateAffectedNamedRanges(a,h,!0,!1);if(i){i._affectedFormulas=l;i._affectedDefinedNameVals=r}this.columns.beginUpdate();for(var u=0;u<h;u++){var d=new e.grid.Column;d.isRequired=!1;if(this.itemsSource){d.binding=this._getUniqueColumnName();var c=this.rows[this._getDataRowsOffset()-1];if(c){c._ubv||(c._ubv={});c._ubv[d._hash]=FlexSheet._getHeaderRowText(d)}}this.columns.insert(a,d)}this.columns.endUpdate();this.selectedSheet._filterDefinition=this._filter.filterDefinition;this.selectedSheet.grid.columns._dirty=!1;this._sortManager._updateSortSortDescription(a,h);this._sortManager.commitSort(!1);this._updateTablesForUpdatingColumn(a,h);this.selection&&-1!==this.selection.row&&-1!==this.selection.col||(this.selection=new e.grid.CellRange(0,0));if(i){i.saveNewState();this._undoStack._addAction(i)}this.onColumnChanged(new s(a,h,!0,!0))}};FlexSheet.prototype.deleteColumns=function(o,n){if(this.selectedSheet){var i=o,l=e.isArray(o);if(!l)if(e.isNumber(o)){if((n=e.isNumber(n)?n:1)<1)return;i=[new e.grid.CellRange(-1,o,-1,o+n-1)]}else l=(i=this._selections()).length>1;if((i=g.validateColumnRanges(i,this.columns.length)).length){var r=this.selection.leftCol,a=0;i.forEach((function(e){a+=e.columnSpan;e.row=e.row2=-1}));this._clearCalcEngine();this.finishEditing();var h,u=l?new s(i,!1,!0):new s(i[0].leftCol,i[0].columnSpan,!1,!0);this.onPrepareChangingColumn(u);this.undoStack.stackSize>0&&(h=new t._ColumnsChangedAction(this,null,null,!1));this.columns.beginUpdate();for(var d=i.length-1;d>=0;d--){var c=i[d],_=void 0;if(h){(_=new t._ColumnsChangedAction(this,c.leftCol,c.columnSpan,!1))._affectedFormulas=this._updateAffectedFormula(c.rightCol,c.columnSpan,!1,!1);_._affectedDefinedNameVals=this._updateAffectedNamedRanges(c.rightCol,c.columnSpan,!1,!1);_._deletedTables=this._updateTablesForUpdatingColumn(c.leftCol,c.columnSpan,!0);h._delSubActions.push(_)}this._updateCellsForUpdatingColumn(this.columns.length,c.leftCol,c.columnSpan,!0);for(var f=c.rightCol;f>=c.leftCol;f--)if(this.columns[f].isVisible){this.columns.removeAt(f);this._sortManager.deleteSortLevel(f)}this._sortManager._updateSortSortDescription(c.leftCol,c.columnSpan,!1)}this.columns.endUpdate();this.selectedSheet._filterDefinition=this._filter.filterDefinition;this.selectedSheet.grid.columns._dirty=!1;this._sortManager.commitSort(!1);this.selectedSheet.selectionRanges.clear();var p=this.columns.length;if(0===p){this.select(new e.grid.CellRange);"move"===this.hostElement.style.cursor&&(this.hostElement.style.cursor="default")}else if(this.selection.leftCol>=p)this.select(new e.grid.CellRange(0,p-1,this.rows.length-1,p-1));else{var w=r-a+1;w=Math.max(w,i[0].leftCol);w=Math.min(w,this.selection.leftCol);this.select(new e.grid.CellRange(this.selection.row,w,this.selection.row2,w))}if(h){this._undoStack._addAction(h);h._delSubActions.forEach((function(e){return e.saveNewState()}))}this.onColumnChanged(u)}}};FlexSheet.prototype.mergeRange=function(o,n){void 0===n&&(n=!1);var i,l,r,s,a,h=o||this.selection,u=-1,d=-1;if(this.selectedSheet){if(h){if(1===h.rowSpan&&1===h.columnSpan)return;for(i=h.topRow;i<=h.bottomRow;i++)for(l=h.leftCol;l<=h.rightCol;l++)if(this.selectedSheet.findTable(i,l))return;if(!o&&!n){this.undoStack.stackSize>0&&(a=new t._CellMergeAction(this));this.hostElement.focus()}if(!this._resetMergedRange(h)){for(i=h.topRow;i<=h.bottomRow;i++)if((r=this.rows[i])&&r.isVisible){u=i;break}for(l=h.leftCol;l<=h.rightCol;l++)if((s=this.columns[l])&&s.isVisible){d=l;break}u>-1&&d>-1&&this.selectedSheet._mergedRanges.push(new e.grid.CellRange(u,d,h.bottomRow,h.rightCol))}if(a){a.saveNewState();this._undoStack._addAction(a)}}o||this.refresh()}};FlexSheet.prototype.getMergedRange=function(t,o,i,l){void 0===l&&(l=!0);var r,s,a,h,u=this.selectedSheet?this.selectedSheet._getMergedRange(o,i):null;if(t===this.cells&&u){if(!u.isSingleCell&&(this.frozenRows>0||this.frozenColumns>0)&&(u.topRow<this.frozenRows&&u.bottomRow>=this.frozenRows||u.leftCol<this.frozenColumns&&u.rightCol>=this.frozenColumns)){r=u.topRow;s=u.bottomRow;a=u.leftCol;h=u.rightCol;o>=this.frozenRows&&u.topRow<this.frozenRows&&(r=this.frozenRows);o<this.frozenRows&&u.bottomRow>=this.frozenRows&&(s=this.frozenRows-1);s>=this.rows.length&&(s=this.rows.length-1);i>=this.frozenColumns&&u.leftCol<this.frozenColumns&&(a=this.frozenColumns);i<this.frozenColumns&&u.rightCol>=this.frozenColumns&&(h=this.frozenColumns-1);h>=this.columns.length&&(h=this.columns.length-1);return new e.grid.CellRange(r,a,s,h)}return u.bottomRow>=this.rows.length?new e.grid.CellRange(u.topRow,u.leftCol,this.rows.length-1,u.rightCol):u.rightCol>=this.columns.length?new e.grid.CellRange(u.topRow,u.leftCol,u.bottomRow,this.columns.length-1):u.clone()}return n.prototype.getMergedRange.call(this,t,o,i,l)};FlexSheet.prototype.evaluate=function(o,n,i,l){void 0===l&&(l=!0);var r=this._evaluate(o,n,i);return l&&null!=r&&!e.isPrimitive(r)?r instanceof t.FormulaError?r.error:r.value:r};FlexSheet.prototype.getCellValue=function(o,n,i,l){void 0===i&&(i=!1);var r=l&&l!==this.selectedSheet?l.grid.columns[n]:this.columns[n],s=this._getCellStyle(o,n,l),a=s&&s.format||null,h=l&&l!==this.selectedSheet?l.grid.getCellData(o,n,!1):this.getCellData(o,n,!1);if(e.isString(h)){var u=l||this.selectedSheet;if(u){var d=u.findTable(o,n);if(d&&d._isHeaderRow(o))return h}var c=t._FormulaErrorHelper.asError(h);if(c)return c;if(_isFormula(h)&&(h=this._evaluate(h,null,l,o,n))instanceof t.FormulaError)return h}if(i){a||null==h||e.isPrimitive(h)||(a=h.format);h=this._formatEvaluatedResult(h,r,a)}else null==h||e.isPrimitive(h)||(h=h.value);return 0===i?h:null==h?"":h};FlexSheet.prototype.showFunctionList=function(t){var o=this;if(this._enableFormulas){this._functionTarget=e.tryCast(t,HTMLInputElement);if(this._functionTarget&&this._functionTarget.value&&"="===this._functionTarget.value[0]){this._functionList._cv.filter=function(e){var t,n=e.actualvalue.toLowerCase(),i=o._getCurrentFormulaIndex(o._functionTarget.value);-1===i&&(i=0);return(t=o._functionTarget.value.substr(i+1).trim().toLowerCase()).length>0&&0===n.indexOf(t)||"="===o._functionTarget.value};this._functionList.selectedIndex=0;var n=this._cumulativeOffset(t),i=this._cumulativeOffset(this._root),l=n.y+t.clientHeight+2+(e.hasClass(t,"wj-grid-editor")?this._ptScrl.y:0),r=n.x+(e.hasClass(t,"wj-grid-editor")?this._ptScrl.x:0);e.setCss(this._functionListHost,{height:this._functionList._cv.items.length>5?"218px":"auto",display:this._functionList._cv.items.length>0?"block":"none",top:"",left:""});this._functionListHost.scrollTop=0;this._functionListHost.offsetHeight+l>i.y+this._root.offsetHeight?l=l-t.clientHeight-this._functionListHost.offsetHeight-5:l+=5;this._functionListHost.offsetWidth+r>i.x+this._root.offsetWidth&&(r=i.x+this._root.offsetWidth-this._functionListHost.offsetWidth);e.setCss(this._functionListHost,{top:l,left:r})}else this.hideFunctionList()}};FlexSheet.prototype.hideFunctionList=function(){this._functionListHost.style.display="none"};FlexSheet.prototype.selectPreviousFunction=function(){this._functionList.selectedIndex>0&&this._functionList.selectedIndex--};FlexSheet.prototype.selectNextFunction=function(){this._functionList.selectedIndex<this._functionList.itemsSource.length&&this._functionList.selectedIndex++};FlexSheet.prototype.applyFunctionToCell=function(){if(this._functionTarget){var e=this._getCurrentFormulaIndex(this._functionTarget.value);-1===e?e=this._functionTarget.value.indexOf("="):e+=1;this._functionTarget.value=this._functionTarget.value.substring(0,e)+this._functionList.selectedValue+"(";"="!==this._functionTarget.value[0]&&(this._functionTarget.value="="+this._functionTarget.value);this._functionTarget.focus();this.hideFunctionList()}};FlexSheet.prototype.save=function(e,t){var o=this._saveToWorkbook(t);e&&o.save(e);return o};FlexSheet.prototype.saveAsync=function(e,t,o,n){var i=this._saveToWorkbook(n);i.saveAsync(e,t,o);return i};FlexSheet.prototype.saveToWorkbookOM=function(e){return this._saveToWorkbook(e)._serialize()};FlexSheet.prototype.load=function(t){var o=this;if(t instanceof Blob)e.grid.xlsx._blobToBuffer(t,(function(n){t=null;var i=new e.xlsx.Workbook;i.load(n);n=null;o._loadFromWorkbook(i);i=null}));else if(t instanceof e.xlsx.Workbook){this._loadFromWorkbook(t);t=null}else{if(!(t instanceof ArrayBuffer||e.isString(t)))throw"Invalid workbook.";var n=new e.xlsx.Workbook;n.load(t);t=null;this._loadFromWorkbook(n);n=null}};FlexSheet.prototype.loadAsync=function(t,o,n){var i=this;if(t instanceof Blob)e.grid.xlsx._blobToBuffer(t,(function(l){t=null;var r=new e.xlsx.Workbook;r.loadAsync(l,(function(){i._loadFromWorkbook(r);o&&o(r);l=null;r=null}),n)}));else if(t instanceof e.xlsx.Workbook){this._loadFromWorkbook(t);o&&o(t);t=null}else{if(!(t instanceof ArrayBuffer||e.isString(t)))throw"Invalid workbook.";var l=new e.xlsx.Workbook;l.loadAsync(t,(function(){t=null;i._loadFromWorkbook(l);o&&o(l);l=null}),n)}};FlexSheet.prototype.loadFromWorkbookOM=function(t){var o;t instanceof e.xlsx.Workbook?o=t:(o=new e.xlsx.Workbook)._deserialize(t);this._loadFromWorkbook(o)};FlexSheet.prototype.undo=function(){var e=this;setTimeout((function(){e._undoStack.undo()}),100)};FlexSheet.prototype.redo=function(){var e=this;setTimeout((function(){e._undoStack.redo()}),100)};FlexSheet.prototype.select=function(t,o){void 0===o&&(o=!0);var i,l,r;if(e.isNumber(t)&&e.isNumber(o)){t=new e.grid.CellRange(t,o);this._lastSelMovePos=t;o=!0}else this._lastSelMovePos=null;if(t.rowSpan!==this.rows.length&&t.columnSpan!==this.columns.length)for(l=t.topRow;l<=t.bottomRow;l++)for(r=t.leftCol;r<=t.rightCol;r++)if((i=this.getMergedRange(this.cells,l,r))&&!t.equals(i)){if(t.row<=t.row2){t.row=Math.min(t.topRow,i.topRow);t.row2=Math.max(t.bottomRow,i.bottomRow)}else{t.row=Math.max(t.bottomRow,i.bottomRow);t.row2=Math.min(t.topRow,i.topRow)}if(t.col<=t.col2){t.col=Math.min(t.leftCol,i.leftCol);t.col2=Math.max(t.rightCol,i.rightCol)}else{t.col=Math.max(t.rightCol,i.rightCol);t.col2=Math.min(t.leftCol,i.leftCol)}}this._isPasting&&this.collectionView&&(this.collectionView._pendingRefresh=!1);!this._enableMulSel&&this.selectedSheet&&this.selectedSheet.selectionRanges.clear();return n.prototype.select.call(this,t,o)};FlexSheet.prototype.addCustomFunction=function(t,o,n,i,l){e._deprecated("addCustomFunction","addFunction");this._calcEngine.addCustomFunction(t,o,i,l);this._addCustomFunctionDescription(t,n)};FlexSheet.prototype.addFunction=function(e,t,o,n,i){this._calcEngine.addFunction(e,t,n,i);this._addCustomFunctionDescription(e,o)};FlexSheet.prototype.dispose=function(){var e=window.navigator.userAgent;this._needCopyToSheet=!1;this.removeEventListener(document.body,"mousemove",this._mouseMoveHdl);this.removeEventListener(document.body,"keydown",this._keydownHdl);this.removeEventListener(document.body,"click",this._clickHdl);if(e.match(/iPad/i)||e.match(/iPhone/i)){this.removeEventListener(document.body,"touchstart",this._touchStartHdl);this.removeEventListener(document.body,"touchend",this._touchEndHdl)}this._filter&&this._filter.filterApplied.removeAllHandlers();this.hideFunctionList();if(!this.itemsSource){var t=this._selHdl.selection;t.row=t.row2=-1}n.prototype.dispose.call(this)};FlexSheet.prototype.getClipString=function(t){var o,i,l,r,s,a,h="",u=!0;if(!this.selectedSheet)return n.prototype.getClipString.call(this,t);this._isCutting=!1;if(!t)if(this.selectedSheet.selectionRanges.length>1){if(this._isMultipleRowsSelected()){h="";(o=this._selections()).sort(this._sortByRow);for(l=0;l<o.length;l++){h&&(h+="\n");h+=this.getClipString(o[l])}return h}if(this._isMultipleColumnsSelected()){h="";(o=this._selections()).sort(this._sortByColumn);for(i=(r=o[0]).topRow,u=!0;i<=r.bottomRow;i++){u||(h+="\n");u=!1;for(l=0,g=!0;l<o.length;l++){s=o[l];g||(h+="\t");g=!1;h+=this.getClipString(new e.grid.CellRange(i,s.col,i,s.col2))}}return h}e.assert(!1,"Copy or Cut operation cannot be used on multiple selections.")}else{t=this.selection;switch(this.selectionMode){case e.grid.SelectionMode.Row:case e.grid.SelectionMode.RowRange:t.col=0;t.col2=this.columns.length-1;break;case e.grid.SelectionMode.ListBox:t.col=0;t.col2=this.columns.length-1;for(var d=0;d<this.rows.length;d++)if(this.rows[d].isSelected&&this.rows[d].isVisible){t.row=t.row2=d;h&&(h+="\n");h+=this.getClipString(t)}return h}}if(!(t=e.asType(t,e.grid.CellRange)).isValid)return"";var c=t.topRow;for(u=!0;c<=t.bottomRow;c++)if(this.rows[c].isVisible){u||(h+="\n");u=!1;for(var _=t.leftCol,g=!0;_<=t.rightCol;_++)if(this.columns[_].isVisible){g||(h+="\t");g=!1;(a=(a=this.getCellValue(c,_,!0).toString()).replace(/\t/g," ")).indexOf("\n")>-1&&(a='"'+a.replace(/"/g,'""')+'"');h+=a}}return h};FlexSheet.prototype.setClipString=function(t,o){var i,l,r,s,a,h,u,d,c,_,g,f,p,w,m,C,S,b,y,v=null==o,R=!1,x=this.editableCollectionView;if(this.selectedSheet){o=o?e.asType(o,e.grid.CellRange):this.selection;y=t=e.asString(t).replace(/\r\n/g,"\n").replace(/\r/g,"\n");d=this._edtHdl._parseClipString(e.asString(t));v&&!o.isSingleCell&&d.length&&this._edtHdl._expandClipRows(d,o);C=this._containsMultiLineText(d);if(this._copiedRanges&&0!==this._copiedRanges.length&&(y.trim()===this._getRangeString(this._copiedRanges,this._copiedSheet).trim()||this._containsRandFormula(this._copiedRanges,this._copiedSheet))&&!this._cutValue||C){if(this._copiedRanges){var T=this._getRangeString(this._copiedRanges,this._copiedSheet,!1)+"\r\n";T=e.asString(T).replace(/\r\n/g,"\n").replace(/\r/g,"\n");d=this._edtHdl._parseClipString(e.asString(T));v&&!o.isSingleCell&&d.length&&this._edtHdl._expandClipRows(d,o)}(s=o.topRow+d.length-1)>=this.rows.length&&(s=this.rows.length-1);(a=o.leftCol+d[0].length-1)>=this.columns.length&&(a=this.columns.length-1);i=new e.grid.CellRange(o.topRow,o.leftCol,s,a);if(this.onPasting(new e.grid.CellRangeEventArgs(this.cells,i,t))){this.beginUpdate();if(C||!this._copiedRanges||this._copiedRanges.length>1||0===this._copiedRanges.length){l=o.topRow;h=(m=this._copiedRanges&&this._copiedRanges.length>1?this._copiedRanges[0]:new e.grid.CellRange).topRow;for(var E=0;E<d.length&&l<this.rows.length;E++,l++)if(this.rows[l].isVisible){c=d[E];u=m.leftCol;g=(r=o.leftCol)-u;for(var F=0;F<c.length&&r<this.columns.length;F++,r++)if(this.columns[r].isVisible){var A=c[F];if(!this.columns[r].isReadOnly&&!this.rows[l].isReadOnly){var k=A.length;k>1&&'"'==A[0]&&'"'==A[k-1]&&A.indexOf("\n")>-1&&(A=A.substr(1,k-2));R=this._postSetClipStringProcess(A,l,r,h,u,x);i.row2=Math.max(i.row2,l);i.col2=Math.max(i.col2,r)}u>=0&&u++}else F--;h>=0&&h++}else E--}else if(this._copiedRanges&&1===this._copiedRanges.length){var D=this.selectedSheet===this._copiedSheet?this:this._copiedSheet.grid;S=0;m=this.selectionMode===e.grid.SelectionMode.ListBox?this._getSelectionForListBoxMode(D):this._copiedRanges[0];l=o.topRow;for(E=0;E<d.length&&l<this.rows.length;E++,l++){b=0;if(this.rows[l].isVisible){for(;D.rows[m.topRow+S]&&!D.rows[m.topRow+S].isVisible;)S++;S>=m.rowSpan&&(S%=m.rowSpan);if(!D.rows[m.topRow+S])break;_=l-m.topRow-S;c=d[E];r=o.leftCol;for(F=0;F<c.length&&r<this.columns.length;F++,r++)if(this.columns[r]&&this.columns[r].isVisible){b>=m.columnSpan&&(b%=m.columnSpan);if(!D.columns[m.leftCol+b])break;g=r-m.leftCol-b;if(!this.columns[r].isReadOnly&&!this.rows[l].isReadOnly){A=c[F];var I=this._getCellStyle(m.topRow+S,m.leftCol+b,this._copiedSheet);if(_isFormula(A)&&(0!==_||0!==g))try{f=this._calcEngine._parse(A);p=new e.grid.CellRange(m.topRow+S,m.leftCol+b);w=new e.grid.CellRange(m.topRow+S+_,m.leftCol+b+g);var M=!(this._isCutting&&!f._refersTo(m));f._moveCellRangeExp(this.selectedSheetIndex,p,w,!1,M)&&(A="="+f._getStringExpression())}catch(e){}D.columns[m.leftCol+b].format&&!this.columns[r].format&&(I?I.format||(I.format=D.columns[m.leftCol+b].format):I={format:D.columns[m.leftCol+b].format});R=this._postSetClipStringProcess(A,l,r,m.topRow+S,m.leftCol+b,x,I);i.row2=Math.max(i.row2,l);i.col2=Math.max(i.col2,r)}b++}else F--;S++}else E--}}if(this._isCutting){this._delCutData(d.length,d[0].length);this._isCutting=!1;this._cutValue=y;this._copiedRanges=null;this._copiedSheet=null}this.endUpdate();this.collectionView&&R&&this.collectionView.refresh();this.select(i);this.onPasted(new e.grid.CellRangeEventArgs(this.cells,i))}else{this._cutValue=null;this._copiedRanges=null;this._copiedSheet=null}}else{if(y!==this._cutValue){this._cutValue=null;n.prototype.setClipString.call(this,t)}this._copiedRanges=null;this._copiedSheet=null}}else n.prototype.setClipString.call(this,t,o)};FlexSheet.prototype.getBuiltInTableStyle=function(e){var t;null==this._builtInTableStylesCache&&(this._builtInTableStylesCache={});if(null==(t=this._builtInTableStylesCache[e.toLowerCase()])){t=this._createBuiltInTableStyle(e);Object.freeze(t);this._builtInTableStylesCache[e.toLowerCase()]=t}return t};FlexSheet.prototype.onSortingColumn=function(e){return!1};FlexSheet.prototype._getCvIndex=function(e){return e>-1&&this.collectionView?this.rows[e]instanceof d?e:n.prototype._getCvIndex.call(this,e):-1};FlexSheet.prototype._headerRowAtTop=function(){var e=this._getDataRowsOffset();return e>0&&this.rows[e-1]instanceof d};FlexSheet.prototype._getDataRowsOffset=function(){var e=0;this.allowAddNew&&this.newRowAtTop&&e++;this.rows[e]instanceof d&&e++;return e};FlexSheet.prototype._bindGrid=function(e){if(!this._ignoreBindGrid)if(this.itemsSource)n.prototype._bindGrid.call(this,e);else if(!this.rows.length){var t=this._selHdl.selection;t.row=t.row2=-1}};FlexSheet.prototype._init=function(){var o=this,n=window.navigator.userAgent,mouseUp=function(e){document.removeEventListener("mouseup",mouseUp);o._mouseUp(e)};this.hostElement.setAttribute("tabindex","-1");this._divContainer=this.hostElement.querySelector('[wj-part="container"]');this._tabHolder=new t._TabHolder(this.hostElement.querySelector('[wj-part="tab-holder"]'),this);this._sheets.selectedSheetChanged.addHandler(this._selectedSheetChange,this);this._sheets.collectionChanged.addHandler(this._sourceChange,this);this._sheets.sheetVisibleChanged.addHandler(this._sheetVisibleChange,this);this._sheets.sheetCleared.addHandler(this.onSheetCleared,this);this._contextMenu=new t._SheetContextMenu(this.hostElement.querySelector('[wj-part="context-menu"]'),this);this._tabHolder.addEventListener(this._tabHolder.hostElement,"mousedown",(function(){n.match(/iPad/i)||n.match(/iPhone/i)||o._hideContextMenu()}));this._gpCells=new u(this,e.grid.CellType.Cell,this.rows,this.columns,this._eCt);this._gpCHdr=new u(this,e.grid.CellType.ColumnHeader,this._hdrRows,this.columns,this._eCHdrCt);this._gpRHdr=new u(this,e.grid.CellType.RowHeader,this.rows,this._hdrCols,this._eRHdrCt);this._gpTL=new u(this,e.grid.CellType.TopLeft,this._hdrRows,this._hdrCols,this._eTLCt);this._syncSelection=this._flexSheetSyncSelection.bind(this);this._sortManager=new t.SortManager(this);this._filter=new t.FlexSheetFilter(this);this._filter.filterApplied.addHandler((function(){if(o.selectedSheet){o.selectedSheet._filterDefinition=o._filter.filterDefinition;if(o.selectedSheet.itemsSource){o.selectedSheet._storeRowSettings();o.selectedSheet._setRowSettings()}}}));this._calcEngine=new t._CalcEngine(this);this._calcEngine.unknownFunction.addHandler((function(e,t){o.onUnknownFunction(t)}),this);this._initFuncsList();this._undoStack=new t.UndoStack(this);this.loadedRows.addHandler((function(){if(o.collectionView&&!(o.rows[0]instanceof d)&&!o._headerRowRemoved){var t=new d;t.isReadOnly=!0;for(var n=0;n<o.columns.length;n++){var i=o.columns[n];t._ubv||(t._ubv={});t._ubv[i._hash]=FlexSheet._getHeaderRowText(i)}o.rows[0]instanceof e.grid._NewRowTemplate&&o.newRowAtTop?o.rows.insert(1,t):o.rows.insert(0,t)}o._filter&&o._filter.apply()}));this.itemsSourceChanged.addHandler((function(){var e;for(e=0;e<o.columns.length;e++)o.columns[e].isRequired=!1;o.collectionView&&o.collectionView.currentChanged.removeHandler(null,o)}));this.copied.addHandler((function(t,n){var i;if(o.selectedSheet){o._copiedSheet=o.selectedSheet;o._needCopyToSheet=!0;if(o.selectedSheet.selectionRanges.length>1)if(o._isMultipleRowsSelected()){(i=o.selectedSheet.selectionRanges.slice(0)).sort(o._sortByRow);o._copiedRanges=i}else if(o._isMultipleColumnsSelected()){(i=o.selectedSheet.selectionRanges.slice(0)).sort(o._sortByColumn);o._copiedRanges=i}else e.assert(!1,"Copy operation cannot be used on multiple selections.");else o._copiedRanges=[n.range]}}));this.rows.collectionChanged.addHandler((function(t,n){o._clearForEmptySheet("rows");o.itemsSource||!o.selectedSheet||!o._needCopyToSheet||o._isCopying||o._isUndoing||n.item instanceof e.grid._NewRowTemplate||o._copyRowsToSelectedSheet();o.itemsSource&&o.selectedSheet&&n.action===e.collections.NotifyCollectionChangedAction.Remove&&n.item instanceof d&&!o._draggingSingleRow&&(o._headerRowRemoved=!0)}),this);this.columns.collectionChanged.addHandler((function(e,t){o._clearForEmptySheet("columns");o.selectedSheet&&o._needCopyToSheet&&!o._isCopying&&!o._isUndoing&&o._copyColumnsToSelectedSheet()}),this);this.definedNames.collectionChanged.addHandler((function(t,n){if(n.action===e.collections.NotifyCollectionChangedAction.Add||n.action===e.collections.NotifyCollectionChangedAction.Change){var i=n.action===e.collections.NotifyCollectionChangedAction.Add?"inserted":"updated";if(!(n.item instanceof _)){o.definedNames.remove(n.item);throw"Invalid defined name item object was "+i+".  The DefinedName instance should be "+i+" in the definedNames array."}if(!n.item||!n.item.name||null==n.item.value){o.definedNames.remove(n.item);throw"Invalid defined name was "+i+"."}if(null!=n.item.sheetName&&!o._validateSheetName(n.item.sheetName)){o.definedNames.remove(n.item);throw"The sheet name ("+n.item.sheetName+") does not exist in FlexSheet."}if(o._checkExistDefinedName(n.item.name,n.item.sheetName,n.index)){o.definedNames.remove(n.item);throw"The "+n.item.name+" already existed in definedNames."}}}));this.addEventListener(this.hostElement,"mousedown",(function(e){document.addEventListener("mouseup",mouseUp);o._isDescendant(o._divContainer,e.target)&&o._mouseDown(e)}),!0);this.addEventListener(this.hostElement,"dragend",(function(){o._columnHeaderClicked=!1;o._htDown=null;o._enableMulSel=!1;o.selectedSheet._addSelection(o.selection)}));this.addEventListener(this.hostElement,"contextmenu",(function(t){if(!t.defaultPrevented&&o.selectedSheet){if(!o.activeEditor){var n=void 0,i=void 0,l=o.selection;if(o._isContextMenuKeyDown&&l.row>-1&&l.col>-1&&o.rows.length>0&&o.columns.length>0){var r=o.columns[l.col],s=o.rows[l.row],a=o._cumulativeOffset(o.hostElement),h=o._cumulativeScrollOffset(o.hostElement),u=r.pos+o._eCt.offsetLeft+a.x+r.renderSize/2+o._ptScrl.x,d=s.pos+o._eCt.offsetTop+a.y+s.renderSize/2+o._ptScrl.y;i=new e.Point(u-h.x,d-h.y);n=o.hitTest(u,d)}else n=o.hitTest(t);t.preventDefault();if(n&&n.cellType!==e.grid.CellType.None){var c=o.columns.length-1,_=o.rows.length-1,g=void 0;switch(n.cellType){case e.grid.CellType.TopLeft:g=new e.grid.CellRange(Math.min(0,_),Math.min(0,c),_,c);break;case e.grid.CellType.RowHeader:g=new e.grid.CellRange(n.row,Math.min(0,c),n.row,c);break;case e.grid.CellType.ColumnHeader:g=new e.grid.CellRange(o.itemsSource&&o.rows[0]&&!o.rows[0].isVisible?1:Math.min(0,_),n.col,_,n.col);break;case e.grid.CellType.Cell:g=new e.grid.CellRange(n.row,n.col)}(g&&o.selection.contains(g)||n.cellType===e.grid.CellType.RowHeader&&o._isRowSelected(n.row)||n.cellType===e.grid.CellType.ColumnHeader&&o._isColumnSelected(n.col)||n.cellType===e.grid.CellType.Cell&&o._isCellSelected(n.row,n.col))&&(g=null);if(g){if(o.selectedSheet){o.selectedSheet.selectionRanges.clear();o.selectedSheet.selectionRanges.push(g)}o.selection=g}o._contextMenu.show(t,i)}}o._isContextMenuKeyDown=!1}}));this.prepareCellForEdit.addHandler(this._prepareCellForEditHandler,this);this.cellEditEnded.addHandler((function(e,t){(!t.data||46!==t.data.keyCode&&8!==t.data.keyCode)&&setTimeout((function(){o.hideFunctionList()}),200)}));this.cellEditEnding.addHandler((function(e,n){if(!n.cancel&&(!n.data||46!==n.data.keyCode&&8!==n.data.keyCode)){var i=o.getCellData(n.row,n.col,!1),l=o.cellFactory.getEditorValue(o);if((null==i||""===i)&&null!=l&&""!==l&&!isNaN(+l)){var r=o._updateFormulaBoundaryForEditingCell(n.row,n.col);o._undoStack._pendingAction&&o._undoStack._pendingAction instanceof t._EditAction&&(o._undoStack._pendingAction._affectedFormulas=r)}o._clearCalcEngine();o._clearCalcCacheOnRefresh=!1}}));this.rowEditEnding.addHandler((function(e,t){var n=o.collectionView;if(n&&o.selectedSheet){var i=n.sortDescriptions.length>0,l=o._filter&&o._filter._isActive();(i||o.selectedSheet._dataView||l)&&(o.selectedSheet._dataView=n._view.slice());i&&(o.selectedSheet._scrollPosition=o.scrollPosition)}}));this.rowEditEnded.addHandler((function(t,n){var i=o.collectionView;if(i&&o.selectedSheet){o.selectedSheet._dataView&&(o.selectedSheet._dataView=i._view.slice());var l=i.sortDescriptions.length>0,r=o._filter&&o._filter._isActive();if(l||r){i._view=o.selectedSheet._dataView;i._pgView=i._getPageView();if(!(o.itemsSource instanceof e.collections.CollectionView)){o.selectedSheet.grid.collectionView._view=o.selectedSheet._dataView;o.selectedSheet.grid.collectionView._pgView=o.selectedSheet.grid.collectionView._getPageView()}o._bindGrid(!1);o.selectedSheet.grid._bindGrid(!1)}l&&(o.scrollPosition=o.selectedSheet._scrollPosition)}}));this.pasting.addHandler((function(){o._needCopyToSheet=!1;o._isPasting=!0}));this.pasted.addHandler((function(){o.selection;o._needCopyToSheet=!0;o._isPasting=!1;o._clearCalcEngine()}));this.resizingColumn.addHandler((function(){o._resizing=!0}));this.resizingRow.addHandler((function(){o._resizing=!0}));this.resizedColumn.addHandler((function(){o._resizing=!1}));this.resizedRow.addHandler((function(){o._resizing=!1}));this.selectionChanged.addHandler((function(){var t=o.selection;t.rightCol>=o.columns.length&&(o.selection=new e.grid.CellRange(t.row,Math.min(t.col,o.columns.length-1),t.row2,Math.min(o.selection.col2,o.columns.length-1)));o._enableMulSel||o._isCopying||!o.selectedSheet||o.selectedSheet.selectionRanges.clear()}));this.draggingRow.addHandler((function(){return o._draggingSingleRow=!0}));this.draggedRow.addHandler((function(){return o._draggingSingleRow=!1}));this.addEventListener(this.hostElement,"keydown",(function(t){var n,i,l=!1,r=!1;if(t.ctrlKey){if(89===t.keyCode){o.finishEditing();o.redo();t.preventDefault()}if(90===t.keyCode){o.finishEditing();o.undo();t.preventDefault()}if(o.selectedSheet&&65===t.keyCode){o.selectedSheet.selectionRanges.clear();o.selectedSheet.selectionRanges.push(o.selection)}if(67===t.keyCode||45==t.keyCode){if(o.activeEditor){o._copiedRanges=null;o._copiedSheet=null}o._cutValue=null}if(88===t.keyCode&&!o.activeEditor){t.stopPropagation();if(o.selectionMode===e.grid.SelectionMode.ListBox)for(var s=0;s<o.rows.length;s++)if(o.rows[s].isSelected)if(l){if(r)continue;e.assert(!1,"Cut operation cannot be used on multiple selections.")}else{l=!0;r=!0}else r&&(r=!1);if(o.selectedSheet.selectionRanges.length>1)e.assert(!1,"Cut operation cannot be used on multiple selections.");else{o.finishEditing();n=new e.grid.CellRangeEventArgs(o.cells,o.selection);if(o.onCopying(n)){o._cutValue=null;i=o.getClipString();o._isCutting=!0;e.Clipboard.copy(i);o.onCopied(n)}}}t.keyCode!==e.Key.Space||!o.selection.isValid||o.selectionMode!==e.grid.SelectionMode.CellRange&&o.selectionMode!==e.grid.SelectionMode.MultiRange||o.select(new e.grid.CellRange(0,o.selection.col,o.rows.length-1,o.selection.col))}t.keyCode===e.Key.Escape&&o._hideContextMenu();(93===t.keyCode||t.shiftKey&&121===t.keyCode)&&(o._contextMenu.visible&&!e.isFirefox()?o._isContextMenuKeyDown=!1:o._isContextMenuKeyDown=!0)}));this.addEventListener(document.body,"keydown",this._keydownHdl,!0);this.addEventListener(document.body,"click",this._clickHdl);this.addEventListener(document.body,"mousemove",this._mouseMoveHdl);if(n.match(/iPad/i)||n.match(/iPhone/i)){this.addEventListener(document.body,"touchstart",this._touchStartHdl);this.addEventListener(document.body,"touchend",this._touchEndHdl)}};FlexSheet.prototype._flexSheetSyncSelection=function(t){if(this.collectionView&&this.selectionMode!=e.grid.SelectionMode.None){var o=this.selection,n=o.row>-1&&o.row<this.rows.length?this.rows[o.row]:null,i=n?n.dataItem:null;if(this.collectionView instanceof e.collections.CollectionView&&this.collectionView.isUpdating)return;(n instanceof d||this.newRowAtTop&&n instanceof e.grid._NewRowTemplate||i instanceof e.collections.CollectionViewGroup)&&(i=null);if((i!=this.collectionView.currentItem||t)&&(!this.editableCollectionView||!this.editableCollectionView.currentAddItem)){var l=this._getRowIndex(this.collectionView.currentPosition);if(l!=o.row){o.row=o.row2=l;this.select(o,!1);this.selectionMode&&!this._copyingTo&&this.scrollIntoView(o.row,-1)}}}};FlexSheet.prototype._initFuncsList=function(){var t=this;this._functionListHost=document.createElement("div");e.addClass(this._functionListHost,"wj-flexsheet-formula-list");document.querySelector("body").appendChild(this._functionListHost);this._functionListHost.style.display="none";this._functionListHost.style.position="absolute";this._functionList=new e.input.ListBox(this._functionListHost);this._functionList.isContentHtml=!0;this._functionList.itemsSource=this._getFunctions();this._functionList.displayMemberPath="displayValue";this._functionList.selectedValuePath="actualvalue";this.addEventListener(this._functionListHost,"click",this.applyFunctionToCell.bind(this));this.addEventListener(this._functionListHost,"keydown",(function(o){if(o.keyCode===e.Key.Escape){t.hideFunctionList();t.hostElement.focus();o.preventDefault()}if(o.keyCode===e.Key.Enter){t.applyFunctionToCell();t.hostElement.focus();o.preventDefault();o.stopPropagation()}}))};FlexSheet.prototype._getFunctions=function(){for(var e,t=[],n=0;n<o.length;n++){e=o[n];t.push({displayValue:'<div class="wj-flexsheet-formula-name">'+e.name+'</div><div class="wj-flexsheet-formula-description">'+e.description+"</div>",actualvalue:e.name})}return t};FlexSheet.prototype._addCustomFunctionDescription=function(e,t){for(var o={displayValue:'<div class="wj-flexsheet-formula-name">'+e+"</div>"+(t?'<div class="wj-flexsheet-formula-description">'+t+"</div>":""),actualvalue:e},n=this._functionList.itemsSource,i=-1,l=0;l<n.length;l++)if(n[l].actualvalue===e){i=l;break}i>-1?n.splice(i,1,o):n.push(o)};FlexSheet.prototype._getCurrentFormulaIndex=function(e){var t=-1;["+","-","*","/","^","(","&"].forEach((function(o){var n=e.lastIndexOf(o);"/"===o&&(n>=2&&"#N"===e.substr(n-2,2)||n>=4&&"#DIV"===e.substr(n-4,4))||n>t&&(t=n)}));return t};FlexSheet.prototype._prepareCellForEditHandler=function(){var t=this,o=this._edtHdl._edt;if(o){this.addEventListener(o,"keydown",(function(o){if(t.isFunctionListOpen)switch(o.keyCode){case e.Key.Up:t.selectPreviousFunction();o.preventDefault();o.stopPropagation();break;case e.Key.Down:t.selectNextFunction();o.preventDefault();o.stopPropagation();break;case e.Key.Tab:case e.Key.Enter:t.applyFunctionToCell();o.preventDefault();o.stopPropagation();break;case e.Key.Escape:t.hideFunctionList();o.preventDefault();o.stopPropagation()}}));this.addEventListener(o,"keyup",(function(n){(n.keyCode>40||n.keyCode<32)&&n.keyCode!==e.Key.Tab&&n.keyCode!==e.Key.Escape&&setTimeout((function(){t.showFunctionList(o)}),0)}))}};FlexSheet.prototype._addSheet=function(e,o,n,i,l){var r=this,s=new t.Sheet(this,l,e,o,n);this.sheets.isValidSheetName(s)||s._setValidName(this.sheets.getValidSheetName(s));if("number"==typeof i){i<0&&(i=0);i>=this.sheets.length&&(i=this.sheets.length)}else i=this.sheets.length;this.sheets.insert(i,s);s.nameChanged.addHandler((function(e,t){if(!r._loadingFromWorkbook){r._updateDefinedNameWithSheetRefUpdating(t.oldValue,t.newValue);r._updateFormulasWithNameUpdating(t.oldValue,t.newValue)}}));return s};FlexSheet.prototype._showSheet=function(e){if(!(!this.sheets||!this.sheets.length||e>=this.sheets.length||e<0||e===this.selectedSheetIndex||this.sheets[e]&&!this.sheets[e].visible)){this.beginUpdate();this.finishEditing();this._clearCalcEngine();this._isCopying=!0;if(this.selectedSheetIndex>-1&&this.selectedSheetIndex<this.sheets.length&&!this._sheets._exchangingPosition){this._copyingTo=!0;try{this._copyTo(this.sheets[this.selectedSheetIndex])}finally{this._copyingTo=!1}}if(this.sheets[e]){this._selectedSheetIndex=e;this._copyFrom(this.sheets[e])}this._isCopying=!1;this.endUpdate();this._filter.closeEditor()}};FlexSheet.prototype._selectedSheetChange=function(e,t){this.beginUpdate();this._showSheet(t.newValue);this._clearCalcCacheOnRefresh=!1;this.endUpdate();this.onSelectedSheetChanged(t)};FlexSheet.prototype._sourceChange=function(t,o){if(!this.sheets._exchangingPosition){this.beginUpdate();if(o.action===e.collections.NotifyCollectionChangedAction.Add||o.action===e.collections.NotifyCollectionChangedAction.Change){o.item._attachOwner(this);if(o.action===e.collections.NotifyCollectionChangedAction.Add){this._addingSheet=!0;o.index<=this.selectedSheetIndex&&(this._selectedSheetIndex+=1)}else o.index===this.selectedSheetIndex&&this._copyFrom(o.item);this.selectedSheetIndex=o.index}else if(o.action===e.collections.NotifyCollectionChangedAction.Reset){for(var n=0;n<this.sheets.length;n++)this.sheets[n]._attachOwner(this);if(this.sheets.length>0){0===this.selectedSheetIndex&&this._copyFrom(this.selectedSheet);this.selectedSheetIndex=0}else{this.rows.clear();this.columns.clear();this._selectedSheetIndex=-1}}else if(this.sheets.length>0){if(this.selectedSheetIndex===o.index){this._selectedSheetIndex=-1;this.sheets._setCurrentIdx(-1);this.selectedSheetIndex=o.index>this.sheets.length-1?this.sheets.length-1:o.index}else if(this.selectedSheetIndex>o.index){this._selectedSheetIndex--;this.sheets._setCurrentIdx(this._selectedSheetIndex)}}else{this.rows.clear();this.columns.clear();this._selectedSheetIndex=-1}this._updateDivContainerHeight(this.isTabHolderVisible);this.endUpdate()}};FlexSheet.prototype._sheetVisibleChange=function(e,t){t.item.visible||t.index===this.selectedSheetIndex&&(this.selectedSheetIndex===this.sheets.length-1?this.selectedSheetIndex=t.index-1:this.selectedSheetIndex=t.index+1)};FlexSheet.prototype._applyStyleForCell=function(e,t,o,n){void 0===n&&(n=!1);var i,l,r,s=this.rows[e];if(!(null==s||s instanceof d||!s.isVisible&&!n)){r=e*this.columns.length+t;(l=this.selectedSheet._getMergedRange(e,t))&&(r=l.topRow*this.columns.length+l.leftCol);(i=this.selectedSheet._styledCells[r])?Object.keys(o).forEach((function(e){var t=o[e];switch(e){case"className":i[e]="normal"===t||null===t||""===t?void 0:t||i[e];break;case"fontStyle":case"fontWeight":case"textDecoration":i[e]="none"===t||null===t||""===t?void 0:t||i[e];break;default:i[e]=null===t||""===t?void 0:t||i[e]}})):this.selectedSheet._styledCells[r]={className:o.className,textAlign:o.textAlign,verticalAlign:o.verticalAlign,fontStyle:o.fontStyle,fontWeight:o.fontWeight,fontFamily:o.fontFamily,fontSize:o.fontSize,textDecoration:o.textDecoration,backgroundColor:o.backgroundColor,color:o.color,format:o.format,whiteSpace:o.whiteSpace,borderTopColor:o.borderTopColor,borderTopStyle:o.borderTopStyle,borderTopWidth:o.borderTopWidth,borderBottomColor:o.borderBottomColor,borderBottomStyle:o.borderBottomStyle,borderBottomWidth:o.borderBottomWidth,borderLeftColor:o.borderLeftColor,borderLeftStyle:o.borderLeftStyle,borderLeftWidth:o.borderLeftWidth,borderRightColor:o.borderRightColor,borderRightStyle:o.borderRightStyle,borderRightWidth:o.borderRightWidth}}};FlexSheet.prototype._checkCellFormat=function(e,t,o){var n,i,l=e*this.columns.length+t;if(this.selectedSheet){if(n=this.selectedSheet._getMergedRange(e,t)){o.isMergedCell=!0;l=n.topRow*this.columns.length+n.leftCol}if(i=this.selectedSheet._styledCells[l]){o.isBold=o.isBold||"bold"===i.fontWeight;o.isItalic=o.isItalic||"italic"===i.fontStyle;o.isUnderline=o.isUnderline||"underline"===i.textDecoration}e===this.selection.row&&t===this.selection.col&&(i&&i.textAlign?o.textAlign=i.textAlign:t>-1&&(o.textAlign=this.columns[t].getAlignment()||o.textAlign))}};FlexSheet.prototype._resetMergedRange=function(e){var t,o,n,i,l=!1;for(t=e.topRow;t<=e.bottomRow;t++)for(o=e.leftCol;o<=e.rightCol;o++)if(i=this.selectedSheet._getMergedRange(t,o)){l=!0;n=this.selectedSheet._mergedRanges.indexOf(i);this.selectedSheet._mergedRanges.splice(n,1)}return l};FlexSheet.prototype._updateCellsForUpdatingRow=function(e,t,o,n){var i,l,r,s,a,h,u,d=e*this.columns.length;if(n)for(l=i=t*this.columns.length;l<d;l++){r=l-o*this.columns.length;if(s=this.selectedSheet._styledCells[l]){l>=(t+o)*this.columns.length&&(this.selectedSheet._styledCells[r]=s);delete this.selectedSheet._styledCells[l]}}else{i=t*this.columns.length-1;for(l=d-1;l>i;l--){r=l+this.columns.length*o;if(s=this.selectedSheet._styledCells[l]){this.selectedSheet._styledCells[r]=s;delete this.selectedSheet._styledCells[l]}}}if(this.selectedSheet._mergedRanges.length>0)for(h=this.selectedSheet._mergedRanges.length-1;h>=0;h--){a=this.selectedSheet._mergedRanges[h];if(n)if((u=t+o-1)<a.topRow){a.row-=o;a.row2-=o}else if(u>=a.topRow&&u<=a.bottomRow)if(t<=a.topRow&&u>=a.bottomRow)this.selectedSheet._mergedRanges.splice(h,1);else if(t<a.topRow)if(a.row<=a.row2){a.row+=t-a.topRow;a.row2-=o}else{a.row2+=t-a.topRow;a.row-=o}else t===a.topRow&&o===a.rowSpan?this.selectedSheet._mergedRanges.splice(h,1):a.row<=a.row2?a.row2-=o:a.row-=o;else t<=a.topRow?this.selectedSheet._mergedRanges.splice(h,1):t<=a.bottomRow&&(a.row<=a.row2?a.row2+=t-a.bottomRow-1:a.row+=t-a.bottomRow-1);else if(t<=a.topRow){a.row+=o;a.row2+=o}else t>a.topRow&&t<=a.bottomRow&&(a.row<=a.row2?a.row2+=o:a.row+=o)}};FlexSheet.prototype._updateCellsForUpdatingColumn=function(e,t,o,n){var i,l,r,s,a,h,u,d=this.rows.length*e;if(n)for(i=t;i<d;i++){l=i-o*(Math.floor(i/e)+((s=i%e)>=t?1:0));if(r=this.selectedSheet._styledCells[i]){(s<t||s>=t+o)&&(this.selectedSheet._styledCells[l]=r);delete this.selectedSheet._styledCells[i]}}else for(i=d-1;i>=t;i--){l=Math.floor(i/e)*o+i+((s=i%e)>=t?o:0);if(r=this.selectedSheet._styledCells[i]){this.selectedSheet._styledCells[l]=r;delete this.selectedSheet._styledCells[i]}}if(this.selectedSheet._mergedRanges.length>0)for(h=this.selectedSheet._mergedRanges.length-1;h>=0;h--){a=this.selectedSheet._mergedRanges[h];if(n)if((u=t+o-1)<a.leftCol){a.col-=o;a.col2-=o}else if(u>=a.leftCol&&u<=a.rightCol)if(t<=a.leftCol&&u>=a.rightCol)this.selectedSheet._mergedRanges.splice(h,1);else if(t<a.leftCol)if(a.col<=a.col2){a.col+=t-a.leftCol;a.col2-=o}else{a.col2+=t-a.leftCol;a.col-=o}else t===a.leftCol&&o===a.columnSpan?this.selectedSheet._mergedRanges.splice(h,1):a.col<=a.col2?a.col2-=o:a.col-=o;else t<=a.leftCol?this.selectedSheet._mergedRanges.splice(h,1):t<=a.rightCol&&(a.col<=a.col2?a.col2-=a.rightCol-t+1:a.col-=a.rightCol-t+1);else if(t<=a.leftCol){a.col+=o;a.col2+=o}else t>a.leftCol&&t<=a.rightCol&&(a.col<=a.col2?a.col2+=o:a.col+=o)}};FlexSheet.prototype._cloneObject=function(t){var o;if(null==t||!e.isObject(t))return t;o={};for(var n in t)t.hasOwnProperty(n)&&null!=t[n]&&(t[n].clone?o[n]=t[n].clone():o[n]=this._cloneObject(t[n]));return o};FlexSheet.prototype._evaluate=function(e,t,o,n,i){if(e&&e.length>1&&this._enableFormulas){e="="===e[0]?e:"="+e;return this._calcEngine.evaluate(e,t,o,n,i)}return e};FlexSheet.prototype._clearAndCheckItemsOwner=function(e){if(e&&e.length){var t=e[0]._list;e.clear();this._checkCollectionOwner(t)}};FlexSheet.prototype._checkCollectionOwner=function(e,t){void 0===t&&(t=!0);if(e&&e.length&&(!e[0]._list||!t&&e[0]._list!=e))for(var o=0,n=e.length;o<n;o++)e[o]._list=e};FlexSheet.prototype._checkCollectionsOwner=function(){this._checkCollectionOwner(this.columns,!1);this._checkCollectionOwner(this.rows,!1);this._checkCollectionOwner(this.columnFooters.columns,!1);this._checkCollectionOwner(this.columnFooters.rows,!1);this._checkCollectionOwner(this.columnHeaders.columns,!1);this._checkCollectionOwner(this.columnHeaders.rows,!1);this._checkCollectionOwner(this.rowHeaders.columns,!1);this._checkCollectionOwner(this.rowHeaders.rows,!1)};FlexSheet.prototype._copyTo=function(t){var o,n=t.grid.autoGenerateColumns;this.beginUpdate();t._storeRowSettings();this._selHdl.extendedSelection.clear();o=this.selection.clone();t.grid.select(new e.grid.CellRange,!1);this._clearAndCheckItemsOwner(t.grid.rows);this._clearAndCheckItemsOwner(t.grid.columns);this._clearAndCheckItemsOwner(t.grid.columnHeaders.columns);this._clearAndCheckItemsOwner(t.grid.rowHeaders.rows);t._ownerHeaderRowRemoved=this._headerRowRemoved;if(this.itemsSource){t.grid.autoGenerateColumns=!1;t.itemsSource=this.itemsSource;this.collectionView.sortDescriptions.length>0&&(t._dataView=this.collectionView._view.slice());t.grid.collectionView.beginUpdate()}else{t.itemsSource=null;for(var i=0;i<this.rows.length;i++)t.grid.rows.push(this.rows[i])}t._sortList=this.sortManager._committedList.slice();t._getFilterSetting();for(var l=0;l<this.columns.length;l++)t.grid.columns.push(this.columns[l]);if(t.grid.collectionView){this._resetMappedColumns(t.grid);t.grid.collectionView.endUpdate(!0)}t.grid.autoGenerateColumns=n;t.grid.frozenRows=this.frozenRows;t.grid.frozenColumns=this.frozenColumns;t.grid.allowAddNew=this.allowAddNew;null!=this.newRowAtTop&&(t.grid.newRowAtTop=this.newRowAtTop);t.grid.select(o,!1);t._scrollPosition=this.scrollPosition;this._setFlexSheetToDirty();this.endUpdate()};FlexSheet.prototype._copyFrom=function(t,o){var n=this;void 0===o&&(o=!0);var i,l,r,s,a,h,u=this.autoGenerateColumns;this._isCopying=!0;this._dragable=!1;o&&this.beginUpdate();this.itemsSource=null;this._clearAndCheckItemsOwner(this.rows);this._clearAndCheckItemsOwner(this.columns);this._clearAndCheckItemsOwner(this.columnHeaders.columns);this._clearAndCheckItemsOwner(this.rowHeaders.rows);a=t.grid.selection.clone();this._selHdl.select(new e.grid.CellRange,!1);t.selectionRanges.length>1&&(this.selectionMode===e.grid.SelectionMode.CellRange||this.selectionMode===e.grid.SelectionMode.MultiRange)&&(this._enableMulSel=!0);this._headerRowRemoved=t._ownerHeaderRowRemoved;if(t.itemsSource){this.autoGenerateColumns=!1;this._ignoreBindGrid=e.isArray(t.itemsSource)||t.itemsSource instanceof e.collections.CollectionView;this.itemsSource=t.itemsSource;this._ignoreBindGrid=!1;this.collectionView.beginUpdate()}else for(l=0;l<t.grid.rows.length;l++)this.rows.push(t.grid.rows[l]);this.sortManager.sortDescriptions.sourceCollection=t._sortList.slice();this.sortManager._committedList=t._sortList.slice();for(i=0;i<t.grid.columns.length;i++){(s=t.grid.columns[i]).isRequired=!1;this.columns.push(s)}if(this.collectionView){if(t.grid.collectionView){this.collectionView.sortDescriptions.clear();t.grid.collectionView.sortDescriptions.forEach((function(e){return n.collectionView.sortDescriptions.push(e)}))}this.collectionView.moveCurrentToPosition(this._getCvIndex(a.row));this._resetMappedColumns(this);this.collectionView.endUpdate(!0);if(t._dataView){this.collectionView._view=t._dataView;this.collectionView._pgView=this.collectionView._getPageView();if(!(this.itemsSource instanceof e.collections.CollectionView)){t.grid.collectionView._view=t._dataView;t.grid.collectionView._pgView=t.grid.collectionView._getPageView()}this._bindGrid(!1);t.grid._bindGrid(!1)}this.collectionView.collectionChanged.addHandler((function(t,o){o.action===e.collections.NotifyCollectionChangedAction.Reset&&setTimeout((function(){n.invalidate()}),10)}),this)}if(this.rows.length&&this.columns.length){this._selHdl.select(a,!1);if(this.selectionMode===e.grid.SelectionMode.MultiRange){this._selHdl.extendedSelection.beginUpdate();for(var c=0;c<t.selectionRanges.length;c++)this.selection.equals(t.selectionRanges[c])||this._selHdl.extendedSelection.push(t.selectionRanges[c]);this._selHdl.extendedSelection.endUpdate()}}t._applyFilterSetting();for(l=0;l<this.rows.length;l++)if(r=t._rowSettings[l]){var _=this.rows[l];h=_ instanceof d;_.height=r.height;_.allowMerging=r.allowMerging;_.visible=r.visible;_ instanceof e.grid.GroupRow&&(_.isCollapsed=!!r.isCollapsed);_.isSelected=!!r.isSelected;_.isReadOnly=h||!!r.readOnly}this.autoGenerateColumns=u;this.frozenRows=t.grid.frozenRows;this.frozenColumns=t.grid.frozenColumns;this._isCopying=!1;if(o){this.cells.hostElement.style.overflow="hidden";this._setFlexSheetToDirty();this.endUpdate();if(this._addingSheet){clearTimeout(this._toRefresh);this._toRefresh=setTimeout((function(){n._setFlexSheetToDirty();n.invalidate()}),e.Control._REFRESH_INTERVAL);this._addingSheet=!1}}this._updateScrollPos=!0};FlexSheet.prototype.onUpdatedLayout=function(e){if(this._updateScrollPos){this.cells.hostElement.style.overflow="";this._updateScrollPos=!1;var t=this.selectedSheet;if(t){this.scrollPosition=t._scrollPosition;this._ptScrl=t._scrollPosition}}n.prototype.onUpdatedLayout.call(this,e)};FlexSheet.prototype._resetMappedColumns=function(e){var t,o,n=0;e._mappedColumns=null;if(e.collectionView){o=e.collectionView.sortDescriptions;for(;n<o.length;n++)if((t=e.columns.getColumn(o[n].property))&&t.dataMap){e._mappedColumns||(e._mappedColumns={});e._mappedColumns[t.binding]=t.dataMap}}};FlexSheet.prototype._loadFromWorkbook=function(t){var o=this;if(null!=t.sheets&&0!==t.sheets.length){this._loadingFromWorkbook=!0;this.beginUpdate();this.clear();this._reservedContent=t.reservedContent;if(t.colorThemes&&t.colorThemes.length>0)for(var n=0;n<this._colorThemes.length;n++)this._colorThemes[n]=t.colorThemes[n];n=0;for(var i=t.sheets.length;n<i;n++){n>0&&this.addUnboundSheet();var l=this.selectedSheet,r=l.grid,s=r.wj_sheetInfo={};e.grid.xlsx.FlexGridXlsxConverter.load(r,t,{sheetIndex:n,includeColumnHeaders:!1});l.name=s.name;l.visible=s.visible;l._styledCells=s.styledCells;if(s.mergedRanges){for(var a=0;a<s.mergedRanges.length;a++)l._mergedRanges[a]=s.mergedRanges[a];s.mergedRanges=l._mergedRanges}this._copyFrom(l);if(s.tables&&s.tables.length>0)for(var h=0;h<s.tables.length;h++)this._parseFromWorkbookTable(s.tables[h],l)}null!=t.activeWorksheet&&t.activeWorksheet>-1&&t.activeWorksheet<this.sheets.length?this.selectedSheetIndex=t.activeWorksheet:this.selectedSheetIndex=0;t.definedNames&&t.definedNames.forEach((function(e){o.definedNames.push(new _(o,e.name,e.value,e.sheetName))}));this.endUpdate();this._loadingFromWorkbook=!1;this.onLoaded()}};FlexSheet.prototype._saveToWorkbook=function(t){if(0===this.sheets.length)throw"The flexsheet is empty.";for(var o=!(!t||!t.includeFormulaValues),n=this._saveSheetToWorkbook(0,o),i=1;i<this.sheets.length;i++){var l=this._saveSheetToWorkbook(i,o);n._addWorkSheet(l.sheets[0],i)}n.activeWorksheet=this.selectedSheetIndex;n.reservedContent=this._reservedContent;for(i=0;i<this.definedNames.length;i++){var r=this.definedNames[i],s=new e.xlsx.DefinedName;s.name=r.name;s.value=r.value;s.sheetName=r.sheetName;n.definedNames.push(s)}var a=this._colorThemes;if(a&&a.length>0)for(i=0;i<a.length;i++)n.colorThemes[i]=a[i];return n};FlexSheet.prototype._saveSheetToWorkbook=function(t,o){var n=this,i=this.sheets[t],l=i.grid.wj_sheetInfo;o&&(l.evaluateFormula=function(e){return n.evaluate(e,null,i)});if(this.selectedSheetIndex===t){i._storeRowSettings();i.itemsSource instanceof e.collections.CollectionView||this._copyRowsToSelectedSheet()}i._setRowSettings();if(i.tables.length>0){l.tables=[];for(var r=0;r<i.tables.length;r++)l.tables.push(this._parseToWorkbookTable(i.tables[r]))}var s=e.grid.xlsx.FlexGridXlsxConverter.save(i.grid,{sheetName:i.name,sheetVisible:i.visible,includeColumnHeaders:!1});this._checkTableHeaderRow(i.tables,s);l.evaluateFormula=null;return s};FlexSheet.prototype._mouseDown=function(t){var o,n,l=window.navigator.userAgent,r=this.hitTest(t);this.selectedSheet&&(this.selectedSheet._scrollPosition=this.scrollPosition);r.cellType!==e.grid.CellType.None&&(this._isClicking=!0);if(this._dragable){this._isDragging=!0;this._draggingMarker=document.createElement("div");e.setCss(this._draggingMarker,{position:"absolute",display:"none",borderStyle:"dotted",cursor:"move"});document.body.appendChild(this._draggingMarker);this._draggingTooltip=new e.Tooltip;this._draggingCells=this.selection;this.selectedSheet&&this.selectedSheet.selectionRanges.clear();this.onDraggingRowColumn(new i(this.selection.clone(),this._draggingRow,t.shiftKey));t.preventDefault()}else if("crosshair"!==this.hostElement.style.cursor||null!=this._fillingMarker){if(this.selectionMode===e.grid.SelectionMode.CellRange||this.selectionMode===e.grid.SelectionMode.MultiRange){if(t.ctrlKey){if(!this._enableMulSel){this._enableMulSel=!0;0===this.selectedSheet.selectionRanges.length&&this.selectedSheet.selectionRanges.push(this.selection)}}else if(r.cellType!==e.grid.CellType.None){this.selectedSheet&&(3===t.which&&this._isCellSelected(r.row,r.col)||this.selectedSheet.selectionRanges.clear());this._enableMulSel&&this.refresh(!1);this._enableMulSel=!1}}else{this._enableMulSel=!1;this.selectedSheet&&this.selectedSheet.selectionRanges.clear()}this._htDown=r;if(0!==this.rows.length&&0!==this.columns.length){l.match(/iPad/i)||l.match(/iPhone/i)||this._hideContextMenu();if(3!==t.which&&(this.selectionMode===e.grid.SelectionMode.CellRange||this.selectionMode===e.grid.SelectionMode.MultiRange)&&(r.cellType===e.grid.CellType.ColumnHeader||r.cellType===e.grid.CellType.None)&&!(r.col>-1&&this.columns[r.col].isSelected)&&e.hasClass(t.target,"wj-cell")&&!r.edgeRight){this._columnHeaderClicked=!0;n=this.itemsSource&&this.rows[0]&&!this.rows[0].isVisible?1:0;t.target.focus();if(t.shiftKey)this._multiSelectColumns(r);else{o=new e.grid.CellRange(n,r.col,this.rows.length-1,r.col);if(3===t.which&&this.selection.contains(o))return;this.select(o)}this._eCt.children[n]&&this._eCt.children[n].children[r.col]&&this._eCt.children[n].children[r.col].focus()}}}else{this.finishEditing();this._fillingData=!0;this._fillingPoint=new e.Point(t.clientX-this.scrollPosition.x,t.clientY-this.scrollPosition.y);this._fillingSource=this.selection.clone();this._fillingMarker=document.createElement("div");e.setCss(this._fillingMarker,{position:"absolute",display:"none",border:"2px dashed"});this._root.appendChild(this._fillingMarker);this._fillingTooltip=new e.Tooltip;t.preventDefault()}};FlexSheet.prototype._mouseMove=function(t){var o,n=this.hitTest(t),i=this.selection.clone(),l=this.rows.length,r=this.columns.length,s=this.hostElement.style.cursor;if(0!==this.rows.length&&0!==this.columns.length)if(this._isDragging){this.hostElement.style.cursor="move";this._showDraggingMarker(t)}else if(!this._isClicking&&n.edgeBottom&&n.edgeRight&&n.row===i.bottomRow&&n.col===i.rightCol&&this.allowAutoFill)this.hostElement.style.cursor="crosshair";else if(this._fillingData){this.hostElement.style.cursor="crosshair";this._showFillMarker(t)}else{o=this.itemsSource?0===i.topRow||1===i.topRow:0===i.topRow;if(!this._isClicking&&i&&n.cellType!==e.grid.CellType.None&&!this.itemsSource&&!this.isReadOnly&&this._enableDragDrop&&(!this._filter||!this._filter._isEditorOpened())){this._draggingColumn=o&&i.bottomRow===l-1;this._draggingRow=0===i.leftCol&&i.rightCol===r-1;if(n.cellType===e.grid.CellType.Cell){this._draggingColumn&&((n.col===i.leftCol-1||n.col===i.rightCol)&&n.edgeRight||n.row===l-1&&n.edgeBottom)&&(s="move");this._draggingRow&&!this._containsGroupRows(i)&&((n.row===i.topRow-1||n.row===i.bottomRow)&&n.edgeBottom||n.col===r-1&&n.edgeRight)&&(s="move")}else n.cellType===e.grid.CellType.ColumnHeader?n.edgeBottom&&(this._draggingColumn&&n.col>=i.leftCol&&n.col<=i.rightCol?s="move":this._draggingRow&&0===i.topRow&&(s="move")):n.cellType===e.grid.CellType.RowHeader&&n.edgeRight&&(this._draggingColumn&&0===i.leftCol?s="move":this._draggingRow&&n.row>=i.topRow&&n.row<=i.bottomRow&&!this._containsGroupRows(i)&&(s="move"));this._dragable="move"===s;this.hostElement.style.cursor=s}if(this._htDown&&this._htDown.panel){n=new e.grid.HitTestInfo(this._htDown.panel,t);this._multiSelectColumns(n);n.cellType===e.grid.CellType.Cell&&this.scrollIntoView(n.row,n.col)}}else{this._dragable=!1;n.cellType===e.grid.CellType.Cell&&(this.hostElement.style.cursor="default")}};FlexSheet.prototype._mouseUp=function(o){var n=this;try{if(this._isDragging){if(this._dropRange&&!this._draggingCells.equals(this._dropRange)){var i=new l(this._dropRange.clone(),this._draggingRow),r=new e.CancelEventArgs;this.onBeginDroppingRowColumn(i);r.cancel=i.cancel;i.cancel||this._handleDropping(o);this.onEndDroppingRowColumn(r)}}else if(this._fillingData){var s=c.CopyContent,a=this._fillingRange,h=this._fillingSource,u=void 0;this._orgCellSettings=null;if(this._fillingRange&&this._fillingRange.isValid){e.assert(this._canDoFillOperation(),"To do this, all the merged cells need be the same size.");h.leftCol===a.leftCol&&h.rightCol===a.rightCol?h.row!==h.row2&&(s=c.FillSeries):h.col!==h.col2&&(s=c.FillSeries);this._orgCellSettings=this._getCellSettingsForFill();u=new t._FillAction(this,this._fillingSource);this._undoStack._addAction(u);s=c.CopyFormat|s;if(this._fillData(s))var d=this._root.appendChild(document.createElement("div")),_=new t._SmartTag(d,this,s,{operationSelected:function(e){n._fillData(e.operation)},cancelled:function(){d.parentElement.removeChild(d);_.dispose();_=null;n._undoStack._updateCurrentAction(t._FillAction);n.focus()}})}}}finally{this._draggingSingleRow=!1;if(this._isDragging){this._draggingCells=null;this._dropRange=null;document.body.removeChild(this._draggingMarker);this._draggingMarker=null;this._draggingTooltip.hide();this._draggingTooltip=null;this._isDragging=!1;this._draggingColumn=!1;this._draggingRow=!1}if(this._htDown&&this._htDown.cellType!==e.grid.CellType.None&&this.selectedSheet){this._htDown.cellType!==e.grid.CellType.TopLeft||this.selectionMode!==e.grid.SelectionMode.CellRange&&this.selectionMode!==e.grid.SelectionMode.MultiRange||(this.selection=new e.grid.CellRange(0,0,this.rows.length-1,this.columns.length-1));this.selection.isValid&&this.selectedSheet._addSelection(this.selection);this._enableMulSel=!1}if(this._fillingData){this._fillingData=!1;this._fillingPoint=null;this._fillingRange=null;this._root.removeChild(this._fillingMarker);this._fillingMarker=null;this._fillingTooltip.hide();this._fillingTooltip=null;this.hostElement.style.cursor="default"}this._isClicking=!1;this._columnHeaderClicked=!1;this._htDown=null}};FlexSheet.prototype._click=function(){var e=this,t=window.navigator.userAgent;t.match(/iPad/i)||t.match(/iPhone/i)||this._hideContextMenu();setTimeout((function(){e.hideFunctionList()}),200)};FlexSheet.prototype._touchStart=function(t){var o=this;e.hasClass(t.target,"wj-context-menu-item")||this._hideContextMenu();this._longClickTimer=setTimeout((function(){var n;if(o._isDescendant(o._divContainer,t.target)&&(n=o.hitTest(t))&&n.cellType!==e.grid.CellType.None&&!o._resizing){if(n.cellType===e.grid.CellType.TopLeft){o.selection=new e.grid.CellRange(0,0,o.rows.length-1,o.columns.length-1);if(o.selectedSheet){o.selectedSheet.selectionRanges.clear();o.selectedSheet.selectionRanges.push(o.selection)}}o._contextMenu.show(null,new e.Point(t.pageX+10,t.pageY+10))}}),500)};FlexSheet.prototype._touchEnd=function(){clearTimeout(this._longClickTimer)};FlexSheet.prototype._keydown=function(t){if((this._isDescendant(this.hostElement,t.target)||this.hostElement===t.target)&&!this._edtHdl.activeEditor&&!(t.target instanceof HTMLInputElement)&&this.selectedSheet&&(t.keyCode===e.Key.Delete||t.keyCode===e.Key.Back)){this._delSeletionContent(t);t.preventDefault()}var o=this._contextMenu.visible?this._contextMenu:this._tabHolder.sheetControl._contextMenu.visible?this._tabHolder.sheetControl._contextMenu:null;if(o){t.keyCode===e.Key.Down&&o.moveToNext();t.keyCode===e.Key.Up&&o.moveToPrev();t.keyCode===e.Key.Home&&o.moveToFirst();t.keyCode===e.Key.End&&o.moveToLast();t.keyCode===e.Key.Enter&&o.handleContextMenu();t.preventDefault()}};FlexSheet.prototype._showDraggingMarker=function(t){var o,n,i,l,r,s,a,h,u,d=new e.grid.HitTestInfo(this.cells,t),c=this.selection,_=this.columns.length,g=this.rows.length,f=this._cumulativeScrollOffset(this.hostElement),p=this._root.getBoundingClientRect(),w=p.left+f.x,m=p.top+f.y;this.scrollIntoView(d.row,d.col);if(this._draggingColumn){n=c.rightCol-c.leftCol+1;r=0;((i=d.col)<0||i+n>_)&&(i=_-n);o=this.cells.getCellBoundingRect(0,i);s=this._root.offsetHeight-this._eCHdr.offsetHeight;l=(l=this.cells.height)>s?s:l;for(a=0;a<n;a++)r+=this.columns[i+a].renderSize;h=FlexSheet.convertNumberToAlpha(i)+" : "+FlexSheet.convertNumberToAlpha(i+n-1);if(this._dropRange){this._dropRange.col=i;this._dropRange.col2=i+n-1}else this._dropRange=new e.grid.CellRange(0,i,this.rows.length-1,i+n-1)}else if(this._draggingRow){n=c.bottomRow-c.topRow+1;l=0;((i=d.row)<0||i+n>g)&&(i=g-n);o=this.cells.getCellBoundingRect(i,0);s=this._root.offsetWidth-this._eRHdr.offsetWidth;for(a=0;a<n;a++)l+=this.rows[i+a].renderSize;r=(r=this.cells.width)>s?s:r;h=i+1+" : "+(i+n);if(this._dropRange){this._dropRange.row=i;this._dropRange.row2=i+n-1}else this._dropRange=new e.grid.CellRange(i,0,i+n-1,this.columns.length-1)}if(o){u={display:"inline",zIndex:"9999",opacity:.5,top:o.top-(this._draggingColumn?this._ptScrl.y:0)+f.y,left:o.left-(this._draggingRow?this._ptScrl.x:0)+f.x,height:l,width:r};o.top=o.top-(this._draggingColumn?this._ptScrl.y:0);o.left=o.left-(this._draggingRow?this._ptScrl.x:0);if(this.rightToLeft&&this._draggingRow){u.left=u.left-r+o.width+2*this._ptScrl.x;o.left=o.left+2*this._ptScrl.x}if(this._draggingRow){if(w+this._eRHdr.offsetWidth!==u.left||m+this._root.offsetHeight+1<u.top+u.height)return}else if(m+this._eCHdr.offsetHeight!==u.top||w+this._root.offsetWidth+1<u.left+u.width)return;e.setCss(this._draggingMarker,u);this._draggingTooltip.show(this.hostElement,h,o)}};FlexSheet.prototype._showFillMarker=function(t){var o=new e.grid.HitTestInfo(this.cells,t);if(o.row>-1&&o.col>-1){var n=t.clientX-this.scrollPosition.x-this._fillingPoint.x,i=t.clientY-this.scrollPosition.y-this._fillingPoint.y,l=void 0,r=void 0,s=void 0,a=void 0;if(Math.abs(n)>=Math.abs(i)){l=this._fillingSource.topRow;s=this._fillingSource.bottomRow;r=n>=0?this._fillingSource.leftCol:o.col;a=n>=0?o.col:this._fillingSource.rightCol}else{l=i>=0?this._fillingSource.topRow:o.row;s=i>=0?o.row:this._fillingSource.bottomRow;r=this._fillingSource.leftCol;a=this._fillingSource.rightCol}this._fillingRange=new e.grid.CellRange(l,r,s,a);this._updateFillingMarquee();this.scrollIntoView(o.row,o.col);this._showFillTooltip()}};FlexSheet.prototype._updateMarquee=function(){n.prototype._updateMarquee.call(this);this._updateFillingMarquee()};FlexSheet.prototype._updateFillingMarquee=function(){var t=this._fillingMarker,o=this._fillingRange;if(t&&o){var n=this.cells.getCellBoundingRect(o.row,o.col,!0),i=this.cells.getCellBoundingRect(o.row2,o.col2,!0);if(this.rows.frozen){var l=Math.min(this.rows.length,this.rows.frozen),r=this.cells.getCellBoundingRect(l-1,0,!0);o.topRow>=l&&n.top<r.bottom&&(n.top=r.bottom);o.bottomRow>=l&&i.bottom<r.bottom&&(i.height=r.bottom-i.top)}if(this.columns.frozen){var s=Math.min(this.columns.length,this.columns.frozen);r=this.cells.getCellBoundingRect(0,s-1,!0);if(this.rightToLeft){o.leftCol>=s&&n.right>r.left&&(n.left=r.left-n.width);o.rightCol>=s&&i.left>r.left&&(i.left=r.left)}else{o.leftCol>=s&&n.left<r.right&&(n.left=r.right);o.rightCol>=s&&i.right<r.right&&(i.width=r.right-i.left)}}var a=this.cells.hostElement;e.setCss(t,{left:n.left+a.offsetLeft,top:n.top+a.offsetTop,width:i.right-n.left,height:i.bottom-n.top,display:"",zIndex:this.frozenRows||this.frozenColumns?"3":""})}};FlexSheet.prototype._showFillTooltip=function(){var t,o,n,i,l,r,s,a,h,u,d,c,_=this._fillingSource,g=this._fillingRange;this._fillingTooltip.hide();if(!g.equals(_)&&!_.contains(g)){if(o=_.leftCol===g.leftCol&&_.rightCol===g.rightCol){if(g.bottomRow>_.bottomRow){(t=this.cells.getCellBoundingRect(g.bottomRow,g.rightCol)).top=t.bottom+10;n=g.bottomRow-_.topRow}else{(t=this.cells.getCellBoundingRect(g.topRow,g.rightCol)).top+=10;n=g.topRow-_.topRow}t.left=t.right;(i=n%_.rowSpan)<0&&(i+=_.rowSpan);_.row===_.row2&&(l=!0);h=this.selectedSheet.getCellStyle(_.topRow+i,_.leftCol);u=this.getMergedRange(this.cells,_.topRow+i,_.leftCol);d=this.columns[_.leftCol];c=h&&h.format?h.format:d.format;if(l)a=_isFormula(a=this.getCellData(u?u.topRow:_.topRow+i,_.leftCol,!1))?"":e.Globalize.format(a,c);else{r=this.getCellData(_.topRow+i,_.leftCol,!1);if(e.isNumber(r)||e.isDate(r))if(s=this._getFillSeries(o,0,i)){a=this._getFillData(i,n,_,o,s,!0);a=e.Globalize.format(a,c)}else a="";else _isFormula(a=r)&&(a="")}}else{if(g.rightCol>_.rightCol){t=this.cells.getCellBoundingRect(g.bottomRow,g.rightCol);n=g.rightCol-_.leftCol}else{t=this.cells.getCellBoundingRect(g.bottomRow,g.leftCol);n=g.leftCol-_.leftCol}t.top=t.bottom+10;(i=n%_.columnSpan)<0&&(i+=_.columnSpan);_.col===_.col2&&(l=!0);h=this.selectedSheet.getCellStyle(_.topRow,_.leftCol+i);u=this.getMergedRange(this.cells,_.topRow,_.leftCol+i);d=this.columns[_.leftCol+i];c=h&&h.format?h.format:d.format;if(l)a=_isFormula(a=this.getCellData(_.topRow,u?u.leftCol:_.leftCol+i,!1))?"":e.Globalize.format(a,c);else{r=this.getCellData(_.topRow,_.leftCol+i,!1);if(e.isNumber(r)||e.isDate(r))if(s=this._getFillSeries(o,0,i)){a=this._getFillData(i,n,_,o,s,!0);a=e.Globalize.format(a,c)}else a="";else _isFormula(a=r)&&(a="")}}t.top+=this.cells.hostElement.offsetTop;this._fillingTooltip.show(this.hostElement,a,t)}};FlexSheet.prototype._selections=function(){var t=[];if(!this.selectedSheet)return t;if(this.selectionMode==e.grid.SelectionMode.ListBox)for(var o=0,n=this.rows.length,i=this.columns.length-1;o<n;o++)this.rows[o].isSelected&&t.push(new e.grid.CellRange(o,0,o,i));else t=this.selectedSheet.selectionRanges.slice();return t.length?t:[this.selection]};FlexSheet.prototype._isCellSelected=function(e,t){return this._selections().some((function(o){return o.contains(e,t)}))};FlexSheet.prototype._isColumnSelected=function(e){var t=this;return this._selections().some((function(o){return o.containsColumn(e)&&0===o.row&&o.row2===t.rows.length-1}))};FlexSheet.prototype._isRowSelected=function(e){var t=this;return this._selections().some((function(o){return o.containsRow(e)&&0===o.col&&o.col2===t.columns.length-1}))};FlexSheet.prototype._handleDropping=function(o){var n,i,l,r,s,a,h;if(this.selectedSheet&&this._draggingCells&&this._dropRange&&!this._containsMergedCells(this._draggingCells)&&!this._containsMergedCells(this._dropRange)){this._clearCalcEngine();if(this._draggingColumn&&this._draggingCells.leftCol>this._dropRange.leftCol||this._draggingRow&&this._draggingCells.topRow>this._dropRange.topRow)if(o.shiftKey){if(!this._allowExchangeCells(this._draggingRow,!0)){console.warn("Can not complete operation: You are attempting to change a position of table row or column in a way that is not allowed.");return}if(this._draggingColumn){r=this._dropRange.leftCol;for(i=this._draggingCells.leftCol;i<=this._draggingCells.rightCol;i++){this.columns.moveElement(i,r);r++}this._exchangeTableColumns(!0)}else if(this._draggingRow){l=this._dropRange.topRow;for(n=this._draggingCells.topRow;n<=this._draggingCells.bottomRow;n++){this.rows.moveElement(n,l);l++}}this._exchangeCellStyle(!0)}else{this.undoStack.stackSize>0&&(s=new t._MoveCellsAction(this,this._draggingCells,this._dropRange,o.ctrlKey));l=this._dropRange.topRow;for(n=this._draggingCells.topRow;n<=this._draggingCells.bottomRow;n++){r=this._dropRange.leftCol;for(i=this._draggingCells.leftCol;i<=this._draggingCells.rightCol;i++){this._moveCellContent(n,i,l,r,o.ctrlKey);if(this._draggingColumn&&l===this._dropRange.topRow){this.columns[r].dataType=this.columns[i].dataType?this.columns[i].dataType:e.DataType.Object;this.columns[r].align=this.columns[i].align;this.columns[r].format=this.columns[i].format;if(!o.ctrlKey){this.columns[i].dataType=e.DataType.Object;this.columns[i].align=null;this.columns[i].format=null}}r++}l++}if(this._draggingColumn&&!o.ctrlKey){r=this._dropRange.leftCol;for(i=this._draggingCells.leftCol;i<=this._draggingCells.rightCol;i++){this._updateColumnFiler(i,r);r++}}}else if(this._draggingColumn&&this._draggingCells.leftCol<this._dropRange.leftCol||this._draggingRow&&this._draggingCells.topRow<this._dropRange.topRow)if(o.shiftKey){if(!this._allowExchangeCells(this._draggingRow,!1)){console.warn("Can not complete operation: You are attempting to change a position of table row or column in a way that is not allowed.");return}if(this._draggingColumn){r=this._dropRange.rightCol;for(i=this._draggingCells.rightCol;i>=this._draggingCells.leftCol;i--){this.columns.moveElement(i,r);r--}this._exchangeTableColumns(!1)}else if(this._draggingRow){l=this._dropRange.bottomRow;for(n=this._draggingCells.bottomRow;n>=this._draggingCells.topRow;n--){this.rows.moveElement(n,l);l--}}this._exchangeCellStyle(!1)}else{this.undoStack.stackSize>0&&(s=new t._MoveCellsAction(this,this._draggingCells,this._dropRange,o.ctrlKey));l=this._dropRange.bottomRow;for(n=this._draggingCells.bottomRow;n>=this._draggingCells.topRow;n--){r=this._dropRange.rightCol;for(i=this._draggingCells.rightCol;i>=this._draggingCells.leftCol;i--){this._moveCellContent(n,i,l,r,o.ctrlKey);if(this._draggingColumn&&l===this._dropRange.bottomRow){this.columns[r].dataType=this.columns[i].dataType?this.columns[i].dataType:e.DataType.Object;this.columns[r].align=this.columns[i].align;this.columns[r].format=this.columns[i].format;if(!o.ctrlKey){this.columns[i].dataType=e.DataType.Object;this.columns[i].align=null;this.columns[i].format=null}}r--}l--}if(this._draggingColumn&&!o.ctrlKey){r=this._dropRange.rightCol;for(i=this._draggingCells.rightCol;i>=this._draggingCells.leftCol;i--){this._updateColumnFiler(i,r);r--}}}if(!o.ctrlKey){a=this._updateFormulaForDropping(o.shiftKey);h=this._updateNamedRangesForDropping(o.shiftKey)}if(s&&s.saveNewState()){s._affectedFormulas=a;s._affectedDefinedNameVals=h;this._undoStack._addAction(s)}if(this._undoStack._pendingAction){this._undoStack._pendingAction._affectedFormulas=a;this._undoStack._pendingAction._affectedDefinedNameVals=h}this.select(this._dropRange);this.selectedSheet._addSelection(this.selection);this.hostElement.focus()}};FlexSheet.prototype._moveCellContent=function(t,o,n,i,l){var r,s=this.getCellData(t,o,!1),a=t*this.columns.length+o,h=n*this.columns.length+i,u=this.selectedSheet._styledCells[a],d=!0,c=this.selectedSheet.findTable(n,i);if(c&&c._isHeaderRow(n)){var _=c.getRange(),g=c.getColumns(),f=i-_.leftCol;r=g[f].name;null==s||""===s?d=!1:g[f].name=s+""}if(d){if(l&&_isFormula(s)&&h-a!=0)try{var p=this._calcEngine._parse(s);p._moveCellRangeExp(this.selectedSheetIndex,new e.grid.CellRange(t,o),new e.grid.CellRange(n,i),!1,!0)&&(s="="+p._getStringExpression())}catch(e){}this.setCellData(n,i,s)}else d=!0;u?this.selectedSheet._styledCells[h]=this._cloneObject(u):delete this.selectedSheet._styledCells[h];if(l){if(w=this.selectedSheet.findTable(t,o)){m=w._getTableRange();if(w===c&&t===n&&w._isHeaderRow(t)){C=o-m.leftCol;w._updateColumnName(C,s)}}}else{delete this.selectedSheet._styledCells[a];var w;if(w=this.selectedSheet.findTable(t,o)){var m=w._getTableRange();if(w===c&&t===n&&w._isHeaderRow(t)){var C=o-m.leftCol;w._updateColumnName(C,r);return}if(w.showHeaderRow&&t===m.topRow)return}this.setCellData(t,o,null)}};FlexSheet.prototype._allowExchangeCells=function(o,n){var i,l,r,s,a,h=this.selectedSheet.tables;for(i=0;i<h.length;i++){l=h[i];if(o){r=l.getRange(t.TableSection.Data);this._draggingCells.rowSpan;s=new e.grid.CellRange(this._draggingCells.topRow,r.leftCol,this._draggingCells.bottomRow,r.rightCol);a=new e.grid.CellRange(this._dropRange.topRow,r.leftCol,this._dropRange.bottomRow,r.rightCol)}else{r=l.getRange();this._draggingCells.columnSpan;s=new e.grid.CellRange(r.topRow,this._draggingCells.leftCol,r.bottomRow,this._draggingCells.rightCol);a=new e.grid.CellRange(r.topRow,this._dropRange.leftCol,r.bottomRow,this._dropRange.rightCol)}if(r.intersects(s)&&!r.contains(s)||r.intersects(a)&&!r.contains(a)||r.contains(s)&&!r.contains(a)||!r.contains(s)&&r.contains(a))return!1}return!0};FlexSheet.prototype._exchangeTableColumns=function(e){var t,o,n,i,l,r,s=this.selectedSheet.tables;for(t=0;t<s.length;t++)if((n=(o=s[t]).getRange()).leftCol<=this._draggingCells.leftCol&&n.rightCol>=this._draggingCells.rightCol){i=(e?this._draggingCells.leftCol:this._draggingCells.rightCol)-n.leftCol;l=(e?this._dropRange.leftCol:this._dropRange.rightCol)-n.leftCol;for(r=0;r<this._draggingCells.columnSpan;r++){o._moveColumns(i,l);if(e){i++;l++}else{i--;l--}}}};FlexSheet.prototype._exchangeCellStyle=function(e){var t,o,n,i,l,r=0,s=[];for(t=this._draggingCells.topRow;t<=this._draggingCells.bottomRow;t++)for(o=this._draggingCells.leftCol;o<=this._draggingCells.rightCol;o++){n=t*this.columns.length+o;if(this.selectedSheet._styledCells[n]){s.push(this._cloneObject(this.selectedSheet._styledCells[n]));delete this.selectedSheet._styledCells[n]}else s.push(void 0)}if(e){if(this._draggingColumn){l=this._draggingCells.rightCol-this._draggingCells.leftCol+1;for(o=this._draggingCells.leftCol-1;o>=this._dropRange.leftCol;o--)for(t=0;t<this.rows.length;t++){n=t*this.columns.length+o;i=t*this.columns.length+o+l;if(this.selectedSheet._styledCells[n]){this.selectedSheet._styledCells[i]=this._cloneObject(this.selectedSheet._styledCells[n]);delete this.selectedSheet._styledCells[n]}else delete this.selectedSheet._styledCells[i]}}else if(this._draggingRow){l=this._draggingCells.bottomRow-this._draggingCells.topRow+1;for(t=this._draggingCells.topRow-1;t>=this._dropRange.topRow;t--)for(o=0;o<this.columns.length;o++){n=t*this.columns.length+o;i=(t+l)*this.columns.length+o;if(this.selectedSheet._styledCells[n]){this.selectedSheet._styledCells[i]=this._cloneObject(this.selectedSheet._styledCells[n]);delete this.selectedSheet._styledCells[n]}else delete this.selectedSheet._styledCells[i]}}}else if(this._draggingColumn){l=this._draggingCells.rightCol-this._draggingCells.leftCol+1;for(o=this._draggingCells.rightCol+1;o<=this._dropRange.rightCol;o++)for(t=0;t<this.rows.length;t++){n=t*this.columns.length+o;i=t*this.columns.length+o-l;if(this.selectedSheet._styledCells[n]){this.selectedSheet._styledCells[i]=this._cloneObject(this.selectedSheet._styledCells[n]);delete this.selectedSheet._styledCells[n]}else delete this.selectedSheet._styledCells[i]}}else if(this._draggingRow){l=this._draggingCells.bottomRow-this._draggingCells.topRow+1;for(t=this._draggingCells.bottomRow+1;t<=this._dropRange.bottomRow;t++)for(o=0;o<this.columns.length;o++){n=t*this.columns.length+o;i=(t-l)*this.columns.length+o;if(this.selectedSheet._styledCells[n]){this.selectedSheet._styledCells[i]=this._cloneObject(this.selectedSheet._styledCells[n]);delete this.selectedSheet._styledCells[n]}else delete this.selectedSheet._styledCells[i]}}for(t=this._dropRange.topRow;t<=this._dropRange.bottomRow;t++)for(o=this._dropRange.leftCol;o<=this._dropRange.rightCol;o++){n=t*this.columns.length+o;s[r]?this.selectedSheet._styledCells[n]=s[r]:delete this.selectedSheet._styledCells[n];r++}};FlexSheet.prototype._containsMergedCells=function(e,t){var o,n;if(!(t=t||this.selectedSheet))return!1;for(o=0;o<t._mergedRanges.length;o++){n=t._mergedRanges[o];if(e.intersects(n))return!0}return!1};FlexSheet.prototype._multiSelectColumns=function(t){var o;if(t&&this._columnHeaderClicked){(o=new e.grid.CellRange(t.row,t.col)).row=this.itemsSource&&this.rows[0]&&!this.rows[0].isVisible?1:0;o.row2=this.rows.length-1;o.col2=this.selection.col2;this.select(o)}};FlexSheet.prototype._cumulativeOffset=function(t){var o=0,n=0;do{o+=t.offsetTop||0;n+=t.offsetLeft||0;t=t.offsetParent}while(t);return new e.Point(n,o)};FlexSheet.prototype._cumulativeScrollOffset=function(t){var o=0,n=0;do{o+=t.scrollTop||0;n+=t.scrollLeft||0;t=t.offsetParent}while(t&&!(t instanceof HTMLBodyElement));o+=document.body.scrollTop||document.documentElement.scrollTop;n+=document.body.scrollLeft||document.documentElement.scrollLeft;return new e.Point(n,o)};FlexSheet.prototype._checkHitWithinSelection=function(t){var o;if(null!=t&&t.cellType===e.grid.CellType.Cell){if((o=this.getMergedRange(this.cells,t.row,t.col))&&o.contains(this.selection))return!0;if(this.selection.row===t.row&&this.selection.col===t.col)return!0}return!1};FlexSheet.prototype._clearForEmptySheet=function(t){if(this.selectedSheet&&0===this[t].length&&!0!==this._isCopying&&!0!==this._isUndoing&&!0!==this._isSorting){this.selectedSheet._mergedRanges.length=0;this.selectedSheet._styledCells=null;this.select(new e.grid.CellRange)}};FlexSheet.prototype._containsGroupRows=function(t){var o;for(o=t.topRow;o<=t.bottomRow;o++)if(this.rows[o]instanceof e.grid.GroupRow)return!0;return!1};FlexSheet.prototype._delSeletionContent=function(o){var n,i,l,r,s,a,h,u,d,c,_,g=!1,f=new t._EditAction(this),p=this.editableCollectionView,w=!1,m=this.scrollPosition;if(!this.isReadOnly)if(this.allowDelete&&this.selection.isValid&&0===this.selection.leftCol&&this.selection.rightCol===this.columns.length-1)this.deleteRows(this._selections());else{this.beginUpdate();this.undoStack.stackSize>0&&(f=new t._EditAction(this));var C=this._selections();for(l=0;l<C.length;l++){n=C[l];i=new e.grid.CellRange;c=new e.grid.CellEditEndingEventArgs(this.cells,i,o);if((u=this.selectedSheet.tables.length)>0)for(a=u-1;a>=0;a--){h=this.selectedSheet.tables[a];if(n.contains(h.getRange())){f&&f._storeDeletedTables(h);this.selectedSheet.tables.remove(h)}}for(s=n.topRow;s<=n.bottomRow;s++)if((_=this.rows[s])&&!_.isReadOnly&&(_.visible||this.selectedSheet._freezeHiddenRows&&this.selectedSheet._freezeHiddenRows[s]))for(r=n.leftCol;r<=n.rightCol;r++)if((d=this._getBindingColumn(this.cells,s,this.columns[r]))&&!d.isReadOnly&&(!1===d.isRequired||null==d.isRequired&&d.dataType==e.DataType.String)&&(d.visible||this.selectedSheet._freezeHiddenCols&&this.selectedSheet._freezeHiddenCols[r])&&this.getCellData(s,r,!0)){i.setRange(s,r);c.cancel=!1;if(this.onBeginningEdit(c)){if(p){if(!w){w=!0;p.beginUpdate()}p.editItem(_.dataItem);this._edtHdl._edItem=p.currentEditItem}this.setCellData(s,r,"",!0);g=!0;this.onCellEditEnding(c);this.onCellEditEnded(c)}}if(w){p.endUpdate(!0);p._pendingRefresh=!1;n.rowSpan>1&&p.commitEdit()}}if(g&&f){f.saveNewState();this._undoStack._addAction(f)}this.selection=n;this.scrollPosition=m;this.endUpdate()}};FlexSheet.prototype._updateAffectedFormula=function(t,o,n,i,l){var r,s,a,h,u,d,c,_,g,f=[],p=[],w=this.selection.clone();this.selectedSheet._storeRowSettings();this.beginUpdate();for(r=0;r<this.sheets.length;r++){a=(s=this.sheets[r]).grid;for(h=0;h<a.rows.length;h++)for(u=0;u<a.columns.length;u++)if(_isFormula(_=a.getCellData(h,u,!1))&&(g=this._updateCellRef(_,r,t,o,n,i,l))){f.push({sheet:s,point:new e.Point(h,u),formula:_});d=h;c=u;if(r===this.selectedSheetIndex){i?h>=t&&(n?d+=o:d-=o):u>=t&&(n?c+=o:c-=o);if(!n&&(i&&h<=t&&h>=t-o+1||!i&&u<=t&&u>=t-o+1))continue}a.setCellData(h,u,g,!1);p.push({sheet:s,point:new e.Point(d,c),formula:g})}}this.selection=w;this.endUpdate();return{oldFormulas:f,newFormulas:p}};FlexSheet.prototype._updateAffectedNamedRanges=function(t,o,n,i){var l,r,s,a,h=[],u=[];for(l=0;l<this.definedNames.length;l++)if((s=(r=this.definedNames[l]).value)&&e.isString(s)&&(a=this._updateCellRef(s,this.selectedSheetIndex,t,o,n,i))){h.push({name:r.name,value:s});r.value=a;u.push({name:r.name,value:a})}return{oldDefinedNameVals:h,newDefinedNameVals:u}};FlexSheet.prototype._updateFormulaBoundaryForEditingCell=function(t,o){var n,i,l,r,s=[],a=[];this.beginUpdate();for(n=t;n<this.rows.length;n++)if(_isFormula(l=this.getCellData(n,o,!1))&&(r=this._updateCellBoundary(l,t,o))){s.push({point:new e.Point(n,o),formula:l});this.setCellData(n,o,r,!1);a.push({point:new e.Point(n,o),formula:r})}for(i=o;i<this.columns.length;i++)if(_isFormula(l=this.getCellData(t,i,!1))&&(r=this._updateCellBoundary(l,t,o))){s.push({point:new e.Point(t,i),formula:l});this.setCellData(t,i,r,!1);a.push({point:new e.Point(t,i),formula:r})}this.endUpdate();return{oldFormulas:s,newFormulas:a}};FlexSheet.prototype._updateColumnFiler=function(e,t){for(var o=JSON.parse(this._filter.filterDefinition),n=0;n<o.filters.length;n++){var i=o.filters[n];if(i.columnIndex===e){i.columnIndex=t;break}}this._filter.filterDefinition=JSON.stringify(o)};FlexSheet.prototype._isDescendant=function(e,t){for(var o=t.parentNode;null!=o;){if(o===e)return!0;o=o.parentNode}return!1};FlexSheet.prototype._clearCalcEngine=function(){this._calcEngine._clearExpressionCache()};FlexSheet.prototype._getRangeString=function(t,o,n){void 0===n&&(n=!0);var i,l,r,s,a,h="",u=!0,d=o&&o!==this.selectedSheet?o.grid:this;if(e.isArray(t))if(t.length>1){if(this._isMultipleRowsSelected(t,o)){h="";for(l=0;l<t.length;l++){h&&(h+="\n");h+=this._getRangeString(t[l],o)}return h}if(!this._isMultipleColumnsSelected(t,o))return"";h="";for(i=0,u=!0;i<d.rows.length;i++){u||(h+="\n");u=!1;for(l=0,f=!0;l<t.length;l++){(r=t[l].clone()).row=r.row2=i;f||(h+="\t");f=!1;h+=this._getRangeString(t[l],o)}return h}}else{a=t[0];switch(this.selectionMode){case e.grid.SelectionMode.Row:case e.grid.SelectionMode.RowRange:a.col=0;a.col2=o.grid.columns.length-1;break;case e.grid.SelectionMode.ListBox:a.col=0;a.col2=o.grid.columns.length-1;for(var c=0;c<o.grid.rows.length;c++)if(o.grid.rows[c].isSelected&&o.grid.rows[c].isVisible){a.row=a.row2=c;h&&(h+="\n");h+=this._getRangeString(a,o)}return h}}for(var _=(a=e.asType(e.isArray(t)?t[0]:t,e.grid.CellRange)).topRow;_<=a.bottomRow;_++)if(d.rows[_]&&d.rows[_].isVisible){u||(h+="\n");u=!1;for(var g=a.leftCol,f=!0;g<=a.rightCol;g++)if(d.columns[g]&&d.columns[g].isVisible){f||(h+="\t");f=!1;var p=this._getCellStyle(_,g,o),w=p?p.format:"",m=d.columns[g];if(n){_isFormula(s=d.getCellData(_,g,!1))&&(s=this._evaluate(s,null,o,_,g));s=this._formatEvaluatedResult(s,m,w)}else{s=d.getCellData(_,g,!1);e.isDate(s)&&(s=e.Globalize.format(s,w||m.format));m.dataMap&&(s=m.dataMap.getDisplayValue(s))}(s=(s=null==s?"":s.toString()).replace(/\t/g," ")).indexOf("\n")>-1&&(s='"'+s.replace(/"/g,'""')+'"');h+=s}}return h};FlexSheet.prototype._getSelectionForListBoxMode=function(t){for(var o,n=0;n<t.rows.length;n++)t.rows[n].isSelected&&(o?o.row2=n:o=new e.grid.CellRange(n,0,n,t.columns.length-1));return o};FlexSheet.prototype._containsRandFormula=function(e,t){for(var o=0;o<e.length;o++)for(var n=e[o],i=n.topRow;i<=n.bottomRow&&i<t.grid.rows.length;i++)for(var l=n.leftCol;l<=n.rightCol&&l<t.grid.columns.length;l++){var r=t.grid.getCellData(i,l,!1);if(_isFormula(r)&&-1!==r.search(/rand/i))return!0}return!1};FlexSheet.prototype._isMultipleRowsSelected=function(e,t){var o,n,i;e&&e.length>1?i=e:this.selectedSheet.selectionRanges.length>1&&(i=this.selectedSheet.selectionRanges);o=i[0];for(var l=1;l<i.length;l++)if((n=i[l]).leftCol!==o.leftCol||n.rightCol!==o.rightCol)return!1;return!0};FlexSheet.prototype._isMultipleColumnsSelected=function(e,t){var o,n,i;e&&e.length>1?i=e:this.selectedSheet.selectionRanges.length>1&&(i=this.selectedSheet.selectionRanges);o=i[0];for(var l=0;l<i.length;l++)if((n=i[l]).topRow!==o.topRow||n.bottomRow!==o.bottomRow)return!1;return!0};FlexSheet.prototype._postSetClipStringProcess=function(t,o,n,i,l,r,s){var a,h=new e.grid.CellRangeEventArgs(this.cells,new e.grid.CellRange(o,n),t);if(this.onPastingCell(h)){this.rows[h.row]instanceof e.grid._NewRowTemplate&&this._addHdl._rowEditStarting(this,h);if(i>=0&&l>=0&&this._copiedSheet&&(a=this._copiedSheet._getMergedRange(i,l))&&a.topRow===i&&a.leftCol===l){var u=o+a.rowSpan-1;u=u<this.rows.length?u:this.rows.length-1;var d=n+a.columnSpan-1;d=d<this.columns.length?d:this.columns.length-1;for(var c=new e.grid.CellRange(o,n,u,d),_=c.topRow;_<=c.bottomRow;_++)for(var g=c.leftCol;g<=c.rightCol;g++){var p=this.getMergedRange(this.cells,_,g);if(null!=p&&!p.equals(c)){console.error("We can't paste the merged cell to another merged cell.");return!1}}this.mergeRange(new e.grid.CellRange(o,n,u,d),!0)}r&&r.editItem(this.rows[o].dataItem);var w=this.cells.setCellData(o,n,s&&s.format?new f(h.data,s.format):h.data);if(w){if(e.isString(h.data)&&"\n"!==h.data){var m=h.data.match(/\n/g);if(m&&m.length>0){s?s.whiteSpace="pre":s={whiteSpace:"pre"};this.rows[o].height=this.rows.defaultSize*(m.length+1)}}var C=o*this.columns.length+n;this.selectedSheet._styledCells[C]=s?this._cloneObject(s):void 0;this.onPastedCell(h)}}return w};FlexSheet.prototype._delCutData=function(t,o){var n,i,l,r,s=this._copiedSheet===this.selectedSheet?this:this._copiedSheet.grid;for(n=(r=this.selectionMode===e.grid.SelectionMode.ListBox?this._getSelectionForListBoxMode(s):this._copiedRanges[0]).topRow;n<=r.bottomRow;n++)if(null!=s.rows[n])for(i=r.leftCol;i<=r.rightCol;i++)(this._copiedSheet!==this.selectedSheet||n<this.selection.topRow||n>this.selection.topRow+t-1||i<this.selection.leftCol||i>this.selection.leftCol+o-1)&&(0==(l=s._getBindingColumn(s.cells,n,s.columns[i])).isRequired||null==l.isRequired&&l.dataType==e.DataType.String)&&s.getCellData(n,i,!0)&&s.setCellData(n,i,"",!0)};FlexSheet.prototype._containsMultiLineText=function(e){for(var t=0;t<e.length;t++)for(var o=e[t],n=0;n<o.length;n++)if(o[n].indexOf("\n")>0)return!0;return!1};FlexSheet.prototype._sortByRow=function(e,t){return e.topRow>t.topRow?1:e.topRow<t.topRow?-1:0};FlexSheet.prototype._sortByColumn=function(e,t){return e.leftCol>t.leftCol?1:e.leftCol<t.leftCol?-1:0};FlexSheet.prototype._setFlexSheetToDirty=function(){this.columns._dirty=!0;this.rows._dirty=!0;this.rowHeaders.columns._dirty=!0;this.rowHeaders.rows._dirty=!0;this.columnHeaders.columns._dirty=!0;this.columnHeaders.rows._dirty=!0};FlexSheet.convertNumberToAlpha=function(e){var t,o,n="";if(e>=0)do{t=Math.floor(e/26);o=e%26;n=String.fromCharCode(o+65)+n;e=t-1}while(t);return n};FlexSheet.prototype._updateFormulaForReorderingRows=function(e,t,o){void 0===o&&(o=!1);var n,i,l=o?e-t:t-e;this.beginUpdate();for(var r=0;r<this.columns.length;r++)if(_isFormula(n=this.getCellData(t,r,!1))&&0!==l){try{i=this._calcEngine._parse(n)}catch(e){continue}i._updateCellRangeExpForReorderingRows(l)&&this.setCellData(t,r,"="+i._getStringExpression())}this.endUpdate()};FlexSheet.prototype._updateFormulaForDropping=function(t){var o,n,i,l,r,s,a,h,u,d=[],c=[];this.beginUpdate();for(i=0;i<this.sheets.length;i++){n=(o=this.sheets[i]).grid;for(l=0;l<n.rows.length;l++)for(s=0;s<n.columns.length;s++)if(_isFormula(h=n.getCellData(l,s,!1))&&(u=this._updateCellRefForDropping(h,i,t))){n.setCellData(l,s,u,!1);if(t&&i===this.selectedSheetIndex){r=n.rows[l];a=n.columns[s];d.push({sheet:o,row:r,column:a,formula:h});c.push({sheet:o,row:r,column:a,formula:u})}else{d.push({sheet:o,point:new e.Point(l,s),formula:h});c.push({sheet:o,point:new e.Point(l,s),formula:u})}}}this.endUpdate();return{oldFormulas:d,newFormulas:c}};FlexSheet.prototype._updateNamedRangesForDropping=function(t){var o,n,i,l,r=[],s=[];for(o=0;o<this.definedNames.length;o++)if((i=(n=this.definedNames[o]).value)&&e.isString(i)&&(l=this._updateCellRefForDropping(i,this.selectedSheetIndex,t))){r.push({name:n.name,value:i});n.value=l;s.push({name:n.name,value:l})}return{oldDefinedNameVals:r,newDefinedNameVals:s}};FlexSheet.prototype._updateCellRefForDropping=function(e,t,o){void 0===o&&(o=!1);var n;try{n=this._calcEngine._parse(e)}catch(e){return null}return n._moveCellRangeExp(t,this._draggingCells,this._dropRange,o)?"="+n._getStringExpression():null};FlexSheet.prototype._updateCellStyleForReorderingRows=function(e,t,o){var n,i,l=this.columns.length;for(n=0;n<l;n++)(i=this._getCellStyle(e,n))&&(o[t*l+n]=i)};FlexSheet.prototype._scanFormulas=function(){for(var e=[],t=0;t<this.rows.length;t++)for(var o=0;o<this.columns.length;o++){var n=this.getCellData(t,o,!1);_isFormula(n)&&e.push({row:t,column:o,formula:n})}return e};FlexSheet.prototype._resetFormulas=function(e){var t=this;e&&this.deferUpdate((function(){for(var o=0;o<e.length;o++){var n=e[o];t.setCellData(n.row,n.column,n.formula)}}))};FlexSheet.prototype._getCellStyle=function(e,t,o){return(o=o||this.selectedSheet)?o.getCellStyle(e,t):null};FlexSheet.prototype._getSheet=function(e){if(null==e)return null;e=e.toLowerCase();for(var t=0;t<this.sheets.length;t++){var o=this.sheets[t];if(o.name.toLowerCase()===e)return o}return null};FlexSheet.prototype._validateSheetName=function(e){return!!this._getSheet(e)};FlexSheet.prototype._checkExistDefinedName=function(e,t,o){void 0===o&&(o=-1);t=t?t.toLowerCase():t;for(var n=0;n<this.definedNames.length;n++){var i=this.definedNames[n],l=i.sheetName?i.sheetName.toLowerCase():i.sheetName;if(i.name===e&&l===t&&n!==o)return!0}return!1};FlexSheet.prototype._updateDefinedNameWithSheetRefUpdating=function(e,t){for(var o,n,i,l=0;l<this.definedNames.length;l++){null!=(o=this.definedNames[l]).sheetName&&o.sheetName.toLowerCase()===e.toLowerCase()&&(o._sheetName=t);if((n=o.value.match(/(\w+)\!\$?[A-Za-z]+\$?\d+/g))&&n.length>0)for(var r=0;r<n.length;r++)(i=n[r]).substring(0,i.indexOf("!"))===e&&(o.value=o.value.replace(i,i.replace(e,t)))}};FlexSheet.prototype._updateFormulasTableColumn=function(e,t,o,n){if(o!==n){this.beginUpdate();for(var i=new RegExp(e.name+"\\["+o+"\\]","g"),l=e.name+"["+n+"]",r=new RegExp("\\["+o+"\\]","g"),s="["+o+"]",a="["+n+"]",h=0;h<this.sheets.length;h++)for(var u=this.sheets[h],d=u.grid,c=0;c<d.rows.length;c++)for(var _=0;_<d.columns.length;_++){var g=d.getCellData(c,_,!1);if(_isFormula(g)&&g.indexOf("[")>=0){if((g=g.replace(i,l)).indexOf(s)>=0){var f=u.findTable(c,_);f&&f.name===e.name&&(g=g.replace(r,a))}d.setCellData(c,_,g,!1)}}e._updateColumnName(t-e._getTableRange().leftCol,n,!1);this.endUpdate()}};FlexSheet.prototype._updateFormulasWithNameUpdating=function(e,t,o){void 0===o&&(o=!1);if(this.sheets.length){var n=o?/\[/:/\w/,i=this.selection.clone();this.selectedSheet._storeRowSettings();this.beginUpdate();for(var l=0;l<this.sheets.length;l++)for(var r=this.sheets[l].grid,s=0;s<r.rows.length;s++)for(var _loop_1=function(i){var l=r.getCellData(s,i,!1);if(_isFormula(l)){for(var a=!1,h=l.indexOf(e),u=new RegExp(e,"g");h>-1;){var d="",c="";h>0&&(d=l[h-1]);h+e.length<l.length&&(c=l[h+e.length]);if(!/\w/.test(d)&&(o&&n.test(c)||!o&&!n.test(c))){l=l.replace(u,(function(o,n){return n===h?t:e}));a=!0}h=l.indexOf(e,h+e.length)}a&&r.setCellData(s,i,l,!1)}},a=0;a<r.columns.length;a++)_loop_1(a);this.selection=i;this.endUpdate()}};FlexSheet.prototype._getDefinedNameIndexByName=function(e){for(var t=0;t<this.definedNames.length;t++)if(this.definedNames[t].name===e)return t;return-1};FlexSheet.prototype._updateTablesForUpdatingRow=function(e,t,o){var n,i,l,r,s;if(this.selectedSheet.tables.length>0)for(n=this.selectedSheet.tables.length-1;n>=0;n--){l=(i=this.selectedSheet.tables[n]).getRange();if(o){if((r=e+t-1)<l.topRow)i._updateTableRange(-t,-t,0,0);else if(r>=l.topRow&&r<=l.bottomRow){if(e<=l.topRow&&r===l.bottomRow){null==s&&(s=[]);s.push(i);this.selectedSheet.tables.remove(i);continue}if(e<l.topRow){i.showHeaderRow&&(i._showHeaderRow=!1);i._updateTableRange(e-l.topRow,-t,0,0)}else{e===l.topRow&&i.showHeaderRow&&(i._showHeaderRow=!1);r===l.bottomRow&&i.showTotalRow&&(i._showTotalRow=!1);i._updateTableRange(0,-t,0,0)}}else if(e<=l.topRow){null==s&&(s=[]);s.push(i);this.selectedSheet.tables.remove(i)}else if(e<=l.bottomRow){i.showTotalRow&&(i._showTotalRow=!1);i._updateTableRange(0,e-l.bottomRow-1,0,0)}}else e<=l.topRow?i._updateTableRange(t,t,0,0):e>l.topRow&&e<=l.bottomRow&&i._updateTableRange(0,t,0,0)}return s};FlexSheet.prototype._updateTablesForUpdatingColumn=function(e,t,o){var n,i,l,r,s,a,h,u;if(this.selectedSheet.tables.length>0)for(n=this.selectedSheet.tables.length-1;n>=0;n--){l=(i=this.selectedSheet.tables[n]).getRange();if(o){if((r=e+t-1)<l.leftCol)i._updateTableRange(0,0,-t,-t);else if(r>=l.leftCol&&r<=l.rightCol){if(e<=l.leftCol&&r===l.rightCol){null==u&&(u=[]);u.push(i);this.selectedSheet.tables.remove(i);continue}if(e<l.leftCol){s=t-l.leftCol+e;a=l.leftCol;i._updateTableRange(0,0,e-l.leftCol,-t)}else{s=t;a=e;i._updateTableRange(0,0,0,-s)}i._columns.splice(a-l.leftCol,s)}else if(e<=l.leftCol){null==u&&(u=[]);u.push(i);this.selectedSheet.tables.remove(i)}else if(e<=l.rightCol){s=l.rightCol-e+1;i._updateTableRange(0,0,0,-s);i._columns.splice(e,s)}}else if(e<=l.leftCol)i._updateTableRange(0,0,t,t);else if(e>l.leftCol&&e<=l.rightCol){i._updateTableRange(0,0,0,t);a=e-l.leftCol;for(h=0;h<t;h++)i._addColumn(a+h)}}return u};FlexSheet.prototype._updateDivContainerHeight=function(e){var t=this._divContainer.parentElement.clientHeight;e&&(t-=this._tabHolder.getSheetBlanketSize());this._divContainer.style.height=t+"px"};FlexSheet.prototype._isDisableDeleteRow=function(e,t){var o,n,i;if(this.selectedSheet.tables.length>0)for(o=0;o<this.selectedSheet.tables.length;o++){i=(n=this.selectedSheet.tables[o]).getRange();if(n.showHeaderRow&&i.topRow>=e&&i.topRow<=t)return!0}return!1};FlexSheet.prototype._copy=function(e,t){var o,i;if("columns"==e){n.prototype._copy.call(this,e,t);if(this.itemsSource&&(o=this.rows[0])instanceof d){o._ubv=null;o._ubv={};for(var l=0;l<this.columns.length;l++){i=this.columns[l];o._ubv[i._hash]=FlexSheet._getHeaderRowText(i)}}return!0}return!1};FlexSheet.prototype._getTableSheetIndex=function(e,t){this.sheets;for(var o=0;o<e.length;o++)if(e[o].indexOf(t)>-1)return o;return-1};FlexSheet.prototype._sheetSortConverter=function(e,t,o,i){_isFormula(o=n.prototype._sortConverter.call(this,e,t,o,i))&&(o=this.evaluate(o));return o};FlexSheet.prototype._formatEvaluatedResult=function(o,n,i){if(e.isPrimitive(o)){n.dataMap&&(o=n.dataMap.getDisplayValue(o));var l=i||n.format;if(!e.isInt(o)||l||n.dataMap){e.isDate(o)&&_isExclusiveNumericFormat(l)?o=FlexSheet._toOADate(o):l&&"@"!==l&&e.isString(o)&&(+o).toString()===o&&(o=+o);o=null!=o?e.Globalize.format(o,l):""}else o=o.toString()}else if(o){if(o instanceof t.FormulaError)return o.error;l=i||o.format||n.format;if(!e.isInt(o.value)||l||n.dataMap){e.isDate(o.value)&&_isExclusiveNumericFormat(l)?o.value=FlexSheet._toOADate(o.value):e.isString(o.value)&&(+o.value).toString()===o.value&&(o.value=+o.value);o=null!=o.value?e.Globalize.format(o.value,l):""}else o=o.value.toString()}return o};FlexSheet.prototype._updateCellRef=function(e,t,o,n,i,l,r){var s;try{s=this._calcEngine._parse(e)}catch(e){return null}return s._updateCellRangeExp(t,o,n,i,l,r)?"="+s._getStringExpression():null};FlexSheet.prototype._updateCellBoundary=function(e,o,n){var i;try{i=this._calcEngine._parse(e)}catch(e){return null}return i instanceof t._FunctionExpression&&i._updateCellBoundary(o,n)?"="+i._getStringExpression():null};FlexSheet.prototype._fillData=function(t){void 0===t&&(t=c.CopyFormat|c.FillSeries);var o=this._fillingRange||this.selection,n=this._fillingSource,i=0!=(t&c.CopyFormat),l=0!=(t&c.CopyContent),r=0!=(t&c.FillSeries),s=n.leftCol===o.leftCol&&n.rightCol===o.rightCol,h=[],u=new a(o,t);this.onAutoFilling(u);if(u.cancel)return!1;this.beginUpdate();this._resetCellsForFillRange(t);for(var d=0;d<o.rowSpan;d++){var _=o.topRow+d,g=_-n.topRow,f=g%n.rowSpan;f<0&&(f+=n.rowSpan);for(var p=0;p<o.columnSpan;p++){var w=o.leftCol+p,m=w-n.leftCol;if(!(g>=0&&g<n.rowSpan&&m>=0&&m<n.columnSpan)){var C=m%n.columnSpan;C<0&&(C+=n.columnSpan);var S=!1,b=this.getMergedRange(this.cells,n.topRow+f,n.leftCol+C);b&&(S=b.topRow===n.topRow+f&&b.leftCol===n.leftCol+C)&&(this.getMergedRange(this.cells,_,w)||this.mergeRange(new e.grid.CellRange(_,w,_+b.rowSpan-1,w+b.columnSpan-1)));if(i){var y=this.selectedSheet.getCellStyle(n.topRow+f,n.leftCol+C),v=y?this._cloneObject(y):null,R=_*this.columns.length+w;this.selectedSheet._styledCells[R]=v}if((!b||S)&&!this.isReadOnly&&!this.rows[_].isReadOnly&&!this.columns[w].isReadOnly){var x=void 0;if(l)_isFormula(x=this.getCellData(n.topRow+f,n.leftCol+C,!1))?this._fillFormula(x,n.topRow+f,n.leftCol+C,_,w):this.setCellData(_,w,x);else if(r){var T=void 0,E=void 0;if(s){T=p;E=f}else{T=d;E=C}if(null==(x=this.getCellData(n.topRow+f,n.leftCol+C,!1))||e.isString(x)){_isFormula(x)?this._fillFormula(x,n.topRow+f,n.leftCol+C,_,w):this.setCellData(_,w,x);h[T]=null}else{h[T]||(h[T]=this._getFillSeries(s,T,E));var F=h[T];if(F){if(s){x=this._getFillData(f,g,n,s,F,null!=t||0===T);F.endIndex===n.topRow+f&&(h[T]=null)}else{x=this._getFillData(C,m,n,s,F,null!=t||0===T);F.endIndex===n.leftCol+C&&(h[T]=null)}this.setCellData(_,w,x)}}}}}}}this._fillingRange&&this.select(this._fillingRange,!1);this.endUpdate();this.onAutoFilled(u);return!0};FlexSheet.prototype._getFillData=function(e,t,o,n,i,l){var r,s,a=i.items;if(1===a.length&&!l)return a[0];r=n?Math.floor(t/o.rowSpan)*i.itemIndexes[i.itemIndexes.length-1]+o.topRow+e-i.startIndex+1:Math.floor(t/o.columnSpan)*i.itemIndexes[i.itemIndexes.length-1]+o.leftCol+e-i.startIndex+1;s=this._getLinearBestFitTrendData(a,i.itemIndexes,r);"date"===i.type&&(s=FlexSheet._fromOADate(s));return s};FlexSheet.prototype._fillFormula=function(t,o,n,i,l){var r,s,a;try{r=this._calcEngine._parse(t);s=new e.grid.CellRange(o,n);a=new e.grid.CellRange(i,l);r._moveCellRangeExp(this.selectedSheetIndex,s,a,!1,!0)&&(t="="+r._getStringExpression())}catch(e){}finally{this.setCellData(i,l,t)}};FlexSheet.prototype._getFillSeries=function(t,o,n){var i,l,r,s,a,h,u,d,c=this._fillingSource,_=[],g=[];if(t){n=c.topRow+n;s=0;for(a=c.topRow;a<=c.bottomRow;a++){if(h=this.getMergedRange(this.cells,a,c.leftCol+o))if(u&&!h.equals(u)){s+=u.rowSpan;u=h;if(h.leftCol!==c.leftCol+o)continue}else{if(h.topRow!==a||h.leftCol!==c.leftCol+o)continue;s+=1;u=h}else if(u){s+=u.rowSpan;u=null}else s+=1;if(null!=(d=this.getCellData(a,c.leftCol+o,!1))&&""!==d)if(e.isNumber(d)||e.isDate(d)){i=e.isNumber(d)?"number":"date";e.isDate(d)&&(d=FlexSheet._toOADate(d));if(0===_.length){r=a;l=i;_.push(d);g.push(s)}else if(i===l){_.push(d);g.push(s)}else{if(n>=r&&n<=a)return{type:l,startIndex:r,endIndex:a-1,items:_,itemIndexes:g};_.splice(0,_.length);g.splice(0,g.length)}}else if(_.length>0){if(n>=r&&n<=a)return{type:l,startIndex:r,endIndex:a-1,items:_,itemIndexes:g};_.splice(0,_.length);g.splice(0,g.length)}}}else{n=c.leftCol+n;s=0;for(a=c.leftCol;a<=c.rightCol;a++){if(h=this.getMergedRange(this.cells,c.topRow+o,a))if(u&&!h.equals(u)){s+=u.columnSpan;u=h;if(h.topRow!==c.topRow+o)continue}else{if(h.leftCol!==a||h.topRow!==c.topRow+o)continue;s+=1;u=h}else if(u){s+=u.columnSpan;u=null}else s+=1;if(null!=(d=this.getCellData(c.topRow+o,a,!1))&&""!==d)if(e.isNumber(d)||e.isDate(d)){i=e.isNumber(d)?"number":"date";e.isDate(d)&&(d=FlexSheet._toOADate(d));if(0===_.length){r=a;l=i;_.push(d);g.push(s)}else if(i===l){_.push(d);g.push(s)}else{if(n>=r&&n<=a)return{type:l,startIndex:r,endIndex:a-1,items:_,itemIndexes:g};_.splice(0,_.length);g.splice(0,g.length)}}else if(_.length>0){if(n>=r&&n<=a)return{type:l,startIndex:r,endIndex:a-1,items:_,itemIndexes:g};_.splice(0,_.length);g.splice(0,g.length)}}}return _.length>0?{type:l,startIndex:r,endIndex:a-1,items:_,itemIndexes:g}:null};FlexSheet.prototype._getLinearBestFitTrendData=function(e,t,o){var n,i,l,r,s=0,a=0,h=0,u=0;if(1===(r=e.length))return e[0]+o-1;for(n=0;n<t.length;n++){s+=i=t[n];h+=i*i;a+=l=e[n];u+=i*l}return o*((r*u-s*a)/(r*h-s*s))+(a*h-s*u)/(r*h-s*s)};FlexSheet.prototype._getCellSettingsForFill=function(e,t){var o,n,i,l,r,s;e||(e=this._fillingSource);t||(t=this._fillingRange);r=[];for(o=t.topRow;o<=t.bottomRow;o++)for(n=t.leftCol;n<=t.rightCol;n++)if(!(o>=e.topRow&&o<=e.bottomRow&&n>=e.leftCol&&n<=e.rightCol)){i=this.getCellData(o,n,!1);l=this._cloneObject(this.selectedSheet.getCellStyle(o,n));(s=this.getMergedRange(this.cells,o,n))&&s.topRow===o&&s.leftCol===n||(s=null);r.push({row:o,col:n,value:i,style:l,mergedCell:s?s.clone():null})}return r};FlexSheet.prototype._resetCellsForFillRange=function(e){var t=0!=(e&c.CopyFormat),o=0!=(e&c.CopyContent),n=0!=(e&c.FillSeries);if(this._orgCellSettings&&this._orgCellSettings.length>0)for(var i=0;i<this._orgCellSettings.length;i++){var l=this._orgCellSettings[i],r=l.row,s=l.col;if(!t){var a=r*this.columns.length+s;this.selectedSheet._styledCells[a]=l.style}o||n||this.setCellData(r,s,l.value)}};FlexSheet.prototype._canDoFillOperation=function(){var e,t,o,n,i,l,r,s,a,h,u,d,c,_,g,f=this._fillingSource,p=this._fillingRange,w=!1;for(e=f.topRow;e<=f.bottomRow;e++)for(t=f.leftCol;t<=f.rightCol;t++){h=this.getMergedRange(this.cells,e,t);if(u){if(!h||!u.equals(h)){w=!0;break}}else u=h}for(o=p.topRow;o<=p.bottomRow;o++){(n=(i=o-f.topRow)%f.rowSpan)<0&&(n+=f.rowSpan);n+=f.topRow;for(l=p.leftCol;l<=p.rightCol;l++){s=l-f.leftCol;if(!(i>=0&&i<f.rowSpan&&s>=0&&s<f.columnSpan)){(r=s%f.columnSpan)<0&&(r+=f.columnSpan);r+=f.leftCol;h=this.getMergedRange(this.cells,n,r);if(a=this.getMergedRange(this.cells,o,l)){if(w||!h)return!1;d=a?o-a.topRow:NaN;c=a?l-a.leftCol:NaN;_=h?n-h.topRow:NaN;g=h?r-h.leftCol:NaN;if(d!==_||c!==g)return!1}}}}return!0};FlexSheet.prototype._updateItemIndexForInsertingRow=function(e,t,o){for(var n=0;n<e.length;n++){var i=e[n];i&&null!=i._itemIdx&&i._itemIdx>=t&&(i._itemIdx+=o)}};FlexSheet.prototype._updateItemIndexForRemovingRow=function(e,t){for(var o=0;o<e.length;o++){var n=e[o];n&&null!=n._itemIdx&&n._itemIdx>=t&&(n._itemIdx-=1)}};FlexSheet.prototype._copyRowsToSelectedSheet=function(){var e=this;if(this.selectedSheet){this.selectedSheet.grid.rows.clear();for(var t=0;t<this.rows.length;t++){var o=this.rows[t];this.selectedSheet.grid.rows.push(o);o._list=this.rows}setTimeout((function(){e._setFlexSheetToDirty();e.invalidate()}),10)}};FlexSheet.prototype._copyColumnsToSelectedSheet=function(){var e=this;if(this.selectedSheet){this.selectedSheet.grid.columns.clear();for(var t=0;t<this.columns.length;t++){var o=this.columns[t];this.selectedSheet.grid.columns.push(o);o._list=this.columns}setTimeout((function(){e._setFlexSheetToDirty();e.invalidate()}),10)}};FlexSheet.prototype._getUniqueColumnName=function(){for(var e=1;null!=this.columns.getColumn("col"+e);)e++;return"col"+e};FlexSheet.prototype._hideContextMenu=function(){this._contextMenu.hide();this._tabHolder.sheetControl._contextMenu.hide()};FlexSheet.prototype._parseFromWorkbookTable=function(o,n){var i,l,r,s,a,h,u,d,c,_,g,f=n===this.selectedSheet?this:n.grid;r=(l=o.range.split(":"))[0];s=l[1];a=e.xlsx.Workbook.tableAddress(r);i=new e.grid.CellRange(a.row,a.col);h=e.xlsx.Workbook.tableAddress(s);i.row2=h.row;i.col2=h.col;if(i.bottomRow>=n.rowCount){g=i.bottomRow-n.rowCount+1;for(p=0;p<g;p++)f.rows.push(new e.grid.Row)}if(i.rightCol>=n.columnCount){g=i.rightCol-n.columnCount+1;for(p=0;p<g;p++)f.columns.push(new e.grid.Column)}if(o.columns&&o.columns.length>0){u=[];for(var p=0;p<o.columns.length;p++){d=o.columns[p];u[p]=new t.TableColumn(d.name,d.totalRowLabel,d.totalRowFunction,d.showFilterButton)}}null!=o.style&&(c=this._isBuiltInStyleName(o.style.name)?this.getBuiltInTableStyle(o.style.name):this._parseFromWorkbookTableStyle(o.style));_=new t.Table(o.name,i,c,u,{showHeaderRow:o.showHeaderRow,showTotalRow:o.showTotalRow,showBandedColumns:o.showBandedColumns,showBandedRows:o.showBandedRows,alterFirstColumn:o.alterFirstColumn,alterLastColumn:o.alterLastColumn});n.tables.push(_);return _};FlexSheet.prototype._parseFromWorkbookTableStyle=function(e){var o=new t.TableStyle(e.name);null!=e.firstBandedColumnStyle&&(o.firstBandedColumnStyle=this._parseFromWorkbookTableStyleElement(e.firstBandedColumnStyle));null!=e.firstBandedRowStyle&&(o.firstBandedRowStyle=this._parseFromWorkbookTableStyleElement(e.firstBandedRowStyle));null!=e.firstColumnStyle&&(o.firstColumnStyle=this._parseFromWorkbookTableStyleElement(e.firstColumnStyle));null!=e.firstHeaderCellStyle&&(o.firstHeaderCellStyle=this._parseFromWorkbookTableStyleElement(e.firstHeaderCellStyle));null!=e.firstTotalCellStyle&&(o.firstTotalCellStyle=this._parseFromWorkbookTableStyleElement(e.firstTotalCellStyle));null!=e.headerRowStyle&&(o.headerRowStyle=this._parseFromWorkbookTableStyleElement(e.headerRowStyle));null!=e.lastColumnStyle&&(o.lastColumnStyle=this._parseFromWorkbookTableStyleElement(e.lastColumnStyle));null!=e.lastHeaderCellStyle&&(o.lastHeaderCellStyle=this._parseFromWorkbookTableStyleElement(e.lastHeaderCellStyle));null!=e.lastTotalCellStyle&&(o.lastTotalCellStyle=this._parseFromWorkbookTableStyleElement(e.lastTotalCellStyle));null!=e.secondBandedColumnStyle&&(o.secondBandedColumnStyle=this._parseFromWorkbookTableStyleElement(e.secondBandedColumnStyle));null!=e.secondBandedRowStyle&&(o.secondBandedRowStyle=this._parseFromWorkbookTableStyleElement(e.secondBandedRowStyle));null!=e.totalRowStyle&&(o.totalRowStyle=this._parseFromWorkbookTableStyleElement(e.totalRowStyle));null!=e.wholeTableStyle&&(o.wholeTableStyle=this._parseFromWorkbookTableStyleElement(e.wholeTableStyle));return o};FlexSheet.prototype._parseFromWorkbookTableStyleElement=function(t){var o;o={fontWeight:t.font&&t.font.bold?"bold":"none",fontStyle:t.font&&t.font.italic?"italic":"none",textDecoration:t.font&&t.font.underline?"underline":"none",fontFamily:t.font&&t.font.family?t.font.family:"",fontSize:t.font&&t.font.size?t.font.size+"px":"",color:t.font&&t.font.color?t.font.color:"",backgroundColor:t.fill&&t.fill.color?t.fill.color:""};if(t.borders){if(t.borders.left){e.grid.xlsx.FlexGridXlsxConverter._parseBorderStyle(t.borders.left.style,"Left",o);o.borderLeftColor=t.borders.left.color}if(t.borders.right){e.grid.xlsx.FlexGridXlsxConverter._parseBorderStyle(t.borders.right.style,"Right",o);o.borderRightColor=t.borders.right.color}if(t.borders.top){e.grid.xlsx.FlexGridXlsxConverter._parseBorderStyle(t.borders.top.style,"Top",o);o.borderTopColor=t.borders.top.color}if(t.borders.bottom){e.grid.xlsx.FlexGridXlsxConverter._parseBorderStyle(t.borders.bottom.style,"Bottom",o);o.borderBottomColor=t.borders.bottom.color}if(t.borders.vertical){e.grid.xlsx.FlexGridXlsxConverter._parseBorderStyle(t.borders.vertical.style,"Vertical",o);o.borderVerticalColor=t.borders.vertical.color}if(t.borders.horizontal){e.grid.xlsx.FlexGridXlsxConverter._parseBorderStyle(t.borders.horizontal.style,"Horizontal",o);o.borderHorizontalColor=t.borders.horizontal.color}}null!=t.size&&(o.size=t.size);return o};FlexSheet.prototype._parseToWorkbookTable=function(t){var o,n,i=new e.xlsx.WorkbookTable,l=t.getRange(),r=t.getColumns();i.name=t.name;o=e.xlsx.Workbook.xlsxAddress(l.topRow,l.leftCol);n=e.xlsx.Workbook.xlsxAddress(l.bottomRow,l.rightCol);i.range=o+":"+n;if(null!=t.style)if(t.style.isBuiltIn){i.style=new e.xlsx.WorkbookTableStyle;i.style.name=t.style.name}else i.style=this._parseToWorkbookTableStyle(t.style);i.showBandedColumns=t.showBandedColumns;i.showBandedRows=t.showBandedRows;i.showHeaderRow=t.showHeaderRow;i.showTotalRow=t.showTotalRow;i.alterFirstColumn=t.alterFirstColumn;i.alterLastColumn=t.alterLastColumn;for(var s=0;s<r.length;s++){var a=r[s],h=new e.xlsx.WorkbookTableColumn;h.name=a.name;h.totalRowLabel=a.totalRowLabel;h.totalRowFunction=a.totalRowFunction;h.showFilterButton=a.showFilterButton;i.columns.push(h)}return i};FlexSheet.prototype._parseToWorkbookTableStyle=function(t){var o=new e.xlsx.WorkbookTableStyle;o.name=t.name;null!=t.firstBandedColumnStyle&&(o.firstBandedColumnStyle=this._parseToWorkbookTableStyleElement(t.firstBandedColumnStyle,!0));null!=t.firstBandedRowStyle&&(o.firstBandedRowStyle=this._parseToWorkbookTableStyleElement(t.firstBandedRowStyle,!0));null!=t.firstColumnStyle&&(o.firstColumnStyle=this._parseToWorkbookTableStyleElement(t.firstColumnStyle));null!=t.firstHeaderCellStyle&&(o.firstHeaderCellStyle=this._parseToWorkbookTableStyleElement(t.firstHeaderCellStyle));null!=t.firstTotalCellStyle&&(o.firstTotalCellStyle=this._parseToWorkbookTableStyleElement(t.firstTotalCellStyle));null!=t.headerRowStyle&&(o.headerRowStyle=this._parseToWorkbookTableStyleElement(t.headerRowStyle));null!=t.lastColumnStyle&&(o.lastColumnStyle=this._parseToWorkbookTableStyleElement(t.lastColumnStyle));null!=t.lastHeaderCellStyle&&(o.lastHeaderCellStyle=this._parseToWorkbookTableStyleElement(t.lastHeaderCellStyle));null!=t.lastTotalCellStyle&&(o.lastTotalCellStyle=this._parseToWorkbookTableStyleElement(t.lastTotalCellStyle));null!=t.secondBandedColumnStyle&&(o.secondBandedColumnStyle=this._parseToWorkbookTableStyleElement(t.secondBandedColumnStyle,!0));null!=t.secondBandedRowStyle&&(o.secondBandedRowStyle=this._parseToWorkbookTableStyleElement(t.secondBandedRowStyle,!0));null!=t.totalRowStyle&&(o.totalRowStyle=this._parseToWorkbookTableStyleElement(t.totalRowStyle));null!=t.wholeTableStyle&&(o.wholeTableStyle=this._parseToWorkbookTableStyleElement(t.wholeTableStyle));return o};FlexSheet.prototype._parseToWorkbookTableStyleElement=function(t,o){void 0===o&&(o=!1);var n,i=e.grid.xlsx.FlexGridXlsxConverter._parseCellStyle(t,!0);o?(n=new e.xlsx.WorkbookTableBandedStyle).size=t.size:n=new e.xlsx.WorkbookTableCommonStyle;n._deserialize(i);return n};FlexSheet.prototype._isBuiltInStyleName=function(e){var t;if(0===e.search(/TableStyleLight/i)){t=+e.substring(15);if(!isNaN(t)&&t>=1&&t<=21)return!0}else if(0===e.search(/TableStyleMedium/i)){t=+e.substring(16);if(!isNaN(t)&&t>=1&&t<=28)return!0}else if(0===e.search(/TableStyleDark/i)){t=+e.substring(14);if(!isNaN(t)&&t>=1&&t<=11)return!0}return!1};FlexSheet.prototype._getTable=function(e){for(var t=0;t<this.sheets.length;t++)for(var o=this.sheets[t].tables,n=0;n<o.length;n++){var i=o[n];if(i.name.toLowerCase()===e.toLowerCase())return i}return null};FlexSheet.prototype._checkTableHeaderRow=function(e,o){e.forEach((function(e){if(e.showHeaderRow)for(var n=e.getRange(t.TableSection.Header),i=n.row,l=n.leftCol;l<=n.rightCol;l++){var r=o.sheets[0].rows[i].cells[l];r.isDate=!1;if(null==r.value||""===r.value){var s=l-n.leftCol;r.value=e._getColumns()[s].name}}}))};FlexSheet.prototype._getThemeColor=function(t,o){var n,i=this._colorThemes[t];if(null!=o){(n=new e.Color("#"+i).getHsl())[2]=o<0?n[2]*(1+o):n[2]*(1-o)+(1-1*(1-o));return e.Color.fromHsl(n[0],n[1],n[2]).toString()}return"#"+i};FlexSheet.prototype._createBuiltInTableStyle=function(e){var t;if(0===e.search(/TableStyleLight/i)){t=+e.substring(15);if(!isNaN(t)&&t>=1&&t<=21)return t<=7?this._generateTableLightStyle1(t-1,e,!0):t<=14?this._generateTableLightStyle2(t-8,e):this._generateTableLightStyle1(t-15,e,!1)}else if(0===e.search(/TableStyleMedium/i)){t=+e.substring(16);if(!isNaN(t)&&t>=1&&t<=28)return t<=7?this._generateTableMediumStyle1(t-1,e):t<=14?this._generateTableMediumStyle2(t-8,e):t<=21?this._generateTableMediumStyle3(t-15,e):this._generateTableMediumStyle4(t-22,e)}else if(0===e.search(/TableStyleDark/i)){t=+e.substring(14);if(!isNaN(t)&&t>=1&&t<=11)return t<=7?this._generateTableDarkStyle1(t-1,e):this._generateTableDarkStyle2(t-8,e)}return null};FlexSheet.prototype._generateTableLightStyle1=function(e,o,n){var i=new t.TableStyle(o,!0),l=0===e?1:e+3,r=n?"1px":"2px",s=n?"solid":"double",a=n?"1px":"3px";i.wholeTableStyle={borderTopColor:this._getThemeColor(l),borderTopStyle:"solid",borderTopWidth:"1px",borderBottomColor:this._getThemeColor(l),borderBottomStyle:"solid",borderBottomWidth:"1px"};i.firstColumnStyle={fontWeight:"bold"};i.lastColumnStyle={fontWeight:"bold"};i.headerRowStyle={borderBottomColor:this._getThemeColor(l),borderBottomStyle:"solid",borderBottomWidth:r,fontWeight:"bold"};i.totalRowStyle={borderTopColor:this._getThemeColor(l),borderTopStyle:s,borderTopWidth:a,fontWeight:"bold"};if(0===e){i.wholeTableStyle.color=this._getThemeColor(l);i.firstColumnStyle.color=this._getThemeColor(l);i.lastColumnStyle.color=this._getThemeColor(l);i.headerRowStyle.color=this._getThemeColor(l);i.totalRowStyle.color=this._getThemeColor(l);i.firstBandedRowStyle={backgroundColor:this._getThemeColor(0,-.15)};i.firstBandedColumnStyle={backgroundColor:this._getThemeColor(0,-.15)}}else{if(n){i.wholeTableStyle.color=this._getThemeColor(l,-.25);i.firstColumnStyle.color=this._getThemeColor(l,-.25);i.lastColumnStyle.color=this._getThemeColor(l,-.25);i.headerRowStyle.color=this._getThemeColor(l,-.25);i.totalRowStyle.color=this._getThemeColor(l,-.25)}else{i.wholeTableStyle.color=this._getThemeColor(1);i.firstColumnStyle.color=this._getThemeColor(1);i.lastColumnStyle.color=this._getThemeColor(1);i.headerRowStyle.color=this._getThemeColor(1);i.totalRowStyle.color=this._getThemeColor(1)}i.firstBandedRowStyle={backgroundColor:this._getThemeColor(l,.8)};i.firstBandedColumnStyle={backgroundColor:this._getThemeColor(l,.8)}}if(!n){i.wholeTableStyle.borderLeftColor=this._getThemeColor(l);i.wholeTableStyle.borderLeftStyle="solid";i.wholeTableStyle.borderLeftWidth="1px";i.wholeTableStyle.borderRightColor=this._getThemeColor(l);i.wholeTableStyle.borderRightStyle="solid";i.wholeTableStyle.borderRightWidth="1px";i.wholeTableStyle.borderHorizontalColor=this._getThemeColor(l);i.wholeTableStyle.borderHorizontalStyle="solid";i.wholeTableStyle.borderHorizontalWidth="1px";i.wholeTableStyle.borderVerticalColor=this._getThemeColor(l);i.wholeTableStyle.borderVerticalStyle="solid";i.wholeTableStyle.borderVerticalWidth="1px"}return i};FlexSheet.prototype._generateTableLightStyle2=function(e,o){var n=new t.TableStyle(o,!0),i=0===e?1:e+3;n.wholeTableStyle={borderTopColor:this._getThemeColor(i),borderTopStyle:"solid",borderTopWidth:"1px",borderBottomColor:this._getThemeColor(i),borderBottomStyle:"solid",borderBottomWidth:"1px",borderLeftColor:this._getThemeColor(i),borderLeftStyle:"solid",borderLeftWidth:"1px",borderRightColor:this._getThemeColor(i),borderRightStyle:"solid",borderRightWidth:"1px",color:this._getThemeColor(1)};n.firstBandedRowStyle={borderTopColor:this._getThemeColor(i),borderTopStyle:"solid",borderTopWidth:"1px"};n.secondBandedRowStyle={borderTopColor:this._getThemeColor(i),borderTopStyle:"solid",borderTopWidth:"1px"};n.firstBandedColumnStyle={borderLeftColor:this._getThemeColor(i),borderLeftStyle:"solid",borderLeftWidth:"1px"};n.secondBandedColumnStyle={borderLeftColor:this._getThemeColor(i),borderLeftStyle:"solid",borderLeftWidth:"1px"};n.firstColumnStyle={fontWeight:"bold",color:this._getThemeColor(1)};n.lastColumnStyle={fontWeight:"bold",color:this._getThemeColor(1)};n.headerRowStyle={backgroundColor:this._getThemeColor(i),fontWeight:"bold",color:this._getThemeColor(0)};n.totalRowStyle={borderTopColor:this._getThemeColor(i),borderTopStyle:"double",borderTopWidth:"3px",fontWeight:"bold",color:this._getThemeColor(1)};return n};FlexSheet.prototype._generateTableMediumStyle1=function(e,o){var n=new t.TableStyle(o,!0),i=0===e?1:e+3;n.wholeTableStyle={borderTopStyle:"solid",borderTopWidth:"1px",borderBottomStyle:"solid",borderBottomWidth:"1px",borderLeftStyle:"solid",borderLeftWidth:"1px",borderRightStyle:"solid",borderRightWidth:"1px",borderHorizontalStyle:"solid",borderHorizontalWidth:"1px",color:this._getThemeColor(1)};if(0===e){n.wholeTableStyle.borderTopColor=this._getThemeColor(i);n.wholeTableStyle.borderBottomColor=this._getThemeColor(i);n.wholeTableStyle.borderLeftColor=this._getThemeColor(i);n.wholeTableStyle.borderRightColor=this._getThemeColor(i);n.wholeTableStyle.borderHorizontalColor=this._getThemeColor(i);n.firstBandedRowStyle={backgroundColor:this._getThemeColor(0,-.15)};n.firstBandedColumnStyle={backgroundColor:this._getThemeColor(0,-.15)}}else{n.wholeTableStyle.borderTopColor=this._getThemeColor(i,.4);n.wholeTableStyle.borderBottomColor=this._getThemeColor(i,.4);n.wholeTableStyle.borderLeftColor=this._getThemeColor(i,.4);n.wholeTableStyle.borderRightColor=this._getThemeColor(i,.4);n.wholeTableStyle.borderHorizontalColor=this._getThemeColor(i,.4);n.firstBandedRowStyle={backgroundColor:this._getThemeColor(i,.8)};n.firstBandedColumnStyle={backgroundColor:this._getThemeColor(i,.8)}}n.firstColumnStyle={fontWeight:"bold",color:this._getThemeColor(1)};n.lastColumnStyle={fontWeight:"bold",color:this._getThemeColor(1)};n.headerRowStyle={backgroundColor:this._getThemeColor(i),fontWeight:"bold",color:this._getThemeColor(0)};n.totalRowStyle={borderTopColor:this._getThemeColor(i),borderTopStyle:"double",borderTopWidth:"3px",fontWeight:"bold",color:this._getThemeColor(1)};return n};FlexSheet.prototype._generateTableMediumStyle2=function(e,o){var n=new t.TableStyle(o,!0),i=0===e?1:e+3;n.wholeTableStyle={borderVerticalStyle:"solid",borderVerticalWidth:"1px",borderVerticalColor:this._getThemeColor(0),borderHorizontalStyle:"solid",borderHorizontalWidth:"1px",borderHorizontalColor:this._getThemeColor(0),color:this._getThemeColor(1)};if(0===e){n.wholeTableStyle.backgroundColor=this._getThemeColor(0,-.15);n.firstBandedRowStyle={backgroundColor:this._getThemeColor(0,-.35)};n.firstBandedColumnStyle={backgroundColor:this._getThemeColor(0,-.35)}}else{n.wholeTableStyle.backgroundColor=this._getThemeColor(i,.8);n.firstBandedRowStyle={backgroundColor:this._getThemeColor(i,.6)};n.firstBandedColumnStyle={backgroundColor:this._getThemeColor(i,.6)}}n.firstColumnStyle={fontWeight:"bold",color:this._getThemeColor(0),backgroundColor:this._getThemeColor(i)};n.lastColumnStyle={fontWeight:"bold",color:this._getThemeColor(0),backgroundColor:this._getThemeColor(i)};n.headerRowStyle={borderBottomColor:this._getThemeColor(0),borderBottomStyle:"solid",borderBottomWidth:"3px",backgroundColor:this._getThemeColor(i),fontWeight:"bold",color:this._getThemeColor(0)};n.totalRowStyle={borderTopColor:this._getThemeColor(0),borderTopStyle:"solid",borderTopWidth:"3px",backgroundColor:this._getThemeColor(i),fontWeight:"bold",color:this._getThemeColor(0)};return n};FlexSheet.prototype._generateTableMediumStyle3=function(e,o){var n=new t.TableStyle(o,!0),i=0===e?1:e+3;n.wholeTableStyle={borderTopStyle:"solid",borderTopWidth:"2px",borderTopColor:this._getThemeColor(1),borderBottomStyle:"solid",borderBottomWidth:"2px",borderBottomColor:this._getThemeColor(1),color:this._getThemeColor(1)};if(0===e){n.wholeTableStyle.borderLeftColor=this._getThemeColor(1);n.wholeTableStyle.borderLeftStyle="solid";n.wholeTableStyle.borderLeftWidth="1px";n.wholeTableStyle.borderRightColor=this._getThemeColor(1);n.wholeTableStyle.borderRightStyle="solid";n.wholeTableStyle.borderRightWidth="1px";n.wholeTableStyle.borderVerticalColor=this._getThemeColor(1);n.wholeTableStyle.borderVerticalStyle="solid";n.wholeTableStyle.borderVerticalWidth="1px";n.wholeTableStyle.borderHorizontalColor=this._getThemeColor(1);n.wholeTableStyle.borderHorizontalStyle="solid";n.wholeTableStyle.borderHorizontalWidth="1px"}n.firstBandedRowStyle={backgroundColor:this._getThemeColor(0,-.35)};n.firstBandedColumnStyle={backgroundColor:this._getThemeColor(0,-.35)};n.firstColumnStyle={fontWeight:"bold",color:this._getThemeColor(0),backgroundColor:this._getThemeColor(i)};n.lastColumnStyle={fontWeight:"bold",color:this._getThemeColor(0),backgroundColor:this._getThemeColor(i)};n.headerRowStyle={borderBottomColor:this._getThemeColor(1),borderBottomStyle:"solid",borderBottomWidth:"2px",backgroundColor:this._getThemeColor(i),fontWeight:"bold",color:this._getThemeColor(0)};n.totalRowStyle={borderTopColor:this._getThemeColor(1),borderTopStyle:"double",borderTopWidth:"3px"};return n};FlexSheet.prototype._generateTableMediumStyle4=function(e,o){var n=new t.TableStyle(o,!0),i=0===e?1:e+3;n.wholeTableStyle={borderTopStyle:"solid",borderTopWidth:"1px",borderBottomStyle:"solid",borderBottomWidth:"1px",borderLeftStyle:"solid",borderLeftWidth:"1px",borderRightStyle:"solid",borderRightWidth:"1px",borderVerticalStyle:"solid",borderVerticalWidth:"1px",borderHorizontalStyle:"solid",borderHorizontalWidth:"1px",color:this._getThemeColor(1)};if(0===e){n.wholeTableStyle.borderTopColor=this._getThemeColor(i);n.wholeTableStyle.borderBottomColor=this._getThemeColor(i);n.wholeTableStyle.borderLeftColor=this._getThemeColor(i);n.wholeTableStyle.borderRightColor=this._getThemeColor(i);n.wholeTableStyle.borderVerticalColor=this._getThemeColor(i);n.wholeTableStyle.borderHorizontalColor=this._getThemeColor(i);n.wholeTableStyle.backgroundColor=this._getThemeColor(0,-.15);n.firstBandedRowStyle={backgroundColor:this._getThemeColor(0,-.35)};n.firstBandedColumnStyle={backgroundColor:this._getThemeColor(0,-.35)}}else{n.wholeTableStyle.borderTopColor=this._getThemeColor(i,.4);n.wholeTableStyle.borderBottomColor=this._getThemeColor(i,.4);n.wholeTableStyle.borderLeftColor=this._getThemeColor(i,.4);n.wholeTableStyle.borderRightColor=this._getThemeColor(i,.4);n.wholeTableStyle.borderVerticalColor=this._getThemeColor(i,.4);n.wholeTableStyle.borderHorizontalColor=this._getThemeColor(i,.4);n.wholeTableStyle.backgroundColor=this._getThemeColor(i,.8);n.firstBandedRowStyle={backgroundColor:this._getThemeColor(i,.6)};n.firstBandedColumnStyle={backgroundColor:this._getThemeColor(i,.6)}}n.firstColumnStyle={fontWeight:"bold",color:this._getThemeColor(1)};n.lastColumnStyle={fontWeight:"bold",color:this._getThemeColor(1)};n.headerRowStyle={fontWeight:"bold",color:this._getThemeColor(1)};n.totalRowStyle={borderTopColor:this._getThemeColor(i),borderTopStyle:"solid",borderTopWidth:"2px",fontWeight:"bold",color:this._getThemeColor(1)};return n};FlexSheet.prototype._generateTableDarkStyle1=function(e,o){var n=new t.TableStyle(o,!0),i=0===e?1:e+3,l=0===e?.25:-.25;n.wholeTableStyle={color:this._getThemeColor(0)};n.firstBandedRowStyle={backgroundColor:this._getThemeColor(i,l)};n.firstBandedColumnStyle={backgroundColor:this._getThemeColor(i,l)};n.firstColumnStyle={borderRightColor:this._getThemeColor(0),borderRightStyle:"solid",borderRightWidth:"2px",fontWeight:"bold",color:this._getThemeColor(0),backgroundColor:this._getThemeColor(i,l)};n.lastColumnStyle={borderLeftColor:this._getThemeColor(0),borderLeftStyle:"solid",borderLeftWidth:"2px",fontWeight:"bold",color:this._getThemeColor(0),backgroundColor:this._getThemeColor(i,l)};n.headerRowStyle={borderBottomColor:this._getThemeColor(0),borderBottomStyle:"solid",borderBottomWidth:"2px",fontWeight:"bold",color:this._getThemeColor(0),backgroundColor:this._getThemeColor(1)};n.totalRowStyle={borderTopColor:this._getThemeColor(0),borderTopStyle:"solid",borderTopWidth:"2px",fontWeight:"bold",color:this._getThemeColor(0)};if(0===e){n.wholeTableStyle.backgroundColor=this._getThemeColor(i,.5);n.totalRowStyle.backgroundColor=this._getThemeColor(i,.15)}else{n.wholeTableStyle.backgroundColor=this._getThemeColor(i);n.totalRowStyle.backgroundColor=this._getThemeColor(i,-.5)}return n};FlexSheet.prototype._generateTableDarkStyle2=function(e,o){var n=new t.TableStyle(o,!0),i=0===e?0:2*e+2,l=0===e?1:2*e+3,r=0===e?-.15:.8;n.wholeTableStyle={backgroundColor:this._getThemeColor(i,r)};n.firstBandedRowStyle={backgroundColor:this._getThemeColor(i,r-.2)};n.firstBandedColumnStyle={backgroundColor:this._getThemeColor(i,r-.2)};n.firstColumnStyle={fontWeight:"bold",color:this._getThemeColor(1)};n.lastColumnStyle={fontWeight:"bold",color:this._getThemeColor(1)};n.headerRowStyle={color:this._getThemeColor(0),backgroundColor:this._getThemeColor(l)};n.totalRowStyle={borderTopColor:this._getThemeColor(1),borderTopStyle:"double",borderTopWidth:"3px",fontWeight:"bold",color:this._getThemeColor(1)};return n};FlexSheet._getHeaderRowText=function(t){var o=t.binding,n=t._hdr;null!=n&&""!=n.trim()||(n=e.toHeaderCase(o||""));return n};FlexSheet._toOADate=function(e){var t,o=new Date(1900,0,0),n=Date.UTC(1900,0,0),i=o.getTime()-n-6e4*o.getTimezoneOffset(),l=6e4*(e.getTimezoneOffset()-o.getTimezoneOffset());t=(e.getTime()-o.getTime()-(0!==l?l-i:0))/864e5;return t+=t>59?1:0};FlexSheet._fromOADate=function(e){var t,o,n,i=new Date(1900,0,0),l=Date.UTC(1900,0,0),r=i.getTime()-l-6e4*i.getTimezoneOffset();o=e>59?1:0;return 0!=(t=6e4*((n=new Date(i.getTime()+864e5*(e-o))).getTimezoneOffset()-i.getTimezoneOffset()))?new Date(i.getTime()+t-r+864e5*(e-o)):n};FlexSheet.controlTemplate='<div style="width:100%;height:100%"><div wj-part="container" style="width:100%">'+e.grid.FlexGrid.controlTemplate+'</div><div wj-part="tab-holder" class="wj-tabholder" style="width:100%; min-width:100px"></div><div wj-part="context-menu" style="display:none;z-index:100"></div></div>';return FlexSheet}(e.grid.FlexGrid);t.FlexSheet=n;var i=function(e){__extends(DraggingRowColumnEventArgs,e);function DraggingRowColumnEventArgs(t,o,n){var i=e.call(this)||this;i._draggingRange=t;i._isDraggingRows=o;i._isShiftKey=n;return i}Object.defineProperty(DraggingRowColumnEventArgs.prototype,"draggingRange",{get:function(){return this._draggingRange},enumerable:!0,configurable:!0});Object.defineProperty(DraggingRowColumnEventArgs.prototype,"isDraggingRows",{get:function(){return this._isDraggingRows},enumerable:!0,configurable:!0});Object.defineProperty(DraggingRowColumnEventArgs.prototype,"isShiftKey",{get:function(){return this._isShiftKey},enumerable:!0,configurable:!0});return DraggingRowColumnEventArgs}(e.EventArgs);t.DraggingRowColumnEventArgs=i;var l=function(e){__extends(DroppingRowColumnEventArgs,e);function DroppingRowColumnEventArgs(t,o){var n=e.call(this)||this;n._droppingRange=t;n._isDroppingRows=o;return n}Object.defineProperty(DroppingRowColumnEventArgs.prototype,"droppingRange",{get:function(){return this._droppingRange},enumerable:!0,configurable:!0});Object.defineProperty(DroppingRowColumnEventArgs.prototype,"isDroppingRows",{get:function(){return this._isDroppingRows},enumerable:!0,configurable:!0});return DroppingRowColumnEventArgs}(e.CancelEventArgs);t.DroppingRowColumnEventArgs=l;var r=function(e){__extends(UnknownFunctionEventArgs,e);function UnknownFunctionEventArgs(t,o){var n=e.call(this)||this;n._funcName=t;n._params=o;return n}Object.defineProperty(UnknownFunctionEventArgs.prototype,"funcName",{get:function(){return this._funcName},enumerable:!0,configurable:!0});Object.defineProperty(UnknownFunctionEventArgs.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0});return UnknownFunctionEventArgs}(e.EventArgs);t.UnknownFunctionEventArgs=r;var s=function(t){__extends(RowColumnChangedEventArgs,t);function RowColumnChangedEventArgs(o,n,i,l){var r=t.call(this)||this;if(e.isArray(o)){r._ranges=o;r._added=n;if(1===o.length){var s=o[0];if(i){r._index=s.leftCol;r._count=s.columnSpan}else{r._index=s.topRow;r._count=s.rowSpan}}else{r._index=-1;r._count=-1}}else{r._index=o;r._count=n;r._added=i;r._ranges=l?[new e.grid.CellRange(-1,r._index,-1,r._index+r._count-1)]:[new e.grid.CellRange(r._index,-1,r._index+r._count-1,-1)]}return r}Object.defineProperty(RowColumnChangedEventArgs.prototype,"ranges",{get:function(){return this._ranges},enumerable:!0,configurable:!0});Object.defineProperty(RowColumnChangedEventArgs.prototype,"index",{get:function(){return this._index},enumerable:!0,configurable:!0});Object.defineProperty(RowColumnChangedEventArgs.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0});Object.defineProperty(RowColumnChangedEventArgs.prototype,"added",{get:function(){return this._added},enumerable:!0,configurable:!0});Object.defineProperty(RowColumnChangedEventArgs.prototype,"isAdd",{get:function(){e._deprecated("RowColumnChangedEventArgs.isAdd","RowColumnChangedEventArgs.added");return this._added},enumerable:!0,configurable:!0});return RowColumnChangedEventArgs}(e.EventArgs);t.RowColumnChangedEventArgs=s;var a=function(e){__extends(AutoFillingEventArgs,e);function AutoFillingEventArgs(t,o){var n=e.call(this)||this;n._range=t;n._op=o;return n}Object.defineProperty(AutoFillingEventArgs.prototype,"range",{get:function(){return this._range},enumerable:!0,configurable:!0});Object.defineProperty(AutoFillingEventArgs.prototype,"operation",{get:function(){return this._op},enumerable:!0,configurable:!0});return AutoFillingEventArgs}(e.CancelEventArgs);t.AutoFillingEventArgs=a;var h=function(e){__extends(AutoFilledEventArgs,e);function AutoFilledEventArgs(t,o){var n=e.call(this)||this;n._range=t;n._op=o;return n}Object.defineProperty(AutoFilledEventArgs.prototype,"range",{get:function(){return this._range},enumerable:!0,configurable:!0});Object.defineProperty(AutoFilledEventArgs.prototype,"operation",{get:function(){return this._op},enumerable:!0,configurable:!0});return AutoFilledEventArgs}(e.EventArgs);t.AutoFilledEventArgs=h;var u=function(t){__extends(FlexSheetPanel,t);function FlexSheetPanel(e,o,n,i,l){var r=t.call(this,e,o,n,i,l)||this;r._drkColors={};return r}FlexSheetPanel.prototype.getSelectedState=function(o,n,i){if(this.grid){var l=this.grid.selectedSheet,r=l?l.selectionRanges:null,s=r?r.length:0,a=t.prototype.getSelectedState.call(this,o,n,i);if(a===e.grid.SelectedState.None&&s>0)for(var h=this.grid.getMergedRange(this,o,n),u=this.columns.length-1,d=this.rows.length-1,c=0;c<r.length;c++){var _=r[c];if(_&&_ instanceof e.grid.CellRange){if(this.cellType===e.grid.CellType.Cell){if(h){if(h.contains(_.row,_.col))return c!==s-1||this.grid._isClicking?e.grid.SelectedState.Selected:this.grid.showMarquee?e.grid.SelectedState.None:e.grid.SelectedState.Cursor;if(h.intersects(_))return e.grid.SelectedState.Selected}if(_.row===o&&_.col===n)return c!==s-1||this.grid._isClicking?e.grid.SelectedState.Selected:this.grid.showMarquee?e.grid.SelectedState.None:e.grid.SelectedState.Cursor;if(_.contains(o,n))return e.grid.SelectedState.Selected}if(this.cellType===e.grid.CellType.RowHeader&&this.grid.showSelectedHeaders&e.grid.HeadersVisibility.Row&&n===u&&_.containsRow(o))return e.grid.SelectedState.Selected;if(this.cellType===e.grid.CellType.ColumnHeader&&this.grid.showSelectedHeaders&e.grid.HeadersVisibility.Column&&o===d&&_.containsColumn(n))return e.grid.SelectedState.Selected}}return a}};FlexSheetPanel.prototype.getCellData=function(o,i,l){if(e.isString(i)&&(i=this.columns.indexOf(i))<0)throw"Invalid column name or binding.";if(o>=this.rows.length||e.asNumber(i,!1,!0)>=this.columns.length)return null;if(this.cellType===e.grid.CellType.RowHeader)return o+1+"";var r=this.columns[e.asNumber(i,!1,!0)],s=this.grid?this.grid._getBindingColumn(this,o,r):r,a=this.grid;if(this.cellType===e.grid.CellType.ColumnHeader){var h=this.rows[o];if(h&&h._ubv&&null!=h._ubv[r._hash])return t.prototype.getCellData.call(this,o,i,l);var u=s.header;return null==s._hdr||s._hdr==s._orgHdr||u===s.binding||u===e.toHeaderCase(s.binding)?n.convertNumberToAlpha(i):u}if(l&&(!s||!s.dataMap)){if(_isEditingCell(this.grid,o,i)){var d=t.prototype.getCellData.call(this,o,i,!1);return e.Globalize.format(d,null)}var c=a&&a._getCellStyle(o,i);if(c&&c.format){d=t.prototype.getCellData.call(this,o,i,!1);if(e.isDate(d)||e.isNumber(d))return e.Globalize.format(d,c.format)}}return t.prototype.getCellData.call(this,o,i,l)};FlexSheetPanel.prototype.setCellData=function(o,n,i,l,r){void 0===l&&(l=!0);void 0===r&&(r=!0);if(o>=this.rows.length||n>=this.columns.length)return!1;var s,a=this.grid?this.grid._getBindingColumn(this,o,this.columns[n]):this.columns[n],h=this.rows[o];if(i instanceof f){s=i.format;i=i.value}this.grid._isPasting&&(l=!0);var u=e.isString(i);if(this.grid&&this.grid.selectedSheet){var c=this.grid.selectedSheet.findTable(o,n);if(c&&c._isHeaderRow(o)){if(null==i||u&&e.isNullOrWhiteSpace(i)&&!a.dataMap)return;if(!(h instanceof d)){i=a.dataType===e.DataType.Boolean&&e.isBoolean(i)?i:i.toString();c._attached&&this.grid._updateFormulasTableColumn(c,n,this.getCellData(o,n,!1)+"",i+"");return t.prototype.setCellData.call(this,o,n,i,!1,r)}h._ubv[a._hash]=i.toString()}}var _=u&&"'"===i[0],g=u&&_isFormula(i);if(l&&i&&a.dataType!==e.DataType.String&&u&&!_&&!g){var p=e.culture.Globalize;if(this.getCellData(o,n,!0)===i)return!0;var w=this.grid?this.grid._getCellStyle(o,n):null,m=s||w&&w.format||a.format,C=null;m&&/[yYMhsmt\:-]/.test(m)&&!/[pc]/.test(m)&&(C=e.Globalize.parseDate(i,m));null==C&&i.indexOf(p.calendar["/"])>=0&&(C=e.Globalize.parseDate(i,null));if(C)i=C;else{var S=!1,b=!1;if(e.isNullOrWhiteSpace(i)||!(b="%"===i[i.length-1])&&!(S=i.indexOf(p.numberFormat.currency.symbol)>=0)&&/[^-\d,\.]/.test(i))a.dataType===e.DataType.Boolean&&(i=e.changeType(i,e.DataType.Boolean,null));else{var y=e.changeType(i,e.DataType.Number,"");if(e.isNumber(y)){i=y;m||a.dataType&&a.dataType!==e.DataType.Number||(S?this.grid.applyCellsStyle({format:"C"+(e.isInt(i)?"0":"")},[new e.grid.CellRange(o,n)]):b&&this.grid.applyCellsStyle({format:"P"+(e.isInt(100*i)?"0":"")},[new e.grid.CellRange(o,n)]))}else l=!1}}}(g||_||!a.dataType)&&(l=!1);if(!(h instanceof d))return t.prototype.setCellData.call(this,o,n,i,l,r);h._ubv[a._hash]=i};FlexSheetPanel.prototype._renderCell=function(o,n,i,l,r,s){var a=n*this.grid.columns.length+i,h=this.grid.getMergedRange(this,n,i),u=t.prototype._renderCell.call(this,o,n,i,l,r,s);if(this.cellType!==e.grid.CellType.Cell)return u;if(h&&a>h.topRow*this.grid.columns.length+h.leftCol)return u;if(this.columns[i].renderSize<=0&&(!h||h.getRenderSize(this).width<=0))return u;var d=o.childNodes[s];if(d){var c=this.grid.selectedSheet;if(c&&!_isEditingCell(this.grid,n,i)){var _=c.findTable(n,i);_&&_._updateCell(n,i,d)}var g=c?c._styledCells[a]:null,f=void 0;if(e.hasClass(d,"wj-state-selected")||(f=e.hasClass(d,"wj-state-multi-selected"))){g&&g.backgroundColor&&(d.style.backgroundColor="");g&&g.color&&(d.style.color="");f&&g&&g.backgroundColor&&(d.style.backgroundColor=this._darker(g.backgroundColor))}else if(g){""!==g.backgroundColor&&(d.style.backgroundColor=g.backgroundColor);""!==g.color&&(d.style.color=g.color)}}return u};FlexSheetPanel.prototype._darker=function(t){var o=this._drkColors[t];if(!o){var n=new e.Color(t).getHsl();this._drkColors[t]=o=e.Color.fromHsl(n[0],n[1],.75*n[2]).toString()}return o};return FlexSheetPanel}(e.grid.GridPanel);t.FlexSheetPanel=u;var d=function(e){__extends(HeaderRow,e);function HeaderRow(){var t=e.call(this)||this;t.isReadOnly=!0;return t}return HeaderRow}(e.grid.Row);t.HeaderRow=d;var c,_=function(){function DefinedName(e,t,o,n){this._owner=e;this._name=t;this._value=o;if(null!=n){if(!e._validateSheetName(n))throw"The sheet name:("+n+") does not exist in FlexSheet.";this._sheetName=n}}Object.defineProperty(DefinedName.prototype,"name",{get:function(){return this._name},set:function(e){var t;if(this._name!==e){if(this._owner._checkExistDefinedName(e,this._sheetName))throw"The "+e+" already existed in definedNames.";t=this._name;this._name=e;this._owner._updateFormulasWithNameUpdating(t,this._name)}},enumerable:!0,configurable:!0});Object.defineProperty(DefinedName.prototype,"value",{get:function(){return this._value},set:function(e){this._value!==e&&(this._value=e)},enumerable:!0,configurable:!0});Object.defineProperty(DefinedName.prototype,"sheetName",{get:function(){return this._sheetName},enumerable:!0,configurable:!0});return DefinedName}();t.DefinedName=_;function _isFormula(e){return e&&"string"==typeof e&&e.length>1&&"="===e[0]&&"="!==e[1]}t._isFormula=_isFormula;function _isEditingCell(e,t,o){var n=e.editRange;return n&&n.contains(t,o)}t._isEditingCell=_isEditingCell;function _isExclusiveNumericFormat(e){if(e){var t=e.match(/^[cdefgnprx](\d?)/i);if(t){var o=t[0][0].toLowerCase();return"d"!==o&&"e"!==o&&"f"!==o&&"g"!==o||!!t[1]}}return!1}!function(e){e[e.CopyFormat=1]="CopyFormat";e[e.CopyContent=2]="CopyContent";e[e.FillSeries=4]="FillSeries"}(c=t.AutoFillOperation||(t.AutoFillOperation={}));var g=function(){function _RangesHelper(){}_RangesHelper.validateRowRanges=function(e,t){return this._validateCellRanges(e,t,"topRow","bottomRow","row2")};_RangesHelper.excludeRow=function(t,o){if(t&&t.length){for(var n=0;n<t.length;n++){var i=t[n];if(i.containsRow(o))if(1===i.rowSpan){t.splice(n);n--}else if(i.topRow===o)i.setRange(i.topRow+1,i.col,i.bottomRow,i.col2);else if(i.bottomRow===o)i.setRange(i.topRow,i.col,i.bottomRow-1,i.col2);else{t.splice(n,1,new e.grid.CellRange(i.topRow,i.col,o-1,i.col2),new e.grid.CellRange(o+1,i.col,i.bottomRow,i.col2));n++}}return t}};_RangesHelper.validateColumnRanges=function(e,t){return this._validateCellRanges(e,t,"leftCol","rightCol","col2")};_RangesHelper._validateCellRanges=function(e,t,o,n,i){var l=(e=e.filter((function(e){return e&&e[o]>=0&&e[n]>=0&&e[o]<t&&e[n]<t}))).length;if(l>1){for(var r=[],s=(e=e.sort((function(e,t){return t[o]>=e[o]&&t[n]<=e[n]?-1:e[o]-t[o]})))[0].clone(),a=1;a<l;a++){var h=e[a];if(h[o]>=s[o]&&h[n]<=s[n]);else if(h[o]<=s[n]+1)s[i]=h[n];else{r.push(s);s=h.clone()}a===l-1&&r.push(s)}e=r}return e};return _RangesHelper}(),f=function f(e,t){this.value=e;this.format=t}})((t=e.grid||(e.grid={})).sheet||(t.sheet={}))}(wijmo||(wijmo={}));!function(e){!function(t){!function(t){"use strict";var o=function(){function UndoStack(o){this.MAX_STACK_SIZE=500;this._stack=[];this._pointer=-1;this._resizingTriggered=!1;this.undoStackChanged=new e.Event;var n=this;n._owner=o;n._owner.prepareCellForEdit.addHandler(n._initCellEditAction,n);n._owner.cellEditEnded.addHandler((function(e,o){n._pendingAction&&(!o.data||46!==o.data.keyCode&&8!==o.data.keyCode)&&n._pendingAction instanceof t._EditAction&&!n._pendingAction.isPaste&&n._afterProcessCellEditAction(n)}),n);n._owner.pasting.addHandler(n._initCellEditActionForPasting,n);n._owner.pastingCell.addHandler((function(e,o){n._pendingAction&&(n._pendingAction instanceof t._EditAction?n._pendingAction.updateForPasting(o.range):n._pendingAction instanceof t._CutAction&&n._pendingAction.updateForPasting(o.range))}),n);n._owner.pasted.addHandler((function(){if(n._pendingAction)if(n._pendingAction instanceof t._EditAction&&n._pendingAction.isPaste)n._afterProcessCellEditAction(n);else if(n._pendingAction instanceof t._CutAction){n._pendingAction.saveNewState();n._addAction(n._pendingAction);n._pendingAction=null}}),n);n._owner.resizingColumn.addHandler((function(e,o){if(0!==n.stackSize&&n._owner.selectedSheet&&!n._resizingTriggered){n._pendingAction=new t._ColumnResizeAction(n._owner,o.panel,o.col);n._resizingTriggered=!0}}),n);n._owner.resizedColumn.addHandler((function(e,o){n._pendingAction instanceof t._ColumnResizeAction&&n._pendingAction.saveNewState()&&n._addAction(n._pendingAction);n._pendingAction=null;n._resizingTriggered=!1}),n);n._owner.resizingRow.addHandler((function(e,o){if(0!==n.stackSize&&n._owner.selectedSheet&&!n._resizingTriggered){n._pendingAction=new t._RowResizeAction(n._owner,o.panel,o.row);n._resizingTriggered=!0}}),n);n._owner.resizedRow.addHandler((function(e,o){n._pendingAction instanceof t._RowResizeAction&&n._pendingAction.saveNewState()&&n._addAction(n._pendingAction);n._pendingAction=null;n._resizingTriggered=!1}),n);n._owner.draggingRowColumn.addHandler((function(e,o){0!==n.stackSize&&n._owner.selectedSheet&&o.isShiftKey&&(o.isDraggingRows?n._pendingAction=new t._RowsChangedAction(n._owner):n._pendingAction=new t._ColumnsChangedAction(n._owner))}),n);n._owner.endDroppingRowColumn.addHandler((function(e,t){!t.cancel&&n._pendingAction&&n._pendingAction.saveNewState()&&n._addAction(n._pendingAction);n._pendingAction=null}),n)}Object.defineProperty(UndoStack.prototype,"stackSize",{get:function(){return null==this._stackSize?this.MAX_STACK_SIZE:this._stackSize},set:function(t){e.isNumber(t)&&(t<0?this._stackSize=0:t>this.MAX_STACK_SIZE?this._stackSize=this.MAX_STACK_SIZE:this._stackSize=Math.floor(t))},enumerable:!0,configurable:!0});Object.defineProperty(UndoStack.prototype,"canUndo",{get:function(){return this._pointer>-1&&this._pointer<this._stack.length},enumerable:!0,configurable:!0});Object.defineProperty(UndoStack.prototype,"canRedo",{get:function(){return this._pointer+1>-1&&this._pointer+1<this._stack.length},enumerable:!0,configurable:!0});UndoStack.prototype.onUndoStackChanged=function(e){this.undoStackChanged.raise(this,e)};UndoStack.prototype.undo=function(){var e;if(this.canUndo){e=this._stack[this._pointer];this._beforeUndoRedo(e);e.undo();this._pointer--;this.onUndoStackChanged()}};UndoStack.prototype.redo=function(){var e;if(this.canRedo){this._pointer++;e=this._stack[this._pointer];this._beforeUndoRedo(e);e.redo();this.onUndoStackChanged()}};UndoStack.prototype.clear=function(){this._stack.length=0};UndoStack.prototype._addAction=function(e){this._stack.length>0&&this._stack.length>this._pointer+1&&this._stack.splice(this._pointer+1,this._stack.length-this._pointer-1);this._stack.length>=this.stackSize&&this._stack.splice(0,this._stack.length-this.stackSize+1);this._pointer=this._stack.length;this._stack.push(e);this.onUndoStackChanged()};UndoStack.prototype._pop=function(){var e;if(this._pointer<0)return null;e=this._stack[this._pointer];this._pointer--;return e};UndoStack.prototype._updateCurrentAction=function(e){var t;this._pointer<0||(t=this._stack[this._pointer])instanceof e&&t.saveNewState()};UndoStack.prototype._initCellEditAction=function(e,o){0!==this.stackSize&&this._owner.selectedSheet&&(this._pendingAction=new t._EditAction(this._owner,o.range))};UndoStack.prototype._initCellEditActionForPasting=function(){if(0!==this.stackSize&&this._owner.selectedSheet)if(this._owner._isCutting)this._pendingAction=new t._CutAction(this._owner);else{this._pendingAction=new t._EditAction(this._owner);this._pendingAction.markIsPaste()}};UndoStack.prototype._afterProcessCellEditAction=function(e){if(e._pendingAction){e._pendingAction instanceof t._EditAction&&e._pendingAction.saveNewState()&&e._addAction(this._pendingAction);e._pendingAction=null}};UndoStack.prototype._beforeUndoRedo=function(e){this._owner.selectedSheetIndex=e.sheetIndex};return UndoStack}();t.UndoStack=o}(t.sheet||(t.sheet={}))}(e.grid||(e.grid={}))}(wijmo||(wijmo={}));!function(e){!function(t){!function(t){"use strict";var o=function(o){__extends(FlexSheetValueFilterEditor,o);function FlexSheetValueFilterEditor(){return null!==o&&o.apply(this,arguments)||this}FlexSheetValueFilterEditor.prototype.updateEditor=function(){var n=this.filter.column,i=n.grid,l=n.index,r=[],s={},a=this.filter.showValues,h=i.filter.getColumnFilter(n,!1).conditionFilter,u=h.condition1.operator,d=h.condition2.operator;if(this.filter.uniqueValues||null!=i.itemsSource&&null!=i.childItemsPath)o.prototype.updateEditor.call(this);else{for(var c=0;c<i.rows.length;c++){var _=i.rows[c];if(!(_ instanceof t.HeaderRow||_ instanceof e.grid.GroupRow||_ instanceof e.grid._NewRowTemplate)){this.filter.showValues=null;h.condition1.operator=null;h.condition2.operator=null;var g=i.filter._filter(c);this.filter.showValues=a;h.condition1.operator=u;h.condition2.operator=d;if((_.visible||g)&&(_.visible||!this.filter.apply(c)||!h.apply(c))){var f=c,p=l,w=i.getMergedRange(i.cells,f,p);if(w){if(w.leftCol!==l)continue;f=w.topRow;p=w.leftCol}var m=i.getCellValue(f,p),C=void 0;C=this.filter.dataMap?this.filter.dataMap.getDisplayValue(m):i.getCellValue(f,p,!0);m=""===m?null:m;var S=i.getCellData(f,p,!0),b=void 0;if(!s[C]){s[C]=!0;b=S&&"="===S[0]?c+"_"+l:"";r.push({value:m,text:C,cellRef:b})}}}}var y=this.filter.showValues;if(y&&0!=Object.keys(y).length){for(var v in y)for(c=0;c<r.length;c++)if(y[v]&&""!==r[c].cellRef&&r[c].cellRef===y[v].cellRef){y[r[c].text]={show:!0,cellRef:r[c].cellRef};r[c].show=!0;r[c].text!=v&&delete y[v]}else if(r[c].text==v){r[c].show=!0;break}}else for(var c=0;c<r.length;c++)r[c].show=!0;this._lbValues.isContentHtml=n.isContentHtml;this._cmbFilter.text=this.filter.filterText;this._filterText=this._cmbFilter.text.toLowerCase();this._view.pageSize=this.filter.maxValues;this._view.sourceCollection=r}};FlexSheetValueFilterEditor.prototype.updateFilter=function(){var e=null,t=this._view.items;if(this._filterText||this._cbSelectAll.indeterminate){e={};for(var o=0;o<t.length;o++){var n=t[o];n.show&&(e[n.text]={show:!0,cellRef:n.cellRef})}}this._filter.showValues=e;this._filter.filterText=this._filterText};return FlexSheetValueFilterEditor}(e.grid.filter.ValueFilterEditor);t.FlexSheetValueFilterEditor=o}(t.sheet||(t.sheet={}))}(e.grid||(e.grid={}))}(wijmo||(wijmo={}));!function(e){!function(t){!function(t){"use strict";var o=function(o){__extends(FlexSheetConditionFilter,o);function FlexSheetConditionFilter(e){return o.call(this,e)||this}FlexSheetConditionFilter.prototype.apply=function(o){var n,i,l,r,s=this.column,a=s.grid,h=this.condition1,u=this.condition2;if(!(a instanceof t.FlexSheet))return!0;if(!this.isActive)return!0;if(a.rows[o]instanceof e.grid._NewRowTemplate)return!0;""===(n=a.getCellValue(o,s.index))&&s.dataType!==e.DataType.String&&(n=null);i=l=n;if(r=this.dataMap||s.dataMap)i=l=n=r.getDisplayValue(n);else if(e.isDate(n))(e.isString(h.value)||e.isString(u.value))&&(i=l=n=a.getCellValue(o,s.index,!0));else if(e.isNumber(n)){i=l=n=e.Globalize.parseFloat(a.getCellValue(o,s.index,!0));if(0===n&&!s.dataType){h.isActive&&""===h.value&&(i=n.toString());u.isActive&&""===u.value&&(l=l.toString())}}else if(null==n){h.isActive&&e.isNumber(h.value)&&(i=NaN);u.isActive&&e.isNumber(u.value)&&(l=NaN)}var d=h.apply(i),c=u.apply(l);return h.isActive&&u.isActive?this.and?d&&c:d||c:h.isActive?d:!u.isActive||c};return FlexSheetConditionFilter}(e.grid.filter.ConditionFilter);t.FlexSheetConditionFilter=o}(t.sheet||(t.sheet={}))}(e.grid||(e.grid={}))}(wijmo||(wijmo={}));!function(e){!function(t){!function(t){"use strict";var o=function(o){__extends(FlexSheetValueFilter,o);function FlexSheetValueFilter(e){return o.call(this,e)||this}FlexSheetValueFilter.prototype.apply=function(o){var n,i=this.column.grid;if(!(i instanceof t.FlexSheet))return!0;if(!this.showValues||!Object.keys(this.showValues).length)return!0;if(i.rows[o]instanceof e.grid._NewRowTemplate)return!0;o=(n=this.dataMap||this.column.dataMap)?n.getDisplayValue(i.getCellValue(o,this.column.index)):i.getCellValue(o,this.column.index,!0);return null!=this.showValues[o]};return FlexSheetValueFilter}(e.grid.filter.ValueFilter);t.FlexSheetValueFilter=o}(t.sheet||(t.sheet={}))}(e.grid||(e.grid={}))}(wijmo||(wijmo={}));!function(e){!function(t){!function(t){"use strict";var o=function(e){__extends(FlexSheetColumnFilter,e);function FlexSheetColumnFilter(o,n){var i=e.call(this,o,n)||this;i._valueFilter=new t.FlexSheetValueFilter(n);i._valueFilter.exclusiveValueSearch=o.exclusiveValueSearch;i._conditionFilter=new t.FlexSheetConditionFilter(n);return i}return FlexSheetColumnFilter}(e.grid.filter.ColumnFilter);t.FlexSheetColumnFilter=o}(t.sheet||(t.sheet={}))}(e.grid||(e.grid={}))}(wijmo||(wijmo={}));!function(e){!function(t){!function(t){"use strict";var o=function(o){__extends(FlexSheetColumnFilterEditor,o);function FlexSheetColumnFilterEditor(e,t,n){void 0===n&&(n=!0);var i=o.call(this,e,t,n)||this,l=i;n&&(i._divSort.style.display="");i._btnSortAsc=i.cloneElement(i._btnAsc);i._btnSortDsc=i.cloneElement(i._btnDsc);i._btnAsc.parentNode.replaceChild(i._btnSortAsc,i._btnAsc);i._btnDsc.parentNode.replaceChild(i._btnSortDsc,i._btnDsc);i._btnSortAsc.addEventListener("click",(function(e){l._sortBtnClick(e,!0)}));i._btnSortDsc.addEventListener("click",(function(e){l._sortBtnClick(e,!1)}));i._updateSortButtonStateUnbound();return i}FlexSheetColumnFilterEditor.prototype._showFilter=function(n){var i=this;if(n==e.grid.filter.FilterType.Value&&null==this._edtVal){this._edtVal=new t.FlexSheetValueFilterEditor(this._divEdtVal,this.filter.valueFilter);this._edtVal.canApplyChanged.addHandler((function(t){e.enable(i._btnApply,i._edtVal.canApply)}))}o.prototype._showFilter.call(this,n)};FlexSheetColumnFilterEditor.prototype._sortBtnClick=function(e,t){var o,n,i=this.filter.column,l=i.grid.sortManager;e.preventDefault();e.stopPropagation();if((o=l.checkSortItemExists(i.index))>-1){l.sortDescriptions.moveCurrentToPosition(o);l.sortDescriptions.currentItem.ascending=t;n=-o}else{l.addSortLevel(i.index,t);n=-(l.sortDescriptions.items.length-1)}l.moveSortLevel(n);l.commitSort();this.onButtonClicked()};FlexSheetColumnFilterEditor.prototype.cloneElement=function(e){for(var t=e.cloneNode();e.firstChild;)t.appendChild(e.lastChild);return t};FlexSheetColumnFilterEditor.prototype._updateSortButtonStateUnbound=function(){var t=this.filter.column;if(t&&t.grid&&t.grid.selectedSheet)for(var o=t.grid.selectedSheet._unboundSortDesc,n=0;n<o.length;n++)if(o[n].column===t){e.toggleClass(this._btnSortAsc,"wj-state-active",!0===o[n].ascending);e.toggleClass(this._btnSortDsc,"wj-state-active",!1===o[n].ascending);break}};return FlexSheetColumnFilterEditor}(e.grid.filter.ColumnFilterEditor);t.FlexSheetColumnFilterEditor=o}(t.sheet||(t.sheet={}))}(e.grid||(e.grid={}))}(wijmo||(wijmo={}));!function(e){!function(t){!function(t){"use strict";var o=function(o){__extends(FlexSheetFilter,o);function FlexSheetFilter(){return null!==o&&o.apply(this,arguments)||this}Object.defineProperty(FlexSheetFilter.prototype,"filterDefinition",{get:function(){for(var e={filters:[]},t=0;t<this._filters.length;t++){var o=this._filters[t];if(o&&o.column&&this.grid.columns.indexOf(o.column)>-1)if(o.conditionFilter.isActive){var n=o.conditionFilter;e.filters.push({columnIndex:o.column.index,type:"condition",condition1:{operator:n.condition1.operator,value:n.condition1.value},and:n.and,condition2:{operator:n.condition2.operator,value:n.condition2.value}})}else if(o.valueFilter.isActive){var i=o.valueFilter;e.filters.push({columnIndex:o.column.index,type:"value",filterText:i.filterText,showValues:i.showValues})}}return JSON.stringify(e)},set:function(t){var o=JSON.parse(e.asString(t));this.clear();for(var n=0;n<o.filters.length;n++){var i=o.filters[n],l=this.grid.columns[i.columnIndex],r=this.getColumnFilter(l,!0);if(r)switch(i.type){case"condition":var s=r.conditionFilter;s.condition1.value=l.dataType==e.DataType.Date?e.changeType(i.condition1.value,l.dataType,null):i.condition1.value;s.condition1.operator=i.condition1.operator;s.and=i.and;s.condition2.value=l.dataType==e.DataType.Date?e.changeType(i.condition2.value,l.dataType,null):i.condition2.value;s.condition2.operator=i.condition2.operator;break;case"value":var a=r.valueFilter;a.filterText=i.filterText;a.showValues=i.showValues}}this.apply()},enumerable:!0,configurable:!0});FlexSheetFilter.prototype.apply=function(){var o=this;o.grid.deferUpdate((function(){for(var n,i,l,r=-1,s=0;s<o.grid.rows.length;s++)if(!((n=o.grid.rows[s])instanceof t.HeaderRow||s<=r)){r=-1;i=o._filter(s);if(n instanceof e.grid.GroupRow){l=n.getCellRange();if(null==n.dataItem||n.dataItem instanceof e.collections.CollectionViewGroup)n.visible=o._checkGroupVisible(l);else{n.visible=i;r=l.bottomRow;if(l.isValid)for(var a=l.topRow;a<=l.bottomRow;a++)o.grid.rows[a].visible=i}}else n.visible=i}o.grid._isCopying||o.grid._isUndoing||o.grid._isSorting||o.onFilterApplied()}))};FlexSheetFilter.prototype.editColumnFilter=function(o,n){var i=this,l=i.grid;i.closeEditor();o=i._asColumn(o);var r=document.createElement("div"),s=i.getColumnFilter(o),a=new t.FlexSheetColumnFilterEditor(r,s,i.showSortButtons);e.addClass(r,"wj-dropdown-panel");i._divEdt=r;i._edtCol=o;var h=new e.grid.CellRangeEventArgs(l.cells,new e.grid.CellRange(-1,o.index));i.onFilterChanging(h);if(h.cancel){i._divEdt=null;i._edtCol=null}else{h.cancel=!0;l.undoStack.stackSize>0&&(i._undoAcion=new t._FilteringAction(l));l.rightToLeft&&(r.dir="rtl");a.filterChanged.addHandler((function(){h.cancel=!1;i._filterChanged=!0;setTimeout((function(){if(!h.cancel){i.apply();if(i._undoAcion){i._undoAcion.saveNewState();l.undoStack._addAction(i._undoAcion);i._undoAcion=null}}}))}));a.buttonClicked.addHandler((function(){i.closeEditor();l.focus();i.onFilterChanged(h)}));a.lostFocus.addHandler((function(){setTimeout((function(){var t=e.Control.getControl(i._divEdt);t&&!t.containsFocus()&&i.closeEditor()}),10)}));l._edtHdl._commitRowEdits();l.scrollIntoView(-1,o.index,!0);var u=i.grid.columnHeaders,d=n?n.row:u.rows.length-1,c=n?n.col:o.index,_=u.getCellBoundingRect(d,c),g=document.elementFromPoint(_.left+_.width/2,_.top+_.height/2);(g=e.closest(g,".wj-cell"))?e.showPopup(r,g,!1,!1,!1):e.showPopup(r,_);i._setAriaExpanded(g,!0);i._setAriaExpanded(l.cells.getCellElement(-1,c),!0);for(var f=a.hostElement.querySelectorAll("input"),p=0;p<f.length;p++){var w=f[p];if(w.offsetHeight>0&&w.tabIndex>-1&&!w.disabled){w.focus();break}}a.containsFocus()||a.focus()}};FlexSheetFilter.prototype.closeEditor=function(){this._undoAcion&&!this._filterChanged&&(this._undoAcion=null);o.prototype.closeEditor.call(this)};FlexSheetFilter.prototype.getColumnFilter=function(e,o){void 0===o&&(o=!0);if(e=this._asColumn(e)){for(var n=0;n<this._filters.length;n++)if(this._filters[n].column==e)return this._filters[n];if(o){var i=new t.FlexSheetColumnFilter(this,e);this._filters.push(i);return i}}return null};FlexSheetFilter.prototype._isActive=function(){var e=this;return this._filters.some((function(t){return t.column&&(t.conditionFilter.isActive||t.valueFilter.isActive)&&e.grid.columns.indexOf(t.column)>=0}))};FlexSheetFilter.prototype._isEditorOpened=function(){return!!this._divEdt};FlexSheetFilter.prototype._checkGroupVisible=function(t){for(var o,n=!0,i=t.topRow+1;i<=t.bottomRow;i++)if(o=this.grid.rows[i])if(o instanceof e.grid.GroupRow)n=this._checkGroupVisible(o.getCellRange());else if(n=this._filter(i))break;return n};return FlexSheetFilter}(e.grid.filter.FlexGridFilter);t.FlexSheetFilter=o}(t.sheet||(t.sheet={}))}(e.grid||(e.grid={}))}(wijmo||(wijmo={}));!function(e){!function(t){!function(t){"use strict";var o=function(o){__extends(_SmartTag,o);function _SmartTag(n,i,l,r){var s=o.call(this,n)||this;s.CopyCells=t.AutoFillOperation.CopyFormat|t.AutoFillOperation.CopyContent;s.FillSeries=t.AutoFillOperation.CopyFormat|t.AutoFillOperation.FillSeries;s.FillFormat=t.AutoFillOperation.CopyFormat;s.FillWithoutFormat=t.AutoFillOperation.FillSeries;s.FullWidth=32;s.CompactWidth=18;s._uiEventHdl=s._onUIEvent.bind(s);s.operationSelected=new e.Event;s.cancelled=new e.Event;s._owner=i;s._op=l;var a=s.getTemplate();s.applyTemplate("wj-flexsheet-smart-tag",a,{_icon:"icon",_btnMenu:"btn-menu"});var h=s._getPos();e.setCss(s.hostElement,{left:h.x,top:h.y});s.addEventListener(s.hostElement,"mouseover",(function(){s.hostElement.style.width=s.FullWidth+"px";s._btnMenu.style.display=""}));s.addEventListener(s.hostElement,"mouseleave",(function(){if(!s._menu){s.hostElement.style.width=s.CompactWidth+"px";s._btnMenu.style.display="none"}}));s.addEventListener(s.hostElement,"mousedown",(function(e){e.preventDefault();s._showFillOpMenu()}),!0);s.addEventListener(document.body,"mousedown",s._uiEventHdl,!0);s.addEventListener(document.body,"keydown",s._uiEventHdl,!0);s.initialize(r);return s}_SmartTag.prototype.dispose=function(){this.removeEventListener(document.body,"mousedown",this._uiEventHdl,!0);this.removeEventListener(document.body,"keydown",this._uiEventHdl,!0);o.prototype.dispose.call(this)};Object.defineProperty(_SmartTag.prototype,"operation",{get:function(){return this._op},enumerable:!0,configurable:!0});_SmartTag.prototype.onOperationSelected=function(e){this.operationSelected.raise(this,e)};_SmartTag.prototype.onCancelled=function(e){this.cancelled.raise(this,e)};_SmartTag.prototype._getPos=function(){var t=this._owner,o=t._root,n=t.selection,i=t.cells.getCellBoundingRect(n.bottomRow,n.rightCol,!0),l=t.cells.hostElement,r=i.right+l.offsetLeft,s=i.bottom+l.offsetTop;r+t._ptScrl.x+32+(l.offsetHeight>o.offsetHeight?17:0)>o.offsetWidth&&(r-=32);s+t._ptScrl.y+18+(l.offsetWidth>o.offsetWidth?17:0)>o.offsetHeight&&(s-=18);return new e.Point(r,s)};_SmartTag.prototype._showFillOpMenu=function(){var t=this,o=e.culture.FlexSheet;this._menu=new e.input.Menu(document.createElement("div"),{displayMemberPath:"item",selectedValuePath:"op",dropDownCssClass:"wj-flexsheet-fill-menu",openOnHover:!1,closeOnLeave:!1,itemsSource:[{item:o.copyCells,op:this.CopyCells,checked:this._op===this.CopyCells},{item:o.fillSeries,op:this.FillSeries,checked:this._op===this.FillSeries},{item:o.fillFormat,op:this.FillFormat,checked:this._op===this.FillFormat},{item:o.fillWithoutFormat,op:this.FillWithoutFormat,checked:this._op===this.FillWithoutFormat}],selectedValue:this._op,itemClicked:function(e){t._op=e.selectedValue;t.onOperationSelected()}});this._menu.listBox.checkedMemberPath="checked";this._menu.show(this.hostElement);this._menu.selectedValue=this._op};_SmartTag.prototype._onUIEvent=function(t){var o=t.target,n=e.contains(this.hostElement,o),i=this._menu&&e.contains(this._menu.listBox.hostElement,o),l=n||i;l&&t instanceof KeyboardEvent&&(l=i&&(t.keyCode==e.Key.Down||t.keyCode==e.Key.Up||t.keyCode==e.Key.Enter||t.keyCode==e.Key.Escape));l||this.onCancelled()};_SmartTag.controlTemplate='<img wj-part="icon" style="float:left; height: 18; margin: 0" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAFJJREFUeNrclEEKACAIBOfp/Xy7i4WSRnRYBIVRVhFJVIhyEAxllQa5E/wBSnsU6Rza2nugqNmASi57C/KKNg/Iqn+iVWzx6M4bOdUEAAD//wMAAYRMfiNaiqEAAAAASUVORK5CYII=" /><img wj-part="btn-menu" style="float:left; height: 18; margin: 0; display: none" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAASCAYAAACXScT7AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAGCSURBVHjafNFPKKRxHAbw5/v7GYdBYUQjLm5SkoNykCQHtcx431/KgdKumJvSrAO7Nwc3RQ5kd3OkHJC/hUJREluonVcToqRh3sRFPA6M1Mbhc3z6Pj1fkMRHQNJL0uPeul731lU37o1y49cqHr8GvvgWQRLBsmpM/P0j4XAXiooKcXl1CZDEzl4EJBEwAZBUwWAQsVgsFSRR11gmM8trimSa3WypzZ31l5v2/vfk/4oAcv9aSGyUSz4gg/AIAOET0YQswIQWaNrnH+2OeSaY0BJN2+wDTi/OpCrwkxX1vW8q63p5cnaaB+Z/09u7x0nFJTVMiEajPsNCQaC6Ryb8THKcw/Tikho6zj//0RGUNV6gMZ1H8fmpH5iTHDlwsiOhO7FrN5RdP6aBIUj/pvJ2bkFbkxAzBzELELNCQQqgrJ5ST1/jqmYOJcHa7dYYGV5TrQ3d+vfUU+b7IfrOIRCGBYD0o1VGmaHaB6DZkqvMD2hUfF1UAISkvE/+yqbCZ89+HgBtwgFOrBUzJgAAAABJRU5ErkJggg==" />';return _SmartTag}(e.Control);t._SmartTag=o}(t.sheet||(t.sheet={}))}(e.grid||(e.grid={}))}(wijmo||(wijmo={}));!function(e){!function(t){!function(t){var o=function(e){__extends(_FlexSheetSelectionHandler,e);function _FlexSheetSelectionHandler(t){var o=this,n=t.selectionMode;(o=e.call(this,t)||this)._mode=n;o._fs=t;return o}_FlexSheetSelectionHandler.prototype.moveSelection=function(t,o,n){var i=this._fs;!n&&i._lastSelMovePos&&this.selection.copy(i._lastSelMovePos);i._lastSelMovePos=null;e.prototype.moveSelection.call(this,t,o,n)};return _FlexSheetSelectionHandler}(e.grid._SelectionHandler);t._FlexSheetSelectionHandler=o}(t.sheet||(t.sheet={}))}(e.grid||(e.grid={}))}(wijmo||(wijmo={}));!function(e){!function(t){!function(t){"use strict";var o=function(t){__extends(_ContextMenu,t);function _ContextMenu(e,o){var n=t.call(this,e)||this;n._idx=-1;n._owner=o;return n}Object.defineProperty(_ContextMenu.prototype,"visible",{get:function(){return"none"!==this.hostElement.style.display},enumerable:!0,configurable:!0});_ContextMenu.prototype.show=function(e,t){if(this._owner.selectedSheet){this._owner.finishEditing();var o=(t?t.x:e.clientX)+(e?window.pageXOffset:0),n=(t?t.y:e.clientY)+(e?window.pageYOffset:0);this.hostElement.style.position="absolute";this.hostElement.style.display="inline";n+this.hostElement.clientHeight>window.innerHeight+(e?window.pageYOffset:0)&&(n-=this.hostElement.clientHeight);o+this.hostElement.clientWidth>window.innerWidth+(e?window.pageXOffset:0)&&(o-=this.hostElement.clientWidth);this.hostElement.style.top=n+"px";this.hostElement.style.left=o+"px"}};_ContextMenu.prototype.hide=function(){this._idx=-1;var e=this.hostElement.querySelectorAll(".wj-context-menu-item");this._removeSelectedState(e);this.hostElement.style.display="none"};_ContextMenu.prototype.moveToNext=function(){var t=this.hostElement.querySelectorAll(".wj-context-menu-item");this._removeSelectedState(t);this._idx++;for(;t[this._idx]&&("none"===t[this._idx].style.display||e.hasClass(t[this._idx],"wj-state-disabled"));)this._idx++;this._idx>=t.length&&(this._idx=0);e.addClass(t[this._idx],"wj-context-menu-item-selected")};_ContextMenu.prototype.moveToPrev=function(){var t=this.hostElement.querySelectorAll(".wj-context-menu-item");this._removeSelectedState(t);this._idx--;this._idx<0&&(this._idx=t.length-1);for(;this._idx>0&&("none"===t[this._idx].style.display||e.hasClass(t[this._idx],"wj-state-disabled"));)this._idx--;e.addClass(t[this._idx],"wj-context-menu-item-selected")};_ContextMenu.prototype.moveToFirst=function(){var t=this.hostElement.querySelectorAll(".wj-context-menu-item");this._removeSelectedState(t);this._idx=0;e.addClass(t[this._idx],"wj-context-menu-item-selected")};_ContextMenu.prototype.moveToLast=function(){var t=this.hostElement.querySelectorAll(".wj-context-menu-item");this._removeSelectedState(t);this._idx=t.length-1;t[this._idx]&&"none"===t[this._idx].style.display&&this._idx--;e.addClass(t[this._idx],"wj-context-menu-item-selected")};_ContextMenu.prototype.handleContextMenu=function(){if(-1===this._idx)this.moveToNext();else{var e=this.hostElement.querySelectorAll(".wj-context-menu-item");this._handleMenuItemOperation(e);this.hide();this._owner.hostElement.focus()}};_ContextMenu.prototype.refresh=function(e){void 0===e&&(e=!0);t.prototype.refresh.call(this,e);this._localize()};_ContextMenu.prototype._init=function(){var e=this,t=e.hostElement.querySelectorAll(".wj-context-menu-item");e.hostElement.style.zIndex="9999";document.body.appendChild(e.hostElement);e.addEventListener(document.body,"mousemove",(function(){e._removeSelectedState(t)}));e.addEventListener(e.hostElement,"contextmenu",(function(e){e.preventDefault()}));this._localize()};_ContextMenu.prototype._handleMenuItemOperation=function(e){};_ContextMenu.prototype._localize=function(){};_ContextMenu.prototype._removeSelectedState=function(t){for(var o=0;o<t.length;o++)e.removeClass(t[o],"wj-context-menu-item-selected")};return _ContextMenu}(e.Control);t._ContextMenu=o;var n=function(o){__extends(_SheetContextMenu,o);function _SheetContextMenu(e,t){var n=o.call(this,e,t)||this;n._isDisableDelRow=!1;n._isDisableConvertTable=!1;n.applyTemplate("",n.getTemplate(),{_insRows:"insert-rows",_delRows:"delete-rows",_insCols:"insert-columns",_delCols:"delete-columns",_splitter:"splitter",_convertTable:"convert-table"});n._init();return n}_SheetContextMenu.prototype.show=function(t,n){if(this._owner.selectedSheet){if(this._owner._isDisableDeleteRow(this._owner.selection.topRow,this._owner.selection.bottomRow)){this._isDisableDelRow=!0;e.addClass(this._delRows,"wj-state-disabled")}this._showTableOperation();if(!this._owner.selection.isValid){this._isDisableConvertTable=!0;e.addClass(this._convertTable,"wj-state-disabled")}o.prototype.show.call(this,t,n)}};_SheetContextMenu.prototype.hide=function(){o.prototype.hide.call(this);this._isDisableDelRow=!1;this._isDisableConvertTable=!1;e.removeClass(this._delRows,"wj-state-disabled");e.removeClass(this._convertTable,"wj-state-disabled")};_SheetContextMenu.prototype._init=function(){o.prototype._init.call(this);var e=this;e.addEventListener(e._insRows,"click",(function(t){e._owner.insertRows();e.hide();e._owner.hostElement.focus()}));e.addEventListener(e._delRows,"click",(function(t){e._isDisableDelRow||e._owner.deleteRows();e.hide();e._owner.hostElement.focus()}));e.addEventListener(e._insCols,"click",(function(t){e._owner.insertColumns();e.hide();e._owner.hostElement.focus()}));e.addEventListener(e._delCols,"click",(function(t){e._owner.deleteColumns();e.hide();e._owner.hostElement.focus()}));e.addEventListener(e._convertTable,"click",(function(t){e._isDisableConvertTable||e._addTable();e.hide();e._owner.hostElement.focus()}))};_SheetContextMenu.prototype._handleMenuItemOperation=function(e){switch(e[this._idx]){case this._insCols:this._owner.insertColumns();break;case this._insRows:this._owner.insertRows();break;case this._delCols:this._owner.deleteColumns();break;case this._delRows:this._isDisableDelRow||this._owner.deleteRows();break;case this._convertTable:this._addTable()}};_SheetContextMenu.prototype._localize=function(){o.prototype._localize.call(this);var t=e.culture.FlexSheet;this._insRows.textContent=t.insertRow;this._delRows.textContent=t.deleteRow;this._insCols.textContent=t.insertCol;this._delCols.textContent=t.deleteCol;this._convertTable.textContent=t.convertTable};_SheetContextMenu.prototype._showTableOperation=function(){for(var e=this._owner.selection,t=e.topRow;t<=e.bottomRow;t++)for(var o=e.leftCol;o<=e.rightCol;o++){if(null!=this._owner.selectedSheet.findTable(t,o)){this._convertTable.style.display="none";this._splitter.style.display="none";return}}if(e.isSingleCell||this._owner._containsMergedCells(e)){this._convertTable.style.display="none";this._splitter.style.display="none"}else{this._convertTable.style.display="";this._splitter.style.display=""}};_SheetContextMenu.prototype._addTable=function(){var e=this._owner.selectedSheet._addTable(this._owner.selection);if(e){if(0===this._owner.undoStack.stackSize)return;var o=new t._TableAction(this._owner,e);this._owner.undoStack._addAction(o)}};_SheetContextMenu.controlTemplate='<div class="wj-context-menu wj-control wj-flexsheet-context-menu" width="150px"><div class="wj-context-menu-item" wj-part="insert-rows"></div><div class="wj-context-menu-item" wj-part="delete-rows"></div><div class="wj-context-menu-item" wj-part="insert-columns"></div><div class="wj-context-menu-item" wj-part="delete-columns"></div><div class="wj-state-disabled" wj-part="splitter" style="width:100%;height:1px;background-color:lightgray;"></div><div class="wj-context-menu-item" wj-part="convert-table"></div></div>';return _SheetContextMenu}(o);t._SheetContextMenu=n;var i=function(t){__extends(_SheetTabContextMenu,t);function _SheetTabContextMenu(e,o){var n=t.call(this,e,o)||this;n.applyTemplate("",n.getTemplate(),{_insSheet:"insert-sheet",_delSheet:"delete-sheet",_renameSheet:"rename-sheet"});n._init();return n}_SheetTabContextMenu.prototype._init=function(){var o=e.culture.FlexSheet,n=this;n._insSheet.textContent=o.insertSheet;n._delSheet.textContent=o.deleteSheet;n._renameSheet.textContent=o.renameSheet;t.prototype._init.call(this);n.addEventListener(n._insSheet,"click",(function(e){n._owner.addUnboundSheet(null,null,null,n._owner.selectedSheetIndex);n.hide();n._owner.hostElement.focus()}));n.addEventListener(n._delSheet,"click",(function(e){n._owner.sheets.removeAt(n._owner.selectedSheetIndex);n.hide();n._owner.hostElement.focus()}));n.addEventListener(n._renameSheet,"click",(function(e){n._owner._tabHolder.sheetControl._startEditingSheetName(n._owner.selectedSheetIndex);n.hide()}))};_SheetTabContextMenu.prototype._handleMenuItemOperation=function(e){switch(e[this._idx]){case this._insSheet:this._owner.addUnboundSheet(null,null,null,this._owner.selectedSheetIndex);break;case this._delSheet:this._owner.sheets.removeAt(this._owner.selectedSheetIndex);break;case this._renameSheet:this._owner._tabHolder.sheetControl._startEditingSheetName(this._owner.selectedSheetIndex)}};_SheetTabContextMenu.prototype._localize=function(){t.prototype._localize.call(this);var o=e.culture.FlexSheet;this._insSheet.textContent=o.insertSheet;this._delSheet.textContent=o.deleteSheet;this._renameSheet.textContent=o.renameSheet};_SheetTabContextMenu.controlTemplate='<div class="wj-context-menu wj-control wj-flexsheet-context-menu" width="150px"><div class="wj-context-menu-item" wj-part="insert-sheet"></div><div class="wj-context-menu-item" wj-part="delete-sheet"></div><div class="wj-context-menu-item" wj-part="rename-sheet"></div><div>';return _SheetTabContextMenu}(o);t._SheetTabContextMenu=i}(t.sheet||(t.sheet={}))}(e.grid||(e.grid={}))}(wijmo||(wijmo={}));!function(e){var t;(function(t){"use strict";var o=function(){function Sheet(o,n,i,r,s){this._visible=!0;this._unboundSortDesc=new e.collections.ObservableArray;this._currentStyledCells={};this._currentMergedRanges=[];this._isEmptyGrid=!1;this._rowSettings=[];this._scrollPosition=new e.Point;this._ownerHeaderRowRemoved=!1;this.nameChanged=new e.Event;this.visibleChanged=new e.Event;var a=this;a._owner=o;a._name=i;a._sortList=[new t.ColumnSortDescription(-1,!0)];r=e.isNumber(r)&&!isNaN(r)&&r>=0?r:200;s=e.isNumber(s)&&!isNaN(s)&&s>=0?s:20;if(n){n.columns.forEach((function(e){return e._orgHdr=e._hdr}));a._grid=n;a._addHeaderRow(!0)}else a._grid=this._createGrid(r,s);a._grid.loadedRows.addHandler((function(){a._owner&&a._owner._checkCollectionsOwner();a._addHeaderRow();a._setRowSettings()}));a._grid.refreshed.addHandler((function(){a._owner&&a._owner._checkCollectionsOwner()}));a._grid.itemsSourceChanged.addHandler(this._gridItemsSourceChanged,this);a._unboundSortDesc.collectionChanged.addHandler((function(){for(var t=a._unboundSortDesc,o={},n=0;n<t.length;n++)if(!e.tryCast(t[n],l))throw"sortDescriptions array must contain SortDescription objects.";if(a._owner){a._owner.rows.beginUpdate();a._owner.rows.sort(a._compareRows());if(!a._owner._isUndoing){for(n=0;n<a._owner.rows.length;n++){var i=a._owner.rows[n];n!==i._idx&&a._owner._updateFormulaForReorderingRows(i._idx,n);a._owner._updateCellStyleForReorderingRows(i._idx,n,o)}a._currentStyledCells=o}a._owner.rows.endUpdate();a._owner.rows._dirty=!0;a._owner.rows._update();if(a._owner.selectedSheet){a._owner._copyTo(a._owner.selectedSheet);a._owner._copyFrom(a._owner.selectedSheet)}}}));a.tables.collectionChanged.addHandler((function(o,n){if(null!=n.item&&!(n.item instanceof t.Table))throw"The tables only allows to handle Table instance.";if(a._owner)if(n.action===e.collections.NotifyCollectionChangedAction.Add||n.action===e.collections.NotifyCollectionChangedAction.Change){if(n.item){var i=n.item,l=i._getTableRange(),r=a===a._owner.selectedSheet?a._owner:a.grid;try{if(l.topRow>=r.rows.length||l.leftCol>=r.columns.length)throw"";if(l.leftCol+l.columnSpan>r.columns.length)throw"";if(l.topRow+l.rowSpan>r.rows.length)throw"";for(var s=l.topRow;s<=l.bottomRow;s++)for(var h=l.leftCol;h<=l.rightCol;h++)if(a.findTable(s,h)!==i)throw"";i._attachSheet(a)}catch(e){a.tables.removeAt(n.index)}}}else n.action===e.collections.NotifyCollectionChangedAction.Remove&&n.item&&n.item._detachSheet()}))}Object.defineProperty(Sheet.prototype,"grid",{get:function(){null==this._grid.wj_sheetInfo&&(this._grid.wj_sheetInfo={});return this._grid},enumerable:!0,configurable:!0});Object.defineProperty(Sheet.prototype,"name",{get:function(){return this._name},set:function(t){if(!e.isNullOrWhiteSpace(t)&&(this._name&&this._name.toLowerCase()!==t.toLowerCase()||!this._name)){var o=new e.PropertyChangedEventArgs("sheetName",this._name,t);this._name=t;this.grid.wj_sheetInfo.name=t;this.onNameChanged(o)}},enumerable:!0,configurable:!0});Object.defineProperty(Sheet.prototype,"visible",{get:function(){return this._visible},set:function(t){if(this._visible!==t){this._visible=t;this.grid.wj_sheetInfo.visible=t;this.onVisibleChanged(new e.EventArgs)}},enumerable:!0,configurable:!0});Object.defineProperty(Sheet.prototype,"rowCount",{get:function(){return null!=this._grid?this._grid.rows.length:0},set:function(t){if(!this.itemsSource){var o=this.grid.rows.length;if(e.isNumber(t)&&!isNaN(t)&&t>=0&&o!==t){if(o<t)for(var n=0;n<t-o;n++)this.grid.rows.push(new e.grid.Row);else this.grid.rows.splice(t,o-t);this._currentStyledCells=this._adjustStylesDict(this._currentStyledCells);this._owner&&this._owner.selectedSheet&&this._name===this._owner.selectedSheet.name&&this._owner._copyFrom(this)}}},enumerable:!0,configurable:!0});Object.defineProperty(Sheet.prototype,"columnCount",{get:function(){return null!=this._grid?this._grid.columns.length:0},set:function(t){if(!this.itemsSource){var o=this.grid.columns.length;if(e.isNumber(t)&&!isNaN(t)&&t>=0&&o!==t){if(o<t)for(var n=0;n<t-o;n++)this._grid.columns.push(new e.grid.Column);else this._grid.columns.splice(t,o-t);this._currentStyledCells=this._adjustStylesDict(this._currentStyledCells);this._owner&&this._owner.selectedSheet&&this._name===this._owner.selectedSheet.name&&this._owner._copyFrom(this)}}},enumerable:!0,configurable:!0});Object.defineProperty(Sheet.prototype,"selectionRanges",{get:function(){var t=this;if(!this._selectionRanges){this._selectionRanges=new e.collections.ObservableArray;this._selectionRanges.collectionChanged.addHandler((function(){if(t._owner&&!t._owner._isClicking){var o=t._selectionRanges.length;if(o>0){var n=t._selectionRanges[o-1];n&&n instanceof e.grid.CellRange&&(t._owner.selection=n)}if(o>1){t._owner._enableMulSel=!0;t._owner.refresh(!1)}t._owner._enableMulSel=!1}}),this)}return this._selectionRanges},enumerable:!0,configurable:!0});Object.defineProperty(Sheet.prototype,"itemsSource",{get:function(){return null!=this._grid?this._grid.itemsSource:null},set:function(e){if(!this._grid||this._grid.itemsSource!=e){this._owner&&this._owner._isCopying||(this._dataView=null);this._isEmptyGrid&&this._clearGrid();this._grid.itemsSource=e}},enumerable:!0,configurable:!0});Object.defineProperty(Sheet.prototype,"filterSetting",{get:function(){this._owner&&this===this._owner.selectedSheet&&this._getFilterSetting();return this._filterSetting},set:function(e){this._filterSetting=e;this._owner&&this===this._owner.selectedSheet&&this._applyFilterSetting()},enumerable:!0,configurable:!0});Object.defineProperty(Sheet.prototype,"tables",{get:function(){null==this._tables&&(this._tables=new e.collections.ObservableArray);return this._tables},enumerable:!0,configurable:!0});Object.defineProperty(Sheet.prototype,"_styledCells",{get:function(){this._currentStyledCells||(this._currentStyledCells={});this._currentStyledCells.columnCount=this.columnCount;this._currentStyledCells.rowCount=this.rowCount;return this._currentStyledCells},set:function(e){this._currentStyledCells=e},enumerable:!0,configurable:!0});Object.defineProperty(Sheet.prototype,"_mergedRanges",{get:function(){this._currentMergedRanges||(this._currentMergedRanges=[]);return this._currentMergedRanges},enumerable:!0,configurable:!0});Sheet.prototype.onNameChanged=function(e){this.nameChanged.raise(this,e)};Sheet.prototype.onVisibleChanged=function(e){this.visibleChanged.raise(this,e)};Sheet.prototype.dispose=function(){this._clearGrid();this._grid.wj_sheetInfo=null;this._grid.dispose();this._grid=null;if(null!=this._tables){for(var e=0;e<this._tables.length;e++)this._tables[e]=null;this._tables=null}};Sheet.prototype.getCellStyle=function(e,t){var o=this._grid.rows.length,n=this._grid.columns.length;if(e>=o||t>=n)return null;var i=e*n+t;return this._styledCells[i]};Sheet.prototype.addTableFromArray=function(o,n,i,l,r,s,a,h){void 0===h&&(h=!0);var u=!1;if(this._owner){if(null==i||0===i.length)throw"Invalid array to load.";if(!(null!=l&&0!==l.length||null!=(l=Object.keys(i[0]))&&0!==l.length))throw"Invalid array to load.";if(o>=this.rowCount||n>=this.columnCount)return null;for(var d=null==(a&&a.showHeaderRow)||a.showHeaderRow,c=!(!a||!a.showTotalRow),_=o+(d?1:0),g=_+i.length-1+(c?1:0),f=[],p=this._flex,w=0;w<l.length;w++){var m=l[w],C=new t.TableColumn(m);0===w?C._totalRowLabel="Total":w===l.length-1&&(C._totalRowFunction="Sum");f.push(C)}var S=new e.grid.CellRange(o,n,g,n+l.length-1),b=this._needShiftForTable(S);if(0!==b){if(!h)return null;if(!this._canShiftCells(S))return null;var y=this._needAddRowCountForAddTable(b,S);if(p.collectionView){var v=p.itemsSource instanceof e.collections.CollectionView;p.collectionView.beginUpdate();for(var R=0;R<y;R++)v?p.itemsSource.sourceCollection.push({}):p.itemsSource.push({});p.collectionView.endUpdate(!0)}else for(R=0;R<y;R++)p.rows.push(new e.grid.Row);u=!0}if(n+l.length>=p.columns.length){if(!h)return null;var x=n+l.length-p.columns.length+1;if(this.itemsSource&&x>0)return null;p.columns.beginUpdate();for(R=0;R<x;R++)p.columns.push(new e.grid.Column);p.columns.endUpdate()}p.beginUpdate();u&&this._moveDownCells(b,S);if(d)for(w=0;w<l.length;w++){m=l[w];p.setCellData(o,n+w,m)}for(var T=0;T<i.length;T++)for(w=0;w<l.length;w++){m=l[w];p.setCellData(_+T,n+w,i[T][m])}p.endUpdate();return this._addTable(S,r,s,f,a)}};Sheet.prototype.findTable=function(e,t){var o,n=this._tables;if(n&&(o=n.length)>0)for(var i=0;i<o;i++){var l=n[i],r=l._getTableRange();if(e>=r.topRow&&e<=r.bottomRow&&t>=r.leftCol&&t<=r.rightCol)return l}return null};Sheet.prototype._attachOwner=function(e){var t=this;if(this._owner!==e){this._owner=e;if(this._owner){var o=!1;this._owner.loadedRows.addHandler((function(){if(!o){o=!0;t._addHeaderRow()}}))}}};Sheet.prototype._setValidName=function(e){this._name=e;this.grid.wj_sheetInfo.name=e};Sheet.prototype._storeRowSettings=function(){if(this._owner){this._rowSettings=[];for(var t=0;t<this._grid.rows.length;t++){var o=this._owner.rows[t];o&&(this._rowSettings[t]={height:o.height,allowMerging:o.allowMerging,isCollapsed:o instanceof e.grid.GroupRow?o.isCollapsed:null,visible:o.visible,isSelected:o.isSelected,readOnly:o.isReadOnly})}}};Sheet.prototype._setRowSettings=function(){for(var o=0;o<this._rowSettings.length;o++){var n=this._rowSettings[o];if(n){var i=this._grid.rows[o];if(i){var l=i instanceof t.HeaderRow;i.height=n.height;i.allowMerging=n.allowMerging;i.visible=n.visible;i instanceof e.grid.GroupRow&&(i.isCollapsed=!!n.isCollapsed);i.isSelected=!!n.isSelected;i.isReadOnly=l||!!n.readOnly}}}};Sheet.prototype._addTable=function(e,o,n,i,l){if(!e.isValid||!this._owner)return null;var r;null!=o&&null==this._owner._getTable(o)||(o=this._getUniqueTableName());r=new t.Table(o,e,n,i,l);this.tables.push(r);return r};Sheet.prototype._addSelection=function(e){var t=this.selectionRanges;t.beginUpdate();for(var o=t.length-1;o>=0;o--)e.contains(t[o])&&t.removeAt(o);e.isValid&&t.push(e);t.endUpdate()};Object.defineProperty(Sheet.prototype,"_flex",{get:function(){return this===this._owner.selectedSheet?this._owner:this.grid},enumerable:!0,configurable:!0});Sheet.prototype._compareRows=function(){var o=this,n=this._unboundSortDesc;return function(i,l){for(var r=0;r<n.length;r++){var s=n[r],a=i._ubv&&s.column?i._ubv[s.column._hash]:"",h=l._ubv&&s.column?l._ubv[s.column._hash]:"";t._isFormula(a)&&(a=o._owner.evaluate(a));t._isFormula(h)&&(h=o._owner.evaluate(h));a!=a&&(a=null);h!=h&&(h=null);e.isString(a)&&(a=a.toLowerCase()+a);e.isString(h)&&(h=h.toLowerCase()+h);if(""===a||null==a)return 1;if(""===h||null==h)return-1;var u=a<h?-1:a>h?1:0;e.isString(a)&&e.isNumber(h)&&(u=1);e.isString(h)&&e.isNumber(a)&&(u=-1);if(0!==u)return s.ascending?+u:-u}return 0}};Sheet.prototype._createGrid=function(t,o){var n=document.createElement("div");this._isEmptyGrid=!0;n.style.visibility="hidden";document.body.appendChild(n);var i=new e.grid.FlexGrid(n);document.body.removeChild(n);for(var l=0;l<t;l++)i.rows.push(new e.grid.Row);for(var r=0;r<o;r++){var s=new e.grid.Column;s.isRequired=!1;i.columns.push(s)}i.wj_sheetInfo={name:this.name,visible:this.visible,styledCells:this._styledCells,mergedRanges:this._mergedRanges};return i};Sheet.prototype._clearGrid=function(){this._grid.rows.clear();this._grid.columns.clear();this._grid.columnHeaders.columns.clear();this._grid.rowHeaders.rows.clear()};Sheet.prototype._gridItemsSourceChanged=function(){var e=this;if(this._owner&&!this._owner._isCopying&&this._owner.selectedSheet&&this._name===this._owner.selectedSheet.name){this._owner.filter.clear();this._owner._copyFrom(this,!1);setTimeout((function(){e._owner._setFlexSheetToDirty();e._owner.invalidate()}),10)}};Sheet.prototype._addHeaderRow=function(e){void 0===e&&(e=!1);if(this._needAddHeaderRow()||e){var o=new t.HeaderRow;o.isReadOnly=!0;for(var n=0;n<this._grid.columns.length;n++){var i=this._grid.columns[n];o._ubv||(o._ubv={});o._ubv[i._hash]=t.FlexSheet._getHeaderRowText(i)}this._grid.rows.insert(0,o)}};Sheet.prototype._needAddHeaderRow=function(){var e=this._grid.allowAddNew&&this._grid.newRowAtTop?this._grid.rows[1]:this._grid.rows[0];return!(!this._grid.collectionView||this._grid.collectionView.isEmpty||e instanceof t.HeaderRow)&&(null==this._owner||!this._owner.rows.length||(this._owner.allowAddNew&&this._owner.newRowAtTop?this._owner.rows[1]:this._owner.rows[0])instanceof t.HeaderRow)};Sheet.prototype._getUniqueTableName=function(){for(var e="Table1",t=2;null!=this._owner._getTable(e);){e="Table"+t;t++}return e};Sheet.prototype._needShiftForTable=function(e){for(var t=0,o=0,n=this._flex,i=e.topRow;i<=e.bottomRow;i++){if(i>=n.rows.length)return t=e.rowSpan-o;for(var l=e.leftCol;l<=e.rightCol&&l<n.columns.length;l++){var r=n.getCellData(i,l,!1);if(null!=r&&""!==r)return t=e.rowSpan-o}o++}return t};Sheet.prototype._needAddRowCountForAddTable=function(e,t){for(var o=this._flex,n=1;n<=e;n++)for(var i=o.rows.length-n,l=t.leftCol;l<=t.rightCol&&l<o.columns.length;l++){var r=o.getCellData(i,l,!1),s=this.getCellStyle(i,l);if(null!=r&&""!==r||null!=s)return e-n+1}return 0};Sheet.prototype._moveDownTable=function(e){for(var t=e._getTableRange(),o=this._flex,n=t.bottomRow;n>=t.topRow;n--)for(var i=t.leftCol;i<=t.rightCol;i++){var l=null!=o.columns[i].dataMap,r=o.getCellData(n,i,l);o.setCellData(n+1,i,r);o.setCellData(n,i,"")}e._updateTableRange(1,1,0,0)};Sheet.prototype._moveDownCells=function(e,t){for(var o=this._flex,n=o.rows.length-1-e;n>=t.topRow;n--)for(var i=t.leftCol;i<=t.rightCol&&i<o.columns.length;i++){var l=null!=o.columns[i].dataMap,r=o.getCellData(n,i,l);o.setCellData(n+e,i,r);o.setCellData(n,i,"");var s=this.getCellStyle(n,i),a=(n+e)*o.columns.length+i,h=n*o.columns.length+i;if(s){this._styledCells[a]=s;this._styledCells[h]=null}var u=this._mergedRanges[h];if(u){u.row+=e;u.row2+=e;this._mergedRanges[a]=u;this._mergedRanges[h]=null}var d=this.findTable(n,i);if(d){var c=d._getTableRange();c.topRow===n&&c.leftCol===i&&d._updateTableRange(e,e,0,0)}}};Sheet.prototype._moveUpCells=function(e,t){for(var o=this._flex,n=t.topRow;n<o.rows.length;n++)for(var i=t.leftCol;i<=t.rightCol&&i<o.columns.length;i++){var l=null!=o.columns[i].dataMap,r=o.getCellData(n,i,l);o.setCellData(n-e,i,r);o.setCellData(n,i,"");var s=this.getCellStyle(n,i),a=(n-e)*o.columns.length+i,h=n*o.columns.length+i;if(s){this._styledCells[a]=s;this._styledCells[h]=null}var u=this._mergedRanges[h];if(u){u.row-=e;u.row2-=e;this._mergedRanges[a]=u;this._mergedRanges[h]=null}var d=this.findTable(n,i);if(d){var c=d._getTableRange();c.topRow===n&&c.leftCol===i&&d._updateTableRange(-e,-e,0,0)}}};Sheet.prototype._moveDownCellsWithinTable=function(e,t,o){for(var n=this._flex,i=o.bottomRow;i>o.topRow+e;i--)for(var l=o.leftCol;l<=o.rightCol;l++){var r=null!=n.columns[l].dataMap,s=n.getCellData(i,l,r);n.setCellData(i+t,l,s);n.setCellData(i,l,"")}};Sheet.prototype._moveUpCellsWithinTable=function(e,t,o){for(var n=o.topRow+e,i=this._flex,l=n;l<=o.bottomRow;l++)for(var r=o.leftCol;r<=o.rightCol;r++){if(l>=n+t){var s=null!=i.columns[r].dataMap,a=i.getCellData(l,r,s);i.setCellData(l-t,r,a)}i.setCellData(l,r,"")}};Sheet.prototype._canShiftCells=function(e){for(var t=this._flex,o=e.topRow;o<t.rows.length;o++)for(var n=e.leftCol;n<=e.rightCol&&n<t.columns.length;n++){var i=this.findTable(o,n);if(i){var l=i._getTableRange();if(l.leftCol<e.leftCol||l.rightCol>e.rightCol)return!1}var r=o*t.columns.length+n,s=this._mergedRanges[r];if(s&&(s.leftCol<e.leftCol||s.rightCol>e.rightCol))return!1}return!0};Sheet.prototype._needMoveDownTable=function(e){var t=e.getRange();if(0===t.topRow)return!0;for(var o=e.getColumns(),n=this._flex,i=0;i<o.length;i++){var l=n.getCellData(t.topRow-1,t.leftCol+i,!1);if(null!=l&&""!==l)return!0}return!1};Sheet.prototype._needAddRowCountForInsertTableRows=function(e,t){for(var o=this._flex,n=1;n<=e;n++){var i=o.rows.length-n;if(i<=t.bottomRow)return e;for(var l=t.leftCol;l<=t.rightCol&&l<o.columns.length;l++){var r=o.getCellData(i,l,!1),s=this.getCellStyle(i,l);if(null!=r&&""!==r||null!=s)return e-n+1}}return 0};Sheet.prototype._getFilterSetting=function(){this._filterDefinition=this._owner.filter.filterDefinition;this._filterSetting={};this._filterSetting.filterColumns=this._owner.filter.filterColumns;this._filterSetting.columnFilterSettings||(this._filterSetting.columnFilterSettings=[]);for(var e=0;e<this._owner.filter._filters.length;e++){var t=this._owner.filter._filters[e];t&&this._filterSetting.columnFilterSettings.push({column:t.column,filterType:t.filterType,dataMap:t.dataMap,valueFilterSetting:{maxValues:t.valueFilter.maxValues,uniqueValues:t.valueFilter.uniqueValues,sortValues:t.valueFilter.sortValues,dataMap:t.valueFilter.dataMap,exclusiveValueSearch:t.valueFilter.exclusiveValueSearch},conditionFilterSetting:{dataMap:t.conditionFilter.dataMap}})}};Sheet.prototype._applyFilterSetting=function(){if(null==this._filterSetting)this._clearFilterSetting();else{this._owner.filter.filterColumns=this._filterSetting.filterColumns;this._filterDefinition&&(this._owner.filter.filterDefinition=this._filterDefinition);var e=this._filterSetting.columnFilterSettings;if(!e||!e.length)return;for(var t=0;t<e.length;t++){var o=e[t];if(o&&null!=o.column){var n=this._owner.filter.getColumnFilter(o.column);if(n){var i=n.valueFilter.showValues,l=n.valueFilter.filterText,r={operator:n.conditionFilter.condition1.operator,value:n.conditionFilter.condition1.value},s={operator:n.conditionFilter.condition2.operator,value:n.conditionFilter.condition2.value},a=n.conditionFilter.and;null!=o.dataMap&&(n.dataMap=o.dataMap);null!=o.filterType&&(n.filterType=o.filterType);var h=o.valueFilterSetting;if(h){h.dataMap&&(n.valueFilter.dataMap=h.dataMap);null!=h.maxValues&&(n.valueFilter.maxValues=h.maxValues);null!=h.sortValues&&(n.valueFilter.sortValues=h.sortValues);h.uniqueValues&&(n.valueFilter.uniqueValues=h.uniqueValues);n.valueFilter.exclusiveValueSearch=h.exclusiveValueSearch}var u=o.conditionFilterSetting;u&&u.dataMap&&(n.conditionFilter.dataMap=u.dataMap);n.valueFilter.showValues=i;n.valueFilter.filterText=l;n.conditionFilter.condition1.operator=r.operator;n.conditionFilter.condition1.value=r.value;n.conditionFilter.condition2.operator=s.operator;n.conditionFilter.condition2.value=s.value;n.conditionFilter.and=a}}}}};Sheet.prototype._cloneMergedCells=function(){for(var e=[],t=0;t<this._mergedRanges.length;t++){var o=this._mergedRanges[t];e.push(o.clone())}return e};Sheet.prototype._getMergedRange=function(e,t){for(var o=0;o<this._mergedRanges.length;o++){var n=this._mergedRanges[o];if(e>=n.topRow&&e<=n.bottomRow&&t>=n.leftCol&&t<=n.rightCol)return n}return null};Sheet.prototype._clearFilterSetting=function(){this._owner.filter._filters=[];this._owner.filter.filterColumns=null;this._filterDefinition&&(this._owner.filter.filterDefinition=this._filterDefinition)};Sheet.prototype._adjustStylesDict=function(e){if(e){var t=e.columnCount,o=e.rowCount,n=this.columnCount,i=this.rowCount;if(t&&t!=n||o&&o!=i){var l={};Object.keys(e).forEach((function(o){var r=+o;if(!isNaN(r)){var s=Math.floor(r/t),a=r%t;s<i&&a<n&&(l[s*n+a]=e[o]);delete e[o]}}));e=l}e.columnCount=n;e.rowCount=i;return e}};return Sheet}();t.Sheet=o;var n=function(t){__extends(SheetCollection,t);function SheetCollection(){var o=null!==t&&t.apply(this,arguments)||this;o._current=-1;o.sheetCleared=new e.Event;o.selectedSheetChanged=new e.Event;o.sheetNameChanged=new e.Event;o.sheetVisibleChanged=new e.Event;return o}SheetCollection.prototype.onSheetCleared=function(){this.sheetCleared.raise(this)};Object.defineProperty(SheetCollection.prototype,"selectedIndex",{get:function(){return this._current},set:function(e){this._moveCurrentTo(+e)},enumerable:!0,configurable:!0});SheetCollection.prototype.onSelectedSheetChanged=function(e){this.selectedSheetChanged.raise(this,e)};SheetCollection.prototype.push=function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];for(var n=0;n<e.length;n++){var i=e[n].name?this.getValidSheetName(e[n]):this._getUniqueName();i!==e[n].name&&(e[n].name=i);t.prototype.push.call(this,e[n]);this._postprocessSheet(e[n])}return this.length};SheetCollection.prototype.splice=function(e,o){for(var n=this,i=[],l=2;l<arguments.length;l++)i[l-2]=arguments[l];i.forEach((function(e){e.name=e.name?n.getValidSheetName(e):n._getUniqueName();n._postprocessSheet(e)}));return t.prototype.splice.apply(this,[e,o].concat(i))};SheetCollection.prototype.onCollectionChanged=function(e){this._current>=this.length&&(this._current=this.length-1);t.prototype.onCollectionChanged.call(this,e)};SheetCollection.prototype.onSheetNameChanged=function(e){this.sheetNameChanged.raise(this,e)};SheetCollection.prototype.onSheetVisibleChanged=function(e){this.sheetVisibleChanged.raise(this,e)};SheetCollection.prototype.selectFirst=function(){return this._moveCurrentTo(0)};SheetCollection.prototype.selectLast=function(){return this._moveCurrentTo(this.length-1)};SheetCollection.prototype.selectPrevious=function(){return this._moveCurrentTo(this._current-1)};SheetCollection.prototype.selectNext=function(){return this._moveCurrentTo(this._current+1)};SheetCollection.prototype.hide=function(e){if(e<0&&e>=this.length)return!1;if(!this[e].visible)return!1;this[e].visible=!1;return!0};SheetCollection.prototype.show=function(e){if(e<0&&e>=this.length)return!1;this[e].visible=!0;this._moveCurrentTo(e);return!0};SheetCollection.prototype.clear=function(){for(var e=0;e<this.length;e++){var o=this[e];o.dispose();o=null}t.prototype.clear.call(this);this._current=-1;this.onSheetCleared()};SheetCollection.prototype.isValidSheetName=function(e){var t=this._getSheetIndexFrom(e.name),o=this.indexOf(e);return-1===t||t===o};SheetCollection.prototype.getValidSheetName=function(e){for(var t=e.name,o=1,n=this.indexOf(e);;){var i=this._getSheetIndexFrom(t);if(-1===i||i===n)break;t=e.name.concat((o+1).toString());o++}return t};SheetCollection.prototype._setCurrentIdx=function(e){this._current=e};SheetCollection.prototype._moveCurrentTo=function(t){var o=t;if(t<0||t>=this.length)return!1;if(this._current<o||0===o)for(;o<this.length&&!this[o].visible;)o++;else if(this._current>o)for(;o>=0&&!this[o].visible;)o--;if(o===this.length){o=t;for(;o>=0&&!this[o].visible;)o--}if(o<0)return!1;if(o!==this._current){var n=new e.PropertyChangedEventArgs("sheetIndex",this._current,o);this._current=o;this.onSelectedSheetChanged(n)}return!0};SheetCollection.prototype._getSheetIndexFrom=function(e){if(!e)return-1;e=e.toLowerCase();for(var t=0;t<this.length;t++){var o=this[t];if((o.name?o.name.toLowerCase():"")===e)return t}return-1};SheetCollection.prototype._postprocessSheet=function(e){e.nameChanged.removeHandler(this._shNameChanged,this);e.nameChanged.addHandler(this._shNameChanged,this);e.visibleChanged.removeHandler(this._shVisibleChanged,this);e.visibleChanged.addHandler(this._shVisibleChanged,this)};SheetCollection.prototype._shNameChanged=function(t,o){this.isValidSheetName(t)||t._setValidName(this.getValidSheetName(t));var n=this._getSheetIndexFrom(t.name),i=new e.collections.NotifyCollectionChangedEventArgs(e.collections.NotifyCollectionChangedAction.Change,t,e.isNumber(n)?n:this.length-1);this.onSheetNameChanged(i)};SheetCollection.prototype._shVisibleChanged=function(t,o){var n=this._getSheetIndexFrom(t.name),i=new e.collections.NotifyCollectionChangedEventArgs(e.collections.NotifyCollectionChangedAction.Change,t,e.isNumber(n)?n:this.length-1);this.onSheetVisibleChanged(i)};SheetCollection.prototype._getUniqueName=function(){for(var e="Sheet1",t=2;-1!==this._getSheetIndexFrom(e);){e="Sheet"+t;t++}return e};return SheetCollection}(e.collections.ObservableArray);t.SheetCollection=n;var i=function(o){__extends(_SheetTabs,o);function _SheetTabs(e,t,n){var i=o.call(this,e,n)||this;i._rtl=!1;i._sheetTabClicked=!1;i._owner=t;i._sheets=t.sheets;i._rtl="rtl"==getComputedStyle(t.hostElement).direction;i._initControl();i.deferUpdate((function(){i.initialize(n)}));return i}_SheetTabs.prototype.refresh=function(e){this._tabContainer.innerHTML="";this._tabContainer.innerHTML=this._getSheetTabs();this._rtl&&this._adjustSheetsPosition();this._adjustSize()};_SheetTabs.prototype._sourceChanged=function(t,o){void 0===o&&(o=e.collections.NotifyCollectionChangedEventArgs.reset);var n=o;switch(n.action){case e.collections.NotifyCollectionChangedAction.Add:var i=n.index-1;i<0&&(i=0);this._tabContainer.innerHTML="";this._tabContainer.innerHTML=this._getSheetTabs();this._rtl&&this._adjustSheetsPosition();this._adjustSize();break;case e.collections.NotifyCollectionChangedAction.Remove:this._tabContainer.removeChild(this._tabContainer.children[n.index]);this._adjustSize();break;default:this.invalidate()}};_SheetTabs.prototype._selectedSheetChanged=function(e,t){this._updateTabActive(t.oldValue,!1);this._updateTabActive(t.newValue,!0);this._sheetTabClicked?this._sheetTabClicked=!1:this._scrollToActiveSheet(t.newValue,t.oldValue);this._adjustSize()};_SheetTabs.prototype._initControl=function(){var e=this,o=e.hostElement;e.applyTemplate("",e.getTemplate(),{_sheetContainer:"sheet-container",_tabContainer:"container",_sheetPage:"sheet-page",_newSheet:"new-sheet",_contextMenuHost:"context-menu"});e._contextMenu=new t._SheetTabContextMenu(e._contextMenuHost,e._owner);if(e._rtl){e._sheetPage.style.right="0px";e._tabContainer.parentElement.style.right=e._sheetPage.clientWidth+"px";e._tabContainer.style.right="0px";e._tabContainer.style.cssFloat="right";e._newSheet.style.right=e._sheetPage.clientWidth+e._tabContainer.parentElement.clientWidth+"px"}e._adjustNavigationButtons(e._rtl);e.addEventListener(o,"mousedown",(function(){e._owner._mouseHdl._htDown=null}));e.addEventListener(o,"dragstart",(function(t){t.dataTransfer.setData("text","foo");t.target instanceof HTMLLIElement&&e._owner._isDescendant(e._tabContainer,t.target)?e._dragSrcIdx=e._getItemIndex(e._tabContainer,t.target):e._dragSrcIdx=-1}));e.addEventListener(o,"dragover",(function(e){e.dataTransfer.dropEffect="move";e.preventDefault();e.stopPropagation()}));e.addEventListener(o,"drop",(function(t){if(e._dragSrcIdx>-1){var o=void 0;if(t.target instanceof HTMLLIElement&&e._owner._isDescendant(e._tabContainer,t.target))o=e._getItemIndex(e._tabContainer,t.target);else{var n=e._tabContainer.getBoundingClientRect();o=t.clientX<n.left?0:t.clientX>n.right?e._sheets.length-1:-1}if(o!==e._dragSrcIdx){var i=e._sheets[e._dragSrcIdx];e._sheets._exchangingPosition=!0;e._sheets.beginUpdate();e._sheets.splice(e._dragSrcIdx,1);e._sheets.splice(o,0,i);e._sheets.endUpdate();e._owner.selectedSheetIndex=o;e._sheets._exchangingPosition=!1}}e._dragSrcIdx=-1;t.preventDefault();t.stopPropagation()}));e.addEventListener(e._newSheet,"click",(function(t){var o=e._owner.selectedSheetIndex;e._owner.addUnboundSheet();e._scrollToActiveSheet(e._owner.selectedSheetIndex,o)}));e._sheets.collectionChanged.addHandler(e._sourceChanged,e);e._sheets.selectedSheetChanged.addHandler(e._selectedSheetChanged,e);e._sheets.sheetNameChanged.addHandler(e._updateSheetName,e);e._sheets.sheetVisibleChanged.addHandler(e._updateTabShown,e);e._initSheetPage();e._initSheetTab()};_SheetTabs.prototype._initSheetTab=function(){var e=this;e.addEventListener(e._tabContainer,"mousedown",(function(t){var o,n=t.target;if(n instanceof HTMLLIElement){e._sheetTabClicked=!0;o=e._getItemIndex(e._tabContainer,n);e._scrollSheetTabContainer(n);o>-1&&(e._sheets.selectedIndex=o)}}));e.addEventListener(e._tabContainer,"dblclick",(function(t){var o,n=t.target;if(n instanceof HTMLLIElement){o=e._getItemIndex(e._tabContainer,n);e._scrollSheetTabContainer(n);o>-1&&e._startEditingSheetName(o)}}));e.addEventListener(e._tabContainer,"contextmenu",(function(t){t.preventDefault();e._contextMenu.show(t)}))};_SheetTabs.prototype._initSheetPage=function(){var e=this;e.hostElement.querySelector("div.wj-sheet-page").addEventListener("click",(function(t){var o="[object HTMLButtonElement]"===t.target.toString()?t.target:t.target.parentElement,n=e._getItemIndex(e._sheetPage,o);if(0!==e._sheets.length)switch(n){case 0:e._sheets.selectFirst();break;case 1:e._sheets.selectPrevious();break;case 2:e._sheets.selectNext();break;case 3:e._sheets.selectLast()}}))};_SheetTabs.prototype._getSheetTabs=function(){for(var e="",t=0;t<this._sheets.length;t++)e+=this._getSheetElement(this._sheets[t],this._sheets.selectedIndex===t);return e};_SheetTabs.prototype._getSheetElement=function(e,t){void 0===t&&(t=!1);var o="<li";e.visible?t&&(o+=' class="active"'):o+=' class="hidden"';return o+=' draggable="true">'+e.name+"</li>"};_SheetTabs.prototype._updateTabActive=function(t,o){t>=0&&t<this._tabContainer.children.length&&e.toggleClass(this._tabContainer.children[t],"active",o)};_SheetTabs.prototype._updateTabShown=function(t,o){if(!(o.index<0||o.index>=this._tabContainer.children.length)){o.item.visible?e.removeClass(this._tabContainer.children[o.index],"hidden"):e.addClass(this._tabContainer.children[o.index],"hidden");this._adjustSize()}};_SheetTabs.prototype._adjustSize=function(){var e,t=0;if("none"!==this.hostElement.style.display){e=this._tabContainer.parentElement.scrollLeft;this._tabContainer.parentElement.style.width="";this._tabContainer.style.width="";this._sheetPage.parentElement.style.width="";for(var o=0,n=this._tabContainer.childElementCount;o<n;o++)t+=this._tabContainer.children[o].offsetWidth+1;var i=this.hostElement.offsetWidth-this._sheetPage.offsetWidth-this._newSheet.offsetWidth-2;this._tabContainer.parentElement.style.width=(t>i?i:t)+"px";this._tabContainer.style.width=t+"px";this._sheetPage.parentElement.style.width=this._sheetPage.offsetWidth+this._newSheet.offsetWidth+this._tabContainer.parentElement.offsetWidth+3+"px";this._tabContainer.parentElement.scrollLeft=e}};_SheetTabs.prototype._getItemIndex=function(e,t){for(var o=0;o<e.children.length;o++)if(e.children[o]===t)return o;return-1};_SheetTabs.prototype._updateSheetName=function(e,t){this._tabContainer.querySelectorAll("li")[t.index].textContent=t.item.name;this._adjustSize()};_SheetTabs.prototype._scrollSheetTabContainer=function(t){var o=this._tabContainer.parentElement.scrollLeft,n=this._tabContainer.parentElement.offsetWidth;if(this._rtl)switch(e.grid.FlexGrid._getRtlMode()){case"rev":var i=-this._tabContainer.offsetLeft;i+t.offsetLeft+t.offsetWidth>n+o?this._tabContainer.parentElement.scrollLeft+=t.offsetWidth:i+t.offsetLeft<o&&(this._tabContainer.parentElement.scrollLeft-=t.offsetWidth);break;case"neg":t.offsetLeft<o?this._tabContainer.parentElement.scrollLeft-=t.offsetWidth:t.offsetLeft+t.offsetWidth>n+o&&(this._tabContainer.parentElement.scrollLeft+=t.offsetWidth);break;default:var l=this._newSheet.offsetWidth;t.offsetLeft-l+o<0?this._tabContainer.parentElement.scrollLeft+=t.offsetWidth:t.offsetLeft+t.offsetWidth-l+o>n&&(this._tabContainer.parentElement.scrollLeft-=t.offsetWidth)}else{var r=this._sheetPage.offsetWidth;t.offsetLeft+t.offsetWidth-r>n+o?this._tabContainer.parentElement.scrollLeft+=t.offsetWidth:t.offsetLeft-r<o&&(this._tabContainer.parentElement.scrollLeft-=t.offsetWidth)}};_SheetTabs.prototype._adjustSheetsPosition=function(){for(var e=this._tabContainer.querySelectorAll("li"),t=0,o=0;o<e.length;o++){var n=e[o];n.style.cssFloat="right";n.style.right=t+"px";t+=e[o].clientWidth}};_SheetTabs.prototype._scrollToActiveSheet=function(t,o){var n=this._tabContainer.querySelectorAll("li"),i=0;this._tabContainer.clientWidth>this._tabContainer.parentElement.clientWidth&&(i=this._tabContainer.clientWidth-this._tabContainer.parentElement.clientWidth);if(n.length>0&&t<n.length&&o<n.length){if(0===t&&!this._rtl||t===n.length-1&&this._rtl){if(this._rtl)switch(e.grid.FlexGrid._getRtlMode()){case"rev":this._tabContainer.parentElement.scrollLeft=0;break;case"neg":this._tabContainer.parentElement.scrollLeft=-i;break;default:this._tabContainer.parentElement.scrollLeft=i}else this._tabContainer.parentElement.scrollLeft=0;return}if(0===t&&this._rtl||t===n.length-1&&!this._rtl){if(this._rtl)switch(e.grid.FlexGrid._getRtlMode()){case"rev":this._tabContainer.parentElement.scrollLeft=i;break;case"neg":default:this._tabContainer.parentElement.scrollLeft=0}else this._tabContainer.parentElement.scrollLeft=i;return}if(t>=o)for(var l=o+1;l<=t;l++){var r=n[l];this._scrollSheetTabContainer(r)}else for(l=o-1;l>=t;l--){r=n[l];this._scrollSheetTabContainer(r)}}};_SheetTabs.prototype._adjustNavigationButtons=function(t){var o=this.hostElement.querySelectorAll(".wj-sheet-page button");if(o&&4===o.length){var n=void 0;if(t){n=o[0].querySelector("span");e.removeClass(n,"wj-glyph-step-backward");e.addClass(n,"wj-glyph-step-forward");n=o[1].querySelector("span");e.removeClass(n,"wj-glyph-left");e.addClass(n,"wj-glyph-right");n=o[2].querySelector("span");e.removeClass(n,"wj-glyph-right");e.addClass(n,"wj-glyph-left");n=o[3].querySelector("span");e.removeClass(n,"wj-glyph-step-forward");e.addClass(n,"wj-glyph-step-backward")}else{n=o[0].querySelector("span");e.removeClass(n,"wj-glyph-step-forward");e.addClass(n,"wj-glyph-step-backward");n=o[1].querySelector("span");e.removeClass(n,"wj-glyph-right");e.addClass(n,"wj-glyph-left");n=o[2].querySelector("span");e.removeClass(n,"wj-glyph-left");e.addClass(n,"wj-glyph-right");n=o[3].querySelector("span");e.removeClass(n,"wj-glyph-step-backward");e.addClass(n,"wj-glyph-step-forward")}}};_SheetTabs.prototype._startEditingSheetName=function(t){var o,n=this,i=n._tabContainer.children[t],l=i.textContent;n._editingSheetTab=i;n._measureEle=document.createElement("span");n._measureEle.setAttribute(e.grid.FlexGrid._WJS_MEASURE,"true");n._measureEle.style.visibility="hidden";n.hostElement.appendChild(n._measureEle);i.innerHTML='<input type="text" style="width: '+(i.offsetWidth-40)+'px;"/>';o=i.children[0];e.addClass(o,"wj-sheet-name-editor wj-form-control");o.value=l;e.setSelectionRange(o,0,l.length);n.addEventListener(o,"keydown",(function(t){t.keyCode===e.Key.Enter?n._commitSheetName():n._measureInputWidth(t.key)}));n.addEventListener(o,"blur",n._commitSheetName.bind(n))};_SheetTabs.prototype._commitSheetName=function(){if(this._editingSheetTab){var t=this._editingSheetTab.children[0];this.removeEventListener(t);var o=t.value,n=this._getItemIndex(this._tabContainer,this._editingSheetTab);if(null!=o&&""!==o&&-1===this._sheets._getSheetIndexFrom(o)){this._sheets[n].name=o;this._editingSheetTab.textContent=o}else this._editingSheetTab.textContent=this._sheets[n].name;this._editingSheetTab=null;e.removeChild(this._measureEle);this._measureEle=null;this._adjustSize()}};_SheetTabs.prototype._measureInputWidth=function(e){if(this._editingSheetTab&&!(e.length>1)){var t=this._editingSheetTab.children[0],o=t.selectionStart,n=t.selectionEnd,i=t.value;if(null!=(i=i.substring(0,o)+e+i.substring(n))&&""!==i){this._measureEle.textContent=i;t.style.width=this._measureEle.offsetWidth+"px";this._adjustSize()}}};_SheetTabs.controlTemplate='<div wj-part="sheet-container" class="wj-sheet" style="height:100%;position:relative"><div wj-part="sheet-page" class="wj-btn-group wj-sheet-page"><button type="button" class="wj-btn wj-btn-default"><span class="wj-sheet-icon wj-glyph-step-backward"></span></button><button type="button" class="wj-btn wj-btn-default"><span class="wj-sheet-icon wj-glyph-left"></span></button><button type="button" class="wj-btn wj-btn-default"><span class="wj-sheet-icon wj-glyph-right"></span></button><button type="button" class="wj-btn wj-btn-default"><span class="wj-sheet-icon wj-glyph-step-forward"></span></button></div><div class="wj-sheet-tab" style="height:100%;overflow:hidden"><ul wj-part="container"></ul></div><div wj-part="new-sheet" class="wj-new-sheet"><span class="wj-sheet-icon wj-glyph-file"></span></div><div wj-part="context-menu" style="display:none;z-index:100"></div></div>';return _SheetTabs}(e.Control);t._SheetTabs=i;var l=function(){function _UnboundSortDescription(e,t){this._column=e;this._ascending=t}Object.defineProperty(_UnboundSortDescription.prototype,"column",{get:function(){return this._column},enumerable:!0,configurable:!0});Object.defineProperty(_UnboundSortDescription.prototype,"ascending",{get:function(){return this._ascending},enumerable:!0,configurable:!0});return _UnboundSortDescription}();t._UnboundSortDescription=l})((t=e.grid||(e.grid={})).sheet||(t.sheet={}))}(wijmo||(wijmo={}));!function(e){!function(t){!function(t){"use strict";var o=function(e){__extends(_TabHolder,e);function _TabHolder(t,o){var n=e.call(this,t)||this;n._splitterMousedownHdl=n._splitterMousedownHandler.bind(n);n._owner=o;n.applyTemplate("",n.getTemplate(),{_divSheet:"left",_divSplitter:"splitter",_divRight:"right"});n._init();return n}Object.defineProperty(_TabHolder.prototype,"sheetControl",{get:function(){return this._sheetControl},enumerable:!0,configurable:!0});Object.defineProperty(_TabHolder.prototype,"visible",{get:function(){return"none"!==this.hostElement.style.display},set:function(e){this.hostElement.style.display=e?"block":"none";this._divSheet.style.display=e?"block":"none"},enumerable:!0,configurable:!0});_TabHolder.prototype.getSheetBlanketSize=function(){return 20};_TabHolder.prototype.adjustSize=function(){var e=this._owner.scrollSize.width-this._owner.clientSize.width,t=(this._owner.scrollSize.height,this._owner.clientSize.height,this._divSplitter.parentElement);if(e<=0){t.style.minWidth="100px";this._divSplitter.style.display="none";this._divRight.style.display="none";this._divSheet.style.width="100%";this._divSplitter.removeEventListener("mousedown",this._splitterMousedownHdl,!0)}else{t.style.minWidth="300px";this._divSplitter.style.display="none";this._divRight.style.display="none";this._divSheet.style.width="100%";this._divSplitter.removeEventListener("mousedown",this._splitterMousedownHdl,!0);this._divSplitter.addEventListener("mousedown",this._splitterMousedownHdl,!0)}this._sheetControl._adjustSize()};_TabHolder.prototype._init=function(){var e=this;e._funSplitterMousedown=function(t){e._splitterMouseupHandler(t)};e._divSplitter.parentElement.style.height=e.getSheetBlanketSize()+"px";e._sheetControl=new t._SheetTabs(e._divSheet,this._owner)};_TabHolder.prototype._splitterMousedownHandler=function(e){this._startPos=e.pageX;document.addEventListener("mousemove",this._splitterMousemoveHandler.bind(this),!0);document.addEventListener("mouseup",this._funSplitterMousedown,!0);e.preventDefault()};_TabHolder.prototype._splitterMousemoveHandler=function(e){null!==this._startPos&&void 0!==this._startPos&&this._adjustDis(e.pageX-this._startPos)};_TabHolder.prototype._splitterMouseupHandler=function(e){document.removeEventListener("mousemove",this._splitterMousemoveHandler,!0);document.removeEventListener("mouseup",this._funSplitterMousedown,!0);this._adjustDis(e.pageX-this._startPos);this._startPos=null};_TabHolder.prototype._adjustDis=function(e){var t=this._divRight.offsetWidth-e,o=this._divSheet.offsetWidth+e;if(t<=100){t=100;e=this._divRight.offsetWidth-t;o=this._divSheet.offsetWidth+e}else if(o<=100){e=(o=100)-this._divSheet.offsetWidth;t=this._divRight.offsetWidth-e}if(0!=e){this._divRight.style.width=t+"px";this._divSheet.style.width=o+"px";this._startPos=this._startPos+e}};_TabHolder.controlTemplate='<div><div wj-part="left" style="float:left;height:100%;overflow:hidden"></div><div wj-part="splitter" style="float:left;height:100%;width:6px;background-color:#e9eaee;padding:2px;cursor:e-resize"><div style="background-color:#8a9eb2;height:100%"></div></div><div wj-part="right" style="float:left;height:100%;background-color:#e9eaee"></div></div>';return _TabHolder}(e.Control);t._TabHolder=o}(t.sheet||(t.sheet={}))}(e.grid||(e.grid={}))}(wijmo||(wijmo={}));!function(e){var t;(function(t){"use strict";var o=function(){function _Expression(e){e?e instanceof t._Token?this._token=e:this._token=new t._Token(e,t._TokenID.ATOM,t._TokenType.LITERAL):this._token=new t._Token(null,t._TokenID.ATOM,t._TokenType.IDENTIFIER)}Object.defineProperty(_Expression.prototype,"token",{get:function(){return this._token},enumerable:!0,configurable:!0});_Expression.prototype.evaluate=function(e,o,n,i,l){void 0===i&&(i=!0);void 0===l&&(l=!0);if(this._token.tokenType===t._TokenType.ERROR){if(l)throw this._token.value;return this._token.value}if(this._token.tokenType!==t._TokenType.LITERAL)throw new t.SyntaxError(t._ErrorMessages.BadExpression);return this._token.value};_Expression.toString=function(o,n,i,l){var r=o.evaluate(n,i,l);if(r instanceof t.FormulaError)throw r;e.isPrimitive(r)||(r=r.value);e.isString(r)&&"'"===r[0]&&(r=r.substr(1));e.isDate(r)&&(r=r.valueOf());return null!=r?r.toString():""};_Expression.toNumber=function(o,n,i,l){var r=o.evaluate(n,i,l);if(r instanceof t.FormulaError)throw r;e.isPrimitive(r)||(r=r.value);if(e.isNumber(r))return r;if(e.isBoolean(r))return r?1:0;if(e.isDate(r))return t.FlexSheet._toOADate(r);if(e.isString(r)){"'"===r[0]&&(r=r.substr(1));return r?isNaN(+r)?this.isDateValue(r)?t.FlexSheet._toOADate(new Date(r)):e.changeType(r,e.DataType.Number,""):+r:0}return e.changeType(r,e.DataType.Number,"")};_Expression.toBoolean=function(o,n,i,l){var r=o.evaluate(n,i,l);if(r instanceof t.FormulaError)throw r;e.isPrimitive(r)||(r=r.value);if(e.isBoolean(r))return r;if(e.isNumber(r))return 0!==r;e.isString(r)&&"'"===r[0]&&(r=r.substr(1));return e.changeType(r,e.DataType.Boolean,"")};_Expression.toDate=function(o,n,i,l){var r=o.evaluate(n,i,l);if(r instanceof t.FormulaError)throw r;e.isPrimitive(r)||(r=r.value);if(e.isDate(r))return r;if(e.isNumber(r))return t.FlexSheet._fromOADate(r);e.isString(r)&&"'"===r[0]&&(r=r.substr(1));return e.changeType(r,e.DataType.Date,"")};_Expression.isDateValue=function(o){var n,i=["January","February","March","April","May","June","July","August","September","October","November","December","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];o instanceof t.FormulaError||e.isPrimitive(o)||(o=o.value);if(!(n=e.isDate(o))&&e.isString(o)){"'"===o[0]&&(o=o.substr(1));if(!e.isNullOrWhiteSpace(o)&&isNaN(o)&&(o.indexOf("/")>0||o.indexOf("-")>0)&&!(n=!isNaN(Date.parse(o))))for(var l in i)if(o.indexOf(i[l])>-1){n=!0;break}}return n};_Expression.prototype._refersTo=function(e){return!1};_Expression.prototype._updateCellRangeExp=function(e,t,o,n,i,l){return!1};_Expression.prototype._moveCellRangeExp=function(e,t,o,n,i){void 0===n&&(n=!1);void 0===i&&(i=!1);return!1};_Expression.prototype._updateCellRangeExpForReorderingRows=function(e){return!1};_Expression.prototype._updateCellBoundary=function(e,t){return!1};_Expression.prototype._getStringExpression=function(){return null==this._token.value?"":e.isString(this._token.value)?'"'+this._token.value+'"':this._token.value.toString()};return _Expression}();t._Expression=o;var n=function(n){__extends(_UnaryExpression,n);function _UnaryExpression(e,t){var o=n.call(this,e)||this;o._expr=t;return o}_UnaryExpression.prototype.evaluate=function(n,i,l,r,s){void 0===r&&(r=!0);void 0===s&&(s=!0);if(this._expr.token.tokenType===t._TokenType.ERROR){if(s)throw this._expr.token.value;return this._expr.token.value}if(this.token.tokenID===t._TokenID.SUB){if(null==this._evaluatedValue){var a=o.toNumber(this._expr,n,i,l);this._evaluatedValue=e.isString(a)?NaN:-a}return this._evaluatedValue}if(this.token.tokenID===t._TokenID.ADD){if(null==this._evaluatedValue){a=o.toNumber(this._expr,n,i,l);this._evaluatedValue=e.isString(a)?NaN:+a}return this._evaluatedValue}throw new t.SyntaxError(t._ErrorMessages.BadExpression)};_UnaryExpression.prototype._refersTo=function(e){return this._expr._refersTo(e)};_UnaryExpression.prototype._updateCellRangeExp=function(e,t,o,n,i,l){return this._expr._updateCellRangeExp(e,t,o,n,i,l)};_UnaryExpression.prototype._moveCellRangeExp=function(e,t,o,n,i){void 0===n&&(n=!1);void 0===i&&(i=!1);return this._expr._moveCellRangeExp(e,t,o,n,i)};_UnaryExpression.prototype._updateCellRangeExpForReorderingRows=function(e){return this._expr._updateCellRangeExpForReorderingRows(e)};_UnaryExpression.prototype._getStringExpression=function(){return this.token.tokenID===t._TokenID.SUB?(this._inGroup?"(":"")+"-"+this._expr._getStringExpression()+(this._inGroup?")":""):this.token.tokenID===t._TokenID.ADD?(this._inGroup?"(":"")+"+"+this._expr._getStringExpression()+(this._inGroup?")":""):""};return _UnaryExpression}(o);t._UnaryExpression=n;var i=function(n){__extends(_BinaryExpression,n);function _BinaryExpression(e,t,o){var i=n.call(this,e)||this;i._leftExpr=t;i._rightExpr=o;return i}_BinaryExpression.prototype.evaluate=function(n,i,r,s,a){void 0===s&&(s=!0);void 0===a&&(a=!0);var h,u,d,c,_,g,f,p,w;if(null!=this._evaluatedValue)return this._evaluatedValue;if(this._leftExpr.token.tokenType===t._TokenType.ERROR){if(a)throw this._leftExpr.token.value;return this._leftExpr.token.value}if(this._rightExpr.token.tokenType===t._TokenType.ERROR){if(a)throw this._rightExpr.token.value;return this._rightExpr.token.value}h=o.toString(this._leftExpr,n,i,r);u=o.toString(this._rightExpr,n,i,r);if(this.token.tokenType===t._TokenType.CONCAT){this._evaluatedValue=h+u;return this._evaluatedValue}d=this._leftExpr.evaluate(n,i,r);if(!e.isPrimitive(d)){_=d.format;d=d.value}c=this._rightExpr.evaluate(n,i,r);if(!e.isPrimitive(c)){g=c.format;c=c.value}if(w=o.isDateValue(d)||o.isDateValue(c)){f=e.isDate(d)?t.FlexSheet._toOADate(d):e.isNumber(d)?d:t.FlexSheet._toOADate(new Date(d));p=e.isDate(c)?t.FlexSheet._toOADate(c):e.isNumber(c)?c:t.FlexSheet._toOADate(new Date(c))}else{f=o.toNumber(this._leftExpr,n,i,r);p=o.toNumber(this._rightExpr,n,i,r)}if(this.token.tokenType===t._TokenType.COMPARE){var m=void 0;this._leftExpr instanceof l&&this._leftExpr._isEmpty&&(d=null);this._rightExpr instanceof l&&this._rightExpr._isEmpty&&(c=null);var C=null==d;if(C!==(null==c))m=C?-1:1;else{var S=e.isBoolean(d);if(S!==e.isBoolean(c))m=S?1:-1;else{var b=e.isString(d),y=e.isString(c);m=s&&b!==y?b?1:-1:0!==d&&e.isNullOrWhiteSpace(d)||0!==c&&e.isNullOrWhiteSpace(c)?d===c?0:d<c?-1:1:f-p}}switch(this.token.tokenID){case t._TokenID.GT:return m>0;case t._TokenID.LT:return m<0;case t._TokenID.GE:return m>=0;case t._TokenID.LE:return m<=0;case t._TokenID.EQ:if(isNaN(m)){this._evaluatedValue=h.toLowerCase()===u.toLowerCase();return this._evaluatedValue}this._evaluatedValue=0===m;return this._evaluatedValue;case t._TokenID.NE:if(isNaN(m)){this._evaluatedValue=h.toLowerCase()!==u.toLowerCase();return this._evaluatedValue}this._evaluatedValue=0!==m;return this._evaluatedValue}}switch(this.token.tokenID){case t._TokenID.ADD:this._evaluatedValue=f+p;break;case t._TokenID.SUB:this._evaluatedValue=f-p;break;case t._TokenID.MUL:this._evaluatedValue=f*p;break;case t._TokenID.DIV:if(0===p)throw this._evaluatedValue=new t.DivideByZeroError;this._evaluatedValue=f/p;break;case t._TokenID.DIVINT:if(0===p)throw this._evaluatedValue=new t.DivideByZeroError;this._evaluatedValue=Math.floor(f/p);break;case t._TokenID.MOD:if(0===p)throw this._evaluatedValue=new t.DivideByZeroError;this._evaluatedValue=Math.floor(f%p);break;case t._TokenID.POWER:0===p&&(this._evaluatedValue=1);.5===p&&(this._evaluatedValue=Math.sqrt(f));1===p&&(this._evaluatedValue=f);2===p&&(this._evaluatedValue=f*f);3===p&&(this._evaluatedValue=f*f*f);4===p&&(this._evaluatedValue=f*f*f*f);this._evaluatedValue=Math.pow(f,p);break;default:this._evaluatedValue=NaN}if(!isNaN(this._evaluatedValue)){w&&(this._evaluatedValue={value:t.FlexSheet._fromOADate(this._evaluatedValue),format:_||g});return this._evaluatedValue}throw new t.SyntaxError(t._ErrorMessages.BadExpression)};_BinaryExpression.prototype._refersTo=function(e){return this._leftExpr._refersTo(e)||this._rightExpr._refersTo(e)};_BinaryExpression.prototype._updateCellRangeExp=function(e,t,o,n,i,l){var r,s=!1;r=this._leftExpr._updateCellRangeExp(e,t,o,n,i,l);s=s||r;r=this._rightExpr._updateCellRangeExp(e,t,o,n,i,l);return s||r};_BinaryExpression.prototype._moveCellRangeExp=function(e,t,o,n,i){void 0===n&&(n=!1);void 0===i&&(i=!1);var l,r=!1;l=this._leftExpr._moveCellRangeExp(e,t,o,n,i);r=r||l;l=this._rightExpr._moveCellRangeExp(e,t,o,n,i);return r||l};_BinaryExpression.prototype._updateCellRangeExpForReorderingRows=function(e){var t,o=!1;t=this._leftExpr._updateCellRangeExpForReorderingRows(e);o=o||t;t=this._rightExpr._updateCellRangeExpForReorderingRows(e);return o||t};_BinaryExpression.prototype._getStringExpression=function(){var e;switch(this.token.tokenID){case t._TokenID.GT:e=">";break;case t._TokenID.LT:e="<";break;case t._TokenID.GE:e=">=";break;case t._TokenID.LE:e="<=";break;case t._TokenID.EQ:e="=";break;case t._TokenID.NE:e="<>";break;case t._TokenID.ADD:e="+";break;case t._TokenID.SUB:e="-";break;case t._TokenID.MUL:e="*";break;case t._TokenID.DIV:e="/";break;case t._TokenID.DIVINT:e="\\";break;case t._TokenID.POWER:e="^";break;case t._TokenID.CONCAT:e="&";break;default:return""}return(this._inGroup?"(":"")+this._leftExpr._getStringExpression()+e+this._rightExpr._getStringExpression()+(this._inGroup?")":"")};return _BinaryExpression}(o);t._BinaryExpression=i;var l=function(o){__extends(_CellRangeExpression,o);function _CellRangeExpression(t,n,i,l,r,s,a,h,u){void 0===l&&(l=!0);void 0===r&&(r=!1);void 0===s&&(s=!1);void 0===a&&(a=!1);void 0===h&&(h=!1);var d=o.call(this)||this;d._cells=new e.grid.CellRange(t.topRow,t.leftCol,t.bottomRow,t.rightCol);d._sheetRef=n;d._flex=i;d._evalutingRange={};d._isCellRange=l;d._absRow=r;d._absCol=s;d._absRow2=a;d._absCol2=h;d._isWholeRow=u;return d}_CellRangeExpression.prototype.evaluate=function(e,t,o,n,i){void 0===n&&(n=!0);void 0===i&&(i=!0);if(null==this._evaluatedValue){var l=this._extendRange(o),r=this._getCellValue(l,o,e,t,i,!0);this._isEmpty=null==r;null==r&&(r="");this._evaluatedValue=r}return this._evaluatedValue};_CellRangeExpression.prototype.getValues=function(o,n,i,l){void 0===o&&(o=!0);void 0===l&&(l=!0);var r,s,a,h,u,d=[],c=0;if(!(i=this._getSheet()||i||this._flex.selectedSheet))return null;u=this._extendRange(i);a=null==n||isNaN(+n)?u.leftCol:n;h=null==n||isNaN(+n)?u.rightCol:n;var _=new e.grid.CellRange;for(s=u.topRow;s<=u.bottomRow&&s<i.grid.rows.length;s++)if(o||!1!==i.grid.rows[s].isVisible)for(n=a;n<=h&&n<i.grid.columns.length;n++){_.col=n;_.col2=n;_.row=s;_.row2=s;(r=this._getCellValue(_,i,void 0,void 0,l))instanceof t.FormulaError||e.isPrimitive(r)||(r=r.value);d[c]=r;c++}return d};_CellRangeExpression.prototype.getValuesWithTwoDimensions=function(o,n){void 0===o&&(o=!0);var i,l,r,s,a,h=[],u=0,d=0;if(!(n=this._getSheet()||n||this._flex.selectedSheet))return null;for(r=(a=this._extendRange(n)).topRow;r<=a.bottomRow&&r<n.grid.rows.length;r++)if(o||!1!==n.grid.rows[r].isVisible){l=[];d=0;for(s=a.leftCol;s<=a.rightCol&&s<n.grid.columns.length;s++)if(o||!1!==n.grid.columns[s].isVisible){(i=this._getCellValue(new e.grid.CellRange(r,s),n))instanceof t.FormulaError||e.isPrimitive(i)||(i=i.value);l[d]=i;d++}else d++;h[u]=l;u++}else u++;return h};Object.defineProperty(_CellRangeExpression.prototype,"cells",{get:function(){return this._cells},enumerable:!0,configurable:!0});Object.defineProperty(_CellRangeExpression.prototype,"sheetRef",{get:function(){return this._sheetRef},enumerable:!0,configurable:!0});_CellRangeExpression.prototype._getCellValue=function(e,o,n,i,l,r){void 0===l&&(l=!0);var s,a,h;if(!(o=this._getSheet()||o||this._flex.selectedSheet))return null;if(e.isSingleCell){a=e.row;h=e.col}else{if(null!=n&&n>=e.topRow&&n<=e.bottomRow&&e.col===e.col2){a=n;h=e.col}if(null!=i&&i>=e.leftCol&&i<=e.rightCol&&e.row===e.row2){a=e.row;h=i}}if(null==a||null==h)throw new t.ReferenceError(t._ErrorMessages.InvalidCellRef);s=o.name+":"+a+","+h+"-"+a+","+h;if(this._evalutingRange[s])throw new t.SyntaxError(t._ErrorMessages.CircRef);try{if(this._flex){this._evalutingRange[s]=!0;var u=o===this._flex.selectedSheet?this._flex:o.grid;if(a<u.rows.length&&h<u.columns.length){var d=o.grid.columns[h],c=this._flex.getCellValue(a,h,!!r&&0,o);if(c instanceof t.FormulaError){if(l)throw c;return c}d.dataMap&&!r&&(c=d.dataMap.getDisplayValue(c));return c}return 0}}finally{delete this._evalutingRange[s]}};_CellRangeExpression.prototype._getSheet=function(){if(!this._sheetRef)return null;var e=this._flex._getSheet(this._sheetRef);if(!e)throw new t.ReferenceError(t._ErrorMessages.InvalidSheetRef);return e};_CellRangeExpression.prototype._refersTo=function(e){return e.contains(this.cells)};_CellRangeExpression.prototype._updateCellRangeExp=function(e,t,o,n,i,l){var r=this._cells,s=!1;if(this._tableParams&&this._tableParams.length>0)return!1;if(e===this._flex.selectedSheetIndex){if(this._sheetRef&&this._sheetRef.toLowerCase()!==this._flex.selectedSheet.name.toLowerCase())return!1}else if(!this._sheetRef||this._sheetRef.toLowerCase()!==this._flex.selectedSheet.name.toLowerCase())return!1;if(i){if(null==this._isWholeRow||this._isWholeRow){if(l&&(r.leftCol>l.rightCol||r.rightCol<l.leftCol))return!1;if(n){if(r.topRow>=t){r.row+=o;r.row2+=o;s=!0}else if(r.topRow<t&&r.bottomRow>=t){r.row2+=o;s=!0}}else if(r.topRow>t){r.row-=o;r.row2-=o;s=!0}else if(r.isSingleCell){if(r.row>=t-o+1){r.row=t-o+1;r.row2=t-o+1;s=!0}}else if(r.topRow>=t-o+1){r.row=t-o+1;r.row2-=o;s=!0}else if(r.topRow<t-o+1&&r.bottomRow>=t-o+1){r.bottomRow>t?r.row2-=o:r.row2=t-o;s=!0}}}else if(null==this._isWholeRow||!this._isWholeRow){if(l&&(r.topRow>l.bottomRow||r.bottomRow<l.topRow))return!1;if(n){if(r.leftCol>=t){r.col+=o;r.col2+=o;s=!0}else if(r.leftCol<t&&r.rightCol>=t){r.col2+=o;s=!0}}else if(r.leftCol>t){r.col-=o;r.col2-=o;s=!0}else if(r.isSingleCell){if(r.col>=t-o+1){r.col=t-o+1;r.col2=t-o+1;s=!0}}else if(r.leftCol>=t-o+1){r.col=t-o+1;r.col2-=o;s=!0}else if(r.leftCol<t-o+1&&r.rightCol>=t-o+1){r.rightCol>t?r.col2-=o:r.col2=t-o;s=!0}}return s};_CellRangeExpression.prototype._moveCellRangeExp=function(e,t,o,n,i){void 0===n&&(n=!1);void 0===i&&(i=!1);var l,r,s=this._cells,a=!1;if(this._tableParams&&this._tableParams.length>0)return!1;if(this._flex.selectedSheetIndex!=e&&(!this._sheetRef||this._sheetRef.toLowerCase()!==this._flex.selectedSheet.name.toLowerCase()))return!1;if(!i&&this._flex.selectedSheetIndex==e&&this._sheetRef&&this._sheetRef.toLowerCase()!==this._flex.selectedSheet.name.toLowerCase())return!1;l=o.topRow-t.topRow;r=o.leftCol-t.leftCol;if(i){if(0!==l&&(null==this._isWholeRow||this._isWholeRow)){s.row+=i&&this._absRow?0:l;s.row2+=this._isCellRange?i&&this._absRow2?0:l:i&&this._absRow?0:l;a=!0}if(0!==r&&(null==this._isWholeRow||!this._isWholeRow)){s.col+=i&&this._absCol?0:r;s.col2+=this._isCellRange?i&&this._absCol2?0:r:i&&this._absCol?0:r;a=!0}return a}if(t.contains(s)){if(0!==l&&(null==this._isWholeRow||this._isWholeRow)){s.row+=l;s.row2+=l;a=!0}if(0!==r&&(null==this._isWholeRow||!this._isWholeRow)){s.col+=r;s.col2+=r;a=!0}}else if(t.intersects(s)){if(t.intersectsRow(s)){var h=t.topRow>=s.topRow&&t.bottomRow<=s.bottomRow;if(0!==l&&(null==this._isWholeRow||this._isWholeRow))if(t.topRow<=s.topRow){if(l<0){s.row+=l;a=!0}else if(l>0){var u=h&&o.bottomRow<s.bottomRow;if(n&&!u){t.topRow<s.topRow&&(s.row-=s.topRow-t.topRow);s.row2-=t.rowSpan;a=!0}}}else if(t.bottomRow>=s.bottomRow){if(l>0){s.row2+=l;a=!0}else if(l<0){var d=h&&o.topRow>s.topRow;if(n&&!d){t.bottomRow>s.bottomRow&&(s.row2+=t.bottomRow-s.bottomRow);s.row+=t.rowSpan;a=!0}}}else if(n){l<0&&o.topRow<=s.topRow&&(s.row+=t.rowSpan);l>0&&o.bottomRow>=s.bottomRow&&(s.row2-=t.rowSpan);a=!0}}if(t.intersectsColumn(s)&&0!==r&&(null==this._isWholeRow||!this._isWholeRow))if(t.leftCol<=s.leftCol){if(r<0){s.col+=r;a=!0}else if(r>0&&n){t.leftCol<s.leftCol&&(s.col-=s.leftCol-t.leftCol);s.col2-=t.columnSpan;a=!0}}else if(t.rightCol>=s.rightCol){if(r>0){s.col2+=r;a=!0}else if(r<0&&n){t.rightCol>s.rightCol&&(s.col2+=t.rightCol-s.rightCol);s.col+=t.columnSpan;a=!0}}else if(n){r<0?s.col+=t.columnSpan:s.col2-=t.columnSpan;a=!0}}else if(n){if(null==this._isWholeRow||this._isWholeRow)if(s.row!==s.row2&&s.containsRow(o.topRow)){l<0?s.row2+=o.rowSpan:s.row=Math.max(0,s.row-o.rowSpan);a=!0}else{if(s.topRow>=o.topRow&&s.topRow<t.topRow&&l<0){s.row+=o.rowSpan;s.row2+=o.rowSpan;a=!0}if(s.topRow>t.bottomRow&&s.bottomRow<=o.bottomRow&&l>0){s.row-=o.rowSpan;s.row2-=o.rowSpan;a=!0}}if(null==this._isWholeRow||!this._isWholeRow)if(s.col!==s.col2&&s.containsColumn(o.leftCol)){r<0?s.col2+=o.columnSpan:s.col=Math.max(0,s.col-o.columnSpan);a=!0}else{if(s.leftCol>=o.leftCol&&s.leftCol<t.leftCol&&r<0){s.col+=o.columnSpan;s.col2+=o.columnSpan;a=!0}if(s.leftCol>t.rightCol&&s.rightCol<=o.rightCol&&r>0){s.col-=o.columnSpan;s.col2-=o.columnSpan;a=!0}}}return a};_CellRangeExpression.prototype._updateCellRangeExpForReorderingRows=function(e){var t,o=this._cells;if(null==this._isWholeRow||this._isWholeRow){(t=this._cells.row+e)<0?t=0:t>=this._flex.rows.length&&(t=this._flex.rows.length-1);o.row=t;this._isCellRange&&((t=this._cells.row2+e)<0?t=0:t>=this._flex.rows.length&&(t=this._flex.rows.length-1));o.row2=t}return!0};_CellRangeExpression.prototype._updateCellBoundary=function(e,t){var o=this._cells;if(this._sheetRef&&this._sheetRef.toLowerCase()!==this._flex.selectedSheet.name.toLowerCase())return!1;if(o.row===o.row2&&o.row===e&&t===o.col2+1){o.col2+=1;return!0}if(o.col===o.col2&&o.col===t&&e===o.row2+1){o.row2+=1;return!0}return!1};_CellRangeExpression.prototype._getStringExpression=function(){if(this._tableParams&&this._tableParams.length>0)return this._getTableParamsStringExpression();var t=this._quoteName(this._sheetRef);return(t?t+"!":"")+e.xlsx.Workbook.xlsxAddress(this._cells.row,this._cells.col,this._absRow,this._absCol,this._isWholeRow)+(this._isCellRange?":"+e.xlsx.Workbook.xlsxAddress(this._cells.row2,this._cells.col2,this._absRow2,this._absCol2,this._isWholeRow):"")};_CellRangeExpression.prototype._quoteName=function(e){e&&(/[\s\-!\$]/.test(e)||/^\d/.test(e))&&(e="'"+e+"'");return e};_CellRangeExpression.prototype._getTableParamsStringExpression=function(){for(var e,t=0,o="",n=this._tableParams.length,i=!1;t<n;t++)if("#"===(e=this._tableParams[t])[0]){o+="["+e+"]";t<n-1&&(o+=", ")}else if(i)o+=": ["+e+"]";else{o+="["+e+"]";i=!0}n>1&&(o="["+o+"]");this._tableName&&(o=this._tableName+o);return o};_CellRangeExpression.prototype._extendRange=function(e){var t=this._cells.clone();if(null!=this._isWholeRow)if(this._isWholeRow){t.col=0;t.col2=e?e.grid.columns.length-1:this._flex.columns.length-1}else{t.row=0;t.row2=e?e.grid.rows.length-1:this._flex.rows.length-1}return t};return _CellRangeExpression}(o);t._CellRangeExpression=l;var r=function(e){__extends(_FunctionExpression,e);function _FunctionExpression(t,o,n,i){void 0===i&&(i=!0);var l=e.call(this)||this;l._funcId=t;l._funcDefinition=o;l._params=n;l._needCacheEvaluatedVal=i;return l}_FunctionExpression.prototype.evaluate=function(e,t,o){if(!this._needCacheEvaluatedVal)return this._funcDefinition.func(this._params,o,e,t);null==this._evaluatedValue&&(this._evaluatedValue=this._funcDefinition.func(this._params,o,e,t));return this._evaluatedValue};_FunctionExpression.prototype._refersTo=function(e){if(this._params)for(var t=0;t<this._params.length;t++)if(this._params[t]._refersTo(e))return!0;return!1};_FunctionExpression.prototype._updateCellRangeExp=function(e,t,o,n,i,l){var r,s,a=!1;if(this._params&&this._params.length>0)for(r=0;r<this._params.length;r++){s=this._params[r]._updateCellRangeExp(e,t,o,n,i,l);a||(a=a||s)}return a};_FunctionExpression.prototype._moveCellRangeExp=function(e,t,o,n,i){void 0===n&&(n=!1);void 0===i&&(i=!1);var l,r,s=!1;if(this._params&&this._params.length>0)for(l=0;l<this._params.length;l++){r=this._params[l]._moveCellRangeExp(e,t,o,n,i);s||(s=s||r)}return s};_FunctionExpression.prototype._updateCellRangeExpForReorderingRows=function(e){var t,o,n=!1;if(this._params&&this._params.length>0)for(t=0;t<this._params.length;t++){o=this._params[t]._updateCellRangeExpForReorderingRows(e);n||(n=n||o)}return n};_FunctionExpression.prototype._updateCellBoundary=function(e,t){var o;return!!(this._params&&1===this._params.length&&(o=this._params[0])instanceof l)&&o._updateCellBoundary(e,t)};_FunctionExpression.prototype._getStringExpression=function(){return this._funcId+this._parseParamsExpToString()};_FunctionExpression.prototype._parseParamsExpToString=function(){var e,t;if(this._params&&this._params.length>0){t="";for(e=0;e<this._params.length;e++){0===e&&(t+="(");t+=this._params[e]._getStringExpression();e<this._params.length-1?t+=", ":t+=")"}return t}return"()"};return _FunctionExpression}(o);t._FunctionExpression=r})((t=e.grid||(e.grid={})).sheet||(t.sheet={}))}(wijmo||(wijmo={}));!function(e){!function(t){!function(t){"use strict";var o=function(){function _CalcEngine(t){this._expressionCache={};this._idChars="$:!";this._functionTable={};this._cacheSize=0;this._tableRefStart=!1;this.unknownFunction=new e.Event;this._owner=t;this._buildSymbolTable();this._registerAggregateFunction();this._registerMathFunction();this._registerLogicalFunction();this._registerTextFunction();this._registerDateFunction();this._registLookUpReferenceFunction();this._registFinacialFunction();this._registAddressRelatedFunction();this._registerErrorFunctions()}_CalcEngine.prototype.onUnknownFunction=function(e,o){var n,i;if(o&&o.length>0){n=[];for(var l=0;l<o.length;l++)n[l]=o[l].evaluate(this._rowIndex,this._columnIndex)}i=new t.UnknownFunctionEventArgs(e,n);this.unknownFunction.raise(this,i);if(null!=i.value)return new t._Expression(i.value);throw new t.NameError(t._ErrorMessages.UnkFuncName(e))};_CalcEngine.prototype.evaluate=function(o,n,i,l,r,s){void 0===s&&(s=!0);var a,h;if(!this._owner.enableFormulas)return o;try{if(t._isFormula(o)){this._containsCellRef=!1;this._rowIndex=l;this._columnIndex=r;this._sheet=i||this._owner.selectedSheet;h=(a=this._checkCache(o,s)).evaluate(l,r,i,s);for(;h instanceof t._Expression;)h=h.evaluate(l,r,i,s);return n&&e.isPrimitive(h)?e.Globalize.format(h,n):h}return o||""}catch(e){var u=e instanceof t.FormulaError?e:new t.UnknownError(e);a&&(a._evaluatedValue=u);return u}};_CalcEngine.prototype.addCustomFunction=function(e,o,n,i){var l=this;e=e.toLowerCase();this._functionTable[e]=new a((function(e){var n,i=[];if(e&&e.length>0)for(var r=0;r<e.length;r++)(n=e[r])instanceof t._CellRangeExpression?i[r]=n.cells:i[r]=n.evaluate(l._rowIndex,l._columnIndex);return o.apply(l,i)}),i,n)};_CalcEngine.prototype.addFunction=function(e,o,n,i){var l=this;e=e.toLowerCase();this._functionTable[e]=new a((function(e){var n,i=[];if(e&&e.length>0)for(var r=0;r<e.length;r++)(n=e[r])instanceof t._CellRangeExpression?i[r]=n.getValuesWithTwoDimensions():i[r]=[[n.evaluate(l._rowIndex,l._columnIndex)]];return o.apply(l,i)}),i,n)};_CalcEngine.prototype._clearExpressionCache=function(){this._expressionCache=null;this._expressionCache={};this._cacheSize=0};_CalcEngine.prototype._parse=function(e){this._expression=e;this._expressLength=e?e.length:0;this._pointer=0;this._expressLength>0&&"="===this._expression[0]&&this._pointer++;return this._parseExpression()};_CalcEngine.prototype._buildSymbolTable=function(){if(!this._tokenTable){this._tokenTable={};this._addToken("+",l.ADD,i.ADDSUB);this._addToken("-",l.SUB,i.ADDSUB);this._addToken("(",l.OPEN,i.GROUP);this._addToken(")",l.CLOSE,i.GROUP);this._addToken("*",l.MUL,i.MULDIV);this._addToken(",",l.COMMA,i.GROUP);this._addToken(".",l.PERIOD,i.GROUP);this._addToken("/",l.DIV,i.MULDIV);this._addToken("\\",l.DIVINT,i.MULDIV);this._addToken("=",l.EQ,i.COMPARE);this._addToken(">",l.GT,i.COMPARE);this._addToken("<",l.LT,i.COMPARE);this._addToken("^",l.POWER,i.POWER);this._addToken("<>",l.NE,i.COMPARE);this._addToken(">=",l.GE,i.COMPARE);this._addToken("<=",l.LE,i.COMPARE);this._addToken("&",l.CONCAT,i.CONCAT);this._addToken("[",l.OPEN,i.SQUAREBRACKETS);this._addToken("]",l.CLOSE,i.SQUAREBRACKETS)}};_CalcEngine.prototype._registerAggregateFunction=function(){var t=this;t._functionTable.sum=new a((function(o,n){return t._getAggregateResult(e.Aggregate.Sum,o,n)}));t._functionTable.average=new a((function(o,n){return t._getAggregateResult(e.Aggregate.Avg,o,n)}));t._functionTable.max=new a((function(o,n){return t._getAggregateResult(e.Aggregate.Max,o,n)}));t._functionTable.min=new a((function(o,n){return t._getAggregateResult(e.Aggregate.Min,o,n)}));t._functionTable.var=new a((function(o,n){return t._getAggregateResult(e.Aggregate.Var,o,n)}));t._functionTable.varp=new a((function(o,n){return t._getAggregateResult(e.Aggregate.VarPop,o,n)}));t._functionTable.stdev=new a((function(o,n){return t._getAggregateResult(e.Aggregate.Std,o,n)}));t._functionTable.stdevp=new a((function(o,n){return t._getAggregateResult(e.Aggregate.StdPop,o,n)}));t._functionTable.count=new a((function(e,o){return t._getFlexSheetAggregateResult(r.Count,e,o)}));t._functionTable.counta=new a((function(e,o){return t._getFlexSheetAggregateResult(r.CountA,e,o)}));t._functionTable.countblank=new a((function(e,o){return t._getFlexSheetAggregateResult(r.CountBlank,e,o)}));t._functionTable.countif=new a((function(e,o){return t._getFlexSheetAggregateResult(r.CountIf,e,o)}),2,2);t._functionTable.countifs=new a((function(e,o){return t._getFlexSheetAggregateResult(r.CountIfs,e,o)}),254,2);t._functionTable.sumif=new a((function(e,o){return t._getFlexSheetAggregateResult(r.SumIf,e,o)}),3,2);t._functionTable.sumifs=new a((function(e,o){return t._getFlexSheetAggregateResult(r.SumIfs,e,o)}),255,2);t._functionTable.rank=new a((function(e,o){return t._getFlexSheetAggregateResult(r.Rank,e,o)}),3,2);t._functionTable.product=new a((function(e,o){return t._getFlexSheetAggregateResult(r.Product,e,o)}),255,1);t._functionTable.subtotal=new a((function(e,o){return t._handleSubtotal(e,o)}),255,2);t._functionTable.dcount=new a((function(e,o){return t._handleDCount(e,o)}),3,3);t._functionTable.sumproduct=new a((function(e,o){return t._getSumProduct(e,o)}),255,1)};_CalcEngine.prototype._registerMathFunction=function(){var e=this;e._functionTable.pi=new a((function(){return Math.PI}),0,0);e._functionTable.rand=new a((function(){return Math.random()}),0,0);e._functionTable.power=new a((function(o,n){return Math.pow(t._Expression.toNumber(o[0],e._rowIndex,e._columnIndex,n),t._Expression.toNumber(o[1],e._rowIndex,e._columnIndex,n))}),2,2);e._functionTable.atan2=new a((function(o,n){var i=t._Expression.toNumber(o[0],e._rowIndex,e._columnIndex,n),l=t._Expression.toNumber(o[1],e._rowIndex,e._columnIndex,n);if(0===i&&0===l)throw new t.DivideByZeroError(t._ErrorMessages.Atan2ArgsLessThanZero);return Math.atan2(l,i)}),2,2);e._functionTable.mod=new a((function(o,n){var i=t._Expression.toNumber(o[0],e._rowIndex,e._columnIndex,n),l=t._Expression.toNumber(o[1],e._rowIndex,e._columnIndex,n),r=Math.abs(l);if(0===r)throw new t.DivideByZeroError;var s=Math.abs(i)%r;l<0&&(s=-s);return s}),2,2);e._functionTable.trunc=new a((function(o,n){var i,l,r,s=t._Expression.toNumber(o[0],e._rowIndex,e._columnIndex,n),a=2===o.length?t._Expression.toNumber(o[1],e._rowIndex,e._columnIndex,n):0;if(0===a){r="n0";l=s>=0?Math.floor(s):Math.ceil(s)}else{r="n"+((a=a>0?Math.floor(a):Math.ceil(a))>0?a:0);i=Math.pow(10,a);l=s>=0?Math.floor(s*i)/i:Math.ceil(s*i)/i}if(null!=l)return{value:l,format:r}}),2,1);["ceiling","floor"].forEach((function(o){e._functionTable[o]=new a((function(n,i){var l,r,s=t._Expression.toNumber(n[0],e._rowIndex,e._columnIndex,i),a=2===n.length?t._Expression.toNumber(n[1],e._rowIndex,e._columnIndex,i):1;if(isNaN(s))throw new t.ValueError(t._ErrorMessages.InvalidParameter("number"));if(isNaN(a))throw new t.ValueError(t._ErrorMessages.InvalidParameter("significance"));if(s>0&&a<0)throw new t.NumericError(t._ErrorMessages.InvalidParameter("significance"));if(0===s||0===a)return 0;r=1;if(0!==(l=a-Math.floor(a)))for(;l<1;){r*=10;l*=10}return a*r*("ceiling"===o?Math.ceil(s/a):Math.floor(s/a))/r}),2,1)}));["round","rounddown","roundup"].forEach((function(o){e._functionTable[o]=new a((function(n,i){var l,r,s,a,h=t._Expression.toNumber(n[0],e._rowIndex,e._columnIndex,i),u=t._Expression.toNumber(n[1],e._rowIndex,e._columnIndex,i);if(0===u){switch(o){case"rounddown":l=h>=0?Math.floor(h):Math.ceil(h);break;case"roundup":l=h>=0?Math.ceil(h):Math.floor(h);break;case"round":a=h>=0?0:.1;l=Math.round(h-a);break;default:l=Math.floor(h)}r="n0"}else{u=u>0?Math.floor(u):Math.ceil(u);s=Math.pow(10,u);switch(o){case"rounddown":l=h>=0?Math.floor(h*s)/s:Math.ceil(h*s)/s;break;case"roundup":l=h>=0?Math.ceil(h*s)/s:Math.floor(h*s)/s;break;case"round":a=h>=0?0:1*s/10;l=Math.round(h*s-a)/s}r="n"+(u>0?u:0)}if(null!=l)return{value:l,format:r}}),2,2)}));["abs","acos","asin","atan","cos","exp","ln","sin","sqrt","tan"].forEach((function(o){e._functionTable[o]=new a((function(n,i){return"ln"===o?Math.log(t._Expression.toNumber(n[0],e._rowIndex,e._columnIndex,i)):Math[o](t._Expression.toNumber(n[0],e._rowIndex,e._columnIndex,i))}),1,1)}))};_CalcEngine.prototype._registerLogicalFunction=function(){var e=this;e._functionTable.and=new a((function(o,n){var i,l=!0;for(i=0;i<o.length&&(l=l&&t._Expression.toBoolean(o[i],e._rowIndex,e._columnIndex,n));i++);return l}),Number.MAX_VALUE,1);e._functionTable.or=new a((function(o,n){var i,l=!1;for(i=0;i<o.length&&!(l=l||t._Expression.toBoolean(o[i],e._rowIndex,e._columnIndex,n));i++);return l}),Number.MAX_VALUE,1);e._functionTable.not=new a((function(o,n){return!t._Expression.toBoolean(o[0],e._rowIndex,e._columnIndex,n)}),1,1);e._functionTable.if=new a((function(o,n){return 3===o.length?t._Expression.toBoolean(o[0],e._rowIndex,e._columnIndex,n)?o[1].evaluate(e._rowIndex,e._columnIndex,n):o[2].evaluate(e._rowIndex,e._columnIndex,n):!!t._Expression.toBoolean(o[0],e._rowIndex,e._columnIndex,n)&&o[1].evaluate(e._rowIndex,e._columnIndex,n)}),3,2);e._functionTable.true=new a((function(){return!0}),0,0);e._functionTable.false=new a((function(){return!1}),0,0)};_CalcEngine.prototype._registerTextFunction=function(){var o=this;o._functionTable.char=new a((function(e,n){var i,l="";for(i=0;i<e.length;i++)l+=String.fromCharCode(t._Expression.toNumber(e[i],o._rowIndex,o._columnIndex,n));return l}),Number.MAX_VALUE,1);o._functionTable.code=new a((function(e,n){var i=t._Expression.toString(e[0],o._rowIndex,o._columnIndex,n);return i&&i.length>0?i.charCodeAt(0):-1}),1,1);o._functionTable.concatenate=new a((function(e,n){var i,l="";for(i=0;i<e.length;i++)l=l.concat(t._Expression.toString(e[i],o._rowIndex,o._columnIndex,n));return l}),Number.MAX_VALUE,1);o._functionTable.left=new a((function(e,n){var i=t._Expression.toString(e[0],o._rowIndex,o._columnIndex,n),l=null==e[1]?1:Math.floor(t._Expression.toNumber(e[1],o._rowIndex,o._columnIndex,n));return i&&i.length>0?i.slice(0,l):null}),2,1);o._functionTable.right=new a((function(e,n){var i=t._Expression.toString(e[0],o._rowIndex,o._columnIndex,n),l=null==e[1]?1:Math.floor(t._Expression.toNumber(e[1],o._rowIndex,o._columnIndex,n));return i&&i.length>0?l?i.slice(-l):"":null}),2,1);o._functionTable.find=new a((function(n,i){var l,r=t._Expression.toString(n[0],o._rowIndex,o._columnIndex,i),s=t._Expression.toString(n[1],o._rowIndex,o._columnIndex,i),a=null!=n[2]?e.asInt(t._Expression.toNumber(n[2],o._rowIndex,o._columnIndex,i)):0;return null!=s&&null!=r&&(l=!isNaN(a)&&a>0&&a<=s.length?s.indexOf(r,a-1):s.indexOf(r))>-1?l+1:-1}),3,2);o._functionTable.search=new a((function(n,i){var l,r,s,a=t._Expression.toString(n[0],o._rowIndex,o._columnIndex,i),h=t._Expression.toString(n[1],o._rowIndex,o._columnIndex,i),u=null!=n[2]?e.asInt(t._Expression.toNumber(n[2],o._rowIndex,o._columnIndex,i)):0;if(null!=h&&null!=a){r=new RegExp(a,"i");if(!isNaN(u)&&u>0&&u<h.length){h=h.substring(u-1);l=u}else l=1;if((s=h.search(r))>-1)return s+l}return-1}),3,2);o._functionTable.len=new a((function(e,n){var i=t._Expression.toString(e[0],o._rowIndex,o._columnIndex,n);return null!=i?i.length:-1}),1,1);o._functionTable.mid=new a((function(e,n){var i=t._Expression.toString(e[0],o._rowIndex,o._columnIndex,n),l=Math.floor(t._Expression.toNumber(e[1],o._rowIndex,o._columnIndex,n)),r=Math.floor(t._Expression.toNumber(e[2],o._rowIndex,o._columnIndex,n));return i&&i.length>0&&l>0?i.substr(l-1,r):null}),3,3);o._functionTable.lower=new a((function(e,n){var i=t._Expression.toString(e[0],o._rowIndex,o._columnIndex,n);return i&&i.length>0?i.toLowerCase():null}),1,1);o._functionTable.upper=new a((function(e,n){var i=t._Expression.toString(e[0],o._rowIndex,o._columnIndex,n);return i&&i.length>0?i.toUpperCase():null}),1,1);o._functionTable.proper=new a((function(e,n){var i=t._Expression.toString(e[0],o._rowIndex,o._columnIndex,n);if(i&&i.length>0){i=(i=i.toLowerCase())[0].toUpperCase()+i.substring(1);for(var l=1;l<i.length;l++)if(h.test(i[l])&&!h.test(i[l-1])){i=i.substr(0,l)+i[l].toUpperCase()+i.substring(l+1);l++}return i}return null}),1,1);o._functionTable.trim=new a((function(e,n){var i=t._Expression.toString(e[0],o._rowIndex,o._columnIndex,n);return i&&i.length>0?i.trim().replace(/\s+/gm," "):null}),1,1);o._functionTable.replace=new a((function(e,n){var i=t._Expression.toString(e[0],o._rowIndex,o._columnIndex,n),l=Math.floor(t._Expression.toNumber(e[1],o._rowIndex,o._columnIndex,n)),r=Math.floor(t._Expression.toNumber(e[2],o._rowIndex,o._columnIndex,n)),s=t._Expression.toString(e[3],o._rowIndex,o._columnIndex,n);return i&&i.length>0&&l>0?i.substring(0,l-1)+s+i.slice(l-1+r):null}),4,4);o._functionTable.substitute=new a((function(e,n){var i,l=t._Expression.toString(e[0],o._rowIndex,o._columnIndex,n),r=t._Expression.toString(e[1],o._rowIndex,o._columnIndex,n),s=t._Expression.toString(e[2],o._rowIndex,o._columnIndex,n),a=4===e.length?t._Expression.toNumber(e[3],o._rowIndex,o._columnIndex,n):null,h=0;if(null!=a&&a<1||isNaN(a))throw new t.ValueError(t._ErrorMessages.InvalidParameter("instance_num"));if(l&&l.length>0&&r&&r.length>0){i=new RegExp(r,"g");return l.replace(i,(function(e){h++;if(null!=a){a=Math.floor(a);return h===a?s:e}return s}))}return null}),4,3);o._functionTable.rept=new a((function(e,n){var i,l=t._Expression.toString(e[0],o._rowIndex,o._columnIndex,n),r=Math.floor(t._Expression.toNumber(e[1],o._rowIndex,o._columnIndex,n)),s="";if(l&&l.length>0&&r>0)for(i=0;i<r;i++)s=s.concat(l);return s}),2,2);o._functionTable.text=new a((function(n,i){var l,r=n[0].evaluate(o._rowIndex,o._columnIndex,i),s=t._Expression.toString(n[1],o._rowIndex,o._columnIndex,i);!e.isPrimitive(r)&&r&&(r=r.value);if(e.isDate(r))s=e.xlsx.Workbook._fromXlsxDateFormat(s);else{var a=t._Expression.toNumber(n[0],o._rowIndex,o._columnIndex,i);if(!e.isNumber(a)||isNaN(a))return r;if((l=s.match(/^(\d+)(\.\d+)?\E\+(\d+)(\.\d+)?$/))&&5===l.length)return o._parseToScientificValue(a,l[1],l[2],l[3],l[4]);if(/M{1,4}|d{1,4}|y{1,4}/i.test(s)){s=e.xlsx.Workbook._fromXlsxDateFormat(s);r=t.FlexSheet._fromOADate(a)}else s&&!/[ncpfdg]\d?/i.test(s)&&(s=e.xlsx.Workbook.fromXlsxFormat(s)[0])}if(e.isDate(r))switch(s){case"d":return r.getDate();case"M":return r.getMonth()+1;case"y":s="yy";break;case"yyy":s="yyyy"}return e.Globalize.format(r,s)}),2,2);o._functionTable.value=new a((function(n,i){var l,r=t._Expression.toString(n[0],o._rowIndex,o._columnIndex,i);if((r=r.replace(/(\,\d{3})/g,(function(e){return e.substring(1)}))).length>0){if(r[0]===e.culture.Globalize.numberFormat.currency.symbol)return+(r=r.substring(1));if("%"===r[r.length-1])return+(r=r.substring(0,r.length-1))/100}l=+r;return isNaN(l)?t._Expression.toNumber(n[0],o._rowIndex,o._columnIndex,i):l}),1,1);o._functionTable.exact=new a((function(e,n){return t._Expression.toString(e[0],o._rowIndex,o._columnIndex,n)==t._Expression.toString(e[1],o._rowIndex,o._columnIndex,n)}),2,2)};_CalcEngine.prototype._registerDateFunction=function(){var o=this;o._functionTable.now=new a((function(){return{value:new Date,format:"M/d/yyyy h:mm"}}),0,0);o._functionTable.today=new a((function(){var e=new Date;return{value:new Date(e.getFullYear(),e.getMonth(),e.getDate()),format:"M/d/yyyy"}}),0,0);o._functionTable.year=new a((function(n,i){var l=t._Expression.toDate(n[0],o._rowIndex,o._columnIndex,i);return!e.isPrimitive(l)&&l?l.value:e.isDate(l)?l.getFullYear():1900}),1,1);o._functionTable.month=new a((function(n,i){var l=t._Expression.toDate(n[0],o._rowIndex,o._columnIndex,i);return!e.isPrimitive(l)&&l?l.value:e.isDate(l)?l.getMonth()+1:1}),1,1);o._functionTable.day=new a((function(n,i){var l=t._Expression.toDate(n[0],o._rowIndex,o._columnIndex,i);return!e.isPrimitive(l)&&l?l.value:e.isDate(l)?l.getDate():0}),1,1);o._functionTable.hour=new a((function(n,i){var l=n[0].evaluate(o._rowIndex,o._columnIndex,i);if(e.isNumber(l)&&!isNaN(l))return Math.floor(24*(l-Math.floor(l)));if(e.isDate(l))return l.getHours();l=t._Expression.toDate(n[0],o._rowIndex,o._columnIndex,i);!e.isPrimitive(l)&&l&&(l=l.value);if(e.isDate(l))return l.getHours();throw new t.ValueError(t._ErrorMessages.InvalidParameter("serial_number"))}),1,1);o._functionTable.time=new a((function(n,i){var l=n[0].evaluate(o._rowIndex,o._columnIndex,i),r=n[1].evaluate(o._rowIndex,o._columnIndex,i),s=n[2].evaluate(o._rowIndex,o._columnIndex,i);if(e.isNumber(l)&&e.isNumber(r)&&e.isNumber(s)){l%=24;r%=60;s%=60;return{value:new Date(0,0,0,l,r,s),format:"h:mm tt"}}throw new t.ValueError(t._ErrorMessages.InvalidParameters)}),3,3);o._functionTable.date=new a((function(n,i){var l=n[0].evaluate(o._rowIndex,o._columnIndex,i),r=n[1].evaluate(o._rowIndex,o._columnIndex,i),s=n[2].evaluate(o._rowIndex,o._columnIndex,i);if(e.isNumber(l)&&e.isNumber(r)&&e.isNumber(s))return{value:new Date(l,r-1,s),format:"M/d/yyyy"};throw new t.ValueError(t._ErrorMessages.InvalidParameters)}),3,3);o._functionTable.datedif=new a((function(n,i){var l,r,s,a,h,u=t._Expression.toDate(n[0],o._rowIndex,o._columnIndex,i),d=t._Expression.toDate(n[1],o._rowIndex,o._columnIndex,i),c=n[2].evaluate(o._rowIndex,o._columnIndex,i);!e.isPrimitive(u)&&u&&(u=u.value);!e.isPrimitive(d)&&d&&(d=d.value);if(e.isDate(u)&&e.isDate(d)&&e.isString(c)){if((l=u.getTime())>(r=d.getTime()))throw new t.NumericError(t._ErrorMessages.InvalidParameter("start_date"));s=d.getDate()-u.getDate();a=d.getMonth()-u.getMonth();h=d.getFullYear()-u.getFullYear();switch(c.toUpperCase()){case"Y":return a>0?h:a<0?h-1:s>=0?h:h-1;case"M":return s>=0?12*h+a:12*h+a-1;case"D":return(r-l)/864e5;case"YM":return(a=s>=0?12*h+a:12*h+a-1)%12;case"YD":return a>0?(new Date(u.getFullYear(),d.getMonth(),d.getDate()).getTime()-u.getTime())/864e5:a<0?(new Date(u.getFullYear()+1,d.getMonth(),d.getDate()).getTime()-u.getTime())/864e5:s>=0?s:(new Date(u.getFullYear()+1,d.getMonth(),d.getDate()).getTime()-u.getTime())/864e5;case"MD":return s>=0?s:s=new Date(d.getFullYear(),d.getMonth(),0).getDate()-new Date(d.getFullYear(),d.getMonth()-1,1).getDate()+1+s;default:throw new t.NumericError(t._ErrorMessages.InvalidParameter("unit"))}}throw new t.ValueError(t._ErrorMessages.InvalidParameters)}),3,3)};_CalcEngine.prototype._registLookUpReferenceFunction=function(){var o=this;o._functionTable.column=new a((function(e,n,i,l){var r;if(null==e)return l+1;r=e[0];if((r=o._ensureNonFunctionExpression(r,n))instanceof t._CellRangeExpression)return r.cells.col+1;throw new t.SyntaxError(t._ErrorMessages.InvalidCellRef)}),1,0);o._functionTable.columns=new a((function(e,n){var i=e[0];if((i=o._ensureNonFunctionExpression(i,n))instanceof t._CellRangeExpression)return i.cells.columnSpan;throw new t.SyntaxError(t._ErrorMessages.InvalidCellRef)}),1,1);o._functionTable.row=new a((function(e,n,i,l){var r;if(null==e)return i+1;r=e[0];if((r=o._ensureNonFunctionExpression(r,n))instanceof t._CellRangeExpression)return r.cells.row+1;throw new t.SyntaxError(t._ErrorMessages.InvalidCellRef)}),1,0);o._functionTable.rows=new a((function(e,n){var i=e[0];if((i=o._ensureNonFunctionExpression(i,n))instanceof t._CellRangeExpression)return i.cells.rowSpan;throw new t.SyntaxError(t._ErrorMessages.InvalidCellRef)}),1,1);o._functionTable.choose=new a((function(e,n){var i=t._Expression.toNumber(e[0],o._rowIndex,o._columnIndex,n);if(isNaN(i))throw new t.ValueError(t._ErrorMessages.InvalidParameter("index_num"));if(i<1||i>=e.length)throw new t.ValueError(t._ErrorMessages.ParameterIsOutOfRange("index_num"));return e[i=Math.floor(i)].evaluate(o._rowIndex,o._columnIndex,n)}),255,2);o._functionTable.index=new a((function(n,i){var l,r=n[0],s=t._Expression.toNumber(n[1],o._rowIndex,o._columnIndex,i),a=null!=n[2]?t._Expression.toNumber(n[2],o._rowIndex,o._columnIndex,i):0;if(isNaN(s)||s<0)throw new t.ValueError(t._ErrorMessages.InvalidParameter("row_num"));if(isNaN(a)||a<0)throw new t.ValueError(t._ErrorMessages.InvalidParameter("column_num"));if((r=o._ensureNonFunctionExpression(r,i))instanceof t._CellRangeExpression){if(s>(l=r.cells).rowSpan)throw new t.ReferenceError(t._ErrorMessages.ParameterIsOutOfRange("row_num"));if(a>l.columnSpan)throw new t.ReferenceError(t._ErrorMessages.ParameterIsOutOfRange("column_num"));if(s>0&&a>0)return o._owner.getCellValue(l.topRow+s-1,l.leftCol+a-1,!0,i);if(0===s&&0===a)return r;if(0===s)return new t._CellRangeExpression(new e.grid.CellRange(l.topRow,l.leftCol+a-1,l.bottomRow,l.leftCol+a-1),r.sheetRef,o._owner);if(0===a)return new t._CellRangeExpression(new e.grid.CellRange(l.topRow+s-1,l.leftCol,l.topRow+s-1,l.rightCol),r.sheetRef,o._owner)}throw new t.SyntaxError(t._ErrorMessages.InvalidCellRef)}),4,2);o._functionTable.hlookup=new a((function(e,t){return o._handleHLookup(e,t)}),4,3);o._functionTable.vlookup=new a((function(e,t){return o._handleVLookup(e,t)}),4,3)};_CalcEngine.prototype._registFinacialFunction=function(){var e=this;e._functionTable.rate=new a((function(t,o){return{value:e._calculateRate(t,o),format:"p2"}}),6,3)};_CalcEngine.prototype._registAddressRelatedFunction=function(){var o=this;o._functionTable.indirect=new a((function(n,i){var l,r,s,a,h,u,d,c=o._ensureNonFunctionExpression(n[0],i);if(c instanceof t._CellRangeExpression){l=c.cells;r=c.evaluate(l.row,l.col,i)}else r=c.evaluate(o._rowIndex,o._columnIndex,i);if(e.isString(r)){if(2===(s=r.split("!")).length){a=s[0].toLowerCase();h=s[1].toLowerCase()}else h=s[0].toLowerCase();var _=o._getDefinedName(h,a||o._sheet.name);i=i||o._owner.selectedSheet;if(_){if(_.sheetName&&_.sheetName.toLowerCase()!==i.name.toLowerCase())throw new t.ReferenceError(t._ErrorMessages.InvalidCellRef);r=_.value}if(u=o._getCellRange(r)){if(u.sheetRef){for(var g=0;g<o._owner.sheets.length;g++)if(o._owner.sheets[g].name.toLowerCase()===u.sheetRef.toLowerCase()){d=o._owner.sheets[g];break}}else d=o._owner.selectedSheet;if(d)return o._owner.getCellValue(u.cellRef.cellRange.row,u.cellRef.cellRange.col,!0,i)}}throw new t.SyntaxError(t._ErrorMessages.InvalidCellRef)}),2,1);o._functionTable.address=new a((function(n,i){var l,r,s=t._Expression.toNumber(n[0],o._rowIndex,o._columnIndex,i),a=t._Expression.toNumber(n[1],o._rowIndex,o._columnIndex,i),h=!1,u=!1;if(isNaN(s)||!e.isInt(s)||s<1||s>1048576)throw new t.ValueError(t._ErrorMessages.InvalidParameter("row_num"));if(isNaN(a)||!e.isInt(a)||a<1||a>16384)throw new t.ValueError(t._ErrorMessages.InvalidParameter("column_num"));if(null!=n[2]){l=t._Expression.toNumber(n[2],o._rowIndex,o._columnIndex,i);if(isNaN(l)||!e.isInt(l)||l<1||l>4)throw new t.ValueError(t._ErrorMessages.InvalidParameter("abs_num"))}null!=n[4]&&(r=t._Expression.toString(n[4],o._rowIndex,o._columnIndex,i));if(null==l||1===l){h=!0;u=!0}else 2===l?h=!0:3===l&&(u=!0);return(null!=r?r+"!":"")+(u?"$":"")+o._numAlpha(a)+(h?"$":"")+s.toString()}),5,2)};_CalcEngine.prototype._registerErrorFunctions=function(){var e=this,isError=function(o,n){var i;try{i=o.evaluate(e._rowIndex,e._columnIndex,n)}catch(e){e instanceof t.FormulaError&&(i=e)}return i};this._functionTable.iserror=new a((function(e,o){return isError(e[0],o)instanceof t.FormulaError}),1,1);this._functionTable.iserr=new a((function(e,o){var n=isError(e[0],o);return n instanceof t.FormulaError&&!(n instanceof t.NotAvailableError)}),1,1);this._functionTable.iferror=new a((function(o,n){var i=isError(o[0],n);return i instanceof t.FormulaError?o[1].evaluate(e._rowIndex,e._columnIndex,n):i}),2,2)};_CalcEngine.prototype._addToken=function(e,t,o){var i=new n(e,t,o);this._tokenTable[e]=i};_CalcEngine.prototype._parseExpression=function(){this._getToken();return this._parseCompareOrConcat()};_CalcEngine.prototype._parseCompareOrConcat=function(){for(var e,o,n=this._parseAddSub();this._token.tokenType===i.COMPARE||this._token.tokenType===i.CONCAT;){e=this._token;this._getToken();o=this._parseAddSub();n=new t._BinaryExpression(e,n,o)}return n};_CalcEngine.prototype._parseAddSub=function(){for(var e,o,n=this._parseMulDiv();this._token.tokenType===i.ADDSUB;){e=this._token;this._getToken();o=this._parseMulDiv();n=new t._BinaryExpression(e,n,o)}return n};_CalcEngine.prototype._parseMulDiv=function(){for(var e,o,n=this._parsePower();this._token.tokenType===i.MULDIV;){e=this._token;this._getToken();o=this._parsePower();n=new t._BinaryExpression(e,n,o)}return n};_CalcEngine.prototype._parsePower=function(){for(var e,o,n=this._parseUnary();this._token.tokenType===i.POWER;){e=this._token;this._getToken();o=this._parseUnary();n=new t._BinaryExpression(e,n,o)}return n};_CalcEngine.prototype._parseUnary=function(){var e,o;if(this._token.tokenID===l.ADD||this._token.tokenID===l.SUB){e=this._token;this._getToken();o=this._parseAtom();return new t._UnaryExpression(e,o)}return this._parseAtom()};_CalcEngine.prototype._parseAtom=function(){var e,o,n,r,s,a,h,u,d,c,_,g=null;switch(this._token.tokenType){case i.LITERAL:case i.ERROR:g=new t._Expression(this._token);break;case i.IDENTIFIER:var f=this._token.value.toString(),p=f.toLowerCase();if(e=this._functionTable[p]){o=this._getParameters();if(this._token.tokenType===i.GROUP&&this._token.tokenID===l.CLOSE){n=o?o.length:0;if(-1!==e.paramMin&&n<e.paramMin)throw new t.SyntaxError(t._ErrorMessages.TooFewParameters);if(-1!==e.paramMax&&n>e.paramMax)throw new t.SyntaxError(t._ErrorMessages.TooManyParameters);"rand"!==p&&("column"!==p&&"row"!==p||0!==n)||(this._containsCellRef=!0);g=new t._FunctionExpression(p,e,o);break}if("true"===p||"false"===p){g=new t._FunctionExpression(p,e,o,!1);break}}if(2===(u=p.split("!")).length){c=u[0];d=u[1]}else d=u[0];var w=this._getDefinedName(d,c||this._sheet.name);if(w){if(w.sheetName&&w.sheetName.toLowerCase()!==this._sheet.name.toLowerCase()&&w.sheetName.toLowerCase()!==c)throw new t.NameError(t._ErrorMessages.DefNameInvalidSheet(w.sheetName));h=this._pointer;a=this._expressLength;s=this._expression;this._pointer=0;g=this._checkCache(w.value);this._pointer=h;this._expressLength=a;this._expression=s;break}c="";if(null!=(_=this._owner._getTable(p))){if(""===(c=_.sheet.name))throw new t.NameError(t._ErrorMessages.InvalidTable(p));this._getToken();if(this._token.tokenType!==i.SQUAREBRACKETS||this._token.tokenID!==l.OPEN)throw new t.SyntaxError(t._ErrorMessages.InvalidTableRef);this._tableRefStart=!0;g=this._getTableReference(_,c);break}if(r=this._getCellRange(f)){this._containsCellRef=!0;g=new t._CellRangeExpression(r.cellRef.cellRange,r.sheetRef,this._owner,f.indexOf(":")>-1,r.cellRef.absRow,r.cellRef.absCol,r.cellRef.absRow2,r.cellRef.absCol2,r.isWholeRow);break}o=this._getParameters();g=this.onUnknownFunction(p,o);break;case i.GROUP:if(this._token.tokenID!==l.OPEN)throw new t.SyntaxError(t._ErrorMessages.ExpressionExpected);this._getToken();g=this._parseCompareOrConcat();if(this._token.tokenID!==l.CLOSE)throw new t.SyntaxError(t._ErrorMessages.UnbalancedParenthesis);g._inGroup=!0;break;case i.SQUAREBRACKETS:if(this._token.tokenID!==l.OPEN)throw new t.ValueError(t._ErrorMessages.TableReferencesExpected);if(null!=(_=this._sheet.findTable(this._rowIndex,this._columnIndex))){c=_.sheet.name;this._tableRefStart=!0;g=this._getTableReference(_,c,!1)}}if(null===g)throw new t.SyntaxError(t._ErrorMessages.BadExpression);this._getToken();return g};_CalcEngine.prototype._getToken=function(){for(var e,o,r,s,a,h,u="",d="",c=new RegExp("[　-〿぀-ゟ゠-ヿ＀-ﾟ一-龯㐀-䶿]");this._pointer<this._expressLength&&" "===this._expression[this._pointer];)this._pointer++;if(this._pointer>=this._expressLength)this._token=new n(null,l.END,i.GROUP);else{h=(o=this._expression[this._pointer])>="0"&&o<="9"||"."==o;if(!(a=o>="a"&&o<="z"||o>="A"&&o<="Z"||c.test(o))&&!h){var _=this._tokenTable[o];if(_){this._token=_;this._pointer++;if(this._pointer<this._expressLength&&(">"===o||"<"===o)&&(_=this._tokenTable[this._expression.substring(this._pointer-1,this._pointer+1)])){this._token=_;this._pointer++}return}}if(h){s=this._pointer;this._parseDigit();if(":"!==this._expression[this._pointer])return;this._pointer=s}if('"'!==o){if(("'"!==o||(d=this._parseSheetRef()))&&("#"!==o||!this._parseError()))if("#"!==o){if(!a&&!h&&"_"!==o&&this._idChars.indexOf(o)<0&&!d)throw new t.SyntaxError(t._ErrorMessages.IdentifierExpected);for(e=1;e+this._pointer<this._expressLength;e++){a=(o=this._expression[this._pointer+e])>="a"&&o<="z"||o>="A"&&o<="Z"||c.test(o);h=o>="0"&&o<="9";if("'"!==o||":"!==r){r=o;if(!a&&!h&&"_"!==o&&this._idChars.indexOf(o)<0)break}else{u=d+this._expression.substring(this._pointer,this._pointer+e);this._pointer+=e;d=this._parseSheetRef();e=0}}u+=d+this._expression.substring(this._pointer,this._pointer+e);this._pointer+=e;this._token=new n(u,l.ATOM,i.IDENTIFIER)}else this._parseDate()}else this._parseString()}};_CalcEngine.prototype._getTableToken=function(){for(var e,o,r,s="",a=!1;this._pointer<this._expressLength&&" "===this._expression[this._pointer];)this._pointer++;if("@"===(o=this._expression[this._pointer])){s=o;this._pointer++}"["===(o=this._expression[this._pointer])&&(a=!0);for(e=1;e+this._pointer<this._expressLength;e++){o=this._expression[this._pointer+e];if(a&&","===o)throw new t.SyntaxError(t._ErrorMessages.InvalidTableRef);if("]"===o)break}r=s+this._expression.substring(this._pointer+(a?1:0),this._pointer+e);this._pointer+=e+(a?1:0);this._token=new n(r,l.ATOM,i.IDENTIFIER)};_CalcEngine.prototype._parseDigit=function(){var e,t,o=-1,r=!1,s=!1,a=0;for(e=0;e+this._pointer<this._expressLength;e++)if((t=this._expression[this._pointer+e])>="0"&&t<="9"){a=10*a+(+t-0);o>-1&&(o*=10)}else if("."===t&&o<0)o=1;else{if("E"!==t&&"e"!==t||r){if("%"===t){s=!0;e++;break}break}r=!0;"+"!==(t=this._expression[this._pointer+e+1])&&"-"!==t||e++}if(r)a=+this._expression.substring(this._pointer,this._pointer+e);else{o>1&&(a/=o);s&&(a/=100)}this._token=new n(a,l.ATOM,i.LITERAL);this._pointer+=e};_CalcEngine.prototype._parseString=function(){var e,o,r;for(e=1;e+this._pointer<this._expressLength;e++)if('"'===(o=this._expression[this._pointer+e])){if('"'!==(e+this._pointer<this._expressLength-1?this._expression[this._pointer+e+1]:" "))break;e++}if('"'!==o)throw new t.SyntaxError(t._ErrorMessages.CantFindFinalQuote);r=this._expression.substring(this._pointer+1,this._pointer+e);this._pointer+=e+1;if("!"===this._expression[this._pointer])throw new t.SyntaxError(t._ErrorMessages.IllegalCrossSheetReference);this._token=new n(r.replace('""','"'),l.ATOM,i.LITERAL)};_CalcEngine.prototype._parseDate=function(){var e,o,r;for(e=1;e+this._pointer<this._expressLength&&"#"!==(o=this._expression[this._pointer+e]);e++);if("#"!==o)throw new t.SyntaxError(t._ErrorMessages.CantFindFinalDateDelimiter);r=this._expression.substring(this._pointer+1,this._pointer+e);this._pointer+=e+1;this._token=new n(Date.parse(r),l.ATOM,i.LITERAL)};_CalcEngine.prototype._parseError=function(){var e,o=this._pointer;for(e=o+1;e<this._expressLength;e++){var r=this._expression[e],s=this._expression[e-1];if(!(r>="a"&&r<="z"||r>="A"&&r<="Z"||("0"===r||"?"===r||"!"===r||"/"===r)&&(s>="a"&&s<="z"||s>="A"&&s<="Z"||"/"===s||"0"===s)))break}var a=e-o;if(a>3){var h=this._expression.substring(o,o+a),u=t._FormulaErrorHelper.asError(h);if(u){this._token=new n(u,l.ATOM,i.ERROR);this._pointer+=a;return!0}}return!1};_CalcEngine.prototype._parseSheetRef=function(){var e,o,n;for(e=1;e+this._pointer<this._expressLength;e++)if("'"===(o=this._expression[this._pointer+e])){if("'"!==(e+this._pointer<this._expressLength-1?this._expression[this._pointer+e+1]:" "))break;e++}if("'"!==o)throw new t.SyntaxError(t._ErrorMessages.CantFindFinalQuote);n=this._expression.substring(this._pointer+1,this._pointer+e);this._pointer+=e+1;return"!"===this._expression[this._pointer]?n.replace(/\'\'/g,"'"):""};_CalcEngine.prototype._getCellRange=function(e){var o,n,i,l,r;if(e&&(o=e.split(":")).length>0&&o.length<3){if(null==(n=this._parseCell(o[0])).cellRef)return null;l=n.cellRef.cellRange;if(null!=n.cellRef.isWholeRow&&1===o.length)return null;if(l&&2===o.length){r=(i=this._parseCell(o[1])).cellRef.cellRange;if(null!=n.cellRef.isWholeRow&&n.cellRef.isWholeRow!==i.cellRef.isWholeRow)return null;n.sheetRef&&!i.sheetRef&&(i.sheetRef=n.sheetRef);if(n.sheetRef!==i.sheetRef)throw new t.ReferenceError(t._ErrorMessages.CellRefMustBeInSameSheet);if(r){l.col2=r.col;l.row2=r.row}else l=null}}return null==l?null:{cellRef:{cellRange:l,absRow:n.cellRef.absRow,absCol:n.cellRef.absCol,absRow2:i?i.cellRef.absRow:null,absCol2:i?i.cellRef.absCol:null},sheetRef:n.sheetRef,isWholeRow:n.cellRef.isWholeRow}};_CalcEngine.prototype._parseCellRange=function(o){var n,i,l,r,s=-1,a=-1,h=!1,u=!1;for(n=0;n<o.length;n++)if("$"!==(l=o[n])||h){if(!(l>="a"&&l<="z"||l>="A"&&l<="Z"))break;s<0&&(s=0);s=26*s+(l.toUpperCase().charCodeAt(0)-"A".charCodeAt(0)+1)}else h=!0;for(;n<o.length;n++)if("$"!==(l=o[n])||u){if(!(l>="0"&&l<="9"))break;a<0&&(a=0);a=10*a+(+l-0)}else u=!0;if(n<o.length)return null;if(a>-1&&s>-1){if(0===a)throw new t.NameError(t._ErrorMessages.InvalidCellRef);i=new e.grid.CellRange(a-1,s-1)}else if(-1===s){r=!0;i=new e.grid.CellRange(a-1,0)}else if(-1===a){r=!1;i=new e.grid.CellRange(0,s-1)}return{cellRange:i,absRow:u,absCol:h,isWholeRow:r}};_CalcEngine.prototype._parseCell=function(e){var t,o,n;if((t=e.lastIndexOf("!"))>0&&t<e.length-1){n=e.substring(0,t);o=e.substring(t+1)}else{if(!(t<=0))return null;o=e}return{cellRef:this._parseCellRange(o),sheetRef:n}};_CalcEngine.prototype._getParameters=function(){var e,o,n=this._pointer,r=this._token;this._getToken();if(this._token.tokenType!==i.SQUAREBRACKETS||this._token.tokenID!==l.OPEN){if(this._token.tokenID!==l.OPEN){this._pointer=n;this._token=r;return null}n=this._pointer;this._getToken();if(this._token.tokenID===l.CLOSE)return null;this._pointer=n;e=new Array;o=this._parseExpression();e.push(o);for(;this._token.tokenID===l.COMMA;){o=this._parseExpression();e.push(o)}if(this._token.tokenID!==l.CLOSE)throw new t.SyntaxError(t._ErrorMessages.SyntaxError);return e}};_CalcEngine.prototype._getTableReference=function(e,o,n){void 0===n&&(n=!0);var r,s,a=[],h=this._getTableParameter(),u=!1;if(null==h)throw new t.SyntaxError(t._ErrorMessages.InvalidTableRef);a.push(h);for(;this._tableRefStart&&(this._token.tokenID===l.COMMA||":"===this._token.value);){":"===this._token.value&&(u=!0);if(null==(h=this._getTableParameter()))throw new t.SyntaxError(t._ErrorMessages.InvalidTableRef);if(u){a[a.length-1]+=":"+h;u=!1}else a.push(h)}if(this._token.tokenType!==i.SQUAREBRACKETS||this._token.tokenID!==l.CLOSE)throw new t.SyntaxError(t._ErrorMessages.UnbalancedSquareBrackets);this._tableRefStart=!1;r=this._getTableRange(e,a);this._containsCellRef=!0;(s=new t._CellRangeExpression(r,o.toLowerCase(),this._owner))._tableParams=a;n&&(s._tableName=e.name);return s};_CalcEngine.prototype._getTableParameter=function(){var e;for(this._pointer;this._pointer<this._expressLength&&" "===this._expression[this._pointer];)this._pointer++;if("]"===this._expression[this._pointer]){this._tableRefStart=!1;return null}this._getTableToken();e=this._token.value;this._getToken();return e};_CalcEngine.prototype._getTableRange=function(o,n){for(var i,l,r,s,a,h,u=0;u<n.length;u++){if(l)throw new t.ValueError(t._ErrorMessages.InvalidTableRef);a=null;if("#"===(i=n[u].toLowerCase())[0]){switch(i){case"#all":a=o.getRange();break;case"#data":a=o.getRange(t.TableSection.Data);break;case"#headers":a=o.getRange(t.TableSection.Header);break;case"#totals":a=o.getRange(t.TableSection.Footer);break;case"#this row":s=o.getRange();if(!(this._rowIndex>=s.topRow&&this._rowIndex<=s.bottomRow))throw new t.ValueError(t._ErrorMessages.RowIsOutOfTableRange(o.name));a=new e.grid.CellRange(this._rowIndex,s.leftCol,this._rowIndex,s.rightCol);break;default:throw new t.ValueError(t._ErrorMessages.InvalidTableRef)}if(null==a)throw new t.ValueError(t._ErrorMessages.InvalidTableRef);if(null==r)r=a;else{r.row=r.topRow<a.topRow?r.topRow:a.topRow;r.row2=r.bottomRow>a.bottomRow?r.bottomRow:a.bottomRow}}else{l=!0;h=i.split(":");for(var d=0;d<h.length;d++){if(h.length>2)throw new t.ValueError(t._ErrorMessages.InvalidTableColRef);if("@"===(i=h[d])[0]){if(null==(a=o.getRange(t.TableSection.Data,i.substring(1))))throw new t.ValueError(t._ErrorMessages.InvalidTableRef);if(!(this._rowIndex>=a.topRow&&this._rowIndex<=a.bottomRow))throw new t.ValueError(t._ErrorMessages.RowIsOutOfTableRange(o.name));a.row=this._rowIndex;a.row2=this._rowIndex}else if(null==(a=o.getRange(t.TableSection.Data,i)))throw new t.ValueError(t._ErrorMessages.InvalidTableRef);0===d&&(null==r?r=a:r.col=a.col);r.col2=a.col;a=null}}}return r};_CalcEngine.prototype._getAggregate=function(t,o){for(var n=0,i=0,l=0,r=null,s=null,a=0;a<o.length;a++){var h=o[a];if(null!=h&&"number"==typeof h&&!isNaN(h)){(null==r||h<r)&&(r=h);(null==s||h>s)&&(s=h);n++;i+=h;l+=h*h}}var u=0==n?0:i/n;switch(t){case e.Aggregate.Avg:return u;case e.Aggregate.Max:return s;case e.Aggregate.Min:return r;case e.Aggregate.Sum:return i;case e.Aggregate.VarPop:return n<=1?0:l/n-u*u;case e.Aggregate.StdPop:return n<=1?0:Math.sqrt(l/n-u*u);case e.Aggregate.Var:return n<=1?0:(l/n-u*u)*n/(n-1);case e.Aggregate.Std:return n<=1?0:Math.sqrt((l/n-u*u)*n/(n-1))}throw"Invalid aggregate type."};_CalcEngine.prototype._getAggregateResult=function(e,t,o){var n,i=this._getItemList(t,o);n=this._getAggregate(e,i.items);i.isDate&&(n={value:n=new Date(n),format:i.format||"M/d/yyyy"});return n};_CalcEngine.prototype._getFlexSheetAggregateResult=function(e,o,n){var i,l,s,a;switch(e){case r.Count:i=this._getItemList(o,n,!1,void 0,void 0,!1);return this._countNumberCells(i.items);case r.CountA:return(i=this._getItemList(o,n,!1,void 0,void 0,!1)).items.length;case r.CountBlank:i=this._getItemList(o,n,!0,void 0,void 0,!1);return this._countBlankCells(i.items);case r.Rank:s=t._Expression.toNumber(o[0],this._rowIndex,this._columnIndex,n);a=o[2]?t._Expression.toNumber(o[2],this._rowIndex,this._columnIndex,n):0;if(isNaN(s))throw new t.ValueError(t._ErrorMessages.InvalidParameter("number"));if(isNaN(a))throw new t.ValueError(t._ErrorMessages.InvalidParameter("order"));o[1]=this._ensureNonFunctionExpression(o[1],n);if(o[1]instanceof t._CellRangeExpression){i=this._getItemList([o[1]],n);return this._getRankOfCellRange(s,i.items,a)}throw new t.SyntaxError(t._ErrorMessages.InvalidCellRef);case r.CountIf:o[0]=this._ensureNonFunctionExpression(o[0],n);if(o[0]instanceof t._CellRangeExpression){i=this._getItemList([o[0]],n,void 0,void 0,void 0,!1);return this._countCellsByCriteria([i.items],[o[1]],n)}throw new t.SyntaxError(t._ErrorMessages.InvalidCellRef);case r.CountIfs:return this._handleCountIfs(o,n);case r.SumIf:o[0]=this._ensureNonFunctionExpression(o[0],n);if(o[0]instanceof t._CellRangeExpression){var h=!1;o[2]=this._ensureNonFunctionExpression(o[2],n);null!=o[2]&&o[2]instanceof t._CellRangeExpression&&(l=this._getItemList([o[2]],n,h=!0));i=this._getItemList([o[0]],n,h);return this._sumCellsByCriteria([i.items],[o[1]],l?l.items:null,n)}throw new t.SyntaxError(t._ErrorMessages.InvalidCellRef);case r.SumIfs:return this._handleSumIfs(o,n);case r.Product:i=this._getItemList(o,n);return this._getProductOfNumbers(i.items)}throw"Invalid aggregate type."};_CalcEngine.prototype._getItemList=function(o,n,i,l,r,s){void 0===i&&(i=!1);void 0===l&&(l=!0);void 0===s&&(s=!0);var a,h,u,d,c,_,g,f,p,w,m=new Array;for(h=0;h<o.length;h++){c=o[h];if((c=this._ensureNonFunctionExpression(c,n))instanceof t._CellRangeExpression){d=c.getValues(l,r,n,s);if(0===h){(p=(f=c._getSheet()||n||this._sheet).getCellStyle(c.cells.topRow,c.cells.leftCol))&&(g=p.format);g||(w=f.grid.columns[c.cells.leftCol])&&(g=w.format)}e:for(u=0;u<d.length;u++){a=d[u];if(null==_&&null!=a&&!e.isString(a)){_=e.isDate(a);break e}}for(u=0;u<d.length;u++){a=d[u];(i||null!=a&&""!==a)&&(e.isDate(a)?m.push(+a):m.push(a))}}else{(a=c instanceof t._Expression?c.evaluate(this._rowIndex,this._columnIndex,n,void 0,s):c)instanceof t.FormulaError||e.isPrimitive(a)||(a=a.value);if(!i&&(null==a||""===a))continue;var C=+a;isNaN(C)||(a=C);m.push(a);null==_&&m.length>0&&(_=a instanceof Date)}}0===m.length&&(_=!1);return{isDate:_,items:m,format:g}};_CalcEngine.prototype._countBlankCells=function(t){for(var o,n=0,i=0;n<t.length;n++)(null==(o=t[n])||e.isString(o)&&""===o||e.isNumber(o)&&isNaN(o))&&i++;return i};_CalcEngine.prototype._countNumberCells=function(t){for(var o,n=0,i=0;n<t.length;n++)null!=(o=t[n])&&e.isNumber(o)&&!isNaN(o)&&i++;return i};_CalcEngine.prototype._getRankOfCellRange=function(o,n,i){void 0===i&&(i=0);var l,r=0,s=0;i?n.sort((function(e,t){return isNaN(e)||isNaN(t)?-1:e-t})):n.sort((function(e,t){return isNaN(e)||isNaN(t)?1:t-e}));for(;r<n.length;r++){l=n[r];if(!isNaN(l)&&e.isNumber(l)){s++;if(o===l)return s}}throw new t.ValueError(t._ErrorMessages.ParameterIsOutOfRange("number"))};_CalcEngine.prototype._handleCountIfs=function(e,o){var n,i,l,r,s=0,a=[],h=[];if(e.length%2!=0)throw new t.ValueError(t._ErrorMessages.InvalidParameters);for(;s<e.length/2;s++){i=e[2*s];if(!((i=this._ensureNonFunctionExpression(i,o))instanceof t._CellRangeExpression))throw new t.SyntaxError(t._ErrorMessages.InvalidCellRef);if(0===s){if(!i.cells)throw new t.SyntaxError(t._ErrorMessages.InvalidCellRef);l=i.cells.rowSpan;r=i.cells.columnSpan}else{if(!i.cells)throw new t.SyntaxError(t._ErrorMessages.InvalidCellRef);if(i.cells.rowSpan!==l||i.cells.columnSpan!==r)throw new t.ValueError(t._ErrorMessages.RangesMustBeTheSame)}n=this._getItemList([i],o,void 0,void 0,void 0,!1);a[s]=n.items;h[s]=e[2*s+1]}return this._countCellsByCriteria(a,h,o)};_CalcEngine.prototype._countCellsByCriteria=function(o,n,i,l){for(var r,s,a,h,u=0,d=0,c=0,_=o[0].length,g=[];d<n.length;d++)"*"===(h=t._Expression.toString(n[d],this._rowIndex,this._columnIndex,i))?g.push(h):g.push(this._parseRightExpr(h));for(;u<_;u++){r=!1;for(d=0;d<o.length;d++){a=o[d][u];if("string"==typeof(h=g[d])){if("*"!==h&&(null==a||""===a)){r=!1;break}if((r="*"===h||this.evaluate(this._combineExpr(a,h),null,i,this._rowIndex,this._columnIndex,!1))instanceof t.FormulaError||!r)break}else if(!(r=r=h.reg.test(a.toString())===h.checkMathces))break}!r||r instanceof t.FormulaError||(l?null!=(s=l[u])&&e.isNumber(s)&&!isNaN(s)&&c++:c++)}return c};_CalcEngine.prototype._handleSumIfs=function(e,o){var n,i,l,r,s,a,h=1,u=[],d=[],c=!1;if(e.length%2!=1)throw new t.ValueError(t._ErrorMessages.InvalidParameters);l=e[0];if(!((l=this._ensureNonFunctionExpression(l,o))instanceof t._CellRangeExpression))throw new t.ValueError(t._ErrorMessages.InvalidParameter("Sum_range"));if(!l.cells)throw new t.ValueError(t._ErrorMessages.InvalidParameter("Sum_range"));s=l.cells.rowSpan;a=l.cells.columnSpan;i=this._getItemList([l],o,c=!0);for(;h<(e.length+1)/2;h++){r=e[2*h-1];if(!((r=this._ensureNonFunctionExpression(r,o))instanceof t._CellRangeExpression))throw new t.ValueError(t._ErrorMessages.InvalidParameter("Criteria_range"+h));if(!r.cells)throw new t.ValueError(t._ErrorMessages.InvalidParameter("Criteria_range"+h));if(r.cells.rowSpan!==s||r.cells.columnSpan!==a)throw new t.ValueError(t._ErrorMessages.RangesMustBeTheSame);n=this._getItemList([r],o,c);u[h-1]=n.items;d[h-1]=e[2*h]}return this._sumCellsByCriteria(u,d,i.items,o)};_CalcEngine.prototype._sumCellsByCriteria=function(o,n,i,l){var r,s,a,h,u=0,d=0,c=0,_=o[0].length,g=[];null==i&&(i=o[0]);for(;d<n.length;d++)"*"===(h=t._Expression.toString(n[d],this._rowIndex,this._columnIndex,l))?g.push(h):g.push(this._parseRightExpr(h));for(;u<_;u++){s=!1;r=i[u];for(d=0;d<o.length;d++){a=o[d][u];if("string"==typeof(h=g[d])){if("*"!==h&&null==a){s=!1;break}if((s="*"===h||this.evaluate(this._combineExpr(a,h),null,l,this._rowIndex,this._columnIndex))instanceof t.FormulaError||!s)break}else if(!(s=h.reg.test(a.toString())===h.checkMathces))break}s&&e.isNumber(r)&&!isNaN(r)&&(c+=r)}return c};_CalcEngine.prototype._getProductOfNumbers=function(t){var o,n=0,i=1,l=!1;if(t)for(;n<t.length;n++){o=t[n];if(e.isNumber(o)&&!isNaN(o)){i*=o;l=!0}}return l?i:0};_CalcEngine.prototype._handleSubtotal=function(o,n){var i,l,r,a,h=!0,u=!0;if((i=t._Expression.toNumber(o[0],this._rowIndex,this._columnIndex,n))>=1&&i<=11||i>=101&&i<=111){i>=101&&i<=111&&(h=!1);(i=e.asEnum(i,s))!==s.CountA&&i!==s.CountAWithoutHidden||(u=!1);l=this._getItemList(o.slice(1),n,u,h);switch(i){case s.Count:case s.CountWithoutHidden:return this._countNumberCells(l.items);case s.CountA:case s.CountAWithoutHidden:return l.items.length;case s.Product:case s.ProductWithoutHidden:return this._getProductOfNumbers(l.items);case s.Average:case s.AverageWithoutHidden:r=e.Aggregate.Avg;break;case s.Max:case s.MaxWithoutHidden:r=e.Aggregate.Max;break;case s.Min:case s.MinWithoutHidden:r=e.Aggregate.Min;break;case s.Std:case s.StdWithoutHidden:r=e.Aggregate.Std;break;case s.StdPop:case s.StdPopWithoutHidden:r=e.Aggregate.StdPop;break;case s.Sum:case s.SumWithoutHidden:r=e.Aggregate.Sum;break;case s.Var:case s.VarWithoutHidden:r=e.Aggregate.Var;break;case s.VarPop:case s.VarPopWithoutHidden:r=e.Aggregate.VarPop}a=this._getAggregate(r,l.items);l.isDate&&(a=new Date(a));return a}throw new t.ValueError(t._ErrorMessages.InvalidParameter("Function_num"))};_CalcEngine.prototype._handleDCount=function(e,o){var n,i,l,r=e[0],s=e[2];r=this._ensureNonFunctionExpression(r,o);s=this._ensureNonFunctionExpression(s,o);if(r instanceof t._CellRangeExpression&&s instanceof t._CellRangeExpression){n=e[1].evaluate(this._rowIndex,this._columnIndex,o);i=this._getColumnIndexByField(r,n);return(l=this._getItemList([r],o,!1,!0,i,!1)).items&&l.items.length>1?this._DCountWithCriteria(l.items.slice(1),r,s):0}throw new t.ValueError(t._ErrorMessages.InvalidParameter("Database"))};_CalcEngine.prototype._DCountWithCriteria=function(e,o,n){var i,l,r,s,a,h,u,d,c,_,g,f=n.cells,p=0;i=this._owner._getSheet(o.sheetRef);l=this._owner._getSheet(n.sheetRef);if(f.rowSpan>1){r=f.topRow;for(s=f.bottomRow;s>f.topRow;s--){_=[];g=[];for(a=f.leftCol;a<=f.rightCol;a++)if(null!=(u=this._owner.getCellValue(s,a,!1,l))&&""!==u){g.push(new t._Expression(u));d=this._owner.getCellValue(r,a,!1,l);h=this._getColumnIndexByField(o,d);if(!(null!=(c=this._getItemList([o],i,!1,!0,h,!1)).items&&c.items.length>1))throw new t.ValueError("Criteria");_.push(c.items.slice(1))}p+=this._countCellsByCriteria(_,g,i,e)}return p}throw new t.ValueError("Criteria")};_CalcEngine.prototype._getColumnIndexByField=function(o,n){var i,l,r,s,a;if(-1===(a=(i=o.cells).topRow))throw new t.ValueError(t._ErrorMessages.InvalidParameter("Database"));if(e.isInt(n)&&!isNaN(n)){if(n>=1&&n<=i.columnSpan)return r=i.leftCol+n-1}else{l=this._owner._getSheet(o.sheetRef);for(r=i.leftCol;r<=i.rightCol;r++){s=this._owner.getCellValue(a,r,!1,l);if((n=e.isString(n)?n.toLowerCase():n)===(s=e.isString(s)?s.toLowerCase():s))return r}}throw new t.ValueError(t._ErrorMessages.InvalidParameter("Field"))};_CalcEngine.prototype._getSumProduct=function(e,t){var o,n,i,l=0,r=this._getItemListForSumProduct(e,t);if(r.length>0){n=r[0].length;i=r.length;for(var s=0;s<n;s++){o=1;for(var a=0;a<i;a++)o*=r[a][s];l+=o}}return l};_CalcEngine.prototype._getItemListForSumProduct=function(e,o){var n,i,l,r,s,a,h=[new Array];for(l=0;l<e.length;l++){a=e[l];n=new Array;if((a=this._ensureNonFunctionExpression(a,o))instanceof t._CellRangeExpression){s=a.getValues(!0,null,o);for(r=0;r<s.length;r++){i=s[r];n.push(+i)}}else{i=a instanceof t._Expression?a.evaluate(this._rowIndex,this._columnIndex,o):a;n.push(+i)}if(l>0&&n.length!==h[0].length)throw new t.ValueError(t._ErrorMessages.RangesMustBeTheSame);h[l]=n}return h};_CalcEngine.prototype._parseRightExpr=function(e){var o,n,i=!1;if(e.indexOf("?")>-1||e.indexOf("*")>-1){if(null==(o=e.match(/=?([\?\*]*)(\w*)([\?\*]*)(\w*)([\?\*]*)/))||6!==o.length)throw new t.ValueError(t._ErrorMessages.InvalidParameter("Criteria"));n=new RegExp("^"+(o[1].length>0?this._parseRegCriteria(o[1]):"")+o[2]+(o[3].length>0?this._parseRegCriteria(o[3]):"")+o[4]+(o[5].length>0?this._parseRegCriteria(o[5]):"")+"$","i");/^[<>=]/.test(e)?"="===e.trim()[0]&&(i=!0):i=!0;return{reg:n,checkMathces:i}}if(isNaN(+e))if(/^\w/.test(e))e='="'+e+'"';else{if(!/^[<>=]{1,2}\s*-?.+$/.test(e))throw new t.ValueError(t._ErrorMessages.InvalidParameter("Criteria"));e=e.replace(/([<>=]{1,2})\s*(-?.+)/,(function(e,t,o){return t+(isNaN(+o)?'"'+o+'"':o)}))}else e="="+ +e;return e};_CalcEngine.prototype._combineExpr=function(t,o){(e.isString(t)||e.isDate(t))&&(t='"'+t+'"');return(t="="+t)+o};_CalcEngine.prototype._parseRegCriteria=function(e){for(var t=0,o=0,n="";t<e.length;t++)if("*"===e[t]){if(o>0){n+="\\w{"+o+"}";o=0}n+="\\w*"}else"?"===e[t]&&o++;o>0&&(n+="\\w{"+o+"}");return n};_CalcEngine.prototype._calculateRate=function(e,o){var n,i,l,r,s,a,h,u,d,c,_=0,g=0;l=t._Expression.toNumber(e[0],this._rowIndex,this._columnIndex,o);r=t._Expression.toNumber(e[1],this._rowIndex,this._columnIndex,o);s=t._Expression.toNumber(e[2],this._rowIndex,this._columnIndex,o);a=null!=e[3]?t._Expression.toNumber(e[3],this._rowIndex,this._columnIndex,o):0;h=null!=e[4]?t._Expression.toNumber(e[4],this._rowIndex,this._columnIndex,o):0;i=null!=e[5]?t._Expression.toNumber(e[5],this._rowIndex,this._columnIndex,o):.1;Math.abs(i)<1e-7?s*(1+l*i)+r*(1+i*h)*l+a:s*(u=Math.exp(l*Math.log(1+i)))+r*(1/i+h)*(u-1)+a;d=s+r*l+a;c=s*u+r*(1/i+h)*(u-1)+a;n=i;for(;Math.abs(d-c)>1e-7&&_<20;){i=(c*g-d*n)/(c-d);g=n;n=i;d=c;c=Math.abs(i)<1e-7?s*(1+l*i)+r*(1+i*h)*l+a:s*(u=Math.exp(l*Math.log(1+i)))+r*(1/i+h)*(u-1)+a;++_}if(Math.abs(d-c)>1e-7&&20===_)throw new t.NumericError(t._ErrorMessages.RateCriteriaFails);return i};_CalcEngine.prototype._handleHLookup=function(e,t){var o=this;return this._handleLookup(e,t,{base:function(e){return e.topRow},span:function(e){return e.rowSpan},iterStart:function(e){return e.leftCol},iterEnd:function(e){return e.rightCol},getValue:function(e,n){return o._owner.getCellValue(e,n,!1,t)}})};_CalcEngine.prototype._handleVLookup=function(e,t){var o=this;return this._handleLookup(e,t,{base:function(e){return e.leftCol},span:function(e){return e.columnSpan},iterStart:function(e){return e.topRow},iterEnd:function(e){return e.bottomRow},getValue:function(e,n){return o._owner.getCellValue(n,e,!1,t)}})};_CalcEngine.prototype._handleLookup=function(e,o,n){var i=e[0].evaluate(this._rowIndex,this._columnIndex,o),l=e[1],r=t._Expression.toNumber(e[2],this._rowIndex,this._columnIndex,o),s=null==e[3]||t._Expression.toBoolean(e[3],this._rowIndex,this._columnIndex,o);if(null==i||""==i)throw new t.ValueError(t._ErrorMessages.InvalidParameter("Lookup_value"));if(isNaN(r)||r<0)throw new t.ValueError(t._ErrorMessages.InvalidParameter("index_num"));if((l=this._ensureNonFunctionExpression(l,o))instanceof t._CellRangeExpression){var a,h=l.cells;if(r>n.span(h))throw new t.ValueError(t._ErrorMessages.ParameterIsOutOfRange("index_num"));s?-1===(a=this._exactMatch(i,h,!1,n))&&(a=this._approximateMatch(i,h,n)):a=this._exactMatch(i,h,!0,n);if(-1===a)throw new t.NotAvailableError;return n.getValue(n.base(h)+r-1,a)}throw new t.SyntaxError(t._ErrorMessages.InvalidCellRef)};_CalcEngine.prototype._exactMatch=function(o,n,i,l){var r,s=l.base(n);e.isString(o)&&(o=o.toLowerCase());if(i&&e.isString(o)&&(o.indexOf("?")>-1||o.indexOf("*")>-1)){var a=o.match(/([\?\*]*)(\w+)([\?\*]*)(\w+)([\?\*]*)/);if(null==a||6!==a.length)throw new t.ValueError(t._ErrorMessages.InvalidParameter("Lookup_value"));r=new RegExp("^"+(a[1].length>0?this._parseRegCriteria(a[1]):"")+a[2]+(a[3].length>0?this._parseRegCriteria(a[3]):"")+a[4]+(a[5].length>0?this._parseRegCriteria(a[5]):"")+"$","i")}for(var h=l.iterStart(n);h<=l.iterEnd(n);h++){var u=l.getValue(s,h);if(null!=r){if(r.test(u))return h}else{e.isString(u)&&(u=u.toLowerCase());if(o===u)return h}}return-1};_CalcEngine.prototype._approximateMatch=function(o,n,i){var l=i.base(n),r=[];e.isString(o)&&(o=o.toLowerCase());for(var s=i.iterStart(n);s<=i.iterEnd(n);s++){var a=i.getValue(l,s);a=isNaN(+a)?a:+a;r.push({value:a,index:s})}r.sort((function(t,o){e.isString(t.value)&&(t.value=t.value.toLowerCase());e.isString(o.value)&&(o.value=o.value.toLowerCase());return t.value>o.value?-1:t.value===o.value?o.index-t.index:1}));for(var h=0;h<r.length;h++){a=r[h];e.isString(a.value)&&(a.value=a.value.toLowerCase());if(o>a.value)return a.index}throw new t.NotAvailableError};_CalcEngine.prototype._parseToScientificValue=function(t,o,n,i,l){var r,s,a,h,u=0;if(Math.abs(t)>=1){s="+";r=Math.pow(10,o.length);for(;t>r;){t/=r;u+=o.length}}else{s="-";r=Math.pow(10,o.length);for(;t*r<r;){t*=r;u+=o.length}}a=e.Globalize.format(t,"D"+o.length);if(n){if((a+=e.Globalize.format(t-Math.floor(t),o+n).substring(1)).indexOf(".")>-1)h=a.length-1-a.indexOf(".");else{a+=".";h=0}for(;h<n.length-1;){a+="0";h++}}a+="E"+s+e.Globalize.format(u,"D"+i.length);if(l){a+=".";for(var d=1;d<l.length;d++)a+="0"}return a};_CalcEngine.prototype._checkCache=function(e,o,n,r,s){void 0===o&&(o=!0);null!=n&&(this._sheet=this._owner.sheets[n]);null!=r&&(this._rowIndex=r);null!=s&&(this._columnIndex=s);var a=this._sheet?this._sheet.name:"",h=this._expressionCache[a+":"+o+":"+e]||this._expressionCache[a+"_"+this._rowIndex+"_"+this._columnIndex+":"+o+":"+e];if(h){if(h.token.tokenType===i.ERROR)throw h.token.value;return h}h=this._parse(e);if(this._token.tokenID!==l.END||this._token.tokenType!==i.GROUP)throw new t.SyntaxError(t._ErrorMessages.InvalidExpression(e));this._cacheSize>1e4&&this._clearExpressionCache();this._expressionCache[a+(this._containsCellRef?"_"+this._rowIndex+"_"+this._columnIndex:"")+":"+o+":"+e]=h;this._cacheSize++;return h};_CalcEngine.prototype._ensureNonFunctionExpression=function(e,o){for(;e instanceof t._FunctionExpression;)e=e.evaluate(this._rowIndex,this._columnIndex,o);return e};_CalcEngine.prototype._getDefinedName=function(e,t){var o;t=t?t.toLowerCase():t;for(var n=0;n<this._owner.definedNames.length;n++){var i=this._owner.definedNames[n];if(i.name.toLowerCase()===e)if(i.sheetName){if(i.sheetName.toLowerCase()===t)return i}else o=i}return o};_CalcEngine.prototype._numAlpha=function(e){var t=Math.floor((e-1)/26);return(t>0?this._numAlpha(t):"")+String.fromCharCode((e-1)%26+65)};return _CalcEngine}();t._CalcEngine=o;var n=function(){function _Token(e,t,o){this._value=e;this._tokenID=t;this._tokenType=o}Object.defineProperty(_Token.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0});Object.defineProperty(_Token.prototype,"tokenID",{get:function(){return this._tokenID},enumerable:!0,configurable:!0});Object.defineProperty(_Token.prototype,"tokenType",{get:function(){return this._tokenType},enumerable:!0,configurable:!0});return _Token}();t._Token=n;var i,l,r,s,a=function(){function _FunctionDefinition(t,o,n){this._paramMax=Number.MAX_VALUE;this._paramMin=Number.MIN_VALUE;this._func=t;e.isNumber(o)&&!isNaN(o)&&(this._paramMax=o);e.isNumber(n)&&!isNaN(n)&&(this._paramMin=n)}Object.defineProperty(_FunctionDefinition.prototype,"paramMax",{get:function(){return this._paramMax},enumerable:!0,configurable:!0});Object.defineProperty(_FunctionDefinition.prototype,"paramMin",{get:function(){return this._paramMin},enumerable:!0,configurable:!0});Object.defineProperty(_FunctionDefinition.prototype,"func",{get:function(){return this._func},enumerable:!0,configurable:!0});return _FunctionDefinition}();t._FunctionDefinition=a;!function(e){e[e.COMPARE=0]="COMPARE";e[e.ADDSUB=1]="ADDSUB";e[e.MULDIV=2]="MULDIV";e[e.POWER=3]="POWER";e[e.CONCAT=4]="CONCAT";e[e.GROUP=5]="GROUP";e[e.LITERAL=6]="LITERAL";e[e.IDENTIFIER=7]="IDENTIFIER";e[e.ERROR=8]="ERROR";e[e.SQUAREBRACKETS=9]="SQUAREBRACKETS"}(i=t._TokenType||(t._TokenType={}));!function(e){e[e.GT=0]="GT";e[e.LT=1]="LT";e[e.GE=2]="GE";e[e.LE=3]="LE";e[e.EQ=4]="EQ";e[e.NE=5]="NE";e[e.ADD=6]="ADD";e[e.SUB=7]="SUB";e[e.MUL=8]="MUL";e[e.DIV=9]="DIV";e[e.DIVINT=10]="DIVINT";e[e.MOD=11]="MOD";e[e.POWER=12]="POWER";e[e.CONCAT=13]="CONCAT";e[e.OPEN=14]="OPEN";e[e.CLOSE=15]="CLOSE";e[e.END=16]="END";e[e.COMMA=17]="COMMA";e[e.PERIOD=18]="PERIOD";e[e.ATOM=19]="ATOM"}(l=t._TokenID||(t._TokenID={}));!function(e){e[e.Count=0]="Count";e[e.CountA=1]="CountA";e[e.CountBlank=2]="CountBlank";e[e.CountIf=3]="CountIf";e[e.CountIfs=4]="CountIfs";e[e.Rank=5]="Rank";e[e.SumIf=6]="SumIf";e[e.SumIfs=7]="SumIfs";e[e.Product=8]="Product"}(r||(r={}));!function(e){e[e.Average=1]="Average";e[e.Count=2]="Count";e[e.CountA=3]="CountA";e[e.Max=4]="Max";e[e.Min=5]="Min";e[e.Product=6]="Product";e[e.Std=7]="Std";e[e.StdPop=8]="StdPop";e[e.Sum=9]="Sum";e[e.Var=10]="Var";e[e.VarPop=11]="VarPop";e[e.AverageWithoutHidden=101]="AverageWithoutHidden";e[e.CountWithoutHidden=102]="CountWithoutHidden";e[e.CountAWithoutHidden=103]="CountAWithoutHidden";e[e.MaxWithoutHidden=104]="MaxWithoutHidden";e[e.MinWithoutHidden=105]="MinWithoutHidden";e[e.ProductWithoutHidden=106]="ProductWithoutHidden";e[e.StdWithoutHidden=107]="StdWithoutHidden";e[e.StdPopWithoutHidden=108]="StdPopWithoutHidden";e[e.SumWithoutHidden=109]="SumWithoutHidden";e[e.VarWithoutHidden=110]="VarWithoutHidden";e[e.VarPopWithoutHidden=111]="VarPopWithoutHidden"}(s||(s={}));var h=/[A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEF\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7B9\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/}(t.sheet||(t.sheet={}))}(e.grid||(e.grid={}))}(wijmo||(wijmo={}));!function(e){!function(t){!function(t){"use strict";var o=function(o){__extends(_FlexSheetCellFactory,o);function _FlexSheetCellFactory(){return null!==o&&o.apply(this,arguments)||this}_FlexSheetCellFactory.prototype.updateCell=function(n,i,l,r,s){var a,h,u,d=n.grid,c=/^border/;n.cellType===e.grid.CellType.Cell&&this._resetCellStyle(r);if(n.cellType===e.grid.CellType.Cell){var _=i*d.columns.length+l,g=d.selectedSheet;if((h=g&&g._styledCells?g._styledCells[_]:null)&&"pre-wrap"==h.whiteSpace&&(u=t._isEditingCell(d,i,l))){a=n.rows[i]._getFlag(e.grid.RowColFlags.MultiLine);n.rows[i]._setFlag(e.grid.RowColFlags.MultiLine,!0,!0)}}o.prototype.updateCell.call(this,n,i,l,r,s);null!=a&&n.rows[i]._setFlag(e.grid.RowColFlags.MultiLine,a,!0);if(s&&!s.isSingleCell){i=s.row;l=s.col}switch(n.cellType){case e.grid.CellType.ColumnHeader:var f=n.getCellData(i,l,!0);r.textContent?r.innerHTML=r.innerHTML.replace(e.escapeHtml(r.textContent),f).replace(r.textContent,f):r.innerHTML+=f;r.style.textAlign="center";break;case e.grid.CellType.Cell:var p=d._getBindingColumn(n,i,n.columns[l]);if(s&&!s.isSingleCell){var w=this._getFirstVisibleCell(d,s);i=w.row;l=w.col}if(n.rows[i]instanceof t.HeaderRow){(n.columns[l].dataMapEditor===e.grid.DataMapEditor.RadioButtons&&r.firstElementChild instanceof HTMLLabelElement||n.columns[l].dataType===e.DataType.Boolean&&1===r.childElementCount&&r.firstElementChild instanceof HTMLLabelElement&&r.firstElementChild.firstElementChild instanceof HTMLInputElement&&"checkbox"===r.firstElementChild.firstElementChild.type||n.columns[l].dataType!==e.DataType.Boolean&&!r.innerHTML)&&(r.innerHTML=e.escapeHtml(d.getCellValue(i,l)));e.addClass(r,"wj-header-row")}else{if(u){var m=r.querySelector("input");m&&h&&h.textAlign&&(m.style.textAlign=h.textAlign)}else{var C=n.rows[i]instanceof e.grid.GroupRow;if(n.columns[l].dataType===e.DataType.Boolean){var S=r.querySelector('[type="checkbox"]');if(S){S.checked=d.getCellValue(i,l);S.disabled=S.disabled||!d.canEditCell(i,l)}}else if(p.dataMap&&!C){var b=d.getCellValue(i,l,!0),y=r.firstChild;y&&3===y.nodeType&&y.nodeValue!==b&&(y.nodeValue=b)}else if(0===r.childElementCount&&r.textContent===d.getCellData(i,l,!0)){b=d.getCellValue(i,l,!0);var v=(h?h.format:null)||(C?null:p.format);if(""!==b&&e.isNumber(+b)&&!isNaN(+b)&&/[hsmy\:]/i.test(v)){var R=t.FlexSheet._fromOADate(+b);isNaN(R.getTime())||(b=e.Globalize.formatDate(R,v))}if(v||!C){b=e.isString(b)?b.replace(/^(\')(\s*[\w|=])/,"$2"):b;e.isString(b)?b&&this._isURL(b)?r.innerHTML='<a href="'+b+'" target="_blank">'+e.escapeHtml(b)+"</a>":r.innerHTML=e.escapeHtml(b):r.innerHTML=b}}}if(h){var x,T=r.style;for(var E in h)if("className"===E)h.className&&e.addClass(r,h.className);else if("format"!==E&&(x=h[E]))if(!e.hasClass(r,"wj-state-selected")&&!e.hasClass(r,"wj-state-multi-selected")||"color"!==E&&"backgroundColor"!==E)if("whiteSpace"===E&&"normal"===x)T[E]="";else{if(c.test(E))continue;T[E]=x}else T[E]=""}var F=this._getCellBorders(d,d.selectedSheet,s||new e.grid.CellRange(i,l));if(F)for(var A in F)r.style[A]=F[A]}if(r.style.backgroundColor||r.style.color){h||(h={});r.style.backgroundColor&&(h.backgroundColor=r.style.backgroundColor);r.style.color&&(h.color=r.style.color)}}if(n.cellType===e.grid.CellType.Cell){i!==d._lastVisibleFrozenRow||e.hasClass(r,"wj-frozen-row")||e.addClass(r,"wj-frozen-row");l!==d._lastVisibleFrozenColumn||e.hasClass(r,"wj-frozen-col")||e.addClass(r,"wj-frozen-col")}};_FlexSheetCellFactory.prototype._resetCellStyle=function(e){var t=e.style;t.fontFamily="";t.fontSize="";t.fontStyle="";t.fontWeight="";t.textDecoration="";t.textAlign="";t.verticalAlign="";t.backgroundColor="";t.color="";t.whiteSpace="";t.borderLeftStyle="";t.borderLeftColor="";t.borderLeftWidth="";t.borderRightStyle="";t.borderRightColor="";t.borderRightWidth="";t.borderTopStyle="";t.borderTopColor="";t.borderTopWidth="";t.borderBottomStyle="";t.borderBottomColor="";t.borderBottomWidth=""};_FlexSheetCellFactory.prototype._getFirstVisibleCell=function(t,o){var n,i;for(n=o.topRow;n<=o.bottomRow&&!t.rows[n].isVisible;n++);for(i=o.leftCol;i<=o.rightCol&&!t.columns[i].isVisible;i++);return new e.grid.CellRange(n,i)};_FlexSheetCellFactory.prototype._isURL=function(e){return new RegExp("^(https|http|ftp|rtsp|mms)://(([0-9a-z_!~*'().&=+$%-]+: )?[0-9a-z_!~*'().&=+$%-]+@)?(([0-9]{1,3}.){3}[0-9]{1,3}|([0-9a-z_!~*'()-]+.)*([0-9a-z][0-9a-z-]{0,61})?[0-9a-z].[a-z]{2,6})(:[0-9]{1,4})?(/($|[a-zA-Z0-9.,?'\\+&amp;%$#=~_-]+))*").test(e)};_FlexSheetCellFactory.prototype._getCellBorders=function(e,t,o){var n=t&&t._styledCells;if(!n)return null;var i=o.topRow,l=o.leftCol,r=o.bottomRow,s=o.rightCol,a=e.columns.length,h=n[i*a+l],u=n[r*a+s],d=l>0?n[i*a+l-1]:null,c=s+1<a?n[i*a+s+1]:null,_=i>0?n[(i-1)*a+l]:null,g=n[(r+1)*a+l];if(!(h||u||d||c||_||g))return null;var f={},p=h&&h.borderLeftStyle&&"none"!==h.borderLeftStyle&&!(!h.borderLeftColor&&!h.borderLeftWidth),w=d&&d.borderRightStyle&&"none"!==d.borderRightStyle&&!(!d.borderRightColor&&!d.borderRightWidth);if(!p&&w||p&&w&&parseInt(d.borderRightWidth||1)>parseInt(h.borderLeftWidth||1)){if("double"!==d.borderRightStyle){f.borderLeftColor=d.borderRightColor;f.borderLeftStyle=d.borderRightStyle;f.borderLeftWidth=Math.floor(parseInt(d.borderRightWidth||1)/2)+"px"}}else if(p){f.borderLeftColor=h.borderLeftColor;f.borderLeftStyle=h.borderLeftStyle;f.borderLeftWidth="double"!==h.borderLeftStyle?Math.ceil(parseInt(h.borderLeftWidth||1)/2)+"px":f.borderLeftWidth=h.borderLeftWidth}var m=h&&h.borderTopStyle&&"none"!==h.borderTopStyle&&!(!h.borderTopColor&&!h.borderTopWidth),C=_&&_.borderBottomStyle&&"none"!==_.borderBottomStyle&&!(!_.borderBottomColor&&!_.borderBottomWidth);if(!m&&C||m&&C&&parseInt(_.borderBottomWidth||1)>parseInt(h.borderTopWidth||1)){if("double"!==_.borderBottomStyle){f.borderTopColor=_.borderBottomColor;f.borderTopStyle=_.borderBottomStyle;f.borderTopWidth=Math.floor(parseInt(_.borderBottomWidth||1)/2)+"px"}}else if(m){f.borderTopColor=h.borderTopColor;f.borderTopStyle=h.borderTopStyle;f.borderTopWidth="double"!==h.borderTopStyle?Math.ceil(parseInt(h.borderTopWidth||1)/2)+"px":h.borderTopStyle}var S=u&&u.borderRightStyle&&"none"!==u.borderRightStyle&&!(!u.borderRightColor&&!u.borderRightWidth),b=c&&c.borderLeftStyle&&"none"!==c.borderLeftStyle&&!(!c.borderLeftColor&&!c.borderLeftWidth);if(!S&&b||S&&b&&parseInt(c.borderLeftWidth||1)>=parseInt(u.borderRightWidth||1)){if("double"!==c.borderLeftStyle){f.borderRightColor=c.borderLeftColor;f.borderRightStyle=c.borderLeftStyle;f.borderRightWidth=Math.floor(parseInt(c.borderLeftWidth||1)/2)+"px"}}else if(S){f.borderRightColor=u.borderRightColor;f.borderRightStyle=u.borderRightStyle;f.borderRightWidth="double"!==u.borderRightStyle?Math.ceil(parseInt(u.borderRightWidth||1)/2)+"px":u.borderRightWidth}var y=u&&u.borderBottomStyle&&"none"!==u.borderBottomStyle&&!(!u.borderBottomColor&&!u.borderBottomWidth),v=g&&g.borderTopStyle&&"none"!==g.borderTopStyle&&!(!g.borderTopColor&&!g.borderTopWidth);if(!y&&v||y&&v&&parseInt(g.borderTopWidth||1)>=parseInt(u.borderBottomWidth||1)){if("double"!==g.borderTopStyle){f.borderBottomColor=g.borderTopColor;f.borderBottomStyle=g.borderTopStyle;f.borderBottomWidth=Math.floor(parseInt(g.borderTopWidth||1)/2)+"px"}}else if(y){f.borderBottomColor=u.borderBottomColor;f.borderBottomStyle=u.borderBottomStyle;f.borderBottomWidth="double"!==u.borderBottomStyle?Math.ceil(parseInt(u.borderBottomWidth||1)/2)+"px":u.borderBottomWidth}return f};return _FlexSheetCellFactory}(e.grid.CellFactory);t._FlexSheetCellFactory=o}(t.sheet||(t.sheet={}))}(e.grid||(e.grid={}))}(wijmo||(wijmo={}));!function(e){!function(t){t.sheet||(t.sheet={}),e._registerModule("wijmo.grid.sheet",e.grid.sheet)}(e.grid||(e.grid={}))}(wijmo||(wijmo={}));