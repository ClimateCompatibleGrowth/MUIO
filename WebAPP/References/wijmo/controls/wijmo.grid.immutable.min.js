/*!
    *
    * Wijmo Library 5.20213.824
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

var wijmo,__extends=this&&this.__extends||function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){extendStatics(t,e);function __(){this.constructor=t}t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}();!function(t){var e;(function(e){var i,n=function(t){__extends(DataChangeEventArgs,t);function DataChangeEventArgs(e,i,n,r){var o=t.call(this)||this;o.action=e;o.oldItem=i;o.newItem=n;o.itemIndex=r;return o}return DataChangeEventArgs}(t.EventArgs);e.DataChangeEventArgs=n;!function(t){t[t.Add=0]="Add";t[t.Remove=1]="Remove";t[t.Change=2]="Change"}(i=e.DataChangeAction||(e.DataChangeAction={}));var r=function(t){__extends(CloningItemEventArgs,t);function CloningItemEventArgs(e){var i=t.call(this)||this;i._originalItem=e;return i}Object.defineProperty(CloningItemEventArgs.prototype,"originalItem",{get:function(){return this._originalItem},enumerable:!0,configurable:!0});return CloningItemEventArgs}(t.EventArgs);e.CloningItemEventArgs=r;var o=function(){function ImmutabilityProvider(e,i){this._isAddNew=!1;this._isPasting=!1;this.dataChanged=new t.Event;this.cloningItem=new t.Event;t.assert(e instanceof t.grid.FlexGrid,"FlexGrid component is not specified.");this._grid=e;var n=this._cv=new t.collections.CollectionView([]);e.itemsSource=n;e.rowAdded.addHandler(this._gridRowAdded,this);e.deletingRow.addHandler(this._gridDeletingRow,this);e.deletedRow.addHandler(this._gridDeletedRow,this);e.beginningEdit.addHandler(this._gridBeginningEdit,this);e.rowEditEnded.addHandler(this._gridRowEditEnded,this);e.pasting.addHandler(this._gridPasting,this);e.pasted.addHandler(this._gridPasted,this);t.copy(this,i)}ImmutabilityProvider.prototype._clearChg=function(){this._isAddNew=this._isPasting=!1;this._chg=this._iChg=null};Object.defineProperty(ImmutabilityProvider.prototype,"grid",{get:function(){return this._grid},enumerable:!0,configurable:!0});Object.defineProperty(ImmutabilityProvider.prototype,"collectionView",{get:function(){return this._cv},enumerable:!0,configurable:!0});Object.defineProperty(ImmutabilityProvider.prototype,"itemsSource",{get:function(){return this._items},set:function(e){t.assert(null==e||t.isArray(e),"Not an array");if(e!==this._items){this._items=e;var i=this._cv,n=i.sourceCollection,r=i.currentPosition,o=i.currentItem;this._replaceItems(n,e);i.refresh();if(r===i.currentPosition&&o!==i.currentItem){var a=new t.CancelEventArgs;i.onCurrentChanging(a);i.onCurrentChanged(a)}}},enumerable:!0,configurable:!0});ImmutabilityProvider.prototype.onDataChanged=function(t){this.dataChanged.raise(this,t)};ImmutabilityProvider.prototype.onCloningItem=function(t){this.cloningItem.raise(this,t)};ImmutabilityProvider.prototype._gridRowAdded=function(t,e){this._isPasting||(this._isAddNew=!0)};ImmutabilityProvider.prototype._gridDeletingRow=function(t,e){if(!this._isAddNew){var i=e.getRow(),n=i.dataItem,r=this._dataIndex(i);this._cv.sourceCollection.indexOf(n);r>-1&&(this._iChg={oldItem:n,index:r})}};ImmutabilityProvider.prototype._gridDeletedRow=function(t,e){var r=this._iChg,o=this._isAddNew;if(r){this._clearChg();o||this.onDataChanged(new n(i.Remove,r.oldItem,null,r.index))}};ImmutabilityProvider.prototype._gridBeginningEdit=function(t,e){if(!this._isAddNew){var i=e.getRow(),n=i.dataItem,r=this._cv.sourceCollection.indexOf(n),o=this._chg;if(o){if(o.changedItems[r])return}else o=this._chg={changedItems:{}};this._addItemChange(i.index,r)}};ImmutabilityProvider.prototype._gridRowEditEnded=function(t,e){this._isPasting||this._doRowEditEnded(t,e)};ImmutabilityProvider.prototype._doRowEditEnded=function(t,e){var r=this._isAddNew,o=this._chg;this._clearChg();if(r){if(!e.cancel){var a=this._cv.sourceCollection,s=a[a.length-1];this.onDataChanged(new n(i.Add,null,s,a.length-1))}}else if(o)if(e.cancel){var d=e.getRow();this._swapBatchedItems(d,o.changedItems)>1&&this._cv.refresh()}else{var c=o.changedItems;for(var l in c){var h=c[l];this.onDataChanged(new n(i.Change,h.oldItem,h.newItem,h.index))}}};ImmutabilityProvider.prototype._gridPasting=function(e,i){this._isPasting=!0;var n=i.range.rowSpan;if(this._chg&&1!==n)i.cancel=!0;else if(1!==n){var r=this._grid.rows,o=i.range.topRow,a=i.range.bottomRow,s=Math.min(r.length-1,a),d=this._cv.sourceCollection;this._chg={changedItems:{},cvLength:d.length};for(var c=o;c<=s;c++){var l=this._dataIndex(r[c]);l>-1&&this._addItemChange(c,l)}}else{this._isPasting=!1;i.getRow()instanceof t.grid._NewRowTemplate||this._gridBeginningEdit(e,i)}};ImmutabilityProvider.prototype._gridPasted=function(t,e){var r=this._chg;if(r&&1!==e.range.rowSpan){var o=this._cv.sourceCollection,a=r.cvLength,s=o.slice(a,o.length);this._doRowEditEnded(t,e);for(var d=0;d<s.length;d++)this.onDataChanged(new n(i.Add,null,s[d],a+d))}};ImmutabilityProvider.prototype._swapItem=function(t,e,i,n){var r=t;r&&r.dataItem===n||this._grid.rows.some((function(t){return t.dataItem===n&&!!(r=t)}));var o=this._cv,a=o.sourceCollection.indexOf(n),s=o.items.indexOf(n);e.dataItem=i;r&&(r.dataItem=i);o.sourceCollection[a]=i;o.items[s]=i;return a};ImmutabilityProvider.prototype._swapBatchedItems=function(t,e){var i=Object.keys(e),n=i.length;n>1&&(t=null);for(var r=0,o=i;r<o.length;r++){var a=e[o[r]];this._swapItem(t,a.row,a.oldItem,a.newItem)}return n};ImmutabilityProvider.prototype._addItemChange=function(t,e){var i=this._grid.rows[t],n=i.dataItem,r=this._cloneItem(n);null==e&&(e=this._cv.sourceCollection.indexOf(n));this._chg.changedItems[e]={row:i,oldItem:n,newItem:r,index:e};this._swapItem(i,i,r,n)};ImmutabilityProvider.prototype._dataIndex=function(e){var i=e.dataItem;return i&&!(e instanceof t.grid.GroupRow||e instanceof t.grid._NewRowTemplate)?this._cv.sourceCollection.indexOf(i):-1};ImmutabilityProvider.prototype._replaceItems=function(t,e){t.splice(0,t.length);for(var i=t.length=e.length,n=0;n<i;n++)t[n]=e[n];return t};ImmutabilityProvider.prototype._cloneItem=function(t){var e=new r(t);this.onCloningItem(e);var i=e.clonedItem;null==i&&(i=this._cloneBindings(t));return i};ImmutabilityProvider.prototype._cloneBindings=function(t){for(var e=copyObject({},t),i={},n=0,r=this.grid.columns;n<r.length;n++){var o=r[n]._binding,a=o&&o._parts;if(a&&a.length>1)for(var s=a.length-2,d=i,c=0;c<=s;c++){var l=a[c];d[l]||(d[l]={});d=d[l]}}this._cloneProps(e,i);return e};ImmutabilityProvider.prototype._cloneProps=function(e,i){for(var n in i){var r=e[n];if(null!=r)if(t.isArray(r)){var o=e[n]=[].concat(r);this._cloneProps(o,i[n])}else if(t.isObject(r)){o=e[n]=copyObject({},r);this._cloneProps(o,i[n])}}};return ImmutabilityProvider}();e.ImmutabilityProvider=o;function copyObject(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return a.apply(void 0,[t].concat(e))}e.copyObject=copyObject;var a="function"==typeof Object.assign?Object.assign:function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];for(var n=0,r=e;n<r.length;n++){var o=r[n];if(null!=o)for(var a in o){var s=Object.getOwnPropertyDescriptor(t,a);s&&!s.writable||(t[a]=o[a])}}return t}})((e=t.grid||(t.grid={})).immutable||(e.immutable={}))}(wijmo||(wijmo={}));!function(t){!function(e){e.immutable||(e.immutable={}),t._registerModule("wijmo.grid.immutable",t.grid.immutable)}(t.grid||(t.grid={}))}(wijmo||(wijmo={}));