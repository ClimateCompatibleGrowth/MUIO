/*!
    *
    * Wijmo Library 5.20213.824
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

var wijmo,__extends=this&&this.__extends||function(){var extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}}(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,o=1,r=arguments.length;o<r;o++){t=arguments[o];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)};!function(e){!function(t){var o=function(){function OAuth2(t,o,r,n){var i=this;this.userChanged=new e.Event;this.error=new e.Event;this._gapi=window.gapi;if(this._gapi)this._gapiLoaded(t,o,r);else{var s=document.createElement("script");s.src="https://apis.google.com/js/api.js";s.onload=function(){return i._gapiLoaded(t,o,r)};document.head.appendChild(s)}e.copy(this,n)}Object.defineProperty(OAuth2.prototype,"user",{get:function(){var e=this._auth();if(e&&e.isSignedIn.get()){var t=e.currentUser.get().getBasicProfile();return{id:t.getId(),name:t.getName(),firstName:t.getGivenName(),lastName:t.getFamilyName(),imageUrl:t.getImageUrl(),eMail:t.getEmail()}}return null},enumerable:!0,configurable:!0});Object.defineProperty(OAuth2.prototype,"accessToken",{get:function(){var e=this._gapi.auth.getToken();return e?e.access_token:null},enumerable:!0,configurable:!0});Object.defineProperty(OAuth2.prototype,"idToken",{get:function(){var e=this._gapi.auth.getToken();return e?e.id_token:null},enumerable:!0,configurable:!0});OAuth2.prototype.signIn=function(){var e=this;this._auth().signIn().then((function(e){}),(function(t){"popup_closed_by_user"!=t&&e.onError(new r(t))}))};OAuth2.prototype.signOut=function(){this._auth().signOut()};OAuth2.prototype.onUserChanged=function(e){this.userChanged.raise(this,e)};OAuth2.prototype.onError=function(e){this.error.raise(this,e)};OAuth2.prototype._gapiLoaded=function(t,o,n){var i=this,s=this._gapi=window.gapi;e.assert(s,"Failed to load google gapi.");s.load("client:auth2",(function(){var e=n&&n.length?n.join(" "):"";e=e||"https://www.googleapis.com/auth/userinfo.email";s.client.init({apiKey:t,clientId:o,scope:e}).then((function(){i._auth().isSignedIn.listen((function(){i.onUserChanged()}));i.onUserChanged()}),(function(e){i.onError(new r(e))}))}))};OAuth2.prototype._auth=function(){return this._gapi&&this._gapi.auth2?this._gapi.auth2.getAuthInstance():null};return OAuth2}();t.OAuth2=o;var r=function(e){__extends(OAuthError,e);function OAuthError(t){var o=e.call(this)||this;o._error=t;return o}Object.defineProperty(OAuthError.prototype,"error",{get:function(){return this._error},enumerable:!0,configurable:!0});return OAuthError}(e.EventArgs);t.OAuthError=r}(e.cloud||(e.cloud={}))}(wijmo||(wijmo={}));!function(e){!function(t){var o=function(t){__extends(Snapshot,t);function Snapshot(o,r){var n=t.call(this)||this;n._loading=!1;n._deferCommits=!1;n._hasPendingChanges=!1;n.loading=new e.Event;n.loaded=new e.Event;n.error=new e.Event;n.hasPendingChangesChanged=new e.Event;n._checkType("CollectionReference",o,"firestore","doc","onSnapshot");n._collection=o;e.copy(n,r);n.itemsEdited.collectionChanged.addHandler(n._updateHasChanges,n);n.itemsAdded.collectionChanged.addHandler(n._updateHasChanges,n);n.itemsRemoved.collectionChanged.addHandler(n._updateHasChanges,n);n._getData();return n}Object.defineProperty(Snapshot.prototype,"query",{get:function(){return this._query},set:function(e){if(e!=this._query){this._checkType("Query",e,"firestore","onSnapshot");this._query=e;this._getData()}},enumerable:!0,configurable:!0});Object.defineProperty(Snapshot.prototype,"deferCommits",{get:function(){return this._deferCommits},set:function(t){this._deferCommits=e.asBoolean(t);this.deferCommits&&(this.trackChanges=!0)},enumerable:!0,configurable:!0});Snapshot.prototype.commitChanges=function(){var e=this;if(this.deferCommits&&this.hasPendingChanges){var t=this._collection.firestore.batch();this.itemsEdited.forEach((function(o){var r=e._getItemDoc(o),n=e._getItemData(o);t.update(r,n)}));this.itemsAdded.forEach((function(o){var r=e._getItemDoc(o),n=e._getItemData(o);t.set(r,n)}));this.itemsRemoved.forEach((function(o){var r=e._getItemDoc(o);t.delete(r)}));t.commit().then((function(){e.clearChanges();e._getData(!0)})).catch((function(t){return e._raiseError(t,!0)}))}};Snapshot.prototype.cancelChanges=function(){if(this.deferCommits){this.clearChanges();this._getData(!0)}};Object.defineProperty(Snapshot.prototype,"hasPendingChanges",{get:function(){return!!this.deferCommits&&(this.itemsAdded.length>0||this.itemsEdited.length>0||this.itemsRemoved.length>0)},enumerable:!0,configurable:!0});Object.defineProperty(Snapshot.prototype,"isLoading",{get:function(){return this._loading},enumerable:!0,configurable:!0});Snapshot.prototype.load=function(e){this._getData(e)};Snapshot.prototype.onLoading=function(e){this.loading.raise(this,e);return!e.cancel};Snapshot.prototype.onLoaded=function(e){this.loaded.raise(this,e)};Snapshot.prototype.onError=function(e){if(this._loading){this._loading=!1;this.onLoaded()}this.error.raise(this,e);return!e.cancel};Snapshot.prototype.onHasPendingChangesChanged=function(e){this.hasPendingChangesChanged.raise(this,e)};Snapshot.prototype.commitNew=function(){var e=this;if(!this.deferCommits){var o=this.currentAddItem;o&&this._collection.add(this._getItemData(o)).catch((function(t){return e._raiseError(t,!0)}))}t.prototype.commitNew.call(this)};Snapshot.prototype.commitEdit=function(){var e=this;if(!this.deferCommits){var o=this.currentEditItem;if(o&&!this.currentAddItem&&this._getChangedFields(o,this._edtClone)){var r=this._getItemDoc(o),n=this._getItemData(o);r.update(n).catch((function(t){return e._raiseError(t,!0)}))}}t.prototype.commitEdit.call(this)};Snapshot.prototype.remove=function(e){var o=this;if(!this.deferCommits&&e&&e!=this.currentAddItem){this._getItemDoc(e).delete().catch((function(e){return o._raiseError(e,!0)}))}t.prototype.remove.call(this,e)};Snapshot.prototype._raiseError=function(e,t){this.onError(new r(e));t&&this._getData(!0)};Snapshot.prototype._updateHasChanges=function(){var e=this.hasPendingChanges;if(e!=this._hasPendingChanges){this._hasPendingChanges=e;this.onHasPendingChangesChanged()}};Snapshot.prototype._getItemDoc=function(e){var t=e&&e.$META?e.$META.id:this._generateID();return this._collection.doc(t)};Snapshot.prototype._getItemData=function(e){var t={},o=this.calculatedFields;for(var r in e)o&&r in o||"$META"!=r&&(t[r]=e[r]);return t};Snapshot.prototype._getData=function(t){var o=this;this._toGetData&&clearTimeout(this._toGetData);this._toGetData=setTimeout((function(){o._toGetData=null;o._loading=!0;if(o.onLoading(new e.CancelEventArgs)){o._unsubscribe&&o._unsubscribe();o._unsubscribe=o._getQuery().onSnapshot((function(e){var r=[],n=t||!o._loading?o.currentPosition:null;e.forEach((function(e){r.push(__assign({$META:{id:e.id}},e.data()))}));o.sourceCollection=r;null!=n&&o.moveCurrentToPosition(n);if(o._loading){o._loading=!1;o.onLoaded()}}),(function(e){return o._raiseError(e,!0)}))}}),e.Control._REFRESH_INTERVAL)};Snapshot.prototype._generateID=function(){for(var e="";e.length<20;)e+=Math.random().toString(36).substr(2,5);return e};Snapshot.prototype._checkType=function(t,o){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];if(null!=o)for(var i=0;i<r.length;i++){var s=r[i];null==o[s]&&e.assert(!1,'Expected "'+t+'" but the value does not have "'+s+'".')}};Snapshot.prototype._getQuery=function(){return this._query||this._collection};return Snapshot}(e.collections.CollectionView);t.Snapshot=o;var r=function(e){__extends(FirestoreErrorEventArgs,e);function FirestoreErrorEventArgs(t){var o=e.call(this)||this;o._error=t;return o}Object.defineProperty(FirestoreErrorEventArgs.prototype,"error",{get:function(){return this._error},enumerable:!0,configurable:!0});Object.defineProperty(FirestoreErrorEventArgs.prototype,"message",{get:function(){return this._error.message},enumerable:!0,configurable:!0});return FirestoreErrorEventArgs}(e.CancelEventArgs);t.FirestoreErrorEventArgs=r}(e.cloud||(e.cloud={}))}(wijmo||(wijmo={}));!function(e){!function(t){var o=function(t){__extends(Sheet,t);function Sheet(o,r,n){var i=t.call(this)||this;i._loading=!1;i.loading=new e.Event;i.loaded=new e.Event;i.error=new e.Event;i._gSheet=o;i._title=r;i._id=n;i._getData();o.accessTokenChanged.addHandler((function(){o.accessToken&&!i.items.length&&i._getData(!0)}));return i}Object.defineProperty(Sheet.prototype,"googleSheet",{get:function(){return this._gSheet},enumerable:!0,configurable:!0});Object.defineProperty(Sheet.prototype,"title",{get:function(){return this._title},enumerable:!0,configurable:!0});Sheet.prototype.load=function(e){this._getData(e)};Object.defineProperty(Sheet.prototype,"isLoading",{get:function(){return this._loading},enumerable:!0,configurable:!0});Sheet.prototype.onLoading=function(e){this.loading.raise(this,e);return!e.cancel};Sheet.prototype.onLoaded=function(e){this.loaded.raise(this,e)};Sheet.prototype.onError=function(e){if(this._loading){this._loading=!1;this.onLoaded()}this.error.raise(this,e);return!e.cancel};Sheet.prototype.commitNew=function(){var e=this.currentAddItem;e&&this._saveItem(e);t.prototype.commitNew.call(this)};Sheet.prototype.commitEdit=function(){var e=this.currentEditItem;e&&!this.currentAddItem&&this._getChangedFields(e,this._edtClone)&&this._saveItem(e);t.prototype.commitEdit.call(this)};Sheet.prototype.remove=function(o){var r=this;if(o&&o!=this.currentAddItem){var n=this.sourceCollection.indexOf(o);e.assert(n>-1,"Item not found.");var i=n+1;e.assert(null!=this._id,"Sheet doesn't have an ID ? ");var s=this.googleSheet,a=s._getUrl(":batchUpdate");e.httpRequest(a,{method:"POST",requestHeaders:s._getRequestHeaders(),data:{requests:[{deleteDimension:{range:{sheetId:this._id,dimension:"ROWS",startIndex:i,endIndex:i+1}}}]},error:function(e){return r._handleError(e,!1)}})}t.prototype.remove.call(this,o)};Sheet.prototype._getData=function(t){var o=this;this._toGetData&&clearTimeout(this._toGetData);this._toGetData=setTimeout((function(){o._loading=!0;o._itemKeys=null;if(o.onLoading(new e.CancelEventArgs)){var r=o.currentPosition,n=o.googleSheet,i=n._getUrl("/values/"+o.title+"!2:2");e.httpRequest(i,{requestHeaders:n._getRequestHeaders(),data:{valueRenderOption:"UNFORMATTED_VALUE",dateTimeRenderOption:"FORMATTED_STRING"},success:function(i){var s=JSON.parse(i.responseText).values[0],a=n._getUrl("/values/"+o.title);e.httpRequest(a,{requestHeaders:n._getRequestHeaders(),data:{valueRenderOption:"UNFORMATTED_VALUE",dateTimeRenderOption:"SERIAL_NUMBER"},success:function(e){var n=JSON.parse(e.responseText).values;o.sourceCollection=o._parseData(n,s);t&&o.moveCurrentToPosition(r);o._loading=!1;o.onLoaded()},error:function(e){return o._handleError(e,!1)}})},error:function(e){return o._handleError(e,!1)}})}}),e.Control._REFRESH_INTERVAL)};Sheet.prototype._parseData=function(t,o){for(var r=[],n=t[0],i=!0,s=0;s<n.length&&i;s++){var a=n[s];a&&e.isString(a)&&n.indexOf(a)==s||(i=!1)}if(i)t.splice(0,1);else{var l=[];for(s=0;s<n.length;s++)l.push(this._toSheetHeader(s));n=l}this._itemKeys=n;var c=[],u=this._gSheet.columnDataTypes,h=e.DataType;n.forEach((function(e){var t=h.Object;u&&u.forEach((function(o){o.pattern.test(e)&&(t=o.dataType)}));c.push(t)}));t.forEach((function(t){var i={};n.forEach((function(r,n){var s=t[n],a=o[n],l=c[n];l==h.Object&&e.isNumber(s)&&e.isString(a)&&a.length&&(l=h.Date);l!=h.Object&&(s=l==h.Date&&e.isNumber(s)?new Date(86400*(s-25568)*1e3):e.changeType(s,l));i[r]=s}));r.push(i)}));return r};Sheet.prototype._toSheetHeader=function(e){return e<26?String.fromCharCode(65+e):this._toSheetHeader(Math.floor(e/26)-1)+this._toSheetHeader(e%26)};Sheet.prototype._saveItem=function(t){var o=this,r=this.sourceCollection.indexOf(t);e.assert(r>-1,"Item not found?");var n=[];this._itemKeys.forEach((function(e){var o=t[e];n.push(null!=o?o.toString():"")}));var i=this.googleSheet,s=(r+2).toString(),a=this.title+"!A"+s+":Z"+s,l=i._getUrl("/values/"+a);l+=(l.indexOf("?key=")>-1?"&":"?")+"valueInputOption=USER_ENTERED";e.httpRequest(l,{method:"PUT",requestHeaders:i._getRequestHeaders(),data:{range:a,values:[n]},error:function(e){return o._handleError(e,!0)}})};Sheet.prototype._handleError=function(t,o){this.onError(new e.RequestErrorEventArgs(t));o&&this._getData(!0)};return Sheet}(e.collections.CollectionView);t.Sheet=o}(e.cloud||(e.cloud={}))}(wijmo||(wijmo={}));!function(e){!function(t){var o=function(){function GoogleSheet(t,o,r){this._sheetId="";this._accessToken="";this._apiKey="";this._loading=!1;this._sheets=new e.collections.ObservableArray;this.loading=new e.Event;this.loaded=new e.Event;this.error=new e.Event;this.accessTokenChanged=new e.Event;this._sheetId=e.asString(t,!1);this._apiKey=e.asString(o,!1);e.copy(this,r);this._getSheetInfo()}Object.defineProperty(GoogleSheet.prototype,"sheetId",{get:function(){return this._sheetId},enumerable:!0,configurable:!0});Object.defineProperty(GoogleSheet.prototype,"apiKey",{get:function(){return this._apiKey},enumerable:!0,configurable:!0});Object.defineProperty(GoogleSheet.prototype,"accessToken",{get:function(){return this._accessToken},set:function(t){if(t!=this._accessToken){this._accessToken=e.asString(t);this.onAccessTokenChanged()}},enumerable:!0,configurable:!0});Object.defineProperty(GoogleSheet.prototype,"columnDataTypes",{get:function(){return this._colTypes},set:function(e){this._colTypes=e},enumerable:!0,configurable:!0});Object.defineProperty(GoogleSheet.prototype,"sheets",{get:function(){return this._sheets},enumerable:!0,configurable:!0});GoogleSheet.prototype.getSheet=function(e){for(var t=0;t<this._sheets.length;t++){var o=this._sheets[t];if(o.title==e)return o}return null};Object.defineProperty(GoogleSheet.prototype,"isLoading",{get:function(){return this._loading},enumerable:!0,configurable:!0});GoogleSheet.prototype.onLoading=function(e){this.loading.raise(this,e)};GoogleSheet.prototype.onLoaded=function(e){this.loaded.raise(this,e)};GoogleSheet.prototype.onError=function(e){if(this._loading){this._loading=!1;this.onLoaded()}this.error.raise(this,e);return!e.cancel};GoogleSheet.prototype.onAccessTokenChanged=function(e){this.accessTokenChanged.raise(this,e)};GoogleSheet.prototype._copy=function(o,r){var n=this;if("sheets"==o&&e.isArray(r)){r.forEach((function(e){var o=new t.Sheet(n,e);n.sheets.push(o)}));return!0}return!1};GoogleSheet.prototype._getUrl=function(e){var t="https://sheets.googleapis.com/v4/spreadsheets/"+this.sheetId;e&&(t+=e);this.apiKey&&(t+="?key="+this.apiKey);return t};GoogleSheet.prototype._getRequestHeaders=function(){var e={"Content-Type":"application/json"};this.accessToken&&(e.Authorization="Bearer "+this.accessToken);return e};GoogleSheet.prototype._getSheetInfo=function(){var o=this;this._loading=!0;this.onLoading();e.httpRequest(this._getUrl(),{requestHeaders:this._getRequestHeaders(),data:{fields:"sheets.properties"},success:function(r){var n=JSON.parse(r.responseText),i=n.sheets;o.sheets.length?o.sheets.forEach((function(t){for(var o=0;o<i.length;o++){var r=i[o].properties;if(r.title==t.title){t._id=r.sheetId;break}}e.assert(null!=t._id,'Could not find sheet "'+t.title+'".')})):n.sheets.forEach((function(e){var r=e.properties;if("GRID"==r.sheetType){var n=new t.Sheet(o,r.title,r.sheetId);o.sheets.push(n)}}))},error:function(t){o.onError(new e.RequestErrorEventArgs(t))},complete:function(e){o._loading=!1;o.onLoaded()}})};return GoogleSheet}();t.GoogleSheet=o}(e.cloud||(e.cloud={}))}(wijmo||(wijmo={}));!function(e){!function(t){var o=function(){function Firestore(t,o,r){this._projectId="";this._collections=new e.collections.ObservableArray;this._accessToken="";this._idToken="";this._fbToken="";this._apiKey="";this.accessTokenChanged=new e.Event;this._projectId=e.asString(t,!1);this._apiKey=e.asString(o,!1);e.copy(this,r)}Object.defineProperty(Firestore.prototype,"projectId",{get:function(){return this._projectId},enumerable:!0,configurable:!0});Object.defineProperty(Firestore.prototype,"apiKey",{get:function(){return this._apiKey},enumerable:!0,configurable:!0});Object.defineProperty(Firestore.prototype,"accessToken",{get:function(){return this._accessToken},set:function(t){if(t!=this._accessToken){this._accessToken=e.asString(t);this.onAccessTokenChanged()}},enumerable:!0,configurable:!0});Object.defineProperty(Firestore.prototype,"idToken",{get:function(){return this._idToken},set:function(t){var o=this;if(t!=this._idToken){this._idToken=e.asString(t);if(this._idToken){var r="https://identitytoolkit.googleapis.com/v1/accounts:signInWithIdp?key="+this._apiKey;e.httpRequest(r,{method:"POST",data:{requestUri:window.location.href,postBody:"id_token="+this._idToken+"&providerId=google.com",returnSecureToken:!0,returnIdpCredential:!0},success:function(e){var t=JSON.parse(e.responseText);o._fbToken=t.idToken;o.onAccessTokenChanged()},error:function(e){o._fbToken="";o.onAccessTokenChanged()}})}else{this._fbToken="";this.onAccessTokenChanged()}}},enumerable:!0,configurable:!0});Object.defineProperty(Firestore.prototype,"collections",{get:function(){return this._collections},enumerable:!0,configurable:!0});Firestore.prototype.getCollection=function(e){for(var t=this._collections,o=0;o<t.length;o++){var r=t[o];if(r.name==e)return r}return null};Firestore.prototype.onAccessTokenChanged=function(e){this.accessTokenChanged.raise(this,e)};Firestore.prototype._copy=function(o,r){var n=this;if("collections"==o&&e.isArray(r)){r.forEach((function(e){var o=new t.Collection(n,e);n.collections.push(o)}));return!0}return!1};return Firestore}();t.Firestore=o}(e.cloud||(e.cloud={}))}(wijmo||(wijmo={}));!function(e){!function(t){t.softGridFilter=function softGridFilter(){return e._getModule("wijmo.grid.filter")}}(e.cloud||(e.cloud={}))}(wijmo||(wijmo={}));!function(e){!function(t){var o=function(o){__extends(Collection,o);function Collection(t,r,n){var i=o.call(this)||this;i._loading=!1;i._sortOnServer=!1;i._pageOnServer=!1;i._filterOnServer=!1;i._deferCommits=!1;i._hasPendingChanges=!1;i._orderBy=[];i._fieldFilters=[];i._limit=0;i.loading=new e.Event;i.loaded=new e.Event;i.error=new e.Event;i.hasPendingChangesChanged=new e.Event;i._store=t;i._name=r;e.copy(i,n);i.sortDescriptions.collectionChanged.addHandler((function(){i.sortOnServer&&!i.hasPendingChanges&&i._getData(!0)}));t.accessTokenChanged.addHandler((function(){t.accessToken&&!i.items.length&&i.load()}));i.itemsEdited.collectionChanged.addHandler(i._updateHasChanges,i);i.itemsAdded.collectionChanged.addHandler(i._updateHasChanges,i);i.itemsRemoved.collectionChanged.addHandler(i._updateHasChanges,i);i._getData();return i}Object.defineProperty(Collection.prototype,"store",{get:function(){return this._store},enumerable:!0,configurable:!0});Object.defineProperty(Collection.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0});Object.defineProperty(Collection.prototype,"fields",{get:function(){return this._fields},set:function(t){if(t!=this._fields){this._fields=e.asArray(t);this._getData(!0)}},enumerable:!0,configurable:!0});Object.defineProperty(Collection.prototype,"limit",{get:function(){return this._limit},set:function(t){if(t!=this._limit){this._limit=e.asInt(t);this._getData(!0)}},enumerable:!0,configurable:!0});Object.defineProperty(Collection.prototype,"sortOnServer",{get:function(){return this._sortOnServer},set:function(t){if(t!=this._sortOnServer){this._sortOnServer=e.asBoolean(t);this._getData(!0)}},enumerable:!0,configurable:!0});Object.defineProperty(Collection.prototype,"pageOnServer",{get:function(){return this._pageOnServer},set:function(t){if(t!=this._pageOnServer){this._pageOnServer=e.asBoolean(t);this._getData(!0)}},enumerable:!0,configurable:!0});Object.defineProperty(Collection.prototype,"filterOnServer",{get:function(){return this._filterOnServer},set:function(o){if(o!=this._filterOnServer){this._filterOnServer=e.asBoolean(o);if(t.softGridFilter()){null==Collection._filterCulture&&(Collection._filterCulture=e.culture.FlexGridFilter);if(this._filterOnServer){var r=e.culture.FlexGridFilter;r.stringOperators=r.numberOperators}else e.culture.FlexGridFilter=Collection._filterCulture}this._getData(!0)}},enumerable:!0,configurable:!0});Object.defineProperty(Collection.prototype,"deferCommits",{get:function(){return this._deferCommits},set:function(t){this._deferCommits=e.asBoolean(t);this.deferCommits&&(this.trackChanges=!0)},enumerable:!0,configurable:!0});Collection.prototype.commitChanges=function(t){var o=this;if(this.deferCommits){var r=[];this.itemsEdited.forEach((function(e){r.push({update:o._itemToDoc(e)})}));this.itemsAdded.forEach((function(e){var t=o._itemToDoc(e);t.name="projects/"+o.store.projectId+"/databases/(default)/documents/"+o.name+"/"+o._generateID();r.push({update:t})}));this.itemsRemoved.forEach((function(e){r.push({delete:e.$META.name})}));r.length&&e.httpRequest(this._getUrl(":beginTransaction"),{method:"POST",requestHeaders:this._getRequestHeaders(),success:function(n){var i=JSON.parse(n.responseText);e.httpRequest(o._getUrl(":commit"),{method:"POST",data:{writes:r,transaction:i.transaction},requestHeaders:o._getRequestHeaders(),success:function(e){o.clearChanges();o.load()},complete:function(o){e.isFunction(t)&&t(o)},error:function(e){return o._raiseError(e,!0)}})},error:function(e){return o._raiseError(e,!0)}})}};Collection.prototype.cancelChanges=function(){if(this.deferCommits){this.clearChanges();this.load()}};Object.defineProperty(Collection.prototype,"hasPendingChanges",{get:function(){return!!this.deferCommits&&(this.itemsAdded.length>0||this.itemsEdited.length>0||this.itemsRemoved.length>0)},enumerable:!0,configurable:!0});Object.defineProperty(Collection.prototype,"isLoading",{get:function(){return this._loading},enumerable:!0,configurable:!0});Collection.prototype.load=function(e){this._getData(e)};Collection.prototype.select=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.fields=e;return this};Collection.prototype.orderBy=function(t,o){void 0===o&&(o=!0);t?this._orderBy.push(new e.collections.SortDescription(e.asString(t),e.asBoolean(o))):this._orderBy=[];this._getData(!1);return this};Collection.prototype.where=function(t,o,r){if(t){switch(o.toUpperCase()){case"==":o="EQUAL";break;case"!=":o="NOT_EQUAL";break;case">":o="GREATER_THAN";break;case">=":o="GREATER_THAN_OR_EQUAL";break;case"<":o="LESS_THAN";break;case"<=":o="LESS_THAN_OR_EQUAL";break;case"IN":o="IN";e.assert(e.isArray(r),"IN operator requires array values.");break;default:e.assert(!1,"Unknown operator (should be ==, !=, >, >=, <, <=, or IN).")}for(var n=0;n<this._fieldFilters.length;n++){var i=this._fieldFilters[n].fieldFilter;if(i.field.fieldPath==t&&i.op==o){this._fieldFilters.splice(n,1);break}}this._fieldFilters.push({fieldFilter:{field:{fieldPath:t},op:o,value:this._getValueObject(r)}})}else this._fieldFilters=[];this._getData(!1);return this};Collection.prototype.getSubCollection=function(t,o,r){e.assert(e.isObject(t)&&null!=t.$META,"invalid parent item");var n=new Collection(this.store,o,r);n._parentItem=t;return n};Collection.prototype.onLoading=function(e){this.loading.raise(this,e);return!e.cancel};Collection.prototype.onLoaded=function(e){this.loaded.raise(this,e)};Collection.prototype.onError=function(e){if(this._loading){this._loading=!1;this.onLoaded()}this.error.raise(this,e);return!e.cancel};Collection.prototype.onHasPendingChangesChanged=function(e){this.hasPendingChangesChanged.raise(this,e)};Object.defineProperty(Collection.prototype,"totalItemCount",{get:function(){var e=this._totalCount;return this.pageOnServer?null!=e?e:1e9:this._view?this._view.length:0},set:function(t){this._totalCount=e.asInt(t)},enumerable:!0,configurable:!0});Object.defineProperty(Collection.prototype,"pageCount",{get:function(){return this.pageSize?Math.ceil(this.totalItemCount/this.pageSize):1},enumerable:!0,configurable:!0});Object.defineProperty(Collection.prototype,"pageSize",{get:function(){return this._pgSz},set:function(t){if(t!=this._pgSz){this._pgSz=e.asInt(t);if(this.pageOnServer){this._pgIdx=e.clamp(this._pgIdx,0,this.pageCount-1);this._getData(!0)}else this.refresh()}},enumerable:!0,configurable:!0});Collection.prototype.onPageChanging=function(e){o.prototype.onPageChanging.call(this,e);!e.cancel&&this.pageOnServer&&(0==this.pageIndex&&0==this.items.length?e.cancel=!0:this._getData(!0));return!e.cancel};Collection.prototype.commitNew=function(){var t=this;if(!this.deferCommits){var r=this.currentAddItem;if(r){var n=this._itemToDoc(r);e.httpRequest(this._getUrl(),{method:"POST",data:{fields:n.fields},requestHeaders:this._getRequestHeaders(),success:function(o){var n=JSON.parse(o.responseText);t._saveDocName(n,r);e.isNumber(t._totalCount)&&t._totalCount++},error:function(e){return t._raiseError(e,!0)}})}}o.prototype.commitNew.call(this)};Collection.prototype.commitEdit=function(){var t=this;if(!this.deferCommits){var r=this.currentEditItem;if(r&&!this.currentAddItem&&this._getChangedFields(r,this._edtClone)){var n=this._itemToDoc(r);e.httpRequest(this._getUrl(n),{method:"PATCH",data:{fields:n.fields},requestHeaders:this._getRequestHeaders(),error:function(e){return t._raiseError(e,!0)}})}}o.prototype.commitEdit.call(this)};Collection.prototype.remove=function(t){var r=this;if(!this.deferCommits&&t&&t!=this.currentAddItem){var n=this._itemToDoc(t);e.httpRequest(this._getUrl(n),{method:"DELETE",requestHeaders:this._getRequestHeaders(),success:function(t){e.isNumber(r._totalCount)&&r._totalCount--},error:function(e){return r._raiseError(e,!0)}})}o.prototype.remove.call(this,t)};Collection.prototype.updateFilterDefinition=function(e){this._filterProvider=null;if(this.filterOnServer&&t.softGridFilter()&&e instanceof t.softGridFilter().FlexGridFilter){this._filterProvider=e;this._totalCount=null;this.moveCurrentToFirst();this._getData(!0)}};Collection.prototype._getPageView=function(){return this.pageOnServer?this._view:o.prototype._getPageView.call(this)};Collection.prototype._generateID=function(){for(var e="";e.length<20;)e+=Math.random().toString(36).substr(2,5);return e};Collection.prototype._updateHasChanges=function(){var e=this.hasPendingChanges;if(e!=this._hasPendingChanges){this._hasPendingChanges=e;this.onHasPendingChangesChanged()}};Collection.prototype._getData=function(t){var o=this;this._toGetData&&clearTimeout(this._toGetData);this._toGetData=setTimeout((function(){o._toGetData=null;o._loading=!0;if(o.onLoading(new e.CancelEventArgs)){var r=o.currentPosition;e.httpRequest(o._getUrl(":runQuery"),{method:"POST",data:o._getQuery(),requestHeaders:o._getRequestHeaders(),success:function(e){var n=JSON.parse(e.responseText),i=o._parseData(n),s=o.pageSize;if(o.pageOnServer&&s&&i.length<s){var a=n[0].skippedResults||0;o._totalCount=a+i.length;if(0==i.length&&o.pageIndex>0){o.moveToLastPage();return}}o.sourceCollection=i;t&&o.moveCurrentToPosition(r);o._loading=!1;o.onLoaded()},error:function(e){return o._raiseError(e,!1)}})}}),e.Control._REFRESH_INTERVAL)};Collection.prototype._getQuery=function(){var e={from:[{collectionId:this.name}]};this.fields&&this.fields.length&&(e.select={fields:this.fields.map((function(e){return{fieldPath:e}}))});var t=this._fieldFilters;!t.length&&this._filterProvider&&this.filterOnServer&&(t=this._getQueryFilters());t&&t.length&&(e.where=1==t.length?t[0]:{compositeFilter:{filters:t,op:"AND"}});var o=[];t&&t.length&&t.forEach((function(e){var t=e.fieldFilter;"IN"!=t.op&&"EQUAL"!=t.op&&o.push({field:t.field.fieldPath,asc:!0})}));this._orderBy.forEach((function(e){o.push({field:e.property,asc:e.ascending})}));!o.length&&this.sortOnServer&&this.sortDescriptions.forEach((function(e){o.push({field:e.property,asc:e.ascending})}));o.length&&(e.orderBy=o.map((function(e){return{field:{fieldPath:e.field},direction:e.asc?"ASCENDING":"DESCENDING"}})));var r=this.pageSize;if(this.pageOnServer&&r){e.limit=r;e.offset=r*this.pageIndex}!e.limit&&this.limit>0&&(e.limit=this.limit);return{structuredQuery:e}};Collection.prototype._parseData=function(t){var o=this,r=[];e.isArray(t)&&t.forEach((function(e){var t=o._docToItem(e);t&&r.push(t)}));return r};Collection.prototype._raiseError=function(t,o){this.onError(new e.RequestErrorEventArgs(t));o&&this._getData(!0)};Collection.prototype._saveDocName=function(e,t){if(e.name&&!t.$META){t.$META={name:e.name};return!0}return!1};Collection.prototype._docToItem=function(e){e.name||(e=e.document);if(!e||!e.name)return null;var t={};this._saveDocName(e,t);for(var o in e.fields)t[o]=this._getDocValue(e.fields[o]);return t};Collection.prototype._getDocValue=function(e){var t=this,o=null;for(var r in e){o=e[r];switch(r){case"integerValue":o=parseInt(o);break;case"timestampValue":o=new Date(o);break;case"mapValue":var n={};for(var i in o.fields)n[i]=this._getDocValue(o.fields[i]);o=n;break;case"arrayValue":o=o.values?o.values.map((function(e){return t._getDocValue(e)})):[]}}return o};Collection.prototype._itemToDoc=function(e){var t={},o=e.$META,r=this.calculatedFields;o&&o.name&&(t.name=o.name);t.fields={};for(var n in e)r&&n in r||"$META"!=n&&(t.fields[n]=this._getValueObject(e[n]));return t};Collection.prototype._getValueObject=function(t){var o=this,r={},n=e.DataType;switch(e.getType(t)){case n.String:r.stringValue=t;break;case n.Boolean:r.booleanValue=t;break;case n.Date:r.timestampValue=t.toJSON();break;case n.Number:t==Math.round(t)?r.integerValue=t.toString():r.doubleValue=t;break;case n.Array:r.arrayValue={values:t.map((function(e){return o._getValueObject(e)}))};break;case n.Object:var i={};for(var s in t)i[s]=this._getValueObject(t[s]);r.mapValue={fields:i};break;default:e.assert(!1,"failed to create value object.")}return r};Collection.prototype._getRequestHeaders=function(){var e={},t=this.store._fbToken||this.store.accessToken;t&&(e.Authorization="Bearer "+t);return e};Collection.prototype._getUrl=function(t){var o="https://firestore.googleapis.com/v1/";if(e.isObject(t)&&t.name)return o+t.name;t||(t="/"+this.name);return o+(this._parentItem?this._parentItem.$META.name:"projects/"+this.store.projectId+"/databases/(default)/documents")+t};Collection.prototype._getQueryFilters=function(){var e=[],o=this._filterProvider;if(t.softGridFilter()&&o instanceof t.softGridFilter().FlexGridFilter)for(var r=0;r<o.grid.columns.length;r++){var n=o.grid.columns[r],i=o.getColumnFilter(n,!1);if(i&&i.isActive){i.conditionFilter&&i.conditionFilter.isActive?this._getQueryConditionFilter(e,i.conditionFilter):i.valueFilter&&i.valueFilter.isActive&&this._getQueryValueFilter(e,i.valueFilter);break}}return e};Collection.prototype._getQueryConditionFilter=function(e,t){var o=t.column.binding,r=this._getQuerySimpleFilter(t.condition1,o),n=this._getQuerySimpleFilter(t.condition2,o);r&&n&&t.and?e.push({compositeFilter:{op:t.and?"AND":"OR",filters:[r,n]}}):r?e.push(r):n&&e.push(n)};Collection.prototype._getQuerySimpleFilter=function(e,o){if(e.isActive){var r=t.softGridFilter().Operator;return e.operator==r.BW?{compositeFilter:{op:"AND",filters:[{fieldFilter:{field:{fieldPath:o},op:"GREATER_THAN_OR_EQUAL",value:this._getValueObject(e.value)}},{fieldFilter:{field:{fieldPath:o},op:"LESS_THAN",value:this._getValueObject(e.value+"")}}]}}:{fieldFilter:{field:{fieldPath:o},op:this._getFilterOperator(e.operator),value:this._getValueObject(e.value)}}}return null};Collection.prototype._getFilterOperator=function(o){var r=t.softGridFilter().Operator;switch(o){case r.EQ:return"EQUAL";case r.NE:return"NOT_EQUAL";case r.GE:return"GREATER_THAN_OR_EQUAL";case r.GT:return"GREATER_THAN";case r.LE:return"LESS_THAN_OR_EQUAL";case r.LT:return"LESS_THAN"}e.assert(!1,r[o]+" operator not supported (use EQ, NE, GT, GE, LT, or LE)")};Collection.prototype._getQueryValueFilter=function(t,o){var r=o.column,n=r.dataMap,i=[];for(var s in o.showValues){var a=e.changeType(s,r.dataType,r.format);n&&e.isString(a)&&(a=n.getKeyValue(a));i.push(a);if(i.length>=10)break}i.length&&t.push({fieldFilter:{field:{fieldPath:r.binding},op:"IN",value:this._getValueObject(i)}})};Collection._filterCulture=null;return Collection}(e.collections.CollectionView);t.Collection=o}(e.cloud||(e.cloud={}))}(wijmo||(wijmo={}));!function(e){e.cloud||(e.cloud={}),e._registerModule("wijmo.cloud",e.cloud)}(wijmo||(wijmo={}));